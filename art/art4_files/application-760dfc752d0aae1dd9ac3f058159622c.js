/*!
 * jQuery JavaScript Library v1.11.1
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-05-01T17:42Z
 */
function $A(e){if(!e)return[];if("toArray"in Object(e))return e.toArray();for(var t=e.length||0,n=new Array(t);t--;)n[t]=e[t];return n}function $w(e){return Object.isString(e)?(e=e.strip(),e?e.split(/\s+/):[]):[]}function $H(e){return new Hash(e)}function $R(e,t,n){return new ObjectRange(e,t,n)}function $(e){if(arguments.length>1){for(var t=0,n=[],i=arguments.length;i>t;t++)n.push($(arguments[t]));return n}return Object.isString(e)&&(e=document.getElementById(e)),Element.extend(e)}function hex_md5(e){return binl2hex(core_md5(str2binl(e),e.length*chrsz))}function b64_md5(e){return binl2b64(core_md5(str2binl(e),e.length*chrsz))}function str_md5(e){return binl2str(core_md5(str2binl(e),e.length*chrsz))}function hex_hmac_md5(e,t){return binl2hex(core_hmac_md5(e,t))}function b64_hmac_md5(e,t){return binl2b64(core_hmac_md5(e,t))}function str_hmac_md5(e,t){return binl2str(core_hmac_md5(e,t))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n=1732584193,i=-271733879,o=-1732584194,r=271733878,s=0;s<e.length;s+=16){var a=n,l=i,c=o,u=r;n=md5_ff(n,i,o,r,e[s+0],7,-680876936),r=md5_ff(r,n,i,o,e[s+1],12,-389564586),o=md5_ff(o,r,n,i,e[s+2],17,606105819),i=md5_ff(i,o,r,n,e[s+3],22,-1044525330),n=md5_ff(n,i,o,r,e[s+4],7,-176418897),r=md5_ff(r,n,i,o,e[s+5],12,1200080426),o=md5_ff(o,r,n,i,e[s+6],17,-1473231341),i=md5_ff(i,o,r,n,e[s+7],22,-45705983),n=md5_ff(n,i,o,r,e[s+8],7,1770035416),r=md5_ff(r,n,i,o,e[s+9],12,-1958414417),o=md5_ff(o,r,n,i,e[s+10],17,-42063),i=md5_ff(i,o,r,n,e[s+11],22,-1990404162),n=md5_ff(n,i,o,r,e[s+12],7,1804603682),r=md5_ff(r,n,i,o,e[s+13],12,-40341101),o=md5_ff(o,r,n,i,e[s+14],17,-1502002290),i=md5_ff(i,o,r,n,e[s+15],22,1236535329),n=md5_gg(n,i,o,r,e[s+1],5,-165796510),r=md5_gg(r,n,i,o,e[s+6],9,-1069501632),o=md5_gg(o,r,n,i,e[s+11],14,643717713),i=md5_gg(i,o,r,n,e[s+0],20,-373897302),n=md5_gg(n,i,o,r,e[s+5],5,-701558691),r=md5_gg(r,n,i,o,e[s+10],9,38016083),o=md5_gg(o,r,n,i,e[s+15],14,-660478335),i=md5_gg(i,o,r,n,e[s+4],20,-405537848),n=md5_gg(n,i,o,r,e[s+9],5,568446438),r=md5_gg(r,n,i,o,e[s+14],9,-1019803690),o=md5_gg(o,r,n,i,e[s+3],14,-187363961),i=md5_gg(i,o,r,n,e[s+8],20,1163531501),n=md5_gg(n,i,o,r,e[s+13],5,-1444681467),r=md5_gg(r,n,i,o,e[s+2],9,-51403784),o=md5_gg(o,r,n,i,e[s+7],14,1735328473),i=md5_gg(i,o,r,n,e[s+12],20,-1926607734),n=md5_hh(n,i,o,r,e[s+5],4,-378558),r=md5_hh(r,n,i,o,e[s+8],11,-2022574463),o=md5_hh(o,r,n,i,e[s+11],16,1839030562),i=md5_hh(i,o,r,n,e[s+14],23,-35309556),n=md5_hh(n,i,o,r,e[s+1],4,-1530992060),r=md5_hh(r,n,i,o,e[s+4],11,1272893353),o=md5_hh(o,r,n,i,e[s+7],16,-155497632),i=md5_hh(i,o,r,n,e[s+10],23,-1094730640),n=md5_hh(n,i,o,r,e[s+13],4,681279174),r=md5_hh(r,n,i,o,e[s+0],11,-358537222),o=md5_hh(o,r,n,i,e[s+3],16,-722521979),i=md5_hh(i,o,r,n,e[s+6],23,76029189),n=md5_hh(n,i,o,r,e[s+9],4,-640364487),r=md5_hh(r,n,i,o,e[s+12],11,-421815835),o=md5_hh(o,r,n,i,e[s+15],16,530742520),i=md5_hh(i,o,r,n,e[s+2],23,-995338651),n=md5_ii(n,i,o,r,e[s+0],6,-198630844),r=md5_ii(r,n,i,o,e[s+7],10,1126891415),o=md5_ii(o,r,n,i,e[s+14],15,-1416354905),i=md5_ii(i,o,r,n,e[s+5],21,-57434055),n=md5_ii(n,i,o,r,e[s+12],6,1700485571),r=md5_ii(r,n,i,o,e[s+3],10,-1894986606),o=md5_ii(o,r,n,i,e[s+10],15,-1051523),i=md5_ii(i,o,r,n,e[s+1],21,-2054922799),n=md5_ii(n,i,o,r,e[s+8],6,1873313359),r=md5_ii(r,n,i,o,e[s+15],10,-30611744),o=md5_ii(o,r,n,i,e[s+6],15,-1560198380),i=md5_ii(i,o,r,n,e[s+13],21,1309151649),n=md5_ii(n,i,o,r,e[s+4],6,-145523070),r=md5_ii(r,n,i,o,e[s+11],10,-1120210379),o=md5_ii(o,r,n,i,e[s+2],15,718787259),i=md5_ii(i,o,r,n,e[s+9],21,-343485551),n=safe_add(n,a),i=safe_add(i,l),o=safe_add(o,c),r=safe_add(r,u)}return Array(n,i,o,r)}function md5_cmn(e,t,n,i,o,r){return safe_add(bit_rol(safe_add(safe_add(t,e),safe_add(i,r)),o),n)}function md5_ff(e,t,n,i,o,r,s){return md5_cmn(t&n|~t&i,e,t,o,r,s)}function md5_gg(e,t,n,i,o,r,s){return md5_cmn(t&i|n&~i,e,t,o,r,s)}function md5_hh(e,t,n,i,o,r,s){return md5_cmn(t^n^i,e,t,o,r,s)}function md5_ii(e,t,n,i,o,r,s){return md5_cmn(n^(t|~i),e,t,o,r,s)}function core_hmac_md5(e,t){var n=str2binl(e);n.length>16&&(n=core_md5(n,e.length*chrsz));for(var i=Array(16),o=Array(16),r=0;16>r;r++)i[r]=909522486^n[r],o[r]=1549556828^n[r];var s=core_md5(i.concat(str2binl(t)),512+t.length*chrsz);return core_md5(o.concat(s),640)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function bit_rol(e,t){return e<<t|e>>>32-t}function str2binl(e){for(var t=Array(),n=(1<<chrsz)-1,i=0;i<e.length*chrsz;i+=chrsz)t[i>>5]|=(e.charCodeAt(i/chrsz)&n)<<i%32;return t}function binl2str(e){for(var t="",n=(1<<chrsz)-1,i=0;i<32*e.length;i+=chrsz)t+=String.fromCharCode(e[i>>5]>>>i%32&n);return t}function binl2hex(e){for(var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>i%4*8+4&15)+t.charAt(e[i>>2]>>i%4*8&15);return n}function binl2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=0;i<4*e.length;i+=3)for(var o=(e[i>>2]>>8*(i%4)&255)<<16|(e[i+1>>2]>>8*((i+1)%4)&255)<<8|e[i+2>>2]>>8*((i+2)%4)&255,r=0;4>r;r++)n+=8*i+6*r>32*e.length?b64pad:t.charAt(o>>6*(3-r)&63);return n}function closePrototips(){$$(".prototip").each(function(e){e.hide()})}function commentFormSubmitting(e){e&&($j("#comment_form_error").hide(),$j("#errorExplanation").hide()),$j("#comment_form_saving").toggle(e),$j("#comment_form_saving2").toggle(e)}function commentFormSaveError(e){var t=e.responseText?e.responseText:"";commentFormSubmitting(!1),$j("#comment_form_error_detail").text(t),$j("#comment_form_error").show()}function shareOnTwitter(e){Lightbox.showBoxByID("publishTwitterReview_"+e)}function submitShelfButton(e,t,n,i,o,r){var s=new SubmitShelfButtonHandler(e,t,n,i,o,r);s.sendRequest()}function onVote(e,t){document.getElementById("yes_link"+e).style.color=1==t?"#d7d7d7":"#006699"}function checkAll(form,uncheck){for(form=eval("document."+form),i=0;i<form.length;i++)"checkbox"==form[i].type&&(form[i].checked=uncheck?"":"checked")}function onInviteChooseSubmit(e){var t=countChecked("scraperInvites",!0),n=countChecked("scraperInvites",!1);if(t>e||0==n){try{Element.show("inviteConfirm"),Element.update("inviteConfirmCount",t+" ")}catch(i){return confirm("Are you sure you would like to invite all the checked contacts?")}return!1}return!0}function countChecked(form,countChecked){null==countChecked&&(countChecked=!0);var count=0;for(form=eval("document."+form),i=0;i<form.length;i++)"checkbox"==form[i].type&&(form[i].checked&&countChecked||!form[i].checked&&!countChecked)&&count++;return count}function isYahooEmail(e){try{return e?/yahoo.com$/.test(e):!1}catch(t){return!1}}function hideScraperPasswordField(e,t,n,i,o,r){var s=isYahooEmail(t.value)&&r,a=n.up("tr");s?(e.down("form").onsubmit=function(){return YahooOauthPopup.open()},"yahoo_scraper"!=o.value&&(o.oldValue=o.value,o.value="yahoo_scraper"),a.hide(),a.next().down("input").value="find friends"):(e.down("form").onsubmit=null,o.oldValue&&(o.value=o.oldValue),a.show(),a.next().down("input").value="next"),i.value=s}function setScraper(e,t){var n=e.replace("_scraper",""),i=$(e).innerHTML,o=$("display_scraper");o.innerHTML=i;var n=$("service");n.value=e;var r=$("scraper_email"),s=$("scraper_password"),a=$("use_service");if(null!=r){try{r.focus()}catch(l){}r.observe("keyup",function(e){hideScraperPasswordField(o,r,s,a,n,t)})}if(hideScraperPasswordField(o,r,s,a,n,t),""!=$("scraper_email").value)try{s.focus()}catch(c){}}function updateMoreLink(e){var t=$j("#freeText"+e),n=$j("#freeTextContainer"+e),i=t.parents("#other_reviews").length>0,o=t.parents(".review").eq(-1),r=null,s=$j("#bookReviewControls").data("book-reviews-page");o.length&&(r=o.attr("id").replace(/review_/g,"")),t.show(),n.hide(),t.has("a.showMoreReviewText")&&i&&$j.post("/track_conversion_action",{event:"expanded_review",options:{experiments:"review_interaction_tracking",multiple:!0,review_page:s,review_id:r}})}function countChars(e,t){var n=Event.element(e),i=parseInt(n.getAttribute("maxlength"))-n.value.length;t=t||"characterCount";var o=t.match(/^[#\.]/)?$$(t)[0]:$(t);o.innerHTML=i+" characters left"}function chopChars(e){var t=Event.element(e),n=parseInt(t.getAttribute("maxlength"));return 0>=n?void alert("maxlength was not defined!"):(t.value=t.value.slice(0,n-1),!0)}function onTableRowClick(checkbox_name,row_id){element=eval(checkbox_name),element.checked=element.checked?"":"checked",row=document.getElementById(row_id);for(var i=0;i<row.cells.length;i++)row.cells[i].style.backgroundColor=element.checked?"#EBE8D5":"white"}function onTableRowHover(checkbox_name,row_id,over){if(element=eval(checkbox_name),!element.checked){row=document.getElementById(row_id);for(var i=0;i<row.cells.length;i++)row.cells[i].style.backgroundColor=over?"#EBE8D5":"white"}}function setReadAt(e){var e=e||{};if(e.field_id_prefix=e.field_id_prefix||"review_read_at",!e.parent&&e.link&&(e.parent=$(e.link).up(".formField")||$(e.link).up("form")),e.parent)var t=$(e.parent).down("#"+e.field_id_prefix+"_1i"),n=$(e.parent).down("#"+e.field_id_prefix+"_2i"),i=$(e.parent).down("#"+e.field_id_prefix+"_3i");else var t=$(e.field_id_prefix+"_1i"),n=$(e.field_id_prefix+"_2i"),i=$(e.field_id_prefix+"_3i");if(e.clear)t.setValue(0),n.setValue(0),i.setValue(0);else{if(e.date&&"string"==typeof e.date){var o=e.date.match(/(\d+)-(\d+)-(\d+)/);if(o){var r=parseInt(o[1]),s=parseInt(o[2].replace(/^0+/,""))-1,a=parseInt(o[3].replace(/^0+/,""));e.date=new Date(r,s,a)}else e.date=new Date(e.date)}var l=e.date?e.date:new Date;t.setValue(l.getYear()+(l.getYear()<1900?1900:0)),n.setValue(l.getMonth()+1),i.setValue(l.getDate())}t.down(t.selectedIndex).setAttribute("selected","selected"),n.down(n.selectedIndex).setAttribute("selected","selected"),i.down(i.selectedIndex).setAttribute("selected","selected")}function readingProgressChanged(){var e=document.user_status_form,t=e.user_status_book_id;e.user_status_body.value="",e.user_status_body.className="",e.user_status_page.value="",e.user_status_percent.value="",t&&"0"==t.value?(Element.hide("user_status_page_container"),Element.hide("user_status_percent_container")):(Element.show("user_status_page_container"),Element.hide("user_status_percent_container"))}function keyPressWithoutSubmit(e,t,n){var i;return window.event?i=t.keyCode:t.which&&(i=t.which),i==Event.KEY_RETURN?("function"==typeof n&&n(e,t),!1):!0}function addSortable(e,t){Event.observe(window,"load",function(){Sortable.create(e,{onUpdate:function(n){new Ajax.Request(t,{parameters:Sortable.serialize(e),onLoading:function(){$$(".sortable_controls input").invoke("hide"),$$(".sortable_controls .position_loading").invoke("show")},onComplete:function(){$$(".sortable_controls input").invoke("show"),$$(".sortable_controls .position_loading").invoke("hide")}})}}),window.originalSequence=Sortable.sequence(e)})}function commaFormatted(e){e=e.toString();var t=",",n=e.split(".",2),i=n[1],o=parseInt(n[0]);if(isNaN(o))return"";var r="";0>o&&(r="-"),o=Math.abs(o);for(var s=new String(o),n=[];s.length>3;){var a=s.substr(s.length-3);n.unshift(a),s=s.substr(0,s.length-3)}return s.length>0&&n.unshift(s),s=n.join(t),e=!i||i.length<1?s:s+"."+i,e=r+e}function luhn_check(e){var e=e.replace(/\D/g,""),t=e.length,n=t%2,o=0;for(i=0;i<t;i++){var r=e.charAt(i);i%2==n&&(r=2*r,r>9&&(r-=9)),o+=parseInt(r)}return o%10==0?!0:!1}function toggleRadioExtras(e,t,n){if("undefined"==typeof t)var t="radioExtra";"undefined"==typeof n?$$("."+t).invoke("hide"):n.descendants().each(function(e){e.match("."+t)&&e.hide()});var i=$(e).next("."+t);"undefined"!=typeof i&&i.show()}function toShelfName(e){var t=e.toLowerCase().replace(/\W/g,"-");return t=t.replace(/\-+$/,"").slice(0,35)}function saveShelfPosition(e){var t=$("positions_"+e).value;new Ajax.Request("/shelf/move_to_position/",{parameters:{id:e,position:t},onLoading:function(){$("position_loading_"+e).show(),$("positions_"+e).hide(),Tips.hideAll()},onComplete:function(t){$("moveToPosEdit"+e).hide(),Tips.hideAll()},onFailure:function(){alert("Something went wrong re-ordering those shelves.")}})}function renderRatingGraph(e){if(Prototype.Browser.IE)return null;var t=16,n=15,i=$A(e).max(),o=(new pv.Panel).width(t).height(n);return o.add(pv.Bar).data(e).top(function(){return 3*this.index}).width(function(e){return t*e/i}).height(2).left(0).fillStyle("#215625"),o.render(),o}function afterShelfSave(e,t,n,i){document.getElementById(e);Element.update(t,i),Element.hide("add_button_"+n),Element.show("added_message_"+n),"function"==typeof afterShelfSaveCallback&&afterShelfSaveCallback.apply(this,arguments)}function refreshGroupBoxComplete(e,t){Element.update("addGroupBooks"+t,e.responseText)}function addShelfRequest(e,t){var n="/shelf/add_to_shelf/?book_id="+t;return _shelfRequest(n,"name",t,e)}function newShelfRequest(e,t,n){var i="/user_shelf"+e;return _shelfRequest(i,"user_shelf[name]",t,n||e)}function ignoreSuggestion(e){var t,n="/friend/ignore_ajax";return null!=$("maxSuggestionId")&&(t=$("maxSuggestionId").value),new Ajax.Request(n,{method:"get",asynchronous:!0,parameters:{id:e,max_id:t},onLoading:function(){$("add_link_"+e).hide(),$("loading_"+e).show()}}),!1}function _shelfRequest(e,t,n,i){var o=$("addShelfAjaxForm"+n);return o||(o=$("addShelfForm"+i)),new Ajax.Request(e,{asynchronous:!0,evalScripts:!0,onComplete:function(e){o&&o.update("refreshing shelves..."),updateShelfSelect(i,n)},onLoading:function(e){o&&o.update("saving...")},parameters:t+"="+$("newShelfField"+i).value}),!1}function isShowingBuyableFeatures(){return source=Cookies.get("source"),-1==$j.inArray(source,sourcesToHideBuyFeatures)}function showBuyableFeatures(){isShowingBuyableFeatures()&&$j(".buyableFeature").removeClass("buyableFeature")}function select_all_suspicious_users(){alert("Careful. You are about to select every suspicious user on this page."),$j("#usersCreatedRecently .userDeleteCheckbox.suspicious").each(function(e){e.writeAttribute("checked",!0),e.up("tr").highlight()})}function deselect_all_users(){$j("#usersCreatedRecently .userDeleteCheckbox").each(function(e){e.writeAttribute("checked",!1),e.up("tr").highlight()})}function updateSpamResultItemStyling(){$j(".spamResultItemCheckbox").each(function(){this.checked?$j(this).closest("li").first().addClass("selectedItem"):$j(this).closest("li").first().removeClass("selectedItem")})}function disable_subcategories(){$j("#subcategories").hide(),$j("#subcategories select").hide().attr("disabled","disabled")}function set_subcategory_for_category(e){var t=e.replace(/[^a-z0-9]/gi,""),n=$j("#book_blog_subcategory_"+t);disable_subcategories(),""!=n.html().strip()&&(n.removeAttr("disabled").show(),$j("#subcategories").show())}function update_page_after_vote(e,t){var n=$j(e),i=n.attr("data-category"),o=$j('img[data-category="'+i+'"]');if(n.next("img").hide(),t){n.html("Vote").removeClass("changeVote").addClass("castVote"),n.attr("href",n.attr("href").gsub("/unvote","/vote")),n.prev(".voted").remove(),o.hide();var r=1}else{n.html("Change Your Vote").removeClass("castVote").addClass("changeVote"),n.attr("href",n.attr("href").gsub("/vote","/unvote")),$j("<p>").addClass("voted").html("You voted for this "+i.replace(/&/g,"&amp;")+" blog.").insertBefore(n),o.show();var r=-1}var s=$j('a.castVote[data-category="'+i+'"]');t?s.removeClass("disabled"):s.addClass("disabled");var a=$j("#voteCount"),l=parseInt(a.html())+r;a.html(String(l)+" vote"+(1==l?"":"s"))}function handle_vote_click(e,t){e.preventDefault();var n=e.target;$j(n).hasClass("disabled")||($j(n).next("img").show(),$j.post("/book_blogger_award/"+(t?"un":"")+"vote",{entry_id:$j(n).attr("data-id")},function(e){update_page_after_vote(n,t)},"script"))}function enableAll(e){$$(e).each(function(e){e.enableButtons()})}function changeQuote(){var e=$("quotes");if(null!=e){var t=e.childElements();null!=t&&(t[selected_quote].fade(),selected_quote=(selected_quote+1)%t.size(),setTimeout(function(){t[selected_quote].appear()},900))}}function submitMetadataAnswer(e,t){link_text=$("submit_"+e).innerHTML,iVote=parseInt(link_text),new Ajax.Request(t,{parameters:{wm:e},onSuccess:function(t){acText=$("answer_counter_"+e).innerHTML,newText=(parseInt(acText)+iVote).toString(),$("answer_counter_"+e).innerHTML=newText,"0"==newText&&$("answer_line_"+e).hide(),newLink=-1==iVote?"+1":"-1",$("submit_"+e).innerHTML=newLink,t.responseText.length>0&&(old_id=parseInt(t.responseText),oldLink=-1==iVote?"-1":"+1",$("submit_"+old_id).innerHTML=oldLink,oldText=(parseInt($("answer_counter_"+old_id).innerHTML)+-1*iVote).toString(),$("answer_counter_"+old_id).innerHTML=oldText,"0"==oldText&&$("answer_line_"+old_id).hide())}})}function quizFriendInviteSuccess(e){e.replaceWith("<span class=friendInviteSuccess>invite sent</span>")}function getGenre(){var e=location.hash.replace("#","");return""==e?null:e}function setGenre(e){location.hash=e}function activateRateBooksMoreGenreLnk(){var e=$("rateBooksMoreGenreLnk");null!=e&&e.observe("click",function(t){e.hide(),$("moreGenreLoading").show(),new Ajax.Request(e.href,{method:"GET"}),t.stop()})}function rateBooksToGenre(e,t){new Ajax.Request(t,{method:"GET",onLoading:function(){setGenre(e),window.scroll(0,0),$("rateBooksList").update("<div class='loadingPageImage'></div>"),$$(".navRow a").each(function(e){e.removeClassName("selected")}),$("nav_to_"+e).addClassName("selected")},onComplete:function(){activateRateBooksMoreGenreLnk(),"amazon_purchase_import"===e&&updateAmazonPurchaseImportUI(),WantToRead.resetShelfMenuStored()}})}function swapContent(e){var t=$j(e).data("text-id"),n=$j(e).siblings("#freeTextContainer"+t),i=$j(e).siblings("#freeText"+t);"none"==n.css("display")?swapElements(n,i,e):"none"==i.css("display")&&swapElements(i,n,e)}function swapElements(e,t,n){e.show(),t.hide(),"...more"==$j(n).text()?$j(n).text("(less)"):$j(n).text("...more")}function activateUndoNoRecsLink(e){e.observe("click",function(t){e.hide(),e.up("div").down("img.loading").show(),e.up("form").request(),t.stop()})}function showRenameForm(e){var t=e.closest(".displayShelfName"),n=t.parent(),i=n.find(".renameUserShelf");t.hide(),i.show()}function hideRenameForm(e){var t=e.closest(".renameUserShelf"),n=t.parent(),i=n.find(".displayShelfName");t.hide(),i.show()}function submitRenameShelf(e){var t=e.find(".renameUserShelfTxt"),n=t.val();null!=n&&""!=n&&jQuery.post(e.attr("action"),e.serialize(),function(){hideRenameForm(e)})}function activateExpandDetailsLinks(){$$(".workEditions .detailsLink").each(function(e){e.observe("click",function(t){return editionDataElem=e.up(".editionData"),moreDetailsElem=editionDataElem.down(".moreDetails"),moreDetailsElem.hasClassName("hideDetails")?(moreDetailsElem.removeClassName("hideDetails"),e.update("less detail")):(moreDetailsElem.addClassName("hideDetails"),e.update("more detail")),t.stop(),!1})})}!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=e.length,n=oe.type(e);return"function"===n||oe.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,n){if(oe.isFunction(t))return oe.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return oe.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(de.test(t))return oe.filter(t,e,n);t=oe.filter(t,e)}return oe.grep(e,function(e){return oe.inArray(e,t)>=0!==n})}function o(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function r(e){var t=we[e]={};return oe.each(e.match(ye)||[],function(e,n){t[n]=!0}),t}function s(){pe.addEventListener?(pe.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1)):(pe.detachEvent("onreadystatechange",a),e.detachEvent("onload",a))}function a(){(pe.addEventListener||"load"===event.type||"complete"===pe.readyState)&&(s(),oe.ready())}function l(e,t,n){if(void 0===n&&1===e.nodeType){var i="data-"+t.replace(ke,"-$1").toLowerCase();if(n=e.getAttribute(i),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:_e.test(n)?oe.parseJSON(n):n}catch(o){}oe.data(e,t,n)}else n=void 0}return n}function c(e){var t;for(t in e)if(("data"!==t||!oe.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(e,t,n,i){if(oe.acceptData(e)){var o,r,s=oe.expando,a=e.nodeType,l=a?oe.cache:e,c=a?e[s]:e[s]&&s;if(c&&l[c]&&(i||l[c].data)||void 0!==n||"string"!=typeof t)return c||(c=a?e[s]=Y.pop()||oe.guid++:s),l[c]||(l[c]=a?{}:{toJSON:oe.noop}),("object"==typeof t||"function"==typeof t)&&(i?l[c]=oe.extend(l[c],t):l[c].data=oe.extend(l[c].data,t)),r=l[c],i||(r.data||(r.data={}),r=r.data),void 0!==n&&(r[oe.camelCase(t)]=n),"string"==typeof t?(o=r[t],null==o&&(o=r[oe.camelCase(t)])):o=r,o}}function h(e,t,n){if(oe.acceptData(e)){var i,o,r=e.nodeType,s=r?oe.cache:e,a=r?e[oe.expando]:oe.expando;if(s[a]){if(t&&(i=n?s[a]:s[a].data)){oe.isArray(t)?t=t.concat(oe.map(t,oe.camelCase)):t in i?t=[t]:(t=oe.camelCase(t),t=t in i?[t]:t.split(" ")),o=t.length;for(;o--;)delete i[t[o]];if(n?!c(i):!oe.isEmptyObject(i))return}(n||(delete s[a].data,c(s[a])))&&(r?oe.cleanData([e],!0):ne.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function d(){return!0}function f(){return!1}function p(){try{return pe.activeElement}catch(e){}}function m(e){var t=Fe.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function g(e,t){var n,i,o=0,r=typeof e.getElementsByTagName!==Ce?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==Ce?e.querySelectorAll(t||"*"):void 0;if(!r)for(r=[],n=e.childNodes||e;null!=(i=n[o]);o++)!t||oe.nodeName(i,t)?r.push(i):oe.merge(r,g(i,t));return void 0===t||t&&oe.nodeName(e,t)?oe.merge([e],r):r}function v(e){Ae.test(e.type)&&(e.defaultChecked=e.checked)}function b(e,t){return oe.nodeName(e,"table")&&oe.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function y(e){return e.type=(null!==oe.find.attr(e,"type"))+"/"+e.type,e}function w(e){var t=Je.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function S(e,t){for(var n,i=0;null!=(n=e[i]);i++)oe._data(n,"globalEval",!t||oe._data(t[i],"globalEval"))}function x(e,t){if(1===t.nodeType&&oe.hasData(e)){var n,i,o,r=oe._data(e),s=oe._data(t,r),a=r.events;if(a){delete s.handle,s.events={};for(n in a)for(i=0,o=a[n].length;o>i;i++)oe.event.add(t,n,a[n][i])}s.data&&(s.data=oe.extend({},s.data))}}function C(e,t){var n,i,o;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!ne.noCloneEvent&&t[oe.expando]){o=oe._data(t);for(i in o.events)oe.removeEvent(t,i,o.handle);t.removeAttribute(oe.expando)}"script"===n&&t.text!==e.text?(y(t).text=e.text,w(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),ne.html5Clone&&e.innerHTML&&!oe.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ae.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function _(t,n){var i,o=oe(n.createElement(t)).appendTo(n.body),r=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(o[0]))?i.display:oe.css(o[0],"display");return o.detach(),r}function k(e){var t=pe,n=Ze[e];return n||(n=_(e,t),"none"!==n&&n||(Xe=(Xe||oe("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Xe[0].contentWindow||Xe[0].contentDocument).document,t.write(),t.close(),n=_(e,t),Xe.detach()),Ze[e]=n),n}function j(e,t){return{get:function(){var n=e();if(null!=n)return n?void delete this.get:(this.get=t).apply(this,arguments)}}}function $(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,o=dt.length;o--;)if(t=dt[o]+n,t in e)return t;return i}function E(e,t){for(var n,i,o,r=[],s=0,a=e.length;a>s;s++)i=e[s],i.style&&(r[s]=oe._data(i,"olddisplay"),n=i.style.display,t?(r[s]||"none"!==n||(i.style.display=""),""===i.style.display&&Ee(i)&&(r[s]=oe._data(i,"olddisplay",k(i.nodeName)))):(o=Ee(i),(n&&"none"!==n||!o)&&oe._data(i,"olddisplay",o?n:oe.css(i,"display"))));for(s=0;a>s;s++)i=e[s],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?r[s]||"":"none"));return e}function T(e,t,n){var i=lt.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function A(e,t,n,i,o){for(var r=n===(i?"border":"content")?4:"width"===t?1:0,s=0;4>r;r+=2)"margin"===n&&(s+=oe.css(e,n+$e[r],!0,o)),i?("content"===n&&(s-=oe.css(e,"padding"+$e[r],!0,o)),"margin"!==n&&(s-=oe.css(e,"border"+$e[r]+"Width",!0,o))):(s+=oe.css(e,"padding"+$e[r],!0,o),"padding"!==n&&(s+=oe.css(e,"border"+$e[r]+"Width",!0,o)));return s}function D(e,t,n){var i=!0,o="width"===t?e.offsetWidth:e.offsetHeight,r=et(e),s=ne.boxSizing&&"border-box"===oe.css(e,"boxSizing",!1,r);if(0>=o||null==o){if(o=tt(e,t,r),(0>o||null==o)&&(o=e.style[t]),it.test(o))return o;i=s&&(ne.boxSizingReliable()||o===e.style[t]),o=parseFloat(o)||0}return o+A(e,t,n||(s?"border":"content"),i,r)+"px"}function M(e,t,n,i,o){return new M.prototype.init(e,t,n,i,o)}function N(){return setTimeout(function(){ft=void 0}),ft=oe.now()}function I(e,t){var n,i={height:e},o=0;for(t=t?1:0;4>o;o+=2-t)n=$e[o],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function P(e,t,n){for(var i,o=(yt[t]||[]).concat(yt["*"]),r=0,s=o.length;s>r;r++)if(i=o[r].call(n,t,e))return i}function F(e,t,n){var i,o,r,s,a,l,c,u,h=this,d={},f=e.style,p=e.nodeType&&Ee(e),m=oe._data(e,"fxshow");n.queue||(a=oe._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,oe.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],c=oe.css(e,"display"),u="none"===c?oe._data(e,"olddisplay")||k(e.nodeName):c,"inline"===u&&"none"===oe.css(e,"float")&&(ne.inlineBlockNeedsLayout&&"inline"!==k(e.nodeName)?f.zoom=1:f.display="inline-block")),n.overflow&&(f.overflow="hidden",ne.shrinkWrapBlocks()||h.always(function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}));for(i in t)if(o=t[i],mt.exec(o)){if(delete t[i],r=r||"toggle"===o,o===(p?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;p=!0}d[i]=m&&m[i]||oe.style(e,i)}else c=void 0;if(oe.isEmptyObject(d))"inline"===("none"===c?k(e.nodeName):c)&&(f.display=c);else{m?"hidden"in m&&(p=m.hidden):m=oe._data(e,"fxshow",{}),r&&(m.hidden=!p),p?oe(e).show():h.done(function(){oe(e).hide()}),h.done(function(){var t;oe._removeData(e,"fxshow");for(t in d)oe.style(e,t,d[t])});for(i in d)s=P(p?m[i]:0,i,h),i in m||(m[i]=s.start,p&&(s.end=s.start,s.start="width"===i||"height"===i?1:0))}}function O(e,t){var n,i,o,r,s;for(n in e)if(i=oe.camelCase(n),o=t[i],r=e[n],oe.isArray(r)&&(o=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),s=oe.cssHooks[i],s&&"expand"in s){r=s.expand(r),delete e[i];for(n in r)n in e||(e[n]=r[n],t[n]=o)}else t[i]=o}function L(e,t,n){var i,o,r=0,s=bt.length,a=oe.Deferred().always(function(){delete l.elem}),l=function(){if(o)return!1;for(var t=ft||N(),n=Math.max(0,c.startTime+c.duration-t),i=n/c.duration||0,r=1-i,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(r);return a.notifyWith(e,[c,r,n]),1>r&&l?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:oe.extend({},t),opts:oe.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:ft||N(),duration:n.duration,tweens:[],createTween:function(t,n){var i=oe.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(i),i},stop:function(t){var n=0,i=t?c.tweens.length:0;if(o)return this;for(o=!0;i>n;n++)c.tweens[n].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),u=c.props;for(O(u,c.opts.specialEasing);s>r;r++)if(i=bt[r].call(c,e,u,c.opts))return i;return oe.map(u,P,c),oe.isFunction(c.opts.start)&&c.opts.start.call(e,c),oe.fx.timer(oe.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function B(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,o=0,r=t.toLowerCase().match(ye)||[];if(oe.isFunction(n))for(;i=r[o++];)"+"===i.charAt(0)?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function R(e,t,n,i){function o(a){var l;return r[a]=!0,oe.each(e[a]||[],function(e,a){var c=a(t,n,i);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),o(c),!1)}),l}var r={},s=e===Wt;return o(t.dataTypes[0])||!r["*"]&&o("*")}function H(e,t){var n,i,o=oe.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((o[i]?e:n||(n={}))[i]=t[i]);return n&&oe.extend(!0,e,n),e}function U(e,t,n){for(var i,o,r,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===o&&(o=e.mimeType||t.getResponseHeader("Content-Type"));if(o)for(s in a)if(a[s]&&a[s].test(o)){l.unshift(s);break}if(l[0]in n)r=l[0];else{for(s in n){if(!l[0]||e.converters[s+" "+l[0]]){r=s;break}i||(i=s)}r=r||i}return r?(r!==l[0]&&l.unshift(r),n[r]):void 0}function W(e,t,n,i){var o,r,s,a,l,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(r=u.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=u.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(s=c[l+" "+r]||c["* "+r],!s)for(o in c)if(a=o.split(" "),a[1]===r&&(s=c[l+" "+a[0]]||c["* "+a[0]])){s===!0?s=c[o]:c[o]!==!0&&(r=a[0],u.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(h){return{state:"parsererror",error:s?h:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}function z(e,t,n,i){var o;if(oe.isArray(t))oe.each(t,function(t,o){n||Jt.test(e)?i(e,o):z(e+"["+("object"==typeof o?t:"")+"]",o,n,i)});else if(n||"object"!==oe.type(t))i(e,t);else for(o in t)z(e+"["+o+"]",t[o],n,i)}function q(){try{return new e.XMLHttpRequest}catch(t){}}function V(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function J(e){return oe.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var Y=[],G=Y.slice,Q=Y.concat,K=Y.push,X=Y.indexOf,Z={},ee=Z.toString,te=Z.hasOwnProperty,ne={},ie="1.11.1",oe=function(e,t){return new oe.fn.init(e,t)},re=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,ae=/-([\da-z])/gi,le=function(e,t){return t.toUpperCase()};oe.fn=oe.prototype={jquery:ie,constructor:oe,selector:"",length:0,toArray:function(){return G.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:G.call(this)},pushStack:function(e){var t=oe.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return oe.each(this,e,t)},map:function(e){return this.pushStack(oe.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(G.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:K,sort:Y.sort,splice:Y.splice},oe.extend=oe.fn.extend=function(){var e,t,n,i,o,r,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||oe.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(o=arguments[a]))for(i in o)e=s[i],n=o[i],s!==n&&(c&&n&&(oe.isPlainObject(n)||(t=oe.isArray(n)))?(t?(t=!1,r=e&&oe.isArray(e)?e:[]):r=e&&oe.isPlainObject(e)?e:{},s[i]=oe.extend(c,r,n)):void 0!==n&&(s[i]=n));return s},oe.extend({expando:"jQuery"+(ie+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===oe.type(e)},isArray:Array.isArray||function(e){return"array"===oe.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!oe.isArray(e)&&e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==oe.type(e)||e.nodeType||oe.isWindow(e))return!1;try{if(e.constructor&&!te.call(e,"constructor")&&!te.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(ne.ownLast)for(t in e)return te.call(e,t);for(t in e);return void 0===t||te.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Z[ee.call(e)]||"object":typeof e},globalEval:function(t){t&&oe.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(se,"ms-").replace(ae,le)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase();
},each:function(e,t,i){var o,r=0,s=e.length,a=n(e);if(i){if(a)for(;s>r&&(o=t.apply(e[r],i),o!==!1);r++);else for(r in e)if(o=t.apply(e[r],i),o===!1)break}else if(a)for(;s>r&&(o=t.call(e[r],r,e[r]),o!==!1);r++);else for(r in e)if(o=t.call(e[r],r,e[r]),o===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(re,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?oe.merge(i,"string"==typeof e?[e]:e):K.call(i,e)),i},inArray:function(e,t,n){var i;if(t){if(X)return X.call(t,e,n);for(i=t.length,n=n?0>n?Math.max(0,i+n):n:0;i>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){for(var n=+t.length,i=0,o=e.length;n>i;)e[o++]=t[i++];if(n!==n)for(;void 0!==t[i];)e[o++]=t[i++];return e.length=o,e},grep:function(e,t,n){for(var i,o=[],r=0,s=e.length,a=!n;s>r;r++)i=!t(e[r],r),i!==a&&o.push(e[r]);return o},map:function(e,t,i){var o,r=0,s=e.length,a=n(e),l=[];if(a)for(;s>r;r++)o=t(e[r],r,i),null!=o&&l.push(o);else for(r in e)o=t(e[r],r,i),null!=o&&l.push(o);return Q.apply([],l)},guid:1,proxy:function(e,t){var n,i,o;return"string"==typeof t&&(o=e[t],t=e,e=o),oe.isFunction(e)?(n=G.call(arguments,2),i=function(){return e.apply(t||this,n.concat(G.call(arguments)))},i.guid=e.guid=e.guid||oe.guid++,i):void 0},now:function(){return+new Date},support:ne}),oe.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Z["[object "+t+"]"]=t.toLowerCase()});var ce=/*!
 * Sizzle CSS Selector Engine v1.10.19
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-04-18
 */
function(e){function t(e,t,n,i){var o,r,s,a,l,c,h,f,p,m;if((t?t.ownerDocument||t:R)!==M&&D(t),t=t||M,n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=t.nodeType)&&9!==a)return[];if(I&&!i){if(o=be.exec(e))if(s=o[1]){if(9===a){if(r=t.getElementById(s),!r||!r.parentNode)return n;if(r.id===s)return n.push(r),n}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(s))&&L(t,r)&&r.id===s)return n.push(r),n}else{if(o[2])return Z.apply(n,t.getElementsByTagName(e)),n;if((s=o[3])&&S.getElementsByClassName&&t.getElementsByClassName)return Z.apply(n,t.getElementsByClassName(s)),n}if(S.qsa&&(!P||!P.test(e))){if(f=h=B,p=t,m=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=k(e),(h=t.getAttribute("id"))?f=h.replace(we,"\\$&"):t.setAttribute("id",f),f="[id='"+f+"'] ",l=c.length;l--;)c[l]=f+d(c[l]);p=ye.test(e)&&u(t.parentNode)||t,m=c.join(",")}if(m)try{return Z.apply(n,p.querySelectorAll(m)),n}catch(g){}finally{h||t.removeAttribute("id")}}}return $(e.replace(le,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>x.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[B]=!0,e}function o(e){var t=M.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var n=e.split("|"),i=e.length;i--;)x.attrHandle[n[i]]=t}function s(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return i(function(t){return t=+t,i(function(n,i){for(var o,r=e([],n.length,t),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))})})}function u(e){return e&&typeof e.getElementsByTagName!==J&&e}function h(){}function d(e){for(var t=0,n=e.length,i="";n>t;t++)i+=e[t].value;return i}function f(e,t,n){var i=t.dir,o=n&&"parentNode"===i,r=U++;return t.first?function(t,n,r){for(;t=t[i];)if(1===t.nodeType||o)return e(t,n,r)}:function(t,n,s){var a,l,c=[H,r];if(s){for(;t=t[i];)if((1===t.nodeType||o)&&e(t,n,s))return!0}else for(;t=t[i];)if(1===t.nodeType||o){if(l=t[B]||(t[B]={}),(a=l[i])&&a[0]===H&&a[1]===r)return c[2]=a[2];if(l[i]=c,c[2]=e(t,n,s))return!0}}}function p(e){return e.length>1?function(t,n,i){for(var o=e.length;o--;)if(!e[o](t,n,i))return!1;return!0}:e[0]}function m(e,n,i){for(var o=0,r=n.length;r>o;o++)t(e,n[o],i);return i}function g(e,t,n,i,o){for(var r,s=[],a=0,l=e.length,c=null!=t;l>a;a++)(r=e[a])&&(!n||n(r,i,o))&&(s.push(r),c&&t.push(a));return s}function v(e,t,n,o,r,s){return o&&!o[B]&&(o=v(o)),r&&!r[B]&&(r=v(r,s)),i(function(i,s,a,l){var c,u,h,d=[],f=[],p=s.length,v=i||m(t||"*",a.nodeType?[a]:a,[]),b=!e||!i&&t?v:g(v,d,e,a,l),y=n?r||(i?e:p||o)?[]:s:b;if(n&&n(b,y,a,l),o)for(c=g(y,f),o(c,[],a,l),u=c.length;u--;)(h=c[u])&&(y[f[u]]=!(b[f[u]]=h));if(i){if(r||e){if(r){for(c=[],u=y.length;u--;)(h=y[u])&&c.push(b[u]=h);r(null,y=[],c,l)}for(u=y.length;u--;)(h=y[u])&&(c=r?te.call(i,h):d[u])>-1&&(i[c]=!(s[c]=h))}}else y=g(y===s?y.splice(p,y.length):y),r?r(null,s,y,l):Z.apply(s,y)})}function b(e){for(var t,n,i,o=e.length,r=x.relative[e[0].type],s=r||x.relative[" "],a=r?1:0,l=f(function(e){return e===t},s,!0),c=f(function(e){return te.call(t,e)>-1},s,!0),u=[function(e,n,i){return!r&&(i||n!==E)||((t=n).nodeType?l(e,n,i):c(e,n,i))}];o>a;a++)if(n=x.relative[e[a].type])u=[f(p(u),n)];else{if(n=x.filter[e[a].type].apply(null,e[a].matches),n[B]){for(i=++a;o>i&&!x.relative[e[i].type];i++);return v(a>1&&p(u),a>1&&d(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(le,"$1"),n,i>a&&b(e.slice(a,i)),o>i&&b(e=e.slice(i)),o>i&&d(e))}u.push(n)}return p(u)}function y(e,n){var o=n.length>0,r=e.length>0,s=function(i,s,a,l,c){var u,h,d,f=0,p="0",m=i&&[],v=[],b=E,y=i||r&&x.find.TAG("*",c),w=H+=null==b?1:Math.random()||.1,S=y.length;for(c&&(E=s!==M&&s);p!==S&&null!=(u=y[p]);p++){if(r&&u){for(h=0;d=e[h++];)if(d(u,s,a)){l.push(u);break}c&&(H=w)}o&&((u=!d&&u)&&f--,i&&m.push(u))}if(f+=p,o&&p!==f){for(h=0;d=n[h++];)d(m,v,s,a);if(i){if(f>0)for(;p--;)m[p]||v[p]||(v[p]=K.call(l));v=g(v)}Z.apply(l,v),c&&!i&&v.length>0&&f+n.length>1&&t.uniqueSort(l)}return c&&(H=w,E=b),m};return o?i(s):s}var w,S,x,C,_,k,j,$,E,T,A,D,M,N,I,P,F,O,L,B="sizzle"+-new Date,R=e.document,H=0,U=0,W=n(),z=n(),q=n(),V=function(e,t){return e===t&&(A=!0),0},J="undefined",Y=1<<31,G={}.hasOwnProperty,Q=[],K=Q.pop,X=Q.push,Z=Q.push,ee=Q.slice,te=Q.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",oe="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",re=oe.replace("w","w#"),se="\\["+ie+"*("+oe+")(?:"+ie+"*([*^$|!~]?=)"+ie+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+re+"))|)"+ie+"*\\]",ae=":("+oe+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+se+")*)|.*)\\)|)",le=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),ce=new RegExp("^"+ie+"*,"+ie+"*"),ue=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),he=new RegExp("="+ie+"*([^\\]'\"]*?)"+ie+"*\\]","g"),de=new RegExp(ae),fe=new RegExp("^"+re+"$"),pe={ID:new RegExp("^#("+oe+")"),CLASS:new RegExp("^\\.("+oe+")"),TAG:new RegExp("^("+oe.replace("w","w*")+")"),ATTR:new RegExp("^"+se),PSEUDO:new RegExp("^"+ae),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+ne+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,be=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ye=/[+~]/,we=/'|\\/g,Se=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),xe=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)};try{Z.apply(Q=ee.call(R.childNodes),R.childNodes),Q[R.childNodes.length].nodeType}catch(Ce){Z={apply:Q.length?function(e,t){X.apply(e,ee.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}S=t.support={},_=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},D=t.setDocument=function(e){var t,n=e?e.ownerDocument||e:R,i=n.defaultView;return n!==M&&9===n.nodeType&&n.documentElement?(M=n,N=n.documentElement,I=!_(n),i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",function(){D()},!1):i.attachEvent&&i.attachEvent("onunload",function(){D()})),S.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),S.getElementsByTagName=o(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.getElementsByClassName=ve.test(n.getElementsByClassName)&&o(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),S.getById=o(function(e){return N.appendChild(e).id=B,!n.getElementsByName||!n.getElementsByName(B).length}),S.getById?(x.find.ID=function(e,t){if(typeof t.getElementById!==J&&I){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},x.filter.ID=function(e){var t=e.replace(Se,xe);return function(e){return e.getAttribute("id")===t}}):(delete x.find.ID,x.filter.ID=function(e){var t=e.replace(Se,xe);return function(e){var n=typeof e.getAttributeNode!==J&&e.getAttributeNode("id");return n&&n.value===t}}),x.find.TAG=S.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==J?t.getElementsByTagName(e):void 0}:function(e,t){var n,i=[],o=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},x.find.CLASS=S.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==J&&I?t.getElementsByClassName(e):void 0},F=[],P=[],(S.qsa=ve.test(n.querySelectorAll))&&(o(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&P.push("[*^$]="+ie+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||P.push("\\["+ie+"*(?:value|"+ne+")"),e.querySelectorAll(":checked").length||P.push(":checked")}),o(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&P.push("name"+ie+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||P.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),P.push(",.*:")})),(S.matchesSelector=ve.test(O=N.matches||N.webkitMatchesSelector||N.mozMatchesSelector||N.oMatchesSelector||N.msMatchesSelector))&&o(function(e){S.disconnectedMatch=O.call(e,"div"),O.call(e,"[s!='']:x"),F.push("!=",ae)}),P=P.length&&new RegExp(P.join("|")),F=F.length&&new RegExp(F.join("|")),t=ve.test(N.compareDocumentPosition),L=t||ve.test(N.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},V=t?function(e,t){if(e===t)return A=!0,0;var i=!e.compareDocumentPosition-!t.compareDocumentPosition;return i?i:(i=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&i||!S.sortDetached&&t.compareDocumentPosition(e)===i?e===n||e.ownerDocument===R&&L(R,e)?-1:t===n||t.ownerDocument===R&&L(R,t)?1:T?te.call(T,e)-te.call(T,t):0:4&i?-1:1)}:function(e,t){if(e===t)return A=!0,0;var i,o=0,r=e.parentNode,a=t.parentNode,l=[e],c=[t];if(!r||!a)return e===n?-1:t===n?1:r?-1:a?1:T?te.call(T,e)-te.call(T,t):0;if(r===a)return s(e,t);for(i=e;i=i.parentNode;)l.unshift(i);for(i=t;i=i.parentNode;)c.unshift(i);for(;l[o]===c[o];)o++;return o?s(l[o],c[o]):l[o]===R?-1:c[o]===R?1:0},n):M},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==M&&D(e),n=n.replace(he,"='$1']"),S.matchesSelector&&I&&(!F||!F.test(n))&&(!P||!P.test(n)))try{var i=O.call(e,n);if(i||S.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(o){}return t(n,M,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==M&&D(e),L(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==M&&D(e);var n=x.attrHandle[t.toLowerCase()],i=n&&G.call(x.attrHandle,t.toLowerCase())?n(e,t,!I):void 0;return void 0!==i?i:S.attributes||!I?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,o=0;if(A=!S.detectDuplicates,T=!S.sortStable&&e.slice(0),e.sort(V),A){for(;t=e[o++];)t===e[o]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return T=null,e},C=t.getText=function(e){var t,n="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=C(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i++];)n+=C(t);return n},x=t.selectors={cacheLength:50,createPseudo:i,match:pe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Se,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(Se,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return pe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&de.test(n)&&(t=k(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Se,xe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=W[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&W(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==J&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(o){var r=t.attr(o,e);return null==r?"!="===n:n?(r+="","="===n?r===i:"!="===n?r!==i:"^="===n?i&&0===r.indexOf(i):"*="===n?i&&r.indexOf(i)>-1:"$="===n?i&&r.slice(-i.length)===i:"~="===n?(" "+r+" ").indexOf(i)>-1:"|="===n?r===i||r.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,n,i,o){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,l){var c,u,h,d,f,p,m=r!==s?"nextSibling":"previousSibling",g=t.parentNode,v=a&&t.nodeName.toLowerCase(),b=!l&&!a;if(g){if(r){for(;m;){for(h=t;h=h[m];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[s?g.firstChild:g.lastChild],s&&b){for(u=g[B]||(g[B]={}),c=u[e]||[],f=c[0]===H&&c[1],d=c[0]===H&&c[2],h=f&&g.childNodes[f];h=++f&&h&&h[m]||(d=f=0)||p.pop();)if(1===h.nodeType&&++d&&h===t){u[e]=[H,f,d];break}}else if(b&&(c=(t[B]||(t[B]={}))[e])&&c[0]===H)d=c[1];else for(;(h=++f&&h&&h[m]||(d=f=0)||p.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++d||(b&&((h[B]||(h[B]={}))[e]=[H,d]),h!==t)););return d-=o,d===i||d%i===0&&d/i>=0}}},PSEUDO:function(e,n){var o,r=x.pseudos[e]||x.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[B]?r(n):r.length>1?(o=[e,e,"",n],x.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,o=r(e,n),s=o.length;s--;)i=te.call(e,o[s]),e[i]=!(t[i]=o[s])}):function(e){return r(e,0,o)}):r}},pseudos:{not:i(function(e){var t=[],n=[],o=j(e.replace(le,"$1"));return o[B]?i(function(e,t,n,i){for(var r,s=o(e,null,i,[]),a=e.length;a--;)(r=s[a])&&(e[a]=!(t[a]=r))}):function(e,i,r){return t[0]=e,o(t,null,r,n),!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||C(t)).indexOf(e)>-1}}),lang:i(function(e){return fe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(Se,xe).toLowerCase(),function(t){var n;do if(n=I?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===N},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var i=0>n?n+t:n;--i>=0;)e.push(i);return e}),gt:c(function(e,t,n){for(var i=0>n?n+t:n;++i<t;)e.push(i);return e})}},x.pseudos.nth=x.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[w]=a(w);for(w in{submit:!0,reset:!0})x.pseudos[w]=l(w);return h.prototype=x.filters=x.pseudos,x.setFilters=new h,k=t.tokenize=function(e,n){var i,o,r,s,a,l,c,u=z[e+" "];if(u)return n?0:u.slice(0);for(a=e,l=[],c=x.preFilter;a;){(!i||(o=ce.exec(a)))&&(o&&(a=a.slice(o[0].length)||a),l.push(r=[])),i=!1,(o=ue.exec(a))&&(i=o.shift(),r.push({value:i,type:o[0].replace(le," ")}),a=a.slice(i.length));for(s in x.filter)!(o=pe[s].exec(a))||c[s]&&!(o=c[s](o))||(i=o.shift(),r.push({value:i,type:s,matches:o}),a=a.slice(i.length));if(!i)break}return n?a.length:a?t.error(e):z(e,l).slice(0)},j=t.compile=function(e,t){var n,i=[],o=[],r=q[e+" "];if(!r){for(t||(t=k(e)),n=t.length;n--;)r=b(t[n]),r[B]?i.push(r):o.push(r);r=q(e,y(o,i)),r.selector=e}return r},$=t.select=function(e,t,n,i){var o,r,s,a,l,c="function"==typeof e&&e,h=!i&&k(e=c.selector||e);if(n=n||[],1===h.length){if(r=h[0]=h[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&S.getById&&9===t.nodeType&&I&&x.relative[r[1].type]){if(t=(x.find.ID(s.matches[0].replace(Se,xe),t)||[])[0],!t)return n;c&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(o=pe.needsContext.test(e)?0:r.length;o--&&(s=r[o],!x.relative[a=s.type]);)if((l=x.find[a])&&(i=l(s.matches[0].replace(Se,xe),ye.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(o,1),e=i.length&&d(r),!e)return Z.apply(n,i),n;break}}return(c||j(e,h))(i,t,!I,n,ye.test(e)&&u(t.parentNode)||t),n},S.sortStable=B.split("").sort(V).join("")===B,S.detectDuplicates=!!A,D(),S.sortDetached=o(function(e){return 1&e.compareDocumentPosition(M.createElement("div"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),S.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||r(ne,function(e,t,n){var i;return n?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);oe.find=ce,oe.expr=ce.selectors,oe.expr[":"]=oe.expr.pseudos,oe.unique=ce.uniqueSort,oe.text=ce.getText,oe.isXMLDoc=ce.isXML,oe.contains=ce.contains;var ue=oe.expr.match.needsContext,he=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,de=/^.[^:#\[\.,]*$/;oe.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?oe.find.matchesSelector(i,e)?[i]:[]:oe.find.matches(e,oe.grep(t,function(e){return 1===e.nodeType}))},oe.fn.extend({find:function(e){var t,n=[],i=this,o=i.length;if("string"!=typeof e)return this.pushStack(oe(e).filter(function(){for(t=0;o>t;t++)if(oe.contains(i[t],this))return!0}));for(t=0;o>t;t++)oe.find(e,i[t],n);return n=this.pushStack(o>1?oe.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&ue.test(e)?oe(e):e||[],!1).length}});var fe,pe=e.document,me=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ge=oe.fn.init=function(e,t){var n,i;if(!e)return this;if("string"==typeof e){if(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:me.exec(e),!n||!n[1]&&t)return!t||t.jquery?(t||fe).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof oe?t[0]:t,oe.merge(this,oe.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:pe,!0)),he.test(n[1])&&oe.isPlainObject(t))for(n in t)oe.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if(i=pe.getElementById(n[2]),i&&i.parentNode){if(i.id!==n[2])return fe.find(e);this.length=1,this[0]=i}return this.context=pe,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):oe.isFunction(e)?"undefined"!=typeof fe.ready?fe.ready(e):e(oe):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),oe.makeArray(e,this))};ge.prototype=oe.fn,fe=oe(pe);var ve=/^(?:parents|prev(?:Until|All))/,be={children:!0,contents:!0,next:!0,prev:!0};oe.extend({dir:function(e,t,n){for(var i=[],o=e[t];o&&9!==o.nodeType&&(void 0===n||1!==o.nodeType||!oe(o).is(n));)1===o.nodeType&&i.push(o),o=o[t];return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),oe.fn.extend({has:function(e){var t,n=oe(e,this),i=n.length;return this.filter(function(){for(t=0;i>t;t++)if(oe.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,i=0,o=this.length,r=[],s=ue.test(e)||"string"!=typeof e?oe(e,t||this.context):0;o>i;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&oe.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?oe.unique(r):r)},index:function(e){return e?"string"==typeof e?oe.inArray(this[0],oe(e)):oe.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(oe.unique(oe.merge(this.get(),oe(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),oe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return oe.dir(e,"parentNode")},parentsUntil:function(e,t,n){return oe.dir(e,"parentNode",n)},next:function(e){return o(e,"nextSibling")},prev:function(e){return o(e,"previousSibling")},nextAll:function(e){return oe.dir(e,"nextSibling")},prevAll:function(e){return oe.dir(e,"previousSibling")},nextUntil:function(e,t,n){return oe.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return oe.dir(e,"previousSibling",n)},siblings:function(e){return oe.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return oe.sibling(e.firstChild)},contents:function(e){return oe.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:oe.merge([],e.childNodes)}},function(e,t){oe.fn[e]=function(n,i){var o=oe.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=oe.filter(i,o)),this.length>1&&(be[e]||(o=oe.unique(o)),ve.test(e)&&(o=o.reverse())),this.pushStack(o)}});var ye=/\S+/g,we={};oe.Callbacks=function(e){e="string"==typeof e?we[e]||r(e):oe.extend({},e);var t,n,i,o,s,a,l=[],c=!e.once&&[],u=function(r){for(n=e.memory&&r,i=!0,s=a||0,a=0,o=l.length,t=!0;l&&o>s;s++)if(l[s].apply(r[0],r[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,l&&(c?c.length&&u(c.shift()):n?l=[]:h.disable())},h={add:function(){if(l){var i=l.length;!function r(t){oe.each(t,function(t,n){var i=oe.type(n);"function"===i?e.unique&&h.has(n)||l.push(n):n&&n.length&&"string"!==i&&r(n)})}(arguments),t?o=l.length:n&&(a=i,u(n))}return this},remove:function(){return l&&oe.each(arguments,function(e,n){for(var i;(i=oe.inArray(n,l,i))>-1;)l.splice(i,1),t&&(o>=i&&o--,s>=i&&s--)}),this},has:function(e){return e?oe.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=c=n=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,n||h.disable(),this},locked:function(){return!c},fireWith:function(e,n){return!l||i&&!c||(n=n||[],n=[e,n.slice?n.slice():n],t?c.push(n):u(n)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},oe.extend({Deferred:function(e){var t=[["resolve","done",oe.Callbacks("once memory"),"resolved"],["reject","fail",oe.Callbacks("once memory"),"rejected"],["notify","progress",oe.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return o.done(arguments).fail(arguments),this},then:function(){var e=arguments;return oe.Deferred(function(n){oe.each(t,function(t,r){var s=oe.isFunction(e[t])&&e[t];o[r[1]](function(){var e=s&&s.apply(this,arguments);e&&oe.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r[0]+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?oe.extend(e,i):i}},o={};return i.pipe=i.then,oe.each(t,function(e,r){var s=r[2],a=r[3];i[r[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),o[r[0]]=function(){return o[r[0]+"With"](this===o?i:this,arguments),this},o[r[0]+"With"]=s.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t,n,i,o=0,r=G.call(arguments),s=r.length,a=1!==s||e&&oe.isFunction(e.promise)?s:0,l=1===a?e:oe.Deferred(),c=function(e,n,i){return function(o){n[e]=this,i[e]=arguments.length>1?G.call(arguments):o,i===t?l.notifyWith(n,i):--a||l.resolveWith(n,i)}};if(s>1)for(t=new Array(s),n=new Array(s),i=new Array(s);s>o;o++)r[o]&&oe.isFunction(r[o].promise)?r[o].promise().done(c(o,i,r)).fail(l.reject).progress(c(o,n,t)):--a;return a||l.resolveWith(i,r),l.promise()}});var Se;oe.fn.ready=function(e){return oe.ready.promise().done(e),this},oe.extend({isReady:!1,readyWait:1,holdReady:function(e){e?oe.readyWait++:oe.ready(!0)},ready:function(e){if(e===!0?!--oe.readyWait:!oe.isReady){if(!pe.body)return setTimeout(oe.ready);oe.isReady=!0,e!==!0&&--oe.readyWait>0||(Se.resolveWith(pe,[oe]),oe.fn.triggerHandler&&(oe(pe).triggerHandler("ready"),oe(pe).off("ready")))}}}),oe.ready.promise=function(t){if(!Se)if(Se=oe.Deferred(),"complete"===pe.readyState)setTimeout(oe.ready);else if(pe.addEventListener)pe.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1);else{pe.attachEvent("onreadystatechange",a),e.attachEvent("onload",a);var n=!1;try{n=null==e.frameElement&&pe.documentElement}catch(i){}n&&n.doScroll&&!function o(){if(!oe.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}s(),oe.ready()}}()}return Se.promise(t)};var xe,Ce="undefined";for(xe in oe(ne))break;ne.ownLast="0"!==xe,ne.inlineBlockNeedsLayout=!1,oe(function(){var e,t,n,i;n=pe.getElementsByTagName("body")[0],n&&n.style&&(t=pe.createElement("div"),i=pe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),typeof t.style.zoom!==Ce&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ne.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(i))}),function(){var e=pe.createElement("div");if(null==ne.deleteExpando){ne.deleteExpando=!0;try{delete e.test}catch(t){ne.deleteExpando=!1}}e=null}(),oe.acceptData=function(e){var t=oe.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return 1!==n&&9!==n?!1:!t||t!==!0&&e.getAttribute("classid")===t};var _e=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ke=/([A-Z])/g;oe.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?oe.cache[e[oe.expando]]:e[oe.expando],!!e&&!c(e)},data:function(e,t,n){return u(e,t,n)},removeData:function(e,t){return h(e,t)},_data:function(e,t,n){return u(e,t,n,!0)},_removeData:function(e,t){return h(e,t,!0)}}),oe.fn.extend({data:function(e,t){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(o=oe.data(r),1===r.nodeType&&!oe._data(r,"parsedAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=oe.camelCase(i.slice(5)),l(r,i,o[i])));oe._data(r,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){oe.data(this,e)}):arguments.length>1?this.each(function(){oe.data(this,e,t)}):r?l(r,e,oe.data(r,e)):void 0},removeData:function(e){return this.each(function(){oe.removeData(this,e)})}}),oe.extend({queue:function(e,t,n){var i;return e?(t=(t||"fx")+"queue",i=oe._data(e,t),n&&(!i||oe.isArray(n)?i=oe._data(e,t,oe.makeArray(n)):i.push(n)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=oe.queue(e,t),i=n.length,o=n.shift(),r=oe._queueHooks(e,t),s=function(){oe.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===t&&n.unshift("inprogress"),delete r.stop,o.call(e,s,r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return oe._data(e,n)||oe._data(e,n,{empty:oe.Callbacks("once memory").add(function(){oe._removeData(e,t+"queue"),oe._removeData(e,n)})})}}),oe.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?oe.queue(this[0],e):void 0===t?this:this.each(function(){var n=oe.queue(this,e,t);oe._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&oe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){oe.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,o=oe.Deferred(),r=this,s=this.length,a=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)n=oe._data(r[s],e+"queueHooks"),n&&n.empty&&(i++,n.empty.add(a));return a(),o.promise(t)}});var je=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,$e=["Top","Right","Bottom","Left"],Ee=function(e,t){return e=t||e,"none"===oe.css(e,"display")||!oe.contains(e.ownerDocument,e)},Te=oe.access=function(e,t,n,i,o,r,s){var a=0,l=e.length,c=null==n;if("object"===oe.type(n)){o=!0;for(a in n)oe.access(e,t,a,n[a],!0,r,s)}else if(void 0!==i&&(o=!0,oe.isFunction(i)||(s=!0),c&&(s?(t.call(e,i),t=null):(c=t,t=function(e,t,n){return c.call(oe(e),n)})),t))for(;l>a;a++)t(e[a],n,s?i:i.call(e[a],a,t(e[a],n)));return o?e:c?t.call(e):l?t(e[0],n):r},Ae=/^(?:checkbox|radio)$/i;!function(){var e=pe.createElement("input"),t=pe.createElement("div"),n=pe.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ne.leadingWhitespace=3===t.firstChild.nodeType,ne.tbody=!t.getElementsByTagName("tbody").length,ne.htmlSerialize=!!t.getElementsByTagName("link").length,ne.html5Clone="<:nav></:nav>"!==pe.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,n.appendChild(e),ne.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",ne.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",ne.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,ne.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){ne.noCloneEvent=!1}),t.cloneNode(!0).click()),null==ne.deleteExpando){ne.deleteExpando=!0;try{delete t.test}catch(i){ne.deleteExpando=!1}}}(),function(){var t,n,i=pe.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(ne[t+"Bubbles"]=n in e)||(i.setAttribute(n,"t"),ne[t+"Bubbles"]=i.attributes[n].expando===!1);i=null}();var De=/^(?:input|select|textarea)$/i,Me=/^key/,Ne=/^(?:mouse|pointer|contextmenu)|click/,Ie=/^(?:focusinfocus|focusoutblur)$/,Pe=/^([^.]*)(?:\.(.+)|)$/;oe.event={global:{},add:function(e,t,n,i,o){var r,s,a,l,c,u,h,d,f,p,m,g=oe._data(e);if(g){for(n.handler&&(l=n,n=l.handler,o=l.selector),n.guid||(n.guid=oe.guid++),(s=g.events)||(s=g.events={}),(u=g.handle)||(u=g.handle=function(e){return typeof oe===Ce||e&&oe.event.triggered===e.type?void 0:oe.event.dispatch.apply(u.elem,arguments)},u.elem=e),t=(t||"").match(ye)||[""],a=t.length;a--;)r=Pe.exec(t[a])||[],f=m=r[1],p=(r[2]||"").split(".").sort(),f&&(c=oe.event.special[f]||{},f=(o?c.delegateType:c.bindType)||f,c=oe.event.special[f]||{},h=oe.extend({type:f,origType:m,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&oe.expr.match.needsContext.test(o),namespace:p.join(".")},l),(d=s[f])||(d=s[f]=[],d.delegateCount=0,c.setup&&c.setup.call(e,i,p,u)!==!1||(e.addEventListener?e.addEventListener(f,u,!1):e.attachEvent&&e.attachEvent("on"+f,u))),c.add&&(c.add.call(e,h),h.handler.guid||(h.handler.guid=n.guid)),o?d.splice(d.delegateCount++,0,h):d.push(h),oe.event.global[f]=!0);e=null}},remove:function(e,t,n,i,o){var r,s,a,l,c,u,h,d,f,p,m,g=oe.hasData(e)&&oe._data(e);if(g&&(u=g.events)){for(t=(t||"").match(ye)||[""],c=t.length;c--;)if(a=Pe.exec(t[c])||[],f=m=a[1],p=(a[2]||"").split(".").sort(),f){for(h=oe.event.special[f]||{},f=(i?h.delegateType:h.bindType)||f,d=u[f]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=d.length;r--;)s=d[r],!o&&m!==s.origType||n&&n.guid!==s.guid||a&&!a.test(s.namespace)||i&&i!==s.selector&&("**"!==i||!s.selector)||(d.splice(r,1),s.selector&&d.delegateCount--,h.remove&&h.remove.call(e,s));l&&!d.length&&(h.teardown&&h.teardown.call(e,p,g.handle)!==!1||oe.removeEvent(e,f,g.handle),delete u[f])}else for(f in u)oe.event.remove(e,f+t[c],n,i,!0);oe.isEmptyObject(u)&&(delete g.handle,oe._removeData(e,"events"))}},trigger:function(t,n,i,o){var r,s,a,l,c,u,h,d=[i||pe],f=te.call(t,"type")?t.type:t,p=te.call(t,"namespace")?t.namespace.split("."):[];if(a=u=i=i||pe,3!==i.nodeType&&8!==i.nodeType&&!Ie.test(f+oe.event.triggered)&&(f.indexOf(".")>=0&&(p=f.split("."),f=p.shift(),p.sort()),s=f.indexOf(":")<0&&"on"+f,t=t[oe.expando]?t:new oe.Event(f,"object"==typeof t&&t),t.isTrigger=o?2:3,
t.namespace=p.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:oe.makeArray(n,[t]),c=oe.event.special[f]||{},o||!c.trigger||c.trigger.apply(i,n)!==!1)){if(!o&&!c.noBubble&&!oe.isWindow(i)){for(l=c.delegateType||f,Ie.test(l+f)||(a=a.parentNode);a;a=a.parentNode)d.push(a),u=a;u===(i.ownerDocument||pe)&&d.push(u.defaultView||u.parentWindow||e)}for(h=0;(a=d[h++])&&!t.isPropagationStopped();)t.type=h>1?l:c.bindType||f,r=(oe._data(a,"events")||{})[t.type]&&oe._data(a,"handle"),r&&r.apply(a,n),r=s&&a[s],r&&r.apply&&oe.acceptData(a)&&(t.result=r.apply(a,n),t.result===!1&&t.preventDefault());if(t.type=f,!o&&!t.isDefaultPrevented()&&(!c._default||c._default.apply(d.pop(),n)===!1)&&oe.acceptData(i)&&s&&i[f]&&!oe.isWindow(i)){u=i[s],u&&(i[s]=null),oe.event.triggered=f;try{i[f]()}catch(m){}oe.event.triggered=void 0,u&&(i[s]=u)}return t.result}},dispatch:function(e){e=oe.event.fix(e);var t,n,i,o,r,s=[],a=G.call(arguments),l=(oe._data(this,"events")||{})[e.type]||[],c=oe.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=oe.event.handlers.call(this,e,l),t=0;(o=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,r=0;(i=o.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,n=((oe.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,a),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,i,o,r,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(l.disabled!==!0||"click"!==e.type)){for(o=[],r=0;a>r;r++)i=t[r],n=i.selector+" ",void 0===o[n]&&(o[n]=i.needsContext?oe(n,this).index(l)>=0:oe.find(n,this,null,[l]).length),o[n]&&o.push(i);o.length&&s.push({elem:l,handlers:o})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},fix:function(e){if(e[oe.expando])return e;var t,n,i,o=e.type,r=e,s=this.fixHooks[o];for(s||(this.fixHooks[o]=s=Ne.test(o)?this.mouseHooks:Me.test(o)?this.keyHooks:{}),i=s.props?this.props.concat(s.props):this.props,e=new oe.Event(r),t=i.length;t--;)n=i[t],e[n]=r[n];return e.target||(e.target=r.srcElement||pe),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,i,o,r=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(i=e.target.ownerDocument||pe,o=i.documentElement,n=i.body,e.pageX=t.clientX+(o&&o.scrollLeft||n&&n.scrollLeft||0)-(o&&o.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(o&&o.scrollTop||n&&n.scrollTop||0)-(o&&o.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==p()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===p()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return oe.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return oe.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var o=oe.extend(new oe.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?oe.event.trigger(o,null,t):oe.event.dispatch.call(t,o),o.isDefaultPrevented()&&n.preventDefault()}},oe.removeEvent=pe.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(typeof e[i]===Ce&&(e[i]=null),e.detachEvent(i,n))},oe.Event=function(e,t){return this instanceof oe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?d:f):this.type=e,t&&oe.extend(this,t),this.timeStamp=e&&e.timeStamp||oe.now(),void(this[oe.expando]=!0)):new oe.Event(e,t)},oe.Event.prototype={isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=d,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=d,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=d,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},oe.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){oe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,o=e.relatedTarget,r=e.handleObj;return(!o||o!==i&&!oe.contains(i,o))&&(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),ne.submitBubbles||(oe.event.special.submit={setup:function(){return oe.nodeName(this,"form")?!1:void oe.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=oe.nodeName(t,"input")||oe.nodeName(t,"button")?t.form:void 0;n&&!oe._data(n,"submitBubbles")&&(oe.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),oe._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&oe.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return oe.nodeName(this,"form")?!1:void oe.event.remove(this,"._submit")}}),ne.changeBubbles||(oe.event.special.change={setup:function(){return De.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(oe.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),oe.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),oe.event.simulate("change",this,e,!0)})),!1):void oe.event.add(this,"beforeactivate._change",function(e){var t=e.target;De.test(t.nodeName)&&!oe._data(t,"changeBubbles")&&(oe.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||oe.event.simulate("change",this.parentNode,e,!0)}),oe._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return oe.event.remove(this,"._change"),!De.test(this.nodeName)}}),ne.focusinBubbles||oe.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){oe.event.simulate(t,e.target,oe.event.fix(e),!0)};oe.event.special[t]={setup:function(){var i=this.ownerDocument||this,o=oe._data(i,t);o||i.addEventListener(e,n,!0),oe._data(i,t,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this,o=oe._data(i,t)-1;o?oe._data(i,t,o):(i.removeEventListener(e,n,!0),oe._removeData(i,t))}}}),oe.fn.extend({on:function(e,t,n,i,o){var r,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(r in e)this.on(r,t,n,e[r],o);return this}if(null==n&&null==i?(i=t,n=t=void 0):null==i&&("string"==typeof t?(i=n,n=void 0):(i=n,n=t,t=void 0)),i===!1)i=f;else if(!i)return this;return 1===o&&(s=i,i=function(e){return oe().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=oe.guid++)),this.each(function(){oe.event.add(this,e,i,n,t)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,t,n){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,oe(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return(t===!1||"function"==typeof t)&&(n=t,t=void 0),n===!1&&(n=f),this.each(function(){oe.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){oe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?oe.event.trigger(e,t,n,!0):void 0}});var Fe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Oe=/ jQuery\d+="(?:null|\d+)"/g,Le=new RegExp("<(?:"+Fe+")[\\s/>]","i"),Be=/^\s+/,Re=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,He=/<([\w:]+)/,Ue=/<tbody/i,We=/<|&#?\w+;/,ze=/<(?:script|style|link)/i,qe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ve=/^$|\/(?:java|ecma)script/i,Je=/^true\/(.*)/,Ye=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ge={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ne.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Qe=m(pe),Ke=Qe.appendChild(pe.createElement("div"));Ge.optgroup=Ge.option,Ge.tbody=Ge.tfoot=Ge.colgroup=Ge.caption=Ge.thead,Ge.th=Ge.td,oe.extend({clone:function(e,t,n){var i,o,r,s,a,l=oe.contains(e.ownerDocument,e);if(ne.html5Clone||oe.isXMLDoc(e)||!Le.test("<"+e.nodeName+">")?r=e.cloneNode(!0):(Ke.innerHTML=e.outerHTML,Ke.removeChild(r=Ke.firstChild)),!(ne.noCloneEvent&&ne.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||oe.isXMLDoc(e)))for(i=g(r),a=g(e),s=0;null!=(o=a[s]);++s)i[s]&&C(o,i[s]);if(t)if(n)for(a=a||g(e),i=i||g(r),s=0;null!=(o=a[s]);s++)x(o,i[s]);else x(e,r);return i=g(r,"script"),i.length>0&&S(i,!l&&g(e,"script")),i=a=o=null,r},buildFragment:function(e,t,n,i){for(var o,r,s,a,l,c,u,h=e.length,d=m(t),f=[],p=0;h>p;p++)if(r=e[p],r||0===r)if("object"===oe.type(r))oe.merge(f,r.nodeType?[r]:r);else if(We.test(r)){for(a=a||d.appendChild(t.createElement("div")),l=(He.exec(r)||["",""])[1].toLowerCase(),u=Ge[l]||Ge._default,a.innerHTML=u[1]+r.replace(Re,"<$1></$2>")+u[2],o=u[0];o--;)a=a.lastChild;if(!ne.leadingWhitespace&&Be.test(r)&&f.push(t.createTextNode(Be.exec(r)[0])),!ne.tbody)for(r="table"!==l||Ue.test(r)?"<table>"!==u[1]||Ue.test(r)?0:a:a.firstChild,o=r&&r.childNodes.length;o--;)oe.nodeName(c=r.childNodes[o],"tbody")&&!c.childNodes.length&&r.removeChild(c);for(oe.merge(f,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=d.lastChild}else f.push(t.createTextNode(r));for(a&&d.removeChild(a),ne.appendChecked||oe.grep(g(f,"input"),v),p=0;r=f[p++];)if((!i||-1===oe.inArray(r,i))&&(s=oe.contains(r.ownerDocument,r),a=g(d.appendChild(r),"script"),s&&S(a),n))for(o=0;r=a[o++];)Ve.test(r.type||"")&&n.push(r);return a=null,d},cleanData:function(e,t){for(var n,i,o,r,s=0,a=oe.expando,l=oe.cache,c=ne.deleteExpando,u=oe.event.special;null!=(n=e[s]);s++)if((t||oe.acceptData(n))&&(o=n[a],r=o&&l[o])){if(r.events)for(i in r.events)u[i]?oe.event.remove(n,i):oe.removeEvent(n,i,r.handle);l[o]&&(delete l[o],c?delete n[a]:typeof n.removeAttribute!==Ce?n.removeAttribute(a):n[a]=null,Y.push(o))}}}),oe.fn.extend({text:function(e){return Te(this,function(e){return void 0===e?oe.text(this):this.empty().append((this[0]&&this[0].ownerDocument||pe).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=b(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=b(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?oe.filter(e,this):this,o=0;null!=(n=i[o]);o++)t||1!==n.nodeType||oe.cleanData(g(n)),n.parentNode&&(t&&oe.contains(n.ownerDocument,n)&&S(g(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&oe.cleanData(g(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&oe.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return oe.clone(this,e,t)})},html:function(e){return Te(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Oe,""):void 0;if("string"==typeof e&&!ze.test(e)&&(ne.htmlSerialize||!Le.test(e))&&(ne.leadingWhitespace||!Be.test(e))&&!Ge[(He.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Re,"<$1></$2>");try{for(;i>n;n++)t=this[n]||{},1===t.nodeType&&(oe.cleanData(g(t,!1)),t.innerHTML=e);t=0}catch(o){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,oe.cleanData(g(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=Q.apply([],e);var n,i,o,r,s,a,l=0,c=this.length,u=this,h=c-1,d=e[0],f=oe.isFunction(d);if(f||c>1&&"string"==typeof d&&!ne.checkClone&&qe.test(d))return this.each(function(n){var i=u.eq(n);f&&(e[0]=d.call(this,n,i.html())),i.domManip(e,t)});if(c&&(a=oe.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(r=oe.map(g(a,"script"),y),o=r.length;c>l;l++)i=a,l!==h&&(i=oe.clone(i,!0,!0),o&&oe.merge(r,g(i,"script"))),t.call(this[l],i,l);if(o)for(s=r[r.length-1].ownerDocument,oe.map(r,w),l=0;o>l;l++)i=r[l],Ve.test(i.type||"")&&!oe._data(i,"globalEval")&&oe.contains(s,i)&&(i.src?oe._evalUrl&&oe._evalUrl(i.src):oe.globalEval((i.text||i.textContent||i.innerHTML||"").replace(Ye,"")));a=n=null}return this}}),oe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){oe.fn[e]=function(e){for(var n,i=0,o=[],r=oe(e),s=r.length-1;s>=i;i++)n=i===s?this:this.clone(!0),oe(r[i])[t](n),K.apply(o,n.get());return this.pushStack(o)}});var Xe,Ze={};!function(){var e;ne.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,i;return n=pe.getElementsByTagName("body")[0],n&&n.style?(t=pe.createElement("div"),i=pe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),typeof t.style.zoom!==Ce&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(pe.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(i),e):void 0}}();var et,tt,nt=/^margin/,it=new RegExp("^("+je+")(?!px)[a-z%]+$","i"),ot=/^(top|right|bottom|left)$/;e.getComputedStyle?(et=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},tt=function(e,t,n){var i,o,r,s,a=e.style;return n=n||et(e),s=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==s||oe.contains(e.ownerDocument,e)||(s=oe.style(e,t)),it.test(s)&&nt.test(t)&&(i=a.width,o=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=i,a.minWidth=o,a.maxWidth=r)),void 0===s?s:s+""}):pe.documentElement.currentStyle&&(et=function(e){return e.currentStyle},tt=function(e,t,n){var i,o,r,s,a=e.style;return n=n||et(e),s=n?n[t]:void 0,null==s&&a&&a[t]&&(s=a[t]),it.test(s)&&!ot.test(t)&&(i=a.left,o=e.runtimeStyle,r=o&&o.left,r&&(o.left=e.currentStyle.left),a.left="fontSize"===t?"1em":s,s=a.pixelLeft+"px",a.left=i,r&&(o.left=r)),void 0===s?s:s+""||"auto"}),function(){function t(){var t,n,i,o;n=pe.getElementsByTagName("body")[0],n&&n.style&&(t=pe.createElement("div"),i=pe.createElement("div"),i.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(i).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",r=s=!1,l=!0,e.getComputedStyle&&(r="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,o=t.appendChild(pe.createElement("div")),o.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",o.style.marginRight=o.style.width="0",t.style.width="1px",l=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=t.getElementsByTagName("td"),o[0].style.cssText="margin:0;border:0;padding:0;display:none",a=0===o[0].offsetHeight,a&&(o[0].style.display="",o[1].style.display="none",a=0===o[0].offsetHeight),n.removeChild(i))}var n,i,o,r,s,a,l;n=pe.createElement("div"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",o=n.getElementsByTagName("a")[0],i=o&&o.style,i&&(i.cssText="float:left;opacity:.5",ne.opacity="0.5"===i.opacity,ne.cssFloat=!!i.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===n.style.backgroundClip,ne.boxSizing=""===i.boxSizing||""===i.MozBoxSizing||""===i.WebkitBoxSizing,oe.extend(ne,{reliableHiddenOffsets:function(){return null==a&&t(),a},boxSizingReliable:function(){return null==s&&t(),s},pixelPosition:function(){return null==r&&t(),r},reliableMarginRight:function(){return null==l&&t(),l}}))}(),oe.swap=function(e,t,n,i){var o,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];o=n.apply(e,i||[]);for(r in t)e.style[r]=s[r];return o};var rt=/alpha\([^)]*\)/i,st=/opacity\s*=\s*([^)]*)/,at=/^(none|table(?!-c[ea]).+)/,lt=new RegExp("^("+je+")(.*)$","i"),ct=new RegExp("^([+-])=("+je+")","i"),ut={position:"absolute",visibility:"hidden",display:"block"},ht={letterSpacing:"0",fontWeight:"400"},dt=["Webkit","O","Moz","ms"];oe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=tt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ne.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,r,s,a=oe.camelCase(t),l=e.style;if(t=oe.cssProps[a]||(oe.cssProps[a]=$(l,a)),s=oe.cssHooks[t]||oe.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(o=s.get(e,!1,i))?o:l[t];if(r=typeof n,"string"===r&&(o=ct.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(oe.css(e,t)),r="number"),null!=n&&n===n&&("number"!==r||oe.cssNumber[a]||(n+="px"),ne.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),!(s&&"set"in s&&void 0===(n=s.set(e,n,i)))))try{l[t]=n}catch(c){}}},css:function(e,t,n,i){var o,r,s,a=oe.camelCase(t);return t=oe.cssProps[a]||(oe.cssProps[a]=$(e.style,a)),s=oe.cssHooks[t]||oe.cssHooks[a],s&&"get"in s&&(r=s.get(e,!0,n)),void 0===r&&(r=tt(e,t,i)),"normal"===r&&t in ht&&(r=ht[t]),""===n||n?(o=parseFloat(r),n===!0||oe.isNumeric(o)?o||0:r):r}}),oe.each(["height","width"],function(e,t){oe.cssHooks[t]={get:function(e,n,i){return n?at.test(oe.css(e,"display"))&&0===e.offsetWidth?oe.swap(e,ut,function(){return D(e,t,i)}):D(e,t,i):void 0},set:function(e,n,i){var o=i&&et(e);return T(e,n,i?A(e,t,i,ne.boxSizing&&"border-box"===oe.css(e,"boxSizing",!1,o),o):0)}}}),ne.opacity||(oe.cssHooks.opacity={get:function(e,t){return st.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,o=oe.isNumeric(t)?"alpha(opacity="+100*t+")":"",r=i&&i.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===oe.trim(r.replace(rt,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||i&&!i.filter)||(n.filter=rt.test(r)?r.replace(rt,o):r+" "+o)}}),oe.cssHooks.marginRight=j(ne.reliableMarginRight,function(e,t){return t?oe.swap(e,{display:"inline-block"},tt,[e,"marginRight"]):void 0}),oe.each({margin:"",padding:"",border:"Width"},function(e,t){oe.cssHooks[e+t]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];4>i;i++)o[e+$e[i]+t]=r[i]||r[i-2]||r[0];return o}},nt.test(e)||(oe.cssHooks[e+t].set=T)}),oe.fn.extend({css:function(e,t){return Te(this,function(e,t,n){var i,o,r={},s=0;if(oe.isArray(t)){for(i=et(e),o=t.length;o>s;s++)r[t[s]]=oe.css(e,t[s],!1,i);return r}return void 0!==n?oe.style(e,t,n):oe.css(e,t)},e,t,arguments.length>1)},show:function(){return E(this,!0)},hide:function(){return E(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ee(this)?oe(this).show():oe(this).hide()})}}),oe.Tween=M,M.prototype={constructor:M,init:function(e,t,n,i,o,r){this.elem=e,this.prop=n,this.easing=o||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(oe.cssNumber[n]?"":"px")},cur:function(){var e=M.propHooks[this.prop];return e&&e.get?e.get(this):M.propHooks._default.get(this)},run:function(e){var t,n=M.propHooks[this.prop];return this.options.duration?this.pos=t=oe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):M.propHooks._default.set(this),this}},M.prototype.init.prototype=M.prototype,M.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=oe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){oe.fx.step[e.prop]?oe.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[oe.cssProps[e.prop]]||oe.cssHooks[e.prop])?oe.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},M.propHooks.scrollTop=M.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},oe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},oe.fx=M.prototype.init,oe.fx.step={};var ft,pt,mt=/^(?:toggle|show|hide)$/,gt=new RegExp("^(?:([+-])=|)("+je+")([a-z%]*)$","i"),vt=/queueHooks$/,bt=[F],yt={"*":[function(e,t){var n=this.createTween(e,t),i=n.cur(),o=gt.exec(t),r=o&&o[3]||(oe.cssNumber[e]?"":"px"),s=(oe.cssNumber[e]||"px"!==r&&+i)&&gt.exec(oe.css(n.elem,e)),a=1,l=20;if(s&&s[3]!==r){r=r||s[3],o=o||[],s=+i||1;do a=a||".5",s/=a,oe.style(n.elem,e,s+r);while(a!==(a=n.cur()/i)&&1!==a&&--l)}return o&&(s=n.start=+s||+i||0,n.unit=r,n.end=o[1]?s+(o[1]+1)*o[2]:+o[2]),n}]};oe.Animation=oe.extend(L,{tweener:function(e,t){oe.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,o=e.length;o>i;i++)n=e[i],yt[n]=yt[n]||[],yt[n].unshift(t)},prefilter:function(e,t){t?bt.unshift(e):bt.push(e)}}),oe.speed=function(e,t,n){var i=e&&"object"==typeof e?oe.extend({},e):{complete:n||!n&&t||oe.isFunction(e)&&e,duration:e,easing:n&&t||t&&!oe.isFunction(t)&&t};return i.duration=oe.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in oe.fx.speeds?oe.fx.speeds[i.duration]:oe.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){oe.isFunction(i.old)&&i.old.call(this),i.queue&&oe.dequeue(this,i.queue)},i},oe.fn.extend({fadeTo:function(e,t,n,i){return this.filter(Ee).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var o=oe.isEmptyObject(e),r=oe.speed(t,n,i),s=function(){var t=L(this,oe.extend({},e),r);(o||oe._data(this,"finish"))&&t.stop(!0)};return s.finish=s,o||r.queue===!1?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",r=oe.timers,s=oe._data(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&vt.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(n),t=!1,r.splice(o,1));(t||!n)&&oe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=oe._data(this),i=n[e+"queue"],o=n[e+"queueHooks"],r=oe.timers,s=i?i.length:0;for(n.finish=!0,oe.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;s>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),oe.each(["toggle","show","hide"],function(e,t){var n=oe.fn[t];oe.fn[t]=function(e,i,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(I(t,!0),e,i,o)}}),oe.each({slideDown:I("show"),slideUp:I("hide"),slideToggle:I("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){oe.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),oe.timers=[],oe.fx.tick=function(){var e,t=oe.timers,n=0;for(ft=oe.now();n<t.length;n++)e=t[n],e()||t[n]!==e||t.splice(n--,1);t.length||oe.fx.stop(),ft=void 0},oe.fx.timer=function(e){oe.timers.push(e),e()?oe.fx.start():oe.timers.pop()},oe.fx.interval=13,oe.fx.start=function(){pt||(pt=setInterval(oe.fx.tick,oe.fx.interval))},oe.fx.stop=function(){clearInterval(pt),pt=null},oe.fx.speeds={slow:600,fast:200,_default:400},oe.fn.delay=function(e,t){return e=oe.fx?oe.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},function(){var e,t,n,i,o;t=pe.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=t.getElementsByTagName("a")[0],n=pe.createElement("select"),o=n.appendChild(pe.createElement("option")),e=t.getElementsByTagName("input")[0],i.style.cssText="top:1px",ne.getSetAttribute="t"!==t.className,ne.style=/top/.test(i.getAttribute("style")),ne.hrefNormalized="/a"===i.getAttribute("href"),ne.checkOn=!!e.value,ne.optSelected=o.selected,ne.enctype=!!pe.createElement("form").enctype,n.disabled=!0,ne.optDisabled=!o.disabled,e=pe.createElement("input"),e.setAttribute("value",""),ne.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ne.radioValue="t"===e.value}();var wt=/\r/g;oe.fn.extend({val:function(e){var t,n,i,o=this[0];{if(arguments.length)return i=oe.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,oe(this).val()):e,null==o?o="":"number"==typeof o?o+="":oe.isArray(o)&&(o=oe.map(o,function(e){return null==e?"":e+""})),t=oe.valHooks[this.type]||oe.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))});if(o)return t=oe.valHooks[o.type]||oe.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(wt,""):null==n?"":n)}}}),oe.extend({valHooks:{option:{get:function(e){var t=oe.find.attr(e,"value");return null!=t?t:oe.trim(oe.text(e))}},select:{get:function(e){for(var t,n,i=e.options,o=e.selectedIndex,r="select-one"===e.type||0>o,s=r?null:[],a=r?o+1:i.length,l=0>o?a:r?o:0;a>l;l++)if(n=i[l],(n.selected||l===o)&&(ne.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!oe.nodeName(n.parentNode,"optgroup"))){if(t=oe(n).val(),r)return t;s.push(t)}return s},set:function(e,t){for(var n,i,o=e.options,r=oe.makeArray(t),s=o.length;s--;)if(i=o[s],oe.inArray(oe.valHooks.option.get(i),r)>=0)try{i.selected=n=!0}catch(a){i.scrollHeight}else i.selected=!1;return n||(e.selectedIndex=-1),o}}}}),oe.each(["radio","checkbox"],function(){oe.valHooks[this]={set:function(e,t){return oe.isArray(t)?e.checked=oe.inArray(oe(e).val(),t)>=0:void 0}},ne.checkOn||(oe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var St,xt,Ct=oe.expr.attrHandle,_t=/^(?:checked|selected)$/i,kt=ne.getSetAttribute,jt=ne.input;oe.fn.extend({attr:function(e,t){return Te(this,oe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){oe.removeAttr(this,e)})}}),oe.extend({attr:function(e,t,n){var i,o,r=e.nodeType;if(e&&3!==r&&8!==r&&2!==r)return typeof e.getAttribute===Ce?oe.prop(e,t,n):(1===r&&oe.isXMLDoc(e)||(t=t.toLowerCase(),i=oe.attrHooks[t]||(oe.expr.match.bool.test(t)?xt:St)),void 0===n?i&&"get"in i&&null!==(o=i.get(e,t))?o:(o=oe.find.attr(e,t),null==o?void 0:o):null!==n?i&&"set"in i&&void 0!==(o=i.set(e,n,t))?o:(e.setAttribute(t,n+""),n):void oe.removeAttr(e,t))},removeAttr:function(e,t){var n,i,o=0,r=t&&t.match(ye);if(r&&1===e.nodeType)for(;n=r[o++];)i=oe.propFix[n]||n,oe.expr.match.bool.test(n)?jt&&kt||!_t.test(n)?e[i]=!1:e[oe.camelCase("default-"+n)]=e[i]=!1:oe.attr(e,n,""),e.removeAttribute(kt?n:i)},attrHooks:{type:{set:function(e,t){if(!ne.radioValue&&"radio"===t&&oe.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),xt={set:function(e,t,n){return t===!1?oe.removeAttr(e,n):jt&&kt||!_t.test(n)?e.setAttribute(!kt&&oe.propFix[n]||n,n):e[oe.camelCase("default-"+n)]=e[n]=!0,n}},oe.each(oe.expr.match.bool.source.match(/\w+/g),function(e,t){var n=Ct[t]||oe.find.attr;Ct[t]=jt&&kt||!_t.test(t)?function(e,t,i){var o,r;return i||(r=Ct[t],Ct[t]=o,o=null!=n(e,t,i)?t.toLowerCase():null,Ct[t]=r),o}:function(e,t,n){return n?void 0:e[oe.camelCase("default-"+t)]?t.toLowerCase():null}}),jt&&kt||(oe.attrHooks.value={set:function(e,t,n){return oe.nodeName(e,"input")?void(e.defaultValue=t):St&&St.set(e,t,n)}}),kt||(St={set:function(e,t,n){var i=e.getAttributeNode(n);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(n)),i.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},Ct.id=Ct.name=Ct.coords=function(e,t,n){var i;return n?void 0:(i=e.getAttributeNode(t))&&""!==i.value?i.value:null},oe.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:St.set},oe.attrHooks.contenteditable={set:function(e,t,n){St.set(e,""===t?!1:t,n)}},oe.each(["width","height"],function(e,t){oe.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),ne.style||(oe.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var $t=/^(?:input|select|textarea|button|object)$/i,Et=/^(?:a|area)$/i;oe.fn.extend({prop:function(e,t){return Te(this,oe.prop,e,t,arguments.length>1)},removeProp:function(e){return e=oe.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(t){}})}}),oe.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var i,o,r,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return r=1!==s||!oe.isXMLDoc(e),r&&(t=oe.propFix[t]||t,o=oe.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:e[t]=n:o&&"get"in o&&null!==(i=o.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=oe.find.attr(e,"tabindex");return t?parseInt(t,10):$t.test(e.nodeName)||Et.test(e.nodeName)&&e.href?0:-1}}}}),ne.hrefNormalized||oe.each(["href","src"],function(e,t){oe.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),ne.optSelected||(oe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),oe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){oe.propFix[this.toLowerCase()]=this}),ne.enctype||(oe.propFix.enctype="encoding");var Tt=/[\t\r\n\f]/g;oe.fn.extend({addClass:function(e){var t,n,i,o,r,s,a=0,l=this.length,c="string"==typeof e&&e;if(oe.isFunction(e))return this.each(function(t){oe(this).addClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ye)||[];l>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Tt," "):" ")){for(r=0;o=t[r++];)i.indexOf(" "+o+" ")<0&&(i+=o+" ");s=oe.trim(i),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,i,o,r,s,a=0,l=this.length,c=0===arguments.length||"string"==typeof e&&e;if(oe.isFunction(e))return this.each(function(t){oe(this).removeClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ye)||[];l>a;a++)if(n=this[a],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Tt," "):"")){for(r=0;o=t[r++];)for(;i.indexOf(" "+o+" ")>=0;)i=i.replace(" "+o+" "," ");s=e?oe.trim(i):"",n.className!==s&&(n.className=s);
}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):oe.isFunction(e)?this.each(function(n){oe(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var t,i=0,o=oe(this),r=e.match(ye)||[];t=r[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else(n===Ce||"boolean"===n)&&(this.className&&oe._data(this,"__className__",this.className),this.className=this.className||e===!1?"":oe._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;i>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Tt," ").indexOf(t)>=0)return!0;return!1}}),oe.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){oe.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),oe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var At=oe.now(),Dt=/\?/,Mt=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;oe.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,i=null,o=oe.trim(t+"");return o&&!oe.trim(o.replace(Mt,function(e,t,o,r){return n&&t&&(i=0),0===i?e:(n=o||t,i+=!r-!o,"")}))?Function("return "+o)():oe.error("Invalid JSON: "+t)},oe.parseXML=function(t){var n,i;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(i=new DOMParser,n=i.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(o){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||oe.error("Invalid XML: "+t),n};var Nt,It,Pt=/#.*$/,Ft=/([?&])_=[^&]*/,Ot=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Bt=/^(?:GET|HEAD)$/,Rt=/^\/\//,Ht=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ut={},Wt={},zt="*/".concat("*");try{It=location.href}catch(qt){It=pe.createElement("a"),It.href="",It=It.href}Nt=Ht.exec(It.toLowerCase())||[],oe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:It,type:"GET",isLocal:Lt.test(Nt[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":zt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":oe.parseJSON,"text xml":oe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?H(H(e,oe.ajaxSettings),t):H(oe.ajaxSettings,e)},ajaxPrefilter:B(Ut),ajaxTransport:B(Wt),ajax:function(e,t){function n(e,t,n,i){var o,u,v,b,w,x=t;2!==y&&(y=2,a&&clearTimeout(a),c=void 0,s=i||"",S.readyState=e>0?4:0,o=e>=200&&300>e||304===e,n&&(b=U(h,S,n)),b=W(h,b,S,o),o?(h.ifModified&&(w=S.getResponseHeader("Last-Modified"),w&&(oe.lastModified[r]=w),w=S.getResponseHeader("etag"),w&&(oe.etag[r]=w)),204===e||"HEAD"===h.type?x="nocontent":304===e?x="notmodified":(x=b.state,u=b.data,v=b.error,o=!v)):(v=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",o?p.resolveWith(d,[u,x,S]):p.rejectWith(d,[S,x,v]),S.statusCode(g),g=void 0,l&&f.trigger(o?"ajaxSuccess":"ajaxError",[S,h,o?u:v]),m.fireWith(d,[S,x]),l&&(f.trigger("ajaxComplete",[S,h]),--oe.active||oe.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,o,r,s,a,l,c,u,h=oe.ajaxSetup({},t),d=h.context||h,f=h.context&&(d.nodeType||d.jquery)?oe(d):oe.event,p=oe.Deferred(),m=oe.Callbacks("once memory"),g=h.statusCode||{},v={},b={},y=0,w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===y){if(!u)for(u={};t=Ot.exec(s);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===y?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=b[n]=b[n]||e,v[e]=t),this},overrideMimeType:function(e){return y||(h.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>y)for(t in e)g[t]=[g[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||w;return c&&c.abort(t),n(0,t),this}};if(p.promise(S).complete=m.add,S.success=S.done,S.error=S.fail,h.url=((e||h.url||It)+"").replace(Pt,"").replace(Rt,Nt[1]+"//"),h.type=t.method||t.type||h.method||h.type,h.dataTypes=oe.trim(h.dataType||"*").toLowerCase().match(ye)||[""],null==h.crossDomain&&(i=Ht.exec(h.url.toLowerCase()),h.crossDomain=!(!i||i[1]===Nt[1]&&i[2]===Nt[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(Nt[3]||("http:"===Nt[1]?"80":"443")))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=oe.param(h.data,h.traditional)),R(Ut,h,t,S),2===y)return S;l=h.global,l&&0===oe.active++&&oe.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!Bt.test(h.type),r=h.url,h.hasContent||(h.data&&(r=h.url+=(Dt.test(r)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=Ft.test(r)?r.replace(Ft,"$1_="+At++):r+(Dt.test(r)?"&":"?")+"_="+At++)),h.ifModified&&(oe.lastModified[r]&&S.setRequestHeader("If-Modified-Since",oe.lastModified[r]),oe.etag[r]&&S.setRequestHeader("If-None-Match",oe.etag[r])),(h.data&&h.hasContent&&h.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",h.contentType),S.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+zt+"; q=0.01":""):h.accepts["*"]);for(o in h.headers)S.setRequestHeader(o,h.headers[o]);if(h.beforeSend&&(h.beforeSend.call(d,S,h)===!1||2===y))return S.abort();w="abort";for(o in{success:1,error:1,complete:1})S[o](h[o]);if(c=R(Wt,h,t,S)){S.readyState=1,l&&f.trigger("ajaxSend",[S,h]),h.async&&h.timeout>0&&(a=setTimeout(function(){S.abort("timeout")},h.timeout));try{y=1,c.send(v,n)}catch(x){if(!(2>y))throw x;n(-1,x)}}else n(-1,"No Transport");return S},getJSON:function(e,t,n){return oe.get(e,t,n,"json")},getScript:function(e,t){return oe.get(e,void 0,t,"script")}}),oe.each(["get","post"],function(e,t){oe[t]=function(e,n,i,o){return oe.isFunction(n)&&(o=o||i,i=n,n=void 0),oe.ajax({url:e,type:t,dataType:o,data:n,success:i})}}),oe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){oe.fn[t]=function(e){return this.on(t,e)}}),oe._evalUrl=function(e){return oe.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},oe.fn.extend({wrapAll:function(e){if(oe.isFunction(e))return this.each(function(t){oe(this).wrapAll(e.call(this,t))});if(this[0]){var t=oe(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return oe.isFunction(e)?this.each(function(t){oe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=oe(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=oe.isFunction(e);return this.each(function(n){oe(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){oe.nodeName(this,"body")||oe(this).replaceWith(this.childNodes)}).end()}}),oe.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ne.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||oe.css(e,"display"))},oe.expr.filters.visible=function(e){return!oe.expr.filters.hidden(e)};var Vt=/%20/g,Jt=/\[\]$/,Yt=/\r?\n/g,Gt=/^(?:submit|button|image|reset|file)$/i,Qt=/^(?:input|select|textarea|keygen)/i;oe.param=function(e,t){var n,i=[],o=function(e,t){t=oe.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=oe.ajaxSettings&&oe.ajaxSettings.traditional),oe.isArray(e)||e.jquery&&!oe.isPlainObject(e))oe.each(e,function(){o(this.name,this.value)});else for(n in e)z(n,e[n],t,o);return i.join("&").replace(Vt,"+")},oe.fn.extend({serialize:function(){return oe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=oe.prop(this,"elements");return e?oe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!oe(this).is(":disabled")&&Qt.test(this.nodeName)&&!Gt.test(e)&&(this.checked||!Ae.test(e))}).map(function(e,t){var n=oe(this).val();return null==n?null:oe.isArray(n)?oe.map(n,function(e){return{name:t.name,value:e.replace(Yt,"\r\n")}}):{name:t.name,value:n.replace(Yt,"\r\n")}}).get()}}),oe.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&q()||V()}:q;var Kt=0,Xt={},Zt=oe.ajaxSettings.xhr();e.ActiveXObject&&oe(e).on("unload",function(){for(var e in Xt)Xt[e](void 0,!0)}),ne.cors=!!Zt&&"withCredentials"in Zt,Zt=ne.ajax=!!Zt,Zt&&oe.ajaxTransport(function(e){if(!e.crossDomain||ne.cors){var t;return{send:function(n,i){var o,r=e.xhr(),s=++Kt;if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)r[o]=e.xhrFields[o];e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)void 0!==n[o]&&r.setRequestHeader(o,n[o]+"");r.send(e.hasContent&&e.data||null),t=function(n,o){var a,l,c;if(t&&(o||4===r.readyState))if(delete Xt[s],t=void 0,r.onreadystatechange=oe.noop,o)4!==r.readyState&&r.abort();else{c={},a=r.status,"string"==typeof r.responseText&&(c.text=r.responseText);try{l=r.statusText}catch(u){l=""}a||!e.isLocal||e.crossDomain?1223===a&&(a=204):a=c.text?200:404}c&&i(a,l,c,r.getAllResponseHeaders())},e.async?4===r.readyState?setTimeout(t):r.onreadystatechange=Xt[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),oe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return oe.globalEval(e),e}}}),oe.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),oe.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=pe.head||oe("head")[0]||pe.documentElement;return{send:function(i,o){t=pe.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||o(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var en=[],tn=/(=)\?(?=&|$)|\?\?/;oe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=en.pop()||oe.expando+"_"+At++;return this[e]=!0,e}}),oe.ajaxPrefilter("json jsonp",function(t,n,i){var o,r,s,a=t.jsonp!==!1&&(tn.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&tn.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(o=t.jsonpCallback=oe.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(tn,"$1"+o):t.jsonp!==!1&&(t.url+=(Dt.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||oe.error(o+" was not called"),s[0]},t.dataTypes[0]="json",r=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=r,t[o]&&(t.jsonpCallback=n.jsonpCallback,en.push(o)),s&&oe.isFunction(r)&&r(s[0]),s=r=void 0}),"script"):void 0}),oe.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||pe;var i=he.exec(e),o=!n&&[];return i?[t.createElement(i[1])]:(i=oe.buildFragment([e],t,o),o&&o.length&&oe(o).remove(),oe.merge([],i.childNodes))};var nn=oe.fn.load;oe.fn.load=function(e,t,n){if("string"!=typeof e&&nn)return nn.apply(this,arguments);var i,o,r,s=this,a=e.indexOf(" ");return a>=0&&(i=oe.trim(e.slice(a,e.length)),e=e.slice(0,a)),oe.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&oe.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){o=arguments,s.html(i?oe("<div>").append(oe.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){s.each(n,o||[e.responseText,t,e])}),this},oe.expr.filters.animated=function(e){return oe.grep(oe.timers,function(t){return e===t.elem}).length};var on=e.document.documentElement;oe.offset={setOffset:function(e,t,n){var i,o,r,s,a,l,c,u=oe.css(e,"position"),h=oe(e),d={};"static"===u&&(e.style.position="relative"),a=h.offset(),r=oe.css(e,"top"),l=oe.css(e,"left"),c=("absolute"===u||"fixed"===u)&&oe.inArray("auto",[r,l])>-1,c?(i=h.position(),s=i.top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(l)||0),oe.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(d.top=t.top-a.top+s),null!=t.left&&(d.left=t.left-a.left+o),"using"in t?t.using.call(e,d):h.css(d)}},oe.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){oe.offset.setOffset(this,e,t)});var t,n,i={top:0,left:0},o=this[0],r=o&&o.ownerDocument;if(r)return t=r.documentElement,oe.contains(t,o)?(typeof o.getBoundingClientRect!==Ce&&(i=o.getBoundingClientRect()),n=J(r),{top:i.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:i.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):i},position:function(){if(this[0]){var e,t,n={top:0,left:0},i=this[0];return"fixed"===oe.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),oe.nodeName(e[0],"html")||(n=e.offset()),n.top+=oe.css(e[0],"borderTopWidth",!0),n.left+=oe.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-oe.css(i,"marginTop",!0),left:t.left-n.left-oe.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||on;e&&!oe.nodeName(e,"html")&&"static"===oe.css(e,"position");)e=e.offsetParent;return e||on})}}),oe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);oe.fn[e]=function(i){return Te(this,function(e,i,o){var r=J(e);return void 0===o?r?t in r?r[t]:r.document.documentElement[i]:e[i]:void(r?r.scrollTo(n?oe(r).scrollLeft():o,n?o:oe(r).scrollTop()):e[i]=o)},e,i,arguments.length,null)}}),oe.each(["top","left"],function(e,t){oe.cssHooks[t]=j(ne.pixelPosition,function(e,n){return n?(n=tt(e,t),it.test(n)?oe(e).position()[t]+"px":n):void 0})}),oe.each({Height:"height",Width:"width"},function(e,t){oe.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){oe.fn[i]=function(i,o){var r=arguments.length&&(n||"boolean"!=typeof i),s=n||(i===!0||o===!0?"margin":"border");return Te(this,function(t,n,i){var o;return oe.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?oe.css(t,n,s):oe.style(t,n,i,s)},t,r?i:void 0,r,null)}})}),oe.fn.size=function(){return this.length},oe.fn.andSelf=oe.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return oe});var rn=e.jQuery,sn=e.$;return oe.noConflict=function(t){return e.$===oe&&(e.$=sn),t&&e.jQuery===oe&&(e.jQuery=rn),oe},typeof t===Ce&&(e.jQuery=e.$=oe),oe}),function(e,t){e.rails!==t&&e.error("jquery-ujs has already been loaded!");var n,i=e(document);e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not(form button), button[data-confirm]:not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",CSRFProtection:function(t){var n=e('meta[name="csrf-token"]').attr("content");n&&t.setRequestHeader("X-CSRF-Token",n)},refreshCSRFTokens:function(){var t=e("meta[name=csrf-token]").attr("content"),n=e("meta[name=csrf-param]").attr("content");e('form input[name="'+n+'"]').val(t)},fire:function(t,n,i){var o=e.Event(n);return t.trigger(o,i),o.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e.attr("href")},handleRemote:function(i){var o,r,s,a,l,c,u,h;if(n.fire(i,"ajax:before")){if(a=i.data("cross-domain"),l=a===t?null:a,c=i.data("with-credentials")||null,u=i.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,i.is("form")){o=i.attr("method"),r=i.attr("action"),s=i.serializeArray();var d=i.data("ujs:submit-button");d&&(s.push(d),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(o=i.data("method"),r=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):i.is(n.buttonClickSelector)?(o=i.data("method")||"get",r=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(o=i.data("method"),r=n.href(i),s=i.data("params")||null);return h={type:o||"GET",data:s,dataType:u,beforeSend:function(e,o){return o.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+o.accepts.script),n.fire(i,"ajax:beforeSend",[e,o])?void i.trigger("ajax:send",e):!1},success:function(e,t,n){i.trigger("ajax:success",[e,t,n])},complete:function(e,t){i.trigger("ajax:complete",[e,t])},error:function(e,t,n){i.trigger("ajax:error",[e,t,n])},crossDomain:l},c&&(h.xhrFields={withCredentials:c}),r&&(h.url=r),n.ajax(h)}return!1},handleMethod:function(i){var o=n.href(i),r=i.data("method"),s=i.attr("target"),a=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+o+'"></form>'),u='<input name="_method" value="'+r+'" type="hidden" />';l!==t&&a!==t&&(u+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(t,n){return t.is("form")?e(t[0].elements).filter(n):t.find(n)},disableFormElements:function(t){n.formElements(t,n.disableSelector).each(function(){n.disableFormElement(e(this))})},disableFormElement:function(e){var n,i;n=e.is("button")?"html":"val",i=e.data("disable-with"),e.data("ujs:enable-with",e[n]()),i!==t&&e[n](i),e.prop("disabled",!0)},enableFormElements:function(t){n.formElements(t,n.enableSelector).each(function(){n.enableFormElement(e(this))})},enableFormElement:function(e){var t=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[t](e.data("ujs:enable-with")),e.prop("disabled",!1)},allowAction:function(e){var t,i=e.data("confirm"),o=!1;return i?(n.fire(e,"confirm")&&(o=n.confirm(i),t=n.fire(e,"confirm:complete",[o])),o&&t):!0},blankInputs:function(t,n,i){var o,r,s=e(),a=n||"input,textarea",l=t.find(a);return l.each(function(){if(o=e(this),r=o.is("input[type=checkbox],input[type=radio]")?o.is(":checked"):o.val(),!r==!i){if(o.is("input[type=radio]")&&l.filter('input[type=radio]:checked[name="'+o.attr("name")+'"]').length)return!0;s=s.add(o)}}),s.length?s:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var i=e.data("disable-with");e.data("ujs:enable-with",e.html()),i!==t&&e.html(i),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable")}},n.fire(i,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,i){e.crossDomain||n.CSRFProtection(i)}),i.delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),i.delegate(n.buttonDisableSelector,"ajax:complete",function(){n.enableFormElement(e(this))}),i.delegate(n.linkClickSelector,"click.rails",function(i){var o=e(this),r=o.data("method"),s=o.data("params"),a=i.metaKey||i.ctrlKey;if(!n.allowAction(o))return n.stopEverything(i);if(!a&&o.is(n.linkDisableSelector)&&n.disableElement(o),o.data("remote")!==t){if(a&&(!r||"GET"===r)&&!s)return!0;var l=n.handleRemote(o);return l===!1?n.enableElement(o):l.error(function(){n.enableElement(o)}),!1}return o.data("method")?(n.handleMethod(o),!1):void 0}),i.delegate(n.buttonClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);i.is(n.buttonDisableSelector)&&n.disableFormElement(i);var o=n.handleRemote(i);return o===!1?n.enableFormElement(i):o.error(function(){n.enableFormElement(i)}),!1}),i.delegate(n.inputChangeSelector,"change.rails",function(t){var i=e(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(t)}),i.delegate(n.formSubmitSelector,"submit.rails",function(i){var o,r,s=e(this),a=s.data("remote")!==t;if(!n.allowAction(s))return n.stopEverything(i);if(s.attr("novalidate")==t&&(o=n.blankInputs(s,n.requiredInputSelector),o&&n.fire(s,"ajax:aborted:required",[o])))return n.stopEverything(i);if(a){if(r=n.nonBlankInputs(s,n.fileInputSelector)){setTimeout(function(){n.disableFormElements(s)},13);var l=n.fire(s,"ajax:aborted:file",[r]);return l||setTimeout(function(){n.enableFormElements(s)},13),l}return n.handleRemote(s),!1}setTimeout(function(){n.disableFormElements(s)},13)}),i.delegate(n.formInputClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);var o=i.attr("name"),r=o?{name:o,value:i.val()}:null;i.closest("form").data("ujs:submit-button",r)}),i.delegate(n.formSubmitSelector,"ajax:send.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),i.delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){n.refreshCSRFTokens()}))}(jQuery);var $j=jQuery.noConflict(),Prototype={Version:"1.7",Browser:function(){var e=navigator.userAgent,t="[object Opera]"==Object.prototype.toString.call(window.opera);return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML"),MobileSafari:/Apple.*Mobile/.test(e)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var e=window.Element||window.HTMLElement;return!(!e||!e.prototype)}(),SpecificElementExtensions:function(){if("undefined"!=typeof window.HTMLDivElement)return!0;var e=document.createElement("div"),t=document.createElement("form"),n=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(n=!0),e=t=null,n}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)</script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(e){return e}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Abstract={},Try={these:function(){for(var e,t=0,n=arguments.length;n>t;t++){var i=arguments[t];try{e=i();break}catch(o){}}return e}},Class=function(){function e(){}function t(){function t(){this.initialize.apply(this,arguments)}var n=null,i=$A(arguments);Object.isFunction(i[0])&&(n=i.shift()),Object.extend(t,Class.Methods),t.superclass=n,t.subclasses=[],n&&(e.prototype=n.prototype,t.prototype=new e,n.subclasses.push(t));for(var o=0,r=i.length;r>o;o++)t.addMethods(i[o]);return t.prototype.initialize||(t.prototype.initialize=Prototype.emptyFunction),t.prototype.constructor=t,t}function n(e){var t=this.superclass&&this.superclass.prototype,n=Object.keys(e);i&&(e.toString!=Object.prototype.toString&&n.push("toString"),e.valueOf!=Object.prototype.valueOf&&n.push("valueOf"));for(var o=0,r=n.length;r>o;o++){var s=n[o],a=e[s];if(t&&Object.isFunction(a)&&"$super"==a.argumentNames()[0]){var l=a;a=function(e){return function(){return t[e].apply(this,arguments)}}(s).wrap(l),a.valueOf=l.valueOf.bind(l),a.toString=l.toString.bind(l)}this.prototype[s]=a}return this}var i=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}();return{create:t,Methods:{addMethods:n}}}();!function(){function e(e){switch(e){case null:return w;case void 0:return S}var t=typeof e;switch(t){case"boolean":return x;case"number":return C;case"string":return _}return k}function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e){try{return b(e)?"undefined":null===e?"null":e.inspect?e.inspect():String(e)}catch(t){if(t instanceof RangeError)return"...";throw t}}function i(e){return o("",{"":e},[])}function o(t,n,i){var r=n[t],s=typeof r;e(r)===k&&"function"==typeof r.toJSON&&(r=r.toJSON(t));var a=y.call(r);switch(a){case E:case $:case T:r=r.valueOf()}switch(r){case null:return"null";case!0:return"true";case!1:return"false"}switch(s=typeof r){case"string":return r.inspect(!0);case"number":return isFinite(r)?String(r):"null";case"object":for(var l=0,c=i.length;c>l;l++)if(i[l]===r)throw new TypeError;i.push(r);var u=[];if(a===A){for(var l=0,c=r.length;c>l;l++){var h=o(l,r,i);u.push("undefined"==typeof h?"null":h)}u="["+u.join(",")+"]"}else{for(var d=Object.keys(r),l=0,c=d.length;c>l;l++){var t=d[l],h=o(t,r,i);"undefined"!=typeof h&&u.push(t.inspect(!0)+":"+h)}u="{"+u.join(",")+"}"}return i.pop(),u}}function r(e){return JSON.stringify(e)}function s(e){return $H(e).toQueryString()}function a(e){return e&&e.toHTML?e.toHTML():String.interpret(e)}function l(t){if(e(t)!==k)throw new TypeError;var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i);return n}function c(e){var t=[];for(var n in e)t.push(e[n]);return t}function u(e){return t({},e)}function h(e){return!(!e||1!=e.nodeType)}function d(e){return y.call(e)===A}function f(e){return e instanceof Hash}function p(e){return y.call(e)===j}function m(e){return y.call(e)===T}function g(e){return y.call(e)===E}function v(e){return y.call(e)===D}function b(e){return"undefined"==typeof e}var y=Object.prototype.toString,w="Null",S="Undefined",x="Boolean",C="Number",_="String",k="Object",j="[object Function]",$="[object Boolean]",E="[object Number]",T="[object String]",A="[object Array]",D="[object Date]",M=window.JSON&&"function"==typeof JSON.stringify&&"0"===JSON.stringify(0)&&"undefined"==typeof JSON.stringify(Prototype.K),N="function"==typeof Array.isArray&&Array.isArray([])&&!Array.isArray({});N&&(d=Array.isArray),t(Object,{extend:t,inspect:n,toJSON:M?r:i,toQueryString:s,toHTML:a,keys:Object.keys||l,values:c,clone:u,isElement:h,isArray:d,isHash:f,isFunction:p,isString:m,isNumber:g,isDate:v,isUndefined:b})}(),Object.extend(Function.prototype,function(){function e(e,t){for(var n=e.length,i=t.length;i--;)e[n+i]=t[i];return e}function t(t,n){return t=u.call(t,0),e(t,n)}function n(){var e=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=e.length||e[0]?e:[]}function i(e){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var n=this,i=u.call(arguments,1);return function(){var o=t(i,arguments);return n.apply(e,o)}}function o(t){var n=this,i=u.call(arguments,1);return function(o){var r=e([o||window.event],i);return n.apply(t,r)}}function r(){if(!arguments.length)return this;var e=this,n=u.call(arguments,0);return function(){var i=t(n,arguments);return e.apply(this,i)}}function s(e){var t=this,n=u.call(arguments,1);return e=1e3*e,window.setTimeout(function(){return t.apply(t,n)},e)}function a(){var t=e([.01],arguments);return this.delay.apply(this,t)}function l(t){var n=this;return function(){var i=e([n.bind(this)],arguments);return t.apply(this,i)}}function c(){if(this._methodized)return this._methodized;var t=this;return this._methodized=function(){var n=e([this],arguments);return t.apply(null,n)}}var u=Array.prototype.slice;return{argumentNames:n,bind:i,bindAsEventListener:o,curry:r,delay:s,defer:a,wrap:l,methodize:c}}()),function(e){function t(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function n(){return this.toISOString()}e.toISOString||(e.toISOString=t),e.toJSON||(e.toJSON=n)}(Date.prototype),RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(e,t){this.callback=e,this.frequency=t,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(e){throw this.currentlyExecuting=!1,e}}});Object.extend(String,{interpret:function(e){return null==e?"":String(e)},specialChar:{"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,function(){function prepareReplacement(e){if(Object.isFunction(e))return e;var t=new Template(e);return function(e){return t.evaluate(e)}}function gsub(e,t){var n,i="",o=this;if(t=prepareReplacement(t),Object.isString(e)&&(e=RegExp.escape(e)),!e.length&&!e.source)return t=t(""),t+o.split("").join(t)+t;for(;o.length>0;)(n=o.match(e))?(i+=o.slice(0,n.index),i+=String.interpret(t(n)),o=o.slice(n.index+n[0].length)):(i+=o,o="");return i}function sub(e,t,n){return t=prepareReplacement(t),n=Object.isUndefined(n)?1:n,this.gsub(e,function(e){return--n<0?e[0]:t(e)})}function scan(e,t){return this.gsub(e,t),String(this)}function truncate(e,t){return e=e||30,t=Object.isUndefined(t)?"...":t,this.length>e?this.slice(0,e-t.length)+t:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var e=new RegExp(Prototype.ScriptFragment,"img"),t=new RegExp(Prototype.ScriptFragment,"im");return(this.match(e)||[]).map(function(e){return(e.match(t)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(e){var t=this.strip().match(/([^?#]*)(#.*)?$/);return t?t[1].split(e||"&").inject({},function(e,t){if((t=t.split("="))[0]){var n=decodeURIComponent(t.shift()),i=t.length>1?t.join("="):t[0];void 0!=i&&(i=decodeURIComponent(i)),n in e?(Object.isArray(e[n])||(e[n]=[e[n]]),e[n].push(i)):e[n]=i}return e}):{}}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(e){return 1>e?"":new Array(e+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(e){var t=this.replace(/[\x00-\x1f\\]/g,function(e){return e in String.specialChar?String.specialChar[e]:"\\u00"+e.charCodeAt().toPaddedString(2,16)});return e?'"'+t.replace(/"/g,'\\"')+'"':"'"+t.replace(/'/g,"\\'")+"'"}function unfilterJSON(e){return this.replace(e||Prototype.JSONFilter,"$1")}function isJSON(){var e=this;return e.blank()?!1:(e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@"),
e=e.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]"),e=e.replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e))}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;cx.test(json)&&(json=json.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var e=this.unfilterJSON();return JSON.parse(e)}function include(e){return this.indexOf(e)>-1}function startsWith(e){return 0===this.lastIndexOf(e,0)}function endsWith(e){var t=this.length-e.length;return t>=0&&this.indexOf(e,t)===t}function empty(){return""==this}function blank(){return/^\s*$/.test(this)}function interpolate(e,t){return new Template(this,t).evaluate(e)}var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&"function"==typeof JSON.parse&&JSON.parse('{"test": true}').test;return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}}());var Template=Class.create({initialize:function(e,t){this.template=e.toString(),this.pattern=t||Template.Pattern},evaluate:function(e){return e&&Object.isFunction(e.toTemplateReplacements)&&(e=e.toTemplateReplacements()),this.template.gsub(this.pattern,function(t){if(null==e)return t[1]+"";var n=t[1]||"";if("\\"==n)return t[2];var i=e,o=t[3],r=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(t=r.exec(o),null==t)return n;for(;null!=t;){var s=t[1].startsWith("[")?t[2].replace(/\\\\]/g,"]"):t[1];if(i=i[s],null==i||""==t[3])break;o=o.substring("["==t[3]?t[1].length:t[0].length),t=r.exec(o)}return n+String.interpret(i)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable=function(){function e(e,t){var n=0;try{this._each(function(i){e.call(t,i,n++)})}catch(i){if(i!=$break)throw i}return this}function t(e,t,n){var i=-e,o=[],r=this.toArray();if(1>e)return r;for(;(i+=e)<r.length;)o.push(r.slice(i,i+e));return o.collect(t,n)}function n(e,t){e=e||Prototype.K;var n=!0;return this.each(function(i,o){if(n=n&&!!e.call(t,i,o),!n)throw $break}),n}function i(e,t){e=e||Prototype.K;var n=!1;return this.each(function(i,o){if(n=!!e.call(t,i,o))throw $break}),n}function o(e,t){e=e||Prototype.K;var n=[];return this.each(function(i,o){n.push(e.call(t,i,o))}),n}function r(e,t){var n;return this.each(function(i,o){if(e.call(t,i,o))throw n=i,$break}),n}function s(e,t){var n=[];return this.each(function(i,o){e.call(t,i,o)&&n.push(i)}),n}function a(e,t,n){t=t||Prototype.K;var i=[];return Object.isString(e)&&(e=new RegExp(RegExp.escape(e))),this.each(function(o,r){e.match(o)&&i.push(t.call(n,o,r))}),i}function l(e){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(e))return!0;var t=!1;return this.each(function(n){if(n==e)throw t=!0,$break}),t}function c(e,t){return t=Object.isUndefined(t)?null:t,this.eachSlice(e,function(n){for(;n.length<e;)n.push(t);return n})}function u(e,t,n){return this.each(function(i,o){e=t.call(n,e,i,o)}),e}function h(e){var t=$A(arguments).slice(1);return this.map(function(n){return n[e].apply(n,t)})}function d(e,t){e=e||Prototype.K;var n;return this.each(function(i,o){i=e.call(t,i,o),(null==n||i>=n)&&(n=i)}),n}function f(e,t){e=e||Prototype.K;var n;return this.each(function(i,o){i=e.call(t,i,o),(null==n||n>i)&&(n=i)}),n}function p(e,t){e=e||Prototype.K;var n=[],i=[];return this.each(function(o,r){(e.call(t,o,r)?n:i).push(o)}),[n,i]}function m(e){var t=[];return this.each(function(n){t.push(n[e])}),t}function g(e,t){var n=[];return this.each(function(i,o){e.call(t,i,o)||n.push(i)}),n}function v(e,t){return this.map(function(n,i){return{value:n,criteria:e.call(t,n,i)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return i>n?-1:n>i?1:0}).pluck("value")}function b(){return this.map()}function y(){var e=Prototype.K,t=$A(arguments);Object.isFunction(t.last())&&(e=t.pop());var n=[this].concat(t).map($A);return this.map(function(t,i){return e(n.pluck(i))})}function w(){return this.toArray().length}function S(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:e,eachSlice:t,all:n,every:n,any:i,some:i,collect:o,map:o,detect:r,findAll:s,select:s,filter:s,grep:a,include:l,member:l,inGroupsOf:c,inject:u,invoke:h,max:d,min:f,partition:p,pluck:m,reject:g,sortBy:v,toArray:b,entries:b,zip:y,size:w,inspect:S,find:r}}();Array.from=$A,function(){function e(e,t){for(var n=0,i=this.length>>>0;i>n;n++)n in this&&e.call(t,this[n],n,this)}function t(){return this.length=0,this}function n(){return this[0]}function i(){return this[this.length-1]}function o(){return this.select(function(e){return null!=e})}function r(){return this.inject([],function(e,t){return Object.isArray(t)?e.concat(t.flatten()):(e.push(t),e)})}function s(){var e=v.call(arguments,0);return this.select(function(t){return!e.include(t)})}function a(e){return(e===!1?this.toArray():this)._reverse()}function l(e){return this.inject([],function(t,n,i){return 0!=i&&(e?t.last()==n:t.include(n))||t.push(n),t})}function c(e){return this.uniq().findAll(function(t){return e.detect(function(e){return t===e})})}function u(){return v.call(this,0)}function h(){return this.length}function d(){return"["+this.map(Object.inspect).join(", ")+"]"}function f(e,t){t||(t=0);var n=this.length;for(0>t&&(t=n+t);n>t;t++)if(this[t]===e)return t;return-1}function p(e,t){t=isNaN(t)?this.length:(0>t?this.length+t:t)+1;var n=this.slice(0,t).reverse().indexOf(e);return 0>n?n:t-n-1}function m(){for(var e,t=v.call(this,0),n=0,i=arguments.length;i>n;n++)if(e=arguments[n],!Object.isArray(e)||"callee"in e)t.push(e);else for(var o=0,r=e.length;r>o;o++)t.push(e[o]);return t}var g=Array.prototype,v=g.slice,b=g.forEach;b||(b=e),Object.extend(g,Enumerable),g._reverse||(g._reverse=g.reverse),Object.extend(g,{_each:b,clear:t,first:n,last:i,compact:o,flatten:r,without:s,reverse:a,uniq:l,intersect:c,clone:u,toArray:u,size:h,inspect:d});var y=function(){return 1!==[].concat(arguments)[0][0]}(1,2);y&&(g.concat=m),g.indexOf||(g.indexOf=f),g.lastIndexOf||(g.lastIndexOf=p)}();var Hash=Class.create(Enumerable,function(){function e(e){this._object=Object.isHash(e)?e.toObject():Object.clone(e)}function t(e){for(var t in this._object){var n=this._object[t],i=[t,n];i.key=t,i.value=n,e(i)}}function n(e,t){return this._object[e]=t}function i(e){return this._object[e]!==Object.prototype[e]?this._object[e]:void 0}function o(e){var t=this._object[e];return delete this._object[e],t}function r(){return Object.clone(this._object)}function s(){return this.pluck("key")}function a(){return this.pluck("value")}function l(e){var t=this.detect(function(t){return t.value===e});return t&&t.key}function c(e){return this.clone().update(e)}function u(e){return new Hash(e).inject(this,function(e,t){return e.set(t.key,t.value),e})}function h(e,t){return Object.isUndefined(t)?e:e+"="+encodeURIComponent(String.interpret(t))}function d(){return this.inject([],function(e,t){var n=encodeURIComponent(t.key),i=t.value;if(i&&"object"==typeof i){if(Object.isArray(i)){for(var o,r=[],s=0,a=i.length;a>s;s++)o=i[s],r.push(h(n,o));return e.concat(r)}}else e.push(h(n,i));return e}).join("&")}function f(){return"#<Hash:{"+this.map(function(e){return e.map(Object.inspect).join(": ")}).join(", ")+"}>"}function p(){return new Hash(this)}return{initialize:e,_each:t,set:n,get:i,unset:o,toObject:r,toTemplateReplacements:r,keys:s,values:a,index:l,merge:c,update:u,toQueryString:d,inspect:f,toJSON:r,clone:p}}());Hash.from=$H,Object.extend(Number.prototype,function(){function e(){return this.toPaddedString(2,16)}function t(){return this+1}function n(e,t){return $R(0,this,!0).each(e,t),this}function i(e,t){var n=this.toString(t||10);return"0".times(e-n.length)+n}function o(){return Math.abs(this)}function r(){return Math.round(this)}function s(){return Math.ceil(this)}function a(){return Math.floor(this)}return{toColorPart:e,succ:t,times:n,toPaddedString:i,abs:o,round:r,ceil:s,floor:a}}());var ObjectRange=Class.create(Enumerable,function(){function e(e,t,n){this.start=e,this.end=t,this.exclusive=n}function t(e){for(var t=this.start;this.include(t);)e(t),t=t.succ()}function n(e){return e<this.start?!1:this.exclusive?e<this.end:e<=this.end}return{initialize:e,_each:t,include:n}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0};if(Ajax.Responders={responders:[],_each:function(e){this.responders._each(e)},register:function(e){this.include(e)||this.responders.push(e)},unregister:function(e){this.responders=this.responders.without(e)},dispatch:function(e,t,n,i){this.each(function(o){if(Object.isFunction(o[e]))try{o[e].apply(o,[t,n,i])}catch(r){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(e){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,e||{}),this.options.method=this.options.method.toLowerCase(),Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function($super,e,t){$super(t),this.transport=Ajax.getTransport(),this.request(e)},request:function(e){this.url=e,this.method=this.options.method;var t=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(t+=(t?"&":"")+"_method="+this.method,this.method="post"),t&&"get"===this.method&&(this.url+=(this.url.include("?")?"&":"?")+t),this.parameters=t.toQueryParams();try{var n=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(n),Ajax.Responders.dispatch("onCreate",this,n),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body="post"==this.method?this.options.postBody||t:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(i){this.dispatchException(i)}},onStateChange:function(){var e=this.transport.readyState;e>1&&(4!=e||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var e={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if("post"==this.method&&(e["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(e.Connection="close")),"object"==typeof this.options.requestHeaders){var t=this.options.requestHeaders;if(Object.isFunction(t.push))for(var n=0,i=t.length;i>n;n+=2)e[t[n]]=t[n+1];else $H(t).each(function(t){e[t.key]=t.value})}for(var o in e)this.transport.setRequestHeader(o,e[o])},success:function(){var e=this.getStatus();return!e||e>=200&&300>e||304==e},getStatus:function(){try{return 1223===this.transport.status?204:this.transport.status||0}catch(e){return 0}},respondToReadyState:function(e){var t=Ajax.Request.Events[e],n=new Ajax.Response(this);if("Complete"==t){try{this._complete=!0,(this.options["on"+n.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(n,n.headerJSON)}catch(i){this.dispatchException(i)}var o=n.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&o&&o.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+t]||Prototype.emptyFunction)(n,n.headerJSON),Ajax.Responders.dispatch("on"+t,this,n,n.headerJSON)}catch(i){this.dispatchException(i)}"Complete"==t&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var e=this.url.match(/^\s*https?:\/\/[^\/]*/);return!e||e[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(e){try{return this.transport.getResponseHeader(e)||null}catch(t){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(e){(this.options.onException||Prototype.emptyFunction)(this,e),Ajax.Responders.dispatch("onException",this,e)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(e){this.request=e;var t=this.transport=e.transport,n=this.readyState=t.readyState;if((n>2&&!Prototype.Browser.IE||4==n)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(t.responseText),this.headerJSON=this._getHeaderJSON()),4==n){var i=t.responseXML;this.responseXML=Object.isUndefined(i)?null:i,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(e){return this.transport.getResponseHeader(e)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var e=this.getHeader("X-JSON");if(!e)return null;e=decodeURIComponent(escape(e));try{return e.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var e=this.request.options;if(!e.evalJSON||"force"!=e.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(e.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,e,t,n){this.container={success:e.success||e,failure:e.failure||(e.success?null:e)},n=Object.clone(n);var i=n.onComplete;n.onComplete=function(e,t){this.updateContent(e.responseText),Object.isFunction(i)&&i(e,t)}.bind(this),$super(t,n)},updateContent:function(e){var t=this.container[this.success()?"success":"failure"],n=this.options;if(n.evalScripts||(e=e.stripScripts()),t=$(t))if(n.insertion)if(Object.isString(n.insertion)){var i={};i[n.insertion]=e,t.insert(i)}else n.insertion(t,e);else t.update(e)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,e,t,n){$super(n),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=e,this.url=t,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(e){this.options.decay&&(this.decay=e.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=e.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(e,t){for(var n=[],i=document.evaluate(e,$(t)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),o=0,r=i.snapshotLength;r>o;o++)n.push(Element.extend(i.snapshotItem(o)));return n}),!Node)var Node={};Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),function(e){function t(e,t){return"select"===e?!1:"type"in t?!1:!0}var n=function(){try{var e=document.createElement('<input name="x">');return"input"===e.tagName.toLowerCase()&&"x"===e.name}catch(t){return!1}}(),i=e.Element;e.Element=function(e,i){i=i||{},e=e.toLowerCase();var o=Element.cache;if(n&&i.name)return e="<"+e+' name="'+i.name+'">',delete i.name,Element.writeAttribute(document.createElement(e),i);o[e]||(o[e]=Element.extend(document.createElement(e)));var r=t(e,i)?o[e].cloneNode(!1):document.createElement(e);return Element.writeAttribute(r,i)},Object.extend(e.Element,i||{}),i&&(e.Element.prototype=i.prototype)}(this),Element.idCounter=1,Element.cache={},Element._purgeElement=function(e){var t=e._prototypeUID;t&&(Element.stopObserving(e),e._prototypeUID=void 0,delete Element.Storage[t])},Element.Methods={visible:function(e){return"none"!=$(e).style.display},toggle:function(e){return e=$(e),Element[Element.visible(e)?"hide":"show"](e),e},hide:function(e){return e=$(e),e.style.display="none",e},show:function(e){return e=$(e),e.style.display="",e},remove:function(e){return e=$(e),e.parentNode.removeChild(e),e},update:function(){function e(e,t){e=$(e);for(var n=Element._purgeElement,s=e.getElementsByTagName("*"),a=s.length;a--;)n(s[a]);if(t&&t.toElement&&(t=t.toElement()),Object.isElement(t))return e.update().insert(t);t=Object.toHTML(t);var l=e.tagName.toUpperCase();if("SCRIPT"===l&&r)return e.text=t,e;if(o)if(l in Element._insertionTranslations.tags){for(;e.firstChild;)e.removeChild(e.firstChild);Element._getContentFromAnonymousElement(l,t.stripScripts()).each(function(t){e.appendChild(t)})}else if(i&&Object.isString(t)&&t.indexOf("<link")>-1){for(;e.firstChild;)e.removeChild(e.firstChild);var c=Element._getContentFromAnonymousElement(l,t.stripScripts(),!0);c.each(function(t){e.appendChild(t)})}else e.innerHTML=t.stripScripts();else e.innerHTML=t.stripScripts();return t.evalScripts.bind(t).defer(),e}var t=function(){var e=document.createElement("select"),t=!0;return e.innerHTML='<option value="test">test</option>',e.options&&e.options[0]&&(t="OPTION"!==e.options[0].nodeName.toUpperCase()),e=null,t}(),n=function(){try{var e=document.createElement("table");if(e&&e.tBodies){e.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var t="undefined"==typeof e.tBodies[0];return e=null,t}}catch(n){return!0}}(),i=function(){try{var e=document.createElement("div");e.innerHTML="<link>";var t=0===e.childNodes.length;return e=null,t}catch(n){return!0}}(),o=t||n||i,r=function(){var e=document.createElement("script"),t=!1;try{e.appendChild(document.createTextNode("")),t=!e.firstChild||e.firstChild&&3!==e.firstChild.nodeType}catch(n){t=!0}return e=null,t}();return e}(),replace:function(e,t){if(e=$(e),t&&t.toElement)t=t.toElement();else if(!Object.isElement(t)){t=Object.toHTML(t);var n=e.ownerDocument.createRange();n.selectNode(e),t.evalScripts.bind(t).defer(),t=n.createContextualFragment(t.stripScripts())}return e.parentNode.replaceChild(t,e),e},insert:function(e,t){e=$(e),(Object.isString(t)||Object.isNumber(t)||Object.isElement(t)||t&&(t.toElement||t.toHTML))&&(t={bottom:t});var n,i,o,r;for(var s in t)n=t[s],s=s.toLowerCase(),i=Element._insertionTranslations[s],n&&n.toElement&&(n=n.toElement()),Object.isElement(n)?i(e,n):(n=Object.toHTML(n),o=("before"==s||"after"==s?e.parentNode:e).tagName.toUpperCase(),r=Element._getContentFromAnonymousElement(o,n.stripScripts()),("top"==s||"after"==s)&&r.reverse(),r.each(i.curry(e)),n.evalScripts.bind(n).defer());return e},wrap:function(e,t,n){return e=$(e),Object.isElement(t)?$(t).writeAttribute(n||{}):t=Object.isString(t)?new Element(t,n):new Element("div",t),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t},inspect:function(e){e=$(e);var t="<"+e.tagName.toLowerCase();return $H({id:"id",className:"class"}).each(function(n){var i=n.first(),o=n.last(),r=(e[i]||"").toString();r&&(t+=" "+o+"="+r.inspect(!0))}),t+">"},recursivelyCollect:function(e,t,n){e=$(e),n=n||-1;for(var i=[];(e=e[t])&&(1==e.nodeType&&i.push(Element.extend(e)),i.length!=n););return i},ancestors:function(e){return Element.recursivelyCollect(e,"parentNode")},descendants:function(e){return Element.select(e,"*")},firstDescendant:function(e){for(e=$(e).firstChild;e&&1!=e.nodeType;)e=e.nextSibling;return $(e)},immediateDescendants:function(e){for(var t=[],n=$(e).firstChild;n;)1===n.nodeType&&t.push(Element.extend(n)),n=n.nextSibling;return t},previousSiblings:function(e,t){return Element.recursivelyCollect(e,"previousSibling")},nextSiblings:function(e){return Element.recursivelyCollect(e,"nextSibling")},siblings:function(e){return e=$(e),Element.previousSiblings(e).reverse().concat(Element.nextSiblings(e))},match:function(e,t){return e=$(e),Object.isString(t)?Prototype.Selector.match(e,t):t.match(e)},up:function(e,t,n){if(e=$(e),1==arguments.length)return $(e.parentNode);var i=Element.ancestors(e);return Object.isNumber(t)?i[t]:Prototype.Selector.find(i,t,n)},down:function(e,t,n){return e=$(e),1==arguments.length?Element.firstDescendant(e):Object.isNumber(t)?Element.descendants(e)[t]:Element.select(e,t)[n||0]},previous:function(e,t,n){return e=$(e),Object.isNumber(t)&&(n=t,t=!1),Object.isNumber(n)||(n=0),t?Prototype.Selector.find(e.previousSiblings(),t,n):e.recursivelyCollect("previousSibling",n+1)[n]},next:function(e,t,n){if(e=$(e),Object.isNumber(t)&&(n=t,t=!1),Object.isNumber(n)||(n=0),t)return Prototype.Selector.find(e.nextSiblings(),t,n);Object.isNumber(n)?n+1:1;return e.recursivelyCollect("nextSibling",n+1)[n]},select:function(e){e=$(e);var t=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(t,e)},adjacent:function(e){e=$(e);var t=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(t,e.parentNode).without(e)},identify:function(e){e=$(e);var t=Element.readAttribute(e,"id");if(t)return t;do t="anonymous_element_"+Element.idCounter++;while($(t));return Element.writeAttribute(e,"id",t),t},readAttribute:function(e,t){if(e=$(e),Prototype.Browser.IE){var n=Element._attributeTranslations.read;if(n.values[t])return n.values[t](e,t);if(n.names[t]&&(t=n.names[t]),t.include(":"))return e.attributes&&e.attributes[t]?e.attributes[t].value:null}return e.getAttribute(t)},writeAttribute:function(e,t,n){e=$(e);var i={},o=Element._attributeTranslations.write;"object"==typeof t?i=t:i[t]=Object.isUndefined(n)?!0:n;for(var r in i)t=o.names[r]||r,n=i[r],o.values[r]&&(t=o.values[r](e,n)),n===!1||null===n?e.removeAttribute(t):n===!0?e.setAttribute(t,t):e.setAttribute(t,n);return e},getHeight:function(e){return Element.getDimensions(e).height},getWidth:function(e){return Element.getDimensions(e).width},classNames:function(e){return new Element.ClassNames(e)},hasClassName:function(e,t){if(e=$(e)){var n=e.className;return n.length>0&&(n==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(n))}},addClassName:function(e,t){return(e=$(e))?(Element.hasClassName(e,t)||(e.className+=(e.className?" ":"")+t),e):void 0},removeClassName:function(e,t){return(e=$(e))?(e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").strip(),e):void 0},toggleClassName:function(e,t){return(e=$(e))?Element[Element.hasClassName(e,t)?"removeClassName":"addClassName"](e,t):void 0},cleanWhitespace:function(e){e=$(e);for(var t=e.firstChild;t;){var n=t.nextSibling;3!=t.nodeType||/\S/.test(t.nodeValue)||e.removeChild(t),t=n}return e},empty:function(e){return $(e).innerHTML.blank()},descendantOf:function(e,t){if(e=$(e),t=$(t),e.compareDocumentPosition)return 8===(8&e.compareDocumentPosition(t));if(t.contains)return t.contains(e)&&t!==e;for(;e=e.parentNode;)if(e==t)return!0;return!1},scrollTo:function(e){e=$(e);var t=Element.cumulativeOffset(e);return window.scrollTo(t[0],t[1]),e},getStyle:function(e,t){e=$(e),t="float"==t?"cssFloat":t.camelize();var n=e.style[t];if(!n||"auto"==n){var i=document.defaultView.getComputedStyle(e,null);n=i?i[t]:null}return"opacity"==t?n?parseFloat(n):1:"auto"==n?null:n},getOpacity:function(e){return $(e).getStyle("opacity")},setStyle:function(e,t){e=$(e);var n=e.style;if(Object.isString(t))return e.style.cssText+=";"+t,t.include("opacity")?e.setOpacity(t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var i in t)"opacity"==i?e.setOpacity(t[i]):n["float"==i||"cssFloat"==i?Object.isUndefined(n.styleFloat)?"cssFloat":"styleFloat":i]=t[i];return e},setOpacity:function(e,t){return e=$(e),e.style.opacity=1==t||""===t?"":1e-5>t?0:t,e},makePositioned:function(e){e=$(e);var t=Element.getStyle(e,"position");return"static"!=t&&t||(e._madePositioned=!0,e.style.position="relative",Prototype.Browser.Opera&&(e.style.top=0,e.style.left=0)),e},undoPositioned:function(e){return e=$(e),e._madePositioned&&(e._madePositioned=void 0,e.style.position=e.style.top=e.style.left=e.style.bottom=e.style.right=""),e},makeClipping:function(e){return e=$(e),e._overflow?e:(e._overflow=Element.getStyle(e,"overflow")||"auto","hidden"!==e._overflow&&(e.style.overflow="hidden"),e)},undoClipping:function(e){return e=$(e),e._overflow?(e.style.overflow="auto"==e._overflow?"":e._overflow,e._overflow=null,e):e},clonePosition:function(e,t){var n=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[2]||{});t=$(t);var i=Element.viewportOffset(t),o=[0,0],r=null;return e=$(e),"absolute"==Element.getStyle(e,"position")&&(r=Element.getOffsetParent(e),o=Element.viewportOffset(r)),r==document.body&&(o[0]-=document.body.offsetLeft,o[1]-=document.body.offsetTop),n.setLeft&&(e.style.left=i[0]-o[0]+n.offsetLeft+"px"),n.setTop&&(e.style.top=i[1]-o[1]+n.offsetTop+"px"),n.setWidth&&(e.style.width=t.offsetWidth+"px"),n.setHeight&&(e.style.height=t.offsetHeight+"px"),e}},Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants}),Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}},Prototype.Browser.Opera?(Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(e,t,n){switch(n){case"height":case"width":if(!Element.visible(t))return null;var i=parseInt(e(t,n),10);if(i!==t["offset"+n.capitalize()])return i+"px";var o;return o="height"===n?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"],o.inject(i,function(n,i){var o=e(t,i);return null===o?n:n-parseInt(o,10)})+"px";default:return e(t,n)}}),Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(e,t,n){return"title"===n?t.title:e(t,n)})):Prototype.Browser.IE?(Element.Methods.getStyle=function(e,t){e=$(e),t="float"==t||"cssFloat"==t?"styleFloat":t.camelize();var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),"opacity"==t?(n=(e.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&n[1]?parseFloat(n[1])/100:1:"auto"==n?"width"!=t&&"height"!=t||"none"==e.getStyle("display")?null:e["offset"+t.capitalize()]+"px":n},Element.Methods.setOpacity=function(e,t){function n(e){return e.replace(/alpha\([^\)]*\)/gi,"")}e=$(e);var i=e.currentStyle;(i&&!i.hasLayout||!i&&"normal"==e.style.zoom)&&(e.style.zoom=1);var o=e.getStyle("filter"),r=e.style;return 1==t||""===t?((o=n(o))?r.filter=o:r.removeAttribute("filter"),e):(1e-5>t&&(t=0),r.filter=n(o)+"alpha(opacity="+100*t+")",e)},Element._attributeTranslations=function(){var e="className",t="for",n=document.createElement("div");return n.setAttribute(e,"x"),"x"!==n.className&&(n.setAttribute("class","x"),"x"===n.className&&(e="class")),n=null,n=document.createElement("label"),n.setAttribute(t,"x"),"x"!==n.htmlFor&&(n.setAttribute("htmlFor","x"),"x"===n.htmlFor&&(t="htmlFor")),n=null,{read:{names:{"class":e,className:e,"for":t,htmlFor:t},values:{_getAttr:function(e,t){return e.getAttribute(t)},_getAttr2:function(e,t){return e.getAttribute(t,2)},_getAttrNode:function(e,t){var n=e.getAttributeNode(t);return n?n.value:""},_getEv:function(){var e,t=document.createElement("div");t.onclick=Prototype.emptyFunction;var n=t.getAttribute("onclick");return String(n).indexOf("{")>-1?e=function(e,t){return(t=e.getAttribute(t))?(t=t.toString(),t=t.split("{")[1],t=t.split("}")[0],t.strip()):null}:""===n&&(e=function(e,t){return t=e.getAttribute(t),t?t.strip():null}),t=null,e}(),_flag:function(e,t){return $(e).hasAttribute(t)?t:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}(),Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(e,t){e.checked=!!t},style:function(e,t){e.style.cssText=t?t:""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(e){Element._attributeTranslations.write.names[e.toLowerCase()]=e,Element._attributeTranslations.has[e.toLowerCase()]=e}),function(e){Object.extend(e,{href:e._getAttr2,src:e._getAttr2,type:e._getAttr,action:e._getAttrNode,disabled:e._flag,checked:e._flag,readonly:e._flag,multiple:e._flag,onload:e._getEv,onunload:e._getEv,onclick:e._getEv,ondblclick:e._getEv,onmousedown:e._getEv,onmouseup:e._getEv,onmouseover:e._getEv,onmousemove:e._getEv,onmouseout:e._getEv,onfocus:e._getEv,onblur:e._getEv,onkeypress:e._getEv,onkeydown:e._getEv,onkeyup:e._getEv,onsubmit:e._getEv,onreset:e._getEv,onselect:e._getEv,onchange:e._getEv})}(Element._attributeTranslations.read.values),Prototype.BrowserFeatures.ElementExtensions&&!function(){function e(e){for(var t,n=e.getElementsByTagName("*"),i=[],o=0;t=n[o];o++)"!"!==t.tagName&&i.push(t);return i}Element.Methods.down=function(t,n,i){return t=$(t),1==arguments.length?t.firstDescendant():Object.isNumber(n)?e(t)[n]:Element.select(t,n)[i||0]}}()):Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)?Element.Methods.setOpacity=function(e,t){return e=$(e),e.style.opacity=1==t?.999999:""===t?"":1e-5>t?0:t,e}:Prototype.Browser.WebKit&&(Element.Methods.setOpacity=function(e,t){if(e=$(e),e.style.opacity=1==t||""===t?"":1e-5>t?0:t,1==t)if("IMG"==e.tagName.toUpperCase()&&e.width)e.width++,e.width--;else try{var n=document.createTextNode(" ");e.appendChild(n),e.removeChild(n)}catch(i){}return e}),"outerHTML"in document.documentElement&&(Element.Methods.replace=function(e,t){if(e=$(e),t&&t.toElement&&(t=t.toElement()),Object.isElement(t))return e.parentNode.replaceChild(t,e),e;t=Object.toHTML(t);var n=e.parentNode,i=n.tagName.toUpperCase();if(Element._insertionTranslations.tags[i]){var o=e.next(),r=Element._getContentFromAnonymousElement(i,t.stripScripts());n.removeChild(e),o?r.each(function(e){n.insertBefore(e,o)}):r.each(function(e){n.appendChild(e)})}else e.outerHTML=t.stripScripts();return t.evalScripts.bind(t).defer(),e}),Element._returnOffset=function(e,t){var n=[e,t];return n.left=e,n.top=t,n},Element._getContentFromAnonymousElement=function(e,t,n){var i=new Element("div"),o=Element._insertionTranslations.tags[e],r=!1;if(o?r=!0:n&&(r=!0,o=["","",0]),r){i.innerHTML="&nbsp;"+o[0]+t+o[1],i.removeChild(i.firstChild);for(var s=o[2];s--;)i=i.firstChild}else i.innerHTML=t;return $A(i.childNodes)},Element._insertionTranslations={before:function(e,t){e.parentNode.insertBefore(t,e)},top:function(e,t){e.insertBefore(t,e.firstChild)},bottom:function(e,t){e.appendChild(t)},after:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},function(){var e=Element._insertionTranslations.tags;Object.extend(e,{THEAD:e.TBODY,TFOOT:e.TBODY,TH:e.TD})}(),Element.Methods.Simulated={hasAttribute:function(e,t){t=Element._attributeTranslations.has[t]||t;var n=$(e).getAttributeNode(t);return!(!n||!n.specified);
}},Element.Methods.ByTag={},Object.extend(Element,Element.Methods),function(e){!Prototype.BrowserFeatures.ElementExtensions&&e.__proto__&&(window.HTMLElement={},window.HTMLElement.prototype=e.__proto__,Prototype.BrowserFeatures.ElementExtensions=!0),e=null}(document.createElement("div")),Element.extend=function(){function e(e){if("undefined"!=typeof window.Element){var t=window.Element.prototype;if(t){var n="_"+(Math.random()+"").slice(2),i=document.createElement(e);t[n]="x";var o="x"!==i[n];return delete t[n],i=null,o}}return!1}function t(e,t){for(var n in t){var i=t[n];!Object.isFunction(i)||n in e||(e[n]=i.methodize())}}var n=e("object");if(Prototype.BrowserFeatures.SpecificElementExtensions)return n?function(e){if(e&&"undefined"==typeof e._extendedByPrototype){var n=e.tagName;n&&/^(?:object|applet|embed)$/i.test(n)&&(t(e,Element.Methods),t(e,Element.Methods.Simulated),t(e,Element.Methods.ByTag[n.toUpperCase()]))}return e}:Prototype.K;var i={},o=Element.Methods.ByTag,r=Object.extend(function(e){if(!e||"undefined"!=typeof e._extendedByPrototype||1!=e.nodeType||e==window)return e;var n=Object.clone(i),r=e.tagName.toUpperCase();return o[r]&&Object.extend(n,o[r]),t(e,n),e._extendedByPrototype=Prototype.emptyFunction,e},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(i,Element.Methods),Object.extend(i,Element.Methods.Simulated))}});return r.refresh(),r}(),document.documentElement.hasAttribute?Element.hasAttribute=function(e,t){return e.hasAttribute(t)}:Element.hasAttribute=Element.Methods.Simulated.hasAttribute,Element.addMethods=function(e){function t(t){t=t.toUpperCase(),Element.Methods.ByTag[t]||(Element.Methods.ByTag[t]={}),Object.extend(Element.Methods.ByTag[t],e)}function n(e,t,n){n=n||!1;for(var i in e){var o=e[i];Object.isFunction(o)&&(n&&i in t||(t[i]=o.methodize()))}}function i(e){var t,n={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(n[e]&&(t="HTML"+n[e]+"Element"),window[t])return window[t];if(t="HTML"+e+"Element",window[t])return window[t];if(t="HTML"+e.capitalize()+"Element",window[t])return window[t];var i=document.createElement(e),o=i.__proto__||i.constructor.prototype;return i=null,o}var o=Prototype.BrowserFeatures,r=Element.Methods.ByTag;if(e||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})),2==arguments.length){var s=e;e=arguments[1]}s?Object.isArray(s)?s.each(t):t(s):Object.extend(Element.Methods,e||{});var a=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(o.ElementExtensions&&(n(Element.Methods,a),n(Element.Methods.Simulated,a,!0)),o.SpecificElementExtensions)for(var l in Element.Methods.ByTag){var c=i(l);Object.isUndefined(c)||n(r[l],c.prototype)}Object.extend(Element,Element.Methods),delete Element.ByTag,Element.extend.refresh&&Element.extend.refresh(),Element.cache={}},document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}},function(e){function t(){return o.WebKit&&!r.evaluate?document:o.Opera&&window.parseFloat(window.opera.version())<9.5?document.body:document.documentElement}function n(n){return i||(i=t()),s[n]="client"+n,e["get"+n]=function(){return i[s[n]]},e["get"+n]()}var i,o=Prototype.Browser,r=document,s={};e.getWidth=n.curry("Width"),e.getHeight=n.curry("Height")}(document.viewport),Element.Storage={UID:1},Element.addMethods({getStorage:function(e){if(e=$(e)){var t;return e===window?t=0:("undefined"==typeof e._prototypeUID&&(e._prototypeUID=Element.Storage.UID++),t=e._prototypeUID),Element.Storage[t]||(Element.Storage[t]=$H()),Element.Storage[t]}},store:function(e,t,n){return(e=$(e))?(2===arguments.length?Element.getStorage(e).update(t):Element.getStorage(e).set(t,n),e):void 0},retrieve:function(e,t,n){if(e=$(e)){var i=Element.getStorage(e),o=i.get(t);return Object.isUndefined(o)&&(i.set(t,n),o=n),o}},clone:function(e,t){if(e=$(e)){var n=e.cloneNode(t);if(n._prototypeUID=void 0,t)for(var i=Element.select(n,"*"),o=i.length;o--;)i[o]._prototypeUID=void 0;return Element.extend(n)}},purge:function(e){if(e=$(e)){var t=Element._purgeElement;t(e);for(var n=e.getElementsByTagName("*"),i=n.length;i--;)t(n[i]);return null}}}),function(){function e(e){var t=e.match(/^(\d+)%?$/i);return t?Number(t[1])/100:null}function t(t,n,i){var o=null;if(Object.isElement(t)&&(o=t,t=o.getStyle(n)),null===t)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(t))return window.parseFloat(t);var r=t.include("%"),s=i===document.viewport;if(/\d/.test(t)&&o&&o.runtimeStyle&&(!r||!s)){var a=o.style.left,l=o.runtimeStyle.left;return o.runtimeStyle.left=o.currentStyle.left,o.style.left=t||0,t=o.style.pixelLeft,o.style.left=a,o.runtimeStyle.left=l,t}if(o&&r){i=i||o.parentNode;var c=e(t),u=null,h=(o.getStyle("position"),n.include("left")||n.include("right")||n.include("width")),d=n.include("top")||n.include("bottom")||n.include("height");return i===document.viewport?h?u=document.viewport.getWidth():d&&(u=document.viewport.getHeight()):h?u=$(i).measure("width"):d&&(u=$(i).measure("height")),null===u?0:u*c}return 0}function n(e){for(;e&&e.parentNode;){var t=e.getStyle("display");if("none"===t)return!1;e=$(e.parentNode)}return!0}function i(e){return e.include("border")&&(e+="-width"),e.camelize()}function o(e,t){return new Element.Layout(e,t)}function r(e,t){return $(e).getLayout().get(t)}function s(e){e=$(e);var t=Element.getStyle(e,"display");if(t&&"none"!==t)return{width:e.offsetWidth,height:e.offsetHeight};var n=e.style,i={visibility:n.visibility,position:n.position,display:n.display},o={visibility:"hidden",display:"block"};"fixed"!==i.position&&(o.position="absolute"),Element.setStyle(e,o);var r={width:e.offsetWidth,height:e.offsetHeight};return Element.setStyle(e,i),r}function a(e){if(e=$(e),g(e)||v(e)||p(e)||m(e))return $(document.body);var t="inline"===Element.getStyle(e,"display");if(!t&&e.offsetParent)return $(e.offsetParent);for(;(e=e.parentNode)&&e!==document.body;)if("static"!==Element.getStyle(e,"position"))return $(m(e)?document.body:e);return $(document.body)}function l(e){e=$(e);var t=0,n=0;if(e.parentNode)do t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent;while(e);return new Element.Offset(n,t)}function c(e){e=$(e);var t=e.getLayout(),n=0,i=0;do if(n+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent){if(p(e))break;var o=Element.getStyle(e,"position");if("static"!==o)break}while(e);return i-=t.get("margin-top"),n-=t.get("margin-left"),new Element.Offset(i,n)}function u(e){var t=0,n=0;do t+=e.scrollTop||0,n+=e.scrollLeft||0,e=e.parentNode;while(e);return new Element.Offset(n,t)}function h(e){o=$(o);var t=0,n=0,i=document.body,o=e;do if(t+=o.offsetTop||0,n+=o.offsetLeft||0,o.offsetParent==i&&"absolute"==Element.getStyle(o,"position"))break;while(o=o.offsetParent);o=e;do o!=i&&(t-=o.scrollTop||0,n-=o.scrollLeft||0);while(o=o.parentNode);return new Element.Offset(n,t)}function d(e){if(e=$(e),"absolute"===Element.getStyle(e,"position"))return e;var t=a(e),n=e.viewportOffset(),i=t.viewportOffset(),o=n.relativeTo(i),r=e.getLayout();return e.store("prototype_absolutize_original_styles",{left:e.getStyle("left"),top:e.getStyle("top"),width:e.getStyle("width"),height:e.getStyle("height")}),e.setStyle({position:"absolute",top:o.top+"px",left:o.left+"px",width:r.get("width")+"px",height:r.get("height")+"px"}),e}function f(e){if(e=$(e),"relative"===Element.getStyle(e,"position"))return e;var t=e.retrieve("prototype_absolutize_original_styles");return t&&e.setStyle(t),e}function p(e){return"BODY"===e.nodeName.toUpperCase()}function m(e){return"HTML"===e.nodeName.toUpperCase()}function g(e){return e.nodeType===Node.DOCUMENT_NODE}function v(e){return e!==document.body&&!Element.descendantOf(e,document.body)}var b=Prototype.K;"currentStyle"in document.documentElement&&(b=function(e){return e.currentStyle.hasLayout||(e.style.zoom=1),e}),Element.Layout=Class.create(Hash,{initialize:function($super,e,t){$super(),this.element=$(e),Element.Layout.PROPERTIES.each(function(e){this._set(e,null)},this),t&&(this._preComputing=!0,this._begin(),Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(e,t){return Hash.prototype.set.call(this,e,t)},set:function(e,t){throw"Properties of Element.Layout are read-only."},get:function($super,e){var t=$super(e);return null===t?this._compute(e):t},_begin:function(){if(!this._prepared){var e=this.element;if(n(e))return void(this._prepared=!0);var i={position:e.style.position||"",width:e.style.width||"",visibility:e.style.visibility||"",display:e.style.display||""};e.store("prototype_original_styles",i);var o=e.getStyle("position"),r=e.getStyle("width");("0px"===r||null===r)&&(e.style.display="block",r=e.getStyle("width"));var s="fixed"===o?document.viewport:e.parentNode;e.setStyle({position:"absolute",visibility:"hidden",display:"block"});var a,l=e.getStyle("width");if(r&&l===r)a=t(e,"width",s);else if("absolute"===o||"fixed"===o)a=t(e,"width",s);else{var c=e.parentNode,u=$(c).getLayout();a=u.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}e.setStyle({width:a+"px"}),this._prepared=!0}},_end:function(){var e=this.element,t=e.retrieve("prototype_original_styles");e.store("prototype_original_styles",null),e.setStyle(t),this._prepared=!1},_compute:function(e){var t=Element.Layout.COMPUTATIONS;if(!(e in t))throw"Property not found.";return this._set(e,t[e].call(this,this.element))},toObject:function(){var e=$A(arguments),t=0===e.length?Element.Layout.PROPERTIES:e.join(" ").split(" "),n={};return t.each(function(e){if(Element.Layout.PROPERTIES.include(e)){var t=this.get(e);null!=t&&(n[e]=t)}},this),n},toHash:function(){var e=this.toObject.apply(this,arguments);return new Hash(e)},toCSS:function(){var e=$A(arguments),t=0===e.length?Element.Layout.PROPERTIES:e.join(" ").split(" "),n={};return t.each(function(e){if(Element.Layout.PROPERTIES.include(e)&&!Element.Layout.COMPOSITE_PROPERTIES.include(e)){var t=this.get(e);null!=t&&(n[i(e)]=t+"px")}},this),n},inspect:function(){return"#<Element.Layout>"}}),Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(e){this._preComputing||this._begin();var t=this.get("border-box-height");if(0>=t)return this._preComputing||this._end(),0;var n=this.get("border-top"),i=this.get("border-bottom"),o=this.get("padding-top"),r=this.get("padding-bottom");return this._preComputing||this._end(),t-n-i-o-r},width:function(e){this._preComputing||this._begin();var t=this.get("border-box-width");if(0>=t)return this._preComputing||this._end(),0;var n=this.get("border-left"),i=this.get("border-right"),o=this.get("padding-left"),r=this.get("padding-right");return this._preComputing||this._end(),t-n-i-o-r},"padding-box-height":function(e){var t=this.get("height"),n=this.get("padding-top"),i=this.get("padding-bottom");return t+n+i},"padding-box-width":function(e){var t=this.get("width"),n=this.get("padding-left"),i=this.get("padding-right");return t+n+i},"border-box-height":function(e){this._preComputing||this._begin();var t=e.offsetHeight;return this._preComputing||this._end(),t},"border-box-width":function(e){this._preComputing||this._begin();var t=e.offsetWidth;return this._preComputing||this._end(),t},"margin-box-height":function(e){var t=this.get("border-box-height"),n=this.get("margin-top"),i=this.get("margin-bottom");return 0>=t?0:t+n+i},"margin-box-width":function(e){var t=this.get("border-box-width"),n=this.get("margin-left"),i=this.get("margin-right");return 0>=t?0:t+n+i},top:function(e){var t=e.positionedOffset();return t.top},bottom:function(e){var t=e.positionedOffset(),n=e.getOffsetParent(),i=n.measure("height"),o=this.get("border-box-height");return i-o-t.top},left:function(e){var t=e.positionedOffset();return t.left},right:function(e){var t=e.positionedOffset(),n=e.getOffsetParent(),i=n.measure("width"),o=this.get("border-box-width");return i-o-t.left},"padding-top":function(e){return t(e,"paddingTop")},"padding-bottom":function(e){return t(e,"paddingBottom")},"padding-left":function(e){return t(e,"paddingLeft")},"padding-right":function(e){return t(e,"paddingRight")},"border-top":function(e){return t(e,"borderTopWidth")},"border-bottom":function(e){return t(e,"borderBottomWidth")},"border-left":function(e){return t(e,"borderLeftWidth")},"border-right":function(e){return t(e,"borderRightWidth")},"margin-top":function(e){return t(e,"marginTop")},"margin-bottom":function(e){return t(e,"marginBottom")},"margin-left":function(e){return t(e,"marginLeft")},"margin-right":function(e){return t(e,"marginRight")}}}),"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(e){var t=b(e.getOffsetParent()),n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return(i.right-n.right).round()},bottom:function(e){var t=b(e.getOffsetParent()),n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return(i.bottom-n.bottom).round()}}),Element.Offset=Class.create({initialize:function(e,t){this.left=e.round(),this.top=t.round(),this[0]=this.left,this[1]=this.top},relativeTo:function(e){return new Element.Offset(this.left-e.left,this.top-e.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}}),Prototype.Browser.IE?(a=a.wrap(function(e,t){if(t=$(t),g(t)||v(t)||p(t)||m(t))return $(document.body);var n=t.getStyle("position");if("static"!==n)return e(t);t.setStyle({position:"relative"});var i=e(t);return t.setStyle({position:n}),i}),c=c.wrap(function(e,t){if(t=$(t),!t.parentNode)return new Element.Offset(0,0);var n=t.getStyle("position");if("static"!==n)return e(t);var i=t.getOffsetParent();i&&"fixed"===i.getStyle("position")&&b(i),t.setStyle({position:"relative"});var o=e(t);return t.setStyle({position:n}),o})):Prototype.Browser.Webkit&&(l=function(e){e=$(e);var t=0,n=0;do{if(t+=e.offsetTop||0,n+=e.offsetLeft||0,e.offsetParent==document.body&&"absolute"==Element.getStyle(e,"position"))break;e=e.offsetParent}while(e);return new Element.Offset(n,t)}),Element.addMethods({getLayout:o,measure:r,getDimensions:s,getOffsetParent:a,cumulativeOffset:l,positionedOffset:c,cumulativeScrollOffset:u,viewportOffset:h,absolutize:d,relativize:f}),"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(e){if(e=$(e),v(e))return new Element.Offset(0,0);var t=e.getBoundingClientRect(),n=document.documentElement;return new Element.Offset(t.left-n.clientLeft,t.top-n.clientTop)}})}(),window.$$=function(){var e=$A(arguments).join(", ");return Prototype.Selector.select(e,document)},Prototype.Selector=function(){function e(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function t(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function n(e,t,n){n=n||0;var i,o=Prototype.Selector.match,r=e.length,s=0;for(i=0;r>i;i++)if(o(e[i],t)&&n==s++)return Element.extend(e[i])}function i(e){for(var t=0,n=e.length;n>t;t++)Element.extend(e[t]);return e}var o=Prototype.K;return{select:e,match:t,find:n,extendElements:Element.extend===o?o:i,extendElement:Element.extend}}(),Prototype._original_property=window.Sizzle,/*!
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
function(){function e(e,t,n,i,o,r){for(var s="previousSibling"==e&&!r,a=0,l=i.length;l>a;a++){var c=i[a];if(c){s&&1===c.nodeType&&(c.sizcache=n,c.sizset=a),c=c[e];for(var u=!1;c;){if(c.sizcache===n){u=i[c.sizset];break}if(1!==c.nodeType||r||(c.sizcache=n,c.sizset=a),c.nodeName===t){u=c;break}c=c[e]}i[a]=u}}}function t(e,t,n,i,o,r){for(var s="previousSibling"==e&&!r,l=0,c=i.length;c>l;l++){var u=i[l];if(u){s&&1===u.nodeType&&(u.sizcache=n,u.sizset=l),u=u[e];for(var h=!1;u;){if(u.sizcache===n){h=i[u.sizset];break}if(1===u.nodeType)if(r||(u.sizcache=n,u.sizset=l),"string"!=typeof t){if(u===t){h=!0;break}}else if(a.filter(t,[u]).length>0){h=u;break}u=u[e]}i[l]=h}}}var n=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,i=0,o=Object.prototype.toString,r=!1,s=!0;[0,0].sort(function(){return s=!1,0});var a=function(e,t,i,r){i=i||[];var s=t=t||document;if(1!==t.nodeType&&9!==t.nodeType)return[];if(!e||"string"!=typeof e)return i;for(var u,d,f,v,b=[],y=!0,w=m(t),S=e;null!==(n.exec(""),u=n.exec(S));)if(S=u[3],b.push(u[1]),u[2]){v=u[3];break}if(b.length>1&&c.exec(e))if(2===b.length&&l.relative[b[0]])d=g(b[0]+b[1],t);else for(d=l.relative[b[0]]?[t]:a(b.shift(),t);b.length;)e=b.shift(),l.relative[e]&&(e+=b.shift()),d=g(e,d);else{if(!r&&b.length>1&&9===t.nodeType&&!w&&l.match.ID.test(b[0])&&!l.match.ID.test(b[b.length-1])){var x=a.find(b.shift(),t,w);t=x.expr?a.filter(x.expr,x.set)[0]:x.set[0]}if(t){var x=r?{expr:b.pop(),set:h(r)}:a.find(b.pop(),1!==b.length||"~"!==b[0]&&"+"!==b[0]||!t.parentNode?t:t.parentNode,w);for(d=x.expr?a.filter(x.expr,x.set):x.set,b.length>0?f=h(d):y=!1;b.length;){var C=b.pop(),_=C;l.relative[C]?_=b.pop():C="",null==_&&(_=t),l.relative[C](f,_,w)}}else f=b=[]}if(f||(f=d),!f)throw"Syntax error, unrecognized expression: "+(C||e);if("[object Array]"===o.call(f))if(y)if(t&&1===t.nodeType)for(var k=0;null!=f[k];k++)f[k]&&(f[k]===!0||1===f[k].nodeType&&p(t,f[k]))&&i.push(d[k]);else for(var k=0;null!=f[k];k++)f[k]&&1===f[k].nodeType&&i.push(d[k]);else i.push.apply(i,f);else h(f,i);return v&&(a(v,s,i,r),a.uniqueSort(i)),i};a.uniqueSort=function(e){if(f&&(r=s,e.sort(f),r))for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1);return e},a.matches=function(e,t){return a(e,null,null,t)},a.find=function(e,t,n){var i,o;if(!e)return[];for(var r=0,s=l.order.length;s>r;r++){var o,a=l.order[r];if(o=l.leftMatch[a].exec(e)){var c=o[1];if(o.splice(1,1),"\\"!==c.substr(c.length-1)&&(o[1]=(o[1]||"").replace(/\\/g,""),i=l.find[a](o,t,n),null!=i)){e=e.replace(l.match[a],"");break}}}return i||(i=t.getElementsByTagName("*")),{set:i,expr:e}},a.filter=function(e,t,n,i){for(var o,r,s=e,a=[],c=t,u=t&&t[0]&&m(t[0]);e&&t.length;){for(var h in l.filter)if(null!=(o=l.match[h].exec(e))){var d,f,p=l.filter[h];if(r=!1,c==a&&(a=[]),l.preFilter[h])if(o=l.preFilter[h](o,c,n,a,i,u)){if(o===!0)continue}else r=d=!0;if(o)for(var g=0;null!=(f=c[g]);g++)if(f){d=p(f,o,g,c);var v=i^!!d;n&&null!=d?v?r=!0:c[g]=!1:v&&(a.push(f),r=!0)}if(void 0!==d){if(n||(c=a),e=e.replace(l.match[h],""),!r)return[];break}}if(e==s){if(null==r)throw"Syntax error, unrecognized expression: "+e;break}s=e}return c};var l=a.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(e,t,n){var i="string"==typeof t,o=i&&!/\W/.test(t),r=i&&!o;o&&!n&&(t=t.toUpperCase());for(var s,l=0,c=e.length;c>l;l++)if(s=e[l]){for(;(s=s.previousSibling)&&1!==s.nodeType;);e[l]=r||s&&s.nodeName===t?s||!1:s===t}r&&a.filter(t,e,!0)},">":function(e,t,n){var i="string"==typeof t;if(i&&!/\W/.test(t)){t=n?t:t.toUpperCase();for(var o=0,r=e.length;r>o;o++){var s=e[o];if(s){var l=s.parentNode;e[o]=l.nodeName===t?l:!1}}}else{for(var o=0,r=e.length;r>o;o++){var s=e[o];s&&(e[o]=i?s.parentNode:s.parentNode===t)}i&&a.filter(t,e,!0)}},"":function(n,o,r){var s=i++,a=t;if(!/\W/.test(o)){var l=o=r?o:o.toUpperCase();a=e}a("parentNode",o,s,n,l,r)},"~":function(n,o,r){var s=i++,a=t;if("string"==typeof o&&!/\W/.test(o)){var l=o=r?o:o.toUpperCase();a=e}a("previousSibling",o,s,n,l,r)}},find:{ID:function(e,t,n){if("undefined"!=typeof t.getElementById&&!n){var i=t.getElementById(e[1]);return i?[i]:[]}},NAME:function(e,t,n){if("undefined"!=typeof t.getElementsByName){for(var i=[],o=t.getElementsByName(e[1]),r=0,s=o.length;s>r;r++)o[r].getAttribute("name")===e[1]&&i.push(o[r]);return 0===i.length?null:i}},TAG:function(e,t){return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,i,o,r){if(e=" "+e[1].replace(/\\/g,"")+" ",r)return e;for(var s,a=0;null!=(s=t[a]);a++)s&&(o^(s.className&&(" "+s.className+" ").indexOf(e)>=0)?n||i.push(s):n&&(t[a]=!1));return!1},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(e,t){for(var n=0;t[n]===!1;n++);return t[n]&&m(t[n])?e[1]:e[1].toUpperCase()},CHILD:function(e){if("nth"==e[1]){var t=/(-?)(\d*)n((?:\+|-)?\d*)/.exec("even"==e[2]&&"2n"||"odd"==e[2]&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}return e[0]=i++,e},ATTR:function(e,t,n,i,o,r){var s=e[1].replace(/\\/g,"");return!r&&l.attrMap[s]&&(e[1]=l.attrMap[s]),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,t,i,o,r){if("not"===e[1]){if(!((n.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var s=a.filter(e[3],t,i,!0^r);return i||o.push.apply(o,s),!1}e[3]=a(e[3],null,null,t)}else if(l.match.POS.test(e[0])||l.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return e.disabled===!1&&"hidden"!==e.type},disabled:function(e){return e.disabled===!0},checked:function(e){return e.checked===!0},selected:function(e){return e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!a(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||"BUTTON"===e.nodeName.toUpperCase()},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,n,i){return t===i.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0==t},eq:function(e,t,n){return n[3]-0==t}},filter:{PSEUDO:function(e,t,n,i){var o=t[1],r=l.filters[o];if(r)return r(e,n,t,i);if("contains"===o)return(e.textContent||e.innerText||"").indexOf(t[3])>=0;if("not"===o){for(var s=t[3],n=0,a=s.length;a>n;n++)if(s[n]===e)return!1;return!0}},CHILD:function(e,t){var n=t[1],i=e;switch(n){case"only":case"first":for(;i=i.previousSibling;)if(1===i.nodeType)return!1;if("first"==n)return!0;i=e;case"last":for(;i=i.nextSibling;)if(1===i.nodeType)return!1;return!0;case"nth":var o=t[2],r=t[3];if(1==o&&0==r)return!0;var s=t[0],a=e.parentNode;if(a&&(a.sizcache!==s||!e.nodeIndex)){var l=0;for(i=a.firstChild;i;i=i.nextSibling)1===i.nodeType&&(i.nodeIndex=++l);a.sizcache=s}var c=e.nodeIndex-r;return 0==o?0==c:c%o==0&&c/o>=0}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||e.nodeName===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],i=l.attrHandle[n]?l.attrHandle[n](e):null!=e[n]?e[n]:e.getAttribute(n),o=i+"",r=t[2],s=t[4];return null==i?"!="===r:"="===r?o===s:"*="===r?o.indexOf(s)>=0:"~="===r?(" "+o+" ").indexOf(s)>=0:s?"!="===r?o!=s:"^="===r?0===o.indexOf(s):"$="===r?o.substr(o.length-s.length)===s:"|="===r?o===s||o.substr(0,s.length+1)===s+"-":!1:o&&i!==!1},POS:function(e,t,n,i){var o=t[2],r=l.setFilters[o];return r?r(e,n,t,i):void 0}}},c=l.match.POS;for(var u in l.match)l.match[u]=new RegExp(l.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[u]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[u].source);var h=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(d){h=function(e,t){var n=t||[];if("[object Array]"===o.call(e))Array.prototype.push.apply(n,e);else if("number"==typeof e.length)for(var i=0,r=e.length;r>i;i++)n.push(e[i]);else for(var i=0;e[i];i++)n.push(e[i]);return n}}var f;document.documentElement.compareDocumentPosition?f=function(e,t){if(!e.compareDocumentPosition||!t.compareDocumentPosition)return e==t&&(r=!0),0;var n=4&e.compareDocumentPosition(t)?-1:e===t?0:1;return 0===n&&(r=!0),n}:"sourceIndex"in document.documentElement?f=function(e,t){if(!e.sourceIndex||!t.sourceIndex)return e==t&&(r=!0),0;var n=e.sourceIndex-t.sourceIndex;return 0===n&&(r=!0),n}:document.createRange&&(f=function(e,t){if(!e.ownerDocument||!t.ownerDocument)return e==t&&(r=!0),0;var n=e.ownerDocument.createRange(),i=t.ownerDocument.createRange();n.setStart(e,0),n.setEnd(e,0),i.setStart(t,0),i.setEnd(t,0);var o=n.compareBoundaryPoints(Range.START_TO_END,i);return 0===o&&(r=!0),o}),function(){var e=document.createElement("div"),t="script"+(new Date).getTime();e.innerHTML="<a name='"+t+"'/>";var n=document.documentElement;n.insertBefore(e,n.firstChild),document.getElementById(t)&&(l.find.ID=function(e,t,n){if("undefined"!=typeof t.getElementById&&!n){var i=t.getElementById(e[1]);return i?i.id===e[1]||"undefined"!=typeof i.getAttributeNode&&i.getAttributeNode("id").nodeValue===e[1]?[i]:void 0:[]}},l.filter.ID=function(e,t){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&n&&n.nodeValue===t}),n.removeChild(e),n=e=null}(),function(){var e=document.createElement("div");e.appendChild(document.createComment("")),e.getElementsByTagName("*").length>0&&(l.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if("*"===e[1]){for(var i=[],o=0;n[o];o++)1===n[o].nodeType&&i.push(n[o]);n=i}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&"undefined"!=typeof e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(l.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),document.querySelectorAll&&function(){var e=a,t=document.createElement("div");if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){a=function(t,n,i,o){if(n=n||document,!o&&9===n.nodeType&&!m(n))try{return h(n.querySelectorAll(t),i)}catch(r){}return e(t,n,i,o)};for(var n in e)a[n]=e[n];t=null}}(),document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>",0!==e.getElementsByClassName("e").length&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length&&(l.order.splice(1,0,"CLASS"),l.find.CLASS=function(e,t,n){return"undefined"==typeof t.getElementsByClassName||n?void 0:t.getElementsByClassName(e[1])},e=null))}();var p=document.compareDocumentPosition?function(e,t){return 16&e.compareDocumentPosition(t)}:function(e,t){return e!==t&&(e.contains?e.contains(t):!0)},m=function(e){return 9===e.nodeType&&"HTML"!==e.documentElement.nodeName||!!e.ownerDocument&&"HTML"!==e.ownerDocument.documentElement.nodeName},g=function(e,t){for(var n,i=[],o="",r=t.nodeType?[t]:t;n=l.match.PSEUDO.exec(e);)o+=n[0],e=e.replace(l.match.PSEUDO,"");e=l.relative[e]?e+"*":e;for(var s=0,c=r.length;c>s;s++)a(e,r[s],i);return a.filter(o,i)};window.Sizzle=a}(),function(e){function t(t,n){return i(e(t,n||document))}function n(t,n){return 1==e.matches(n,[t]).length}var i=Prototype.Selector.extendElements;Prototype.Selector.engine=e,Prototype.Selector.select=t,Prototype.Selector.match=n}(Sizzle),window.Sizzle=Prototype._original_property,delete Prototype._original_property;var Form={reset:function(e){return e=$(e),e.reset(),e},serializeElements:function(e,t){"object"!=typeof t?t={hash:!!t}:Object.isUndefined(t.hash)&&(t.hash=!0);var n,i,o,r,s=!1,a=t.submit;return t.hash?(r={},o=function(e,t,n){return t in e?(Object.isArray(e[t])||(e[t]=[e[t]]),e[t].push(n)):e[t]=n,e}):(r="",o=function(e,t,n){return e+(e?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(n)}),e.inject(r,function(e,t){return!t.disabled&&t.name&&(n=t.name,i=$(t).getValue(),null==i||"file"==t.type||"submit"==t.type&&(s||a===!1||a&&n!=a||!(s=!0))||(e=o(e,n,i))),e})}};Form.Methods={serialize:function(e,t){return Form.serializeElements(Form.getElements(e),t)},getElements:function(e){for(var t,n=$(e).getElementsByTagName("*"),i=[],o=Form.Element.Serializers,r=0;t=n[r];r++)i.push(t);return i.inject([],function(e,t){return o[t.tagName.toLowerCase()]&&e.push(Element.extend(t)),e})},getInputs:function(e,t,n){e=$(e);var i=e.getElementsByTagName("input");if(!t&&!n)return $A(i).map(Element.extend);for(var o=0,r=[],s=i.length;s>o;o++){var a=i[o];t&&a.type!=t||n&&a.name!=n||r.push(Element.extend(a))}return r},disable:function(e){return e=$(e),Form.getElements(e).invoke("disable"),e},enable:function(e){return e=$(e),Form.getElements(e).invoke("enable"),e},findFirstElement:function(e){var t=$(e).getElements().findAll(function(e){return"hidden"!=e.type&&!e.disabled}),n=t.findAll(function(e){return e.hasAttribute("tabIndex")&&e.tabIndex>=0}).sortBy(function(e){return e.tabIndex}).first();return n?n:t.find(function(e){return/^(?:input|select|textarea)$/i.test(e.tagName)})},focusFirstElement:function(e){e=$(e);var t=e.findFirstElement();return t&&t.activate(),e},request:function(e,t){e=$(e),t=Object.clone(t||{});var n=t.parameters,i=e.readAttribute("action")||"";return i.blank()&&(i=window.location.href),t.parameters=e.serialize(!0),n&&(Object.isString(n)&&(n=n.toQueryParams()),Object.extend(t.parameters,n)),e.hasAttribute("method")&&!t.method&&(t.method=e.method),new Ajax.Request(i,t)}},Form.Element={focus:function(e){return $(e).focus(),e},select:function(e){return $(e).select(),e}},Form.Element.Methods={serialize:function(e){if(e=$(e),!e.disabled&&e.name){var t=e.getValue();if(void 0!=t){var n={};return n[e.name]=t,Object.toQueryString(n)}}return""},getValue:function(e){e=$(e);var t=e.tagName.toLowerCase();return Form.Element.Serializers[t](e)},setValue:function(e,t){e=$(e);var n=e.tagName.toLowerCase();return Form.Element.Serializers[n](e,t),e},clear:function(e){return $(e).value="",e},present:function(e){return""!=$(e).value},activate:function(e){e=$(e);try{e.focus(),!e.select||"input"==e.tagName.toLowerCase()&&/^(?:button|reset|submit)$/i.test(e.type)||e.select()}catch(t){}return e},disable:function(e){return e=$(e),e.disabled=!0,e},enable:function(e){return e=$(e),e.disabled=!1,e}};var Field=Form.Element,$F=Form.Element.Methods.getValue;Form.Element.Serializers=function(){function e(e,i){switch(e.type.toLowerCase()){case"checkbox":case"radio":return t(e,i);default:return n(e,i)}}function t(e,t){return Object.isUndefined(t)?e.checked?e.value:null:void(e.checked=!!t)}function n(e,t){return Object.isUndefined(t)?e.value:void(e.value=t)}function i(e,t){if(Object.isUndefined(t))return("select-one"===e.type?o:r)(e);for(var n,i,s=!Object.isArray(t),a=0,l=e.length;l>a;a++)if(n=e.options[a],i=this.optionValue(n),s){if(i==t)return void(n.selected=!0)}else n.selected=t.include(i)}function o(e){var t=e.selectedIndex;return t>=0?s(e.options[t]):null}function r(e){var t,n=e.length;if(!n)return null;for(var i=0,t=[];n>i;i++){var o=e.options[i];o.selected&&t.push(s(o))}return t}function s(e){return Element.hasAttribute(e,"value")?e.value:e.text}return{input:e,inputSelector:t,textarea:n,select:i,selectOne:o,selectMany:r,optionValue:s,button:n}}(),Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,e,t,n){$super(n,t),this.element=$(e),this.lastValue=this.getValue()},execute:function(){var e=this.getValue();(Object.isString(this.lastValue)&&Object.isString(e)?this.lastValue!=e:String(this.lastValue)!=String(e))&&(this.callback(this.element,e),this.lastValue=e)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(e,t){this.element=$(e),this.callback=t,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var e=this.getValue();this.lastValue!=e&&(this.callback(this.element,e),this.lastValue=e)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(e){if(e.type)switch(e.type.toLowerCase()){case"checkbox":case"radio":Event.observe(e,"click",this.onElementEvent.bind(this));break;default:Event.observe(e,"change",this.onElementEvent.bind(this))}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),function(){function e(e,t){return e.which?e.which===t+1:e.button===t}function t(e,t){return e.button===_[t]}function n(e,t){switch(t){case 0:return 1==e.which&&!e.metaKey;case 1:return 2==e.which||1==e.which&&e.metaKey;case 2:return 3==e.which;default:return!1}}function i(e){return C(e,0)}function o(e){return C(e,1)}function r(e){return C(e,2)}function s(e){e=y.extend(e);var t=e.target,n=e.type,i=e.currentTarget;return i&&i.tagName&&("load"===n||"error"===n||"click"===n&&"input"===i.tagName.toLowerCase()&&"radio"===i.type)&&(t=i),t.nodeType==Node.TEXT_NODE&&(t=t.parentNode),Element.extend(t)}function a(e,t){var n=y.element(e);if(!t)return n;for(;n;){if(Object.isElement(n)&&Prototype.Selector.match(n,t))return Element.extend(n);n=n.parentNode}}function l(e){return{x:c(e),y:u(e)}}function c(e){var t=document.documentElement,n=document.body||{scrollLeft:0};return e.pageX||e.clientX+(t.scrollLeft||n.scrollLeft)-(t.clientLeft||0)}function u(e){var t=document.documentElement,n=document.body||{scrollTop:0};return e.pageY||e.clientY+(t.scrollTop||n.scrollTop)-(t.clientTop||0)}function h(e){y.extend(e),e.preventDefault(),e.stopPropagation(),e.stopped=!0}function d(e){var t;switch(e.type){case"mouseover":case"mouseenter":t=e.fromElement;break;case"mouseout":case"mouseleave":t=e.toElement;break;default:return null}return Element.extend(t)}function f(e,t,n){var i=Element.retrieve(e,"prototype_event_registry");Object.isUndefined(i)&&(E.push(e),i=Element.retrieve(e,"prototype_event_registry",$H()));var o=i.get(t);if(Object.isUndefined(o)&&(o=[],i.set(t,o)),o.pluck("handler").include(n))return!1;var r;return t.include(":")?r=function(i){return Object.isUndefined(i.eventName)?!1:i.eventName!==t?!1:(y.extend(i,e),void n.call(e,i))}:S||"mouseenter"!==t&&"mouseleave"!==t?r=function(t){y.extend(t,e),n.call(e,t)}:("mouseenter"===t||"mouseleave"===t)&&(r=function(t){y.extend(t,e);for(var i=t.relatedTarget;i&&i!==e;)try{i=i.parentNode}catch(o){i=e}i!==e&&n.call(e,t)}),r.handler=n,o.push(r),r}function p(){for(var e=0,t=E.length;t>e;e++)y.stopObserving(E[e]),E[e]=null}function m(e,t,n){e=$(e);var i=f(e,t,n);if(!i)return e;if(t.include(":"))e.addEventListener?e.addEventListener("dataavailable",i,!1):(e.attachEvent("ondataavailable",i),e.attachEvent("onlosecapture",i));else{var o=T(t);e.addEventListener?e.addEventListener(o,i,!1):e.attachEvent("on"+o,i)}return e}function g(e,t,n){e=$(e);var i=Element.retrieve(e,"prototype_event_registry");if(!i)return e;if(!t)return i.each(function(t){var n=t.key;g(e,n)}),e;var o=i.get(t);if(!o)return e;if(!n)return o.each(function(n){g(e,t,n.handler)}),e;for(var r,s=o.length;s--;)if(o[s].handler===n){r=o[s];break}if(!r)return e;if(t.include(":"))e.removeEventListener?e.removeEventListener("dataavailable",r,!1):(e.detachEvent("ondataavailable",r),e.detachEvent("onlosecapture",r));else{var a=T(t);e.removeEventListener?e.removeEventListener(a,r,!1):e.detachEvent("on"+a,r)}return i.set(t,o.without(r)),e}function v(e,t,n,i){e=$(e),Object.isUndefined(i)&&(i=!0),e==document&&document.createEvent&&!e.dispatchEvent&&(e=document.documentElement);var o;return document.createEvent?(o=document.createEvent("HTMLEvents"),o.initEvent("dataavailable",i,!0)):(o=document.createEventObject(),o.eventType=i?"ondataavailable":"onlosecapture"),o.eventName=t,o.memo=n||{},document.createEvent?e.dispatchEvent(o):e.fireEvent(o.eventType,o),y.extend(o)}function b(e,t,n,i){return e=$(e),Object.isFunction(n)&&Object.isUndefined(i)&&(i=n,n=null),new y.Handler(e,t,n,i).start()}var y={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},w=document.documentElement,S="onmouseenter"in w&&"onmouseleave"in w,x=function(e){return!1};window.attachEvent&&(x=window.addEventListener?function(e){return!(e instanceof window.Event)}:function(e){return!0});var C,_={0:1,1:4,2:2};C=window.attachEvent?window.addEventListener?function(n,i){return x(n)?t(n,i):e(n,i)}:t:Prototype.Browser.WebKit?n:e,y.Methods={isLeftClick:i,isMiddleClick:o,isRightClick:r,element:s,findElement:a,pointer:l,pointerX:c,pointerY:u,stop:h};var k=Object.keys(y.Methods).inject({},function(e,t){return e[t]=y.Methods[t].methodize(),e});if(window.attachEvent){var j={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};y.extend=function(e,t){if(!e)return!1;if(!x(e))return e;if(e._extendedByPrototype)return e;e._extendedByPrototype=Prototype.emptyFunction;var n=y.pointer(e);return Object.extend(e,{target:e.srcElement||t,relatedTarget:d(e),pageX:n.x,pageY:n.y}),Object.extend(e,k),Object.extend(e,j),e}}else y.extend=Prototype.K;window.addEventListener&&(y.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(y.prototype,k));var E=[];Prototype.Browser.IE&&window.attachEvent("onunload",p),Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,!1);var T=Prototype.K,A={mouseenter:"mouseover",mouseleave:"mouseout"};S||(T=function(e){return A[e]||e}),y.Handler=Class.create({initialize:function(e,t,n,i){this.element=$(e),this.eventName=t,this.selector=n,this.callback=i,this.handler=this.handleEvent.bind(this)},start:function(){return y.observe(this.element,this.eventName,this.handler),this},stop:function(){return y.stopObserving(this.element,this.eventName,this.handler),this},handleEvent:function(e){var t=y.findElement(e,this.selector);t&&this.callback.call(this.element,e,t)}}),Object.extend(y,y.Methods),Object.extend(y,{fire:v,observe:m,stopObserving:g,on:b}),Element.addMethods({fire:v,observe:m,stopObserving:g,on:b}),Object.extend(document,{fire:v.methodize(),observe:m.methodize(),stopObserving:g.methodize(),on:b.methodize(),loaded:!1}),window.Event?Object.extend(window.Event,y):window.Event=y}(),function(){function e(){document.loaded||(i&&window.clearTimeout(i),document.loaded=!0,document.fire("dom:loaded"))}function t(){"complete"===document.readyState&&(document.stopObserving("readystatechange",t),e())}function n(){try{document.documentElement.doScroll("left")}catch(t){return void(i=n.defer())}e()}var i;document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):(document.observe("readystatechange",t),window==top&&(i=n.defer())),Event.observe(window,"load",e)}(),Element.addMethods(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(e,t){return Element.insert(e,{before:t})},Top:function(e,t){return Element.insert(e,{top:t})},Bottom:function(e,t){return Element.insert(e,{bottom:t})},After:function(e,t){return Element.insert(e,{after:t})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(e,t,n){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(e,t,n):(this.xcomp=t,this.ycomp=n,this.offset=Element.cumulativeOffset(e),n>=this.offset[1]&&n<this.offset[1]+e.offsetHeight&&t>=this.offset[0]&&t<this.offset[0]+e.offsetWidth)},withinIncludingScrolloffsets:function(e,t,n){var i=Element.cumulativeScrollOffset(e);return this.xcomp=t+i[0]-this.deltaX,this.ycomp=n+i[1]-this.deltaY,this.offset=Element.cumulativeOffset(e),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+e.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+e.offsetWidth},overlap:function(e,t){return e?"vertical"==e?(this.offset[1]+t.offsetHeight-this.ycomp)/t.offsetHeight:"horizontal"==e?(this.offset[0]+t.offsetWidth-this.xcomp)/t.offsetWidth:void 0:0},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(e){return Position.prepare(),Element.absolutize(e)},relativize:function(e){return Position.prepare(),Element.relativize(e)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(e,t,n){return n=n||{},Element.clonePosition(t,e,n)}};document.getElementsByClassName||(document.getElementsByClassName=function(e){function t(e){return e.blank()?null:"[contains(concat(' ', @class, ' '), ' "+e+" ')]"}return e.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(e,n){n=n.toString().strip();var i=/\s/.test(n)?$w(n).map(t).join(""):t(n);return i?document._getElementsByXPath(".//*"+i,e):[]}:function(e,t){t=t.toString().strip();var n=[],i=/\s/.test(t)?$w(t):null;if(!i&&!t)return n;var o=$(e).getElementsByTagName("*");t=" "+t+" ";for(var r,s,a=0;r=o[a];a++)r.className&&(s=" "+r.className+" ")&&(s.include(t)||i&&i.all(function(e){return!e.toString().blank()&&s.include(" "+e+" ")}))&&n.push(Element.extend(r));return n},function(e,t){return $(t||document.body).getElementsByClassName(e)}}(Element.Methods)),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(e){this.element=$(e)},_each:function(e){this.element.className.split(/\s+/).select(function(e){return e.length>0})._each(e)},set:function(e){this.element.className=e},add:function(e){this.include(e)||this.set($A(this).concat(e).join(" "))},remove:function(e){this.include(e)&&this.set($A(this).without(e).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),function(){window.Selector=Class.create({initialize:function(e){this.expression=e.strip()},findElements:function(e){return Prototype.Selector.select(this.expression,e)},match:function(e){return Prototype.Selector.match(e,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}}),Object.extend(Selector,{matchElements:function(e,t){for(var n=Prototype.Selector.match,i=[],o=0,r=e.length;r>o;o++){var s=e[o];n(s,t)&&i.push(Element.extend(s))}return i},findElement:function(e,t,n){n=n||0;for(var i,o=0,r=0,s=e.length;s>r;r++)if(i=e[r],Prototype.Selector.match(i,t)&&n===o++)return Element.extend(i)},findChildElements:function(e,t){var n=t.toArray().join(", ");return Prototype.Selector.select(n,e||document)}})}(),$abTesting=function(){var e=function(e,n,i){var o=Cookies.get(e+"Cohort");return"Y"===o||"N"===o||"0"===o?(Cookies.set(e+"Cohort",o,i),jQuery.Deferred().resolve().promise()):t(e)?Math.round(Math.floor(99*Math.random())+1)<=n?$j.post("/track/track",{tid:e+"_cohort_y"},null,"script").done(function(){Cookies.set(e+"Cohort","Y",i)}):$j.post("/track/track",{tid:e+"_cohort_n"},null,"script").done(function(){Cookies.set(e+"Cohort","N",i)}):(Cookies.set(e+"Cohort","0",i),jQuery.Deferred().resolve().promise())},t=function(e){return $j("#js-"+e+"ExperimentResource").length>0},n=function(e){var t=Cookies.get(e+"Cohort");return"Y"===t},i=function(t,i,r){var s=$j("#js-"+t+"ExperimentResource");s.hasClass("js-"+t+"Experiment")&&e(t,i,r).done(function(){n(t)&&o(t)})},o=function(e){$j("#js-"+e+"ExperimentResource").hasClass(e+"Hidden")?$j("#js-"+e+"ExperimentResource").removeClass(e+"Hidden").addClass(e+"Shown"):$j("#js-"+e+"ExperimentResource").removeClass(e+"Shown").addClass(e+"Hidden")};return{runExperiment:i}}();var kindleCloudReaderAutoResize=function(){var e=.9*$j(window).width(),t=.9*$j(window).height();Lightbox.setLightboxDimensions(e,t),$j("#box .kindleCloudReader iframe").css("height",t-40+"px"),Lightbox.center("box")},kindleCloudReaderOpen=function(e){e.preventDefault();var t=$j(this).data("book-id"),n="kindleCloudReaderBook"+t;Lightbox.showBoxByID(n,970,400,!0);var i=$j("#boxContents"),o=$j("#close"),r={padding:i.css("padding"),margin:i.css("margin")};i.css("padding","0px").css("margin","0px"),o.css("top","13px").css("right","15px");var s=$j("#box .kindleCloudReader iframe"),a=$j(this).attr("href");s.attr("src",a).css({width:"100%",border:"none"}).show(),$j(window).resize(_.debounce(kindleCloudReaderAutoResize,300)),$("box").observe("Lightbox:hideBox",function(){$j(window).off("resize"),setTimeout(function(){i.css(r),o.css("top","5px").css("right","5px")},1e3)});for(var l=location.pathname.split("/"),c="",u=0;u<l.length-1;u++)c+=l[u];$j.post("/track/track",{tid:"preview_button--"+c+"--click"}),kindleCloudReaderAutoResize()},showWrongBookKindlePreviewScreen=function(e){e.preventDefault();var t=$j(this).data("book-id");Lightbox.showBoxByID("wrongBookKindlePreviewScreenBook"+t,500,150,!0)},hideWrongBookKindlePreviewScreen=function(e){Lightbox.hideBox(),Lightbox.showBoxByID("js-wrongBookKindlePreviewScreenConfirmation")},hideWrongBookReportConfirmation=function(){Lightbox.hideBox()};$j(document).on("click","#js-kcrPreviewButton",kindleCloudReaderOpen).on("click",".js-wrongBookKindlePreview",showWrongBookKindlePreviewScreen).on("click","#js-wrongBookKindlePreviewScreenCancelLink",hideWrongBookReportConfirmation).on("click","#js-wrongBookKindlePreviewScreenConfirmationDismiss",hideWrongBookReportConfirmation).on("submit",".new_kindle_book_mapping_flag",hideWrongBookKindlePreviewScreen).on("click",".syncPreviewButton",function(){$j.post("/track/track_click",{feature:"SyncPreviewButton"})}).on("click",".asyncPreviewButton",function(){$j.post("/track/track_click",{feature:"AsyncPreviewButton"})}),
// Copyright (c) 2005-2009 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
String.prototype.parseColor=function(){var e="#";if("rgb("==this.slice(0,4)){var t=this.slice(4,this.length-1).split(","),n=0;do e+=parseInt(t[n]).toColorPart();while(++n<3)}else if("#"==this.slice(0,1)){if(4==this.length)for(var n=1;4>n;n++)e+=(this.charAt(n)+this.charAt(n)).toLowerCase();7==this.length&&(e=this.toLowerCase())}return 7==e.length?e:arguments[0]||this},Element.collectTextNodes=function(e){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()?Element.collectTextNodes(e):""}).flatten().join("")},Element.collectTextNodesIgnoreClass=function(e,t){return $A($(e).childNodes).collect(function(e){return 3==e.nodeType?e.nodeValue:e.hasChildNodes()&&!Element.hasClassName(e,t)?Element.collectTextNodesIgnoreClass(e,t):""}).flatten().join("")},Element.setContentZoom=function(e,t){return e=$(e),e.setStyle({fontSize:t/100+"em"}),Prototype.Browser.WebKit&&window.scrollBy(0,0),e},Element.getInlineOpacity=function(e){return $(e).style.opacity||""},Element.forceRerendering=function(e){try{e=$(e);var t=document.createTextNode(" ");e.appendChild(t),e.removeChild(t)}catch(n){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(e){return-Math.cos(e*Math.PI)/2+.5},reverse:function(e){return 1-e},flicker:function(e){var e=-Math.cos(e*Math.PI)/4+.75+Math.random()/4;return e>1?1:e},wobble:function(e){return-Math.cos(e*Math.PI*(9*e))/2+.5},pulse:function(e,t){return-Math.cos(e*((t||5)-.5)*2*Math.PI)/2+.5},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)},none:function(e){return 0},full:function(e){return 1}},DefaultOptions:{duration:1,fps:100,sync:!1,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(e){var t="position:relative";Prototype.Browser.IE&&(t+=";zoom:1"),e=$(e),$A(e.childNodes).each(function(n){3==n.nodeType&&(n.nodeValue.toArray().each(function(i){e.insertBefore(new Element("span",{style:t}).update(" "==i?String.fromCharCode(160):i),n)}),Element.remove(n))})},multiple:function(e,t){var n;n=("object"==typeof e||Object.isFunction(e))&&e.length?e:$(e).childNodes;var i=Object.extend({speed:.1,delay:0},arguments[2]||{}),o=i.delay;$A(n).each(function(e,n){new t(e,Object.extend(i,{delay:n*i.speed+o}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(e,t,n){return e=$(e),t=(t||"appear").toLowerCase(),Effect[Effect.PAIRS[t][e.visible()?1:0]](e,Object.extend({queue:{position:"end",scope:e.id||"global",limit:1}},n||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal,Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[],this.interval=null},_each:function(e){this.effects._each(e)},add:function(e){var t=(new Date).getTime(),n=Object.isString(e.options.queue)?e.options.queue:e.options.queue.position;switch(n){case"front":this.effects.findAll(function(e){return"idle"==e.state}).each(function(t){t.startOn+=e.finishOn,t.finishOn+=e.finishOn});break;case"with-last":t=this.effects.pluck("startOn").max()||t;break;case"end":t=this.effects.pluck("finishOn").max()||t}e.startOn+=t,e.finishOn+=t,(!e.options.queue.limit||this.effects.length<e.options.queue.limit)&&this.effects.push(e),this.interval||(this.interval=setInterval(this.loop.bind(this),15))},remove:function(e){this.effects=this.effects.reject(function(t){return t==e}),0==this.effects.length&&(clearInterval(this.interval),this.interval=null)},loop:function(){for(var e=(new Date).getTime(),t=0,n=this.effects.length;n>t;t++)this.effects[t]&&this.effects[t].loop(e)}}),Effect.Queues={instances:$H(),get:function(e){return Object.isString(e)?this.instances.get(e)||this.instances.set(e,new Effect.ScopedQueue):e}},Effect.Queue=Effect.Queues.get("global"),Effect.Base=Class.create({position:null,start:function(e){e&&e.transition===!1&&(e.transition=Effect.Transitions.linear),this.options=Object.extend(Object.extend({},Effect.DefaultOptions),e||{}),this.currentFrame=0,this.state="idle",this.startOn=1e3*this.options.delay,this.finishOn=this.startOn+1e3*this.options.duration,this.fromToDelta=this.options.to-this.options.from,this.totalTime=this.finishOn-this.startOn,this.totalFrames=this.options.fps*this.options.duration,this.render=function(){function e(e,t){e.options[t+"Internal"]&&e.options[t+"Internal"](e),e.options[t]&&e.options[t](e)}return function(t){"idle"===this.state&&(this.state="running",e(this,"beforeSetup"),this.setup&&this.setup(),e(this,"afterSetup")),"running"===this.state&&(t=this.options.transition(t)*this.fromToDelta+this.options.from,this.position=t,e(this,"beforeUpdate"),this.update&&this.update(t),e(this,"afterUpdate"))}}(),this.event("beforeStart"),this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)},loop:function(e){if(e>=this.startOn){if(e>=this.finishOn)return this.render(1),this.cancel(),this.event("beforeFinish"),this.finish&&this.finish(),void this.event("afterFinish");var t=(e-this.startOn)/this.totalTime,n=(t*this.totalFrames).round();n>this.currentFrame&&(this.render(t),this.currentFrame=n)}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this),this.state="finished"},event:function(e){this.options[e+"Internal"]&&this.options[e+"Internal"](this),this.options[e]&&this.options[e](this)},inspect:function(){var e=$H();for(property in this)Object.isFunction(this[property])||e.set(property,this[property]);return"#<Effect:"+e.inspect()+",options:"+$H(this.options).inspect()+">"}}),Effect.Parallel=Class.create(Effect.Base,{initialize:function(e){this.effects=e||[],this.start(arguments[1])},update:function(e){this.effects.invoke("render",e)},finish:function(e){this.effects.each(function(t){t.render(1),t.cancel(),t.event("beforeFinish"),t.finish&&t.finish(e),t.event("afterFinish")})}}),Effect.Tween=Class.create(Effect.Base,{initialize:function(e,t,n){e=Object.isString(e)?$(e):e;var i=$A(arguments),o=i.last(),r=5==i.length?i[3]:null;this.method=Object.isFunction(o)?o.bind(e):Object.isFunction(e[o])?e[o].bind(e):function(t){e[o]=t},this.start(Object.extend({from:t,to:n},r||{}))},update:function(e){this.method(e)}}),Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction}),Effect.Opacity=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});var t=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(t)},update:function(e){this.element.setOpacity(e)}}),Effect.Move=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(t)},setup:function(){this.element.makePositioned(),this.originalLeft=parseFloat(this.element.getStyle("left")||"0"),this.originalTop=parseFloat(this.element.getStyle("top")||"0"),"absolute"==this.options.mode&&(this.options.x=this.options.x-this.originalLeft,this.options.y=this.options.y-this.originalTop)},update:function(e){this.element.setStyle({left:(this.options.x*e+this.originalLeft).round()+"px",top:(this.options.y*e+this.originalTop).round()+"px"})}}),Effect.MoveBy=function(e,t,n){return new Effect.Move(e,Object.extend({x:n,y:t},arguments[3]||{}))},Effect.Scale=Class.create(Effect.Base,{initialize:function(e,t){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var n=Object.extend({scaleX:!0,scaleY:!0,scaleContent:!0,scaleFromCenter:!1,scaleMode:"box",scaleFrom:100,scaleTo:t},arguments[2]||{});this.start(n)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||!1,this.elementPositioning=this.element.getStyle("position"),this.originalStyle={},["top","left","width","height","fontSize"].each(function(e){this.originalStyle[e]=this.element.style[e]}.bind(this)),this.originalTop=this.element.offsetTop,this.originalLeft=this.element.offsetLeft;var e=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(t){e.indexOf(t)>0&&(this.fontSize=parseFloat(e),this.fontSizeType=t)}.bind(this)),this.factor=(this.options.scaleTo-this.options.scaleFrom)/100,this.dims=null,"box"==this.options.scaleMode&&(this.dims=[this.element.offsetHeight,this.element.offsetWidth]),/^content/.test(this.options.scaleMode)&&(this.dims=[this.element.scrollHeight,this.element.scrollWidth]),this.dims||(this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth])},update:function(e){var t=this.options.scaleFrom/100+this.factor*e;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*t+this.fontSizeType}),this.setDimensions(this.dims[0]*t,this.dims[1]*t)},finish:function(e){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(e,t){var n={};if(this.options.scaleX&&(n.width=t.round()+"px"),this.options.scaleY&&(n.height=e.round()+"px"),this.options.scaleFromCenter){var i=(e-this.dims[0])/2,o=(t-this.dims[1])/2;"absolute"==this.elementPositioning?(this.options.scaleY&&(n.top=this.originalTop-i+"px"),this.options.scaleX&&(n.left=this.originalLeft-o+"px")):(this.options.scaleY&&(n.top=-i+"px"),this.options.scaleX&&(n.left=-o+"px"))}this.element.setStyle(n)}}),Effect.Highlight=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(t)},setup:function(){return"none"==this.element.getStyle("display")?void this.cancel():(this.oldStyle={},this.options.keepBackgroundImage||(this.oldStyle.backgroundImage=this.element.getStyle("background-image"),this.element.setStyle({backgroundImage:"none"})),this.options.endcolor||(this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")),this.options.restorecolor||(this.options.restorecolor=this.element.getStyle("background-color")),this._base=$R(0,2).map(function(e){return parseInt(this.options.startcolor.slice(2*e+1,2*e+3),16)}.bind(this)),void(this._delta=$R(0,2).map(function(e){return parseInt(this.options.endcolor.slice(2*e+1,2*e+3),16)-this._base[e]}.bind(this))))},update:function(e){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(t,n,i){return t+(this._base[i]+this._delta[i]*e).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}}),Effect.ScrollTo=function(e){var t=arguments[1]||{},n=document.viewport.getScrollOffsets(),i=$(e).cumulativeOffset();return t.offset&&(i[1]+=t.offset),new Effect.Tween(null,n.top,i[1],t,function(e){scrollTo(n.left,e.round())})},Effect.Fade=function(e){e=$(e);var t=e.getInlineOpacity(),n=Object.extend({from:e.getOpacity()||1,to:0,afterFinishInternal:function(e){0==e.options.to&&e.element.hide().setStyle({opacity:t})}},arguments[1]||{});return new Effect.Opacity(e,n)},Effect.Appear=function(e){e=$(e);var t=Object.extend({from:"none"==e.getStyle("display")?0:e.getOpacity()||0,to:1,afterFinishInternal:function(e){e.element.forceRerendering()},beforeSetup:function(e){e.element.setOpacity(e.options.from).show()}},arguments[1]||{});return new Effect.Opacity(e,t)},Effect.Puff=function(e){e=$(e);var t={opacity:e.getInlineOpacity(),position:e.getStyle("position"),top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return new Effect.Parallel([new Effect.Scale(e,200,{sync:!0,scaleFromCenter:!0,scaleContent:!0,restoreAfterFinish:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(t)}},arguments[1]||{}))},Effect.BlindUp=function(e){return e=$(e),e.makeClipping(),new Effect.Scale(e,0,Object.extend({scaleContent:!1,scaleX:!1,restoreAfterFinish:!0,afterFinishInternal:function(e){e.element.hide().undoClipping()}},arguments[1]||{}))},Effect.BlindDown=function(e){e=$(e);var t=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:0,scaleMode:{originalHeight:t.height,originalWidth:t.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},arguments[1]||{}))},Effect.SwitchOff=function(e){e=$(e);var t=e.getInlineOpacity();return new Effect.Appear(e,Object.extend({duration:.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:.3,scaleFromCenter:!0,scaleX:!1,scaleContent:!1,restoreAfterFinish:!0,beforeSetup:function(e){e.element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned().setStyle({opacity:t})}})}},arguments[1]||{}))},Effect.DropOut=function(e){e=$(e);var t={top:e.getStyle("top"),left:e.getStyle("left"),opacity:e.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(e,{x:0,y:100,sync:!0}),new Effect.Opacity(e,{sync:!0,to:0})],Object.extend({duration:.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(t)}},arguments[1]||{}))},Effect.Shake=function(e){e=$(e);var t=Object.extend({distance:20,duration:.5},arguments[1]||{}),n=parseFloat(t.distance),i=parseFloat(t.duration)/10,o={top:e.getStyle("top"),left:e.getStyle("left")};return new Effect.Move(e,{x:n,y:0,duration:i,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-n,y:0,duration:2*i,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*n,y:0,duration:2*i,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*-n,y:0,duration:2*i,afterFinishInternal:function(e){new Effect.Move(e.element,{x:2*n,y:0,duration:2*i,afterFinishInternal:function(e){new Effect.Move(e.element,{x:-n,y:0,duration:i,afterFinishInternal:function(e){e.element.undoPositioned().setStyle(o)}})}})}})}})}})}})},Effect.SlideDown=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),n=e.getDimensions();return new Effect.Scale(e,100,Object.extend({scaleContent:!1,scaleX:!1,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:n.height,originalWidth:n.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.SlideUp=function(e){e=$(e).cleanWhitespace();var t=e.down().getStyle("bottom"),n=e.getDimensions();return new Effect.Scale(e,window.opera?0:1,Object.extend({scaleContent:!1,scaleX:!1,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:n.height,originalWidth:n.width},restoreAfterFinish:!0,afterSetup:function(e){e.element.makePositioned(),e.element.down().makePositioned(),window.opera&&e.element.setStyle({top:""}),e.element.makeClipping().show()},afterUpdateInternal:function(e){e.element.down().setStyle({bottom:e.dims[0]-e.element.clientHeight+"px"})},afterFinishInternal:function(e){e.element.hide().undoClipping().undoPositioned(),e.element.down().undoPositioned().setStyle({bottom:t})}},arguments[1]||{}))},Effect.Squish=function(e){return new Effect.Scale(e,window.opera?1:0,{restoreAfterFinish:!0,beforeSetup:function(e){e.element.makeClipping()},afterFinishInternal:function(e){e.element.hide().undoClipping()}})},Effect.Grow=function(e){e=$(e);var t,n,i,o,r=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{}),s={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},a=e.getDimensions();switch(r.direction){case"top-left":t=n=i=o=0;break;case"top-right":t=a.width,n=o=0,i=-a.width;break;case"bottom-left":t=i=0,n=a.height,o=-a.height;break;case"bottom-right":t=a.width,n=a.height,i=-a.width,o=-a.height;break;case"center":t=a.width/2,n=a.height/2,i=-a.width/2,o=-a.height/2}return new Effect.Move(e,{x:t,y:n,duration:.01,beforeSetup:function(e){e.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(e){new Effect.Parallel([new Effect.Opacity(e.element,{sync:!0,to:1,from:0,transition:r.opacityTransition}),new Effect.Move(e.element,{x:i,y:o,sync:!0,transition:r.moveTransition}),new Effect.Scale(e.element,100,{scaleMode:{originalHeight:a.height,originalWidth:a.width},sync:!0,scaleFrom:window.opera?1:0,transition:r.scaleTransition,restoreAfterFinish:!0})],Object.extend({beforeSetup:function(e){e.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.effects[0].element.undoClipping().undoPositioned().setStyle(s)}},r))}})},Effect.Shrink=function(e){e=$(e);var t,n,i=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{}),o={top:e.style.top,left:e.style.left,height:e.style.height,width:e.style.width,opacity:e.getInlineOpacity()},r=e.getDimensions();switch(i.direction){case"top-left":t=n=0;break;case"top-right":t=r.width,n=0;break;case"bottom-left":t=0,n=r.height;break;case"bottom-right":t=r.width,n=r.height;break;case"center":t=r.width/2,n=r.height/2}return new Effect.Parallel([new Effect.Opacity(e,{sync:!0,to:0,from:1,transition:i.opacityTransition}),new Effect.Scale(e,window.opera?1:0,{sync:!0,transition:i.scaleTransition,restoreAfterFinish:!0}),new Effect.Move(e,{x:t,y:n,sync:!0,transition:i.moveTransition})],Object.extend({beforeStartInternal:function(e){e.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(e){e.effects[0].element.hide().undoClipping().undoPositioned().setStyle(o)}},i))},Effect.Pulsate=function(e){e=$(e);var t=arguments[1]||{},n=e.getInlineOpacity(),i=t.transition||Effect.Transitions.linear,o=function(e){return 1-i(-Math.cos(e*(t.pulses||5)*2*Math.PI)/2+.5)};return new Effect.Opacity(e,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(e){e.element.setStyle({opacity:n})}},t),{transition:o}))},Effect.Fold=function(e){e=$(e);var t={top:e.style.top,left:e.style.left,width:e.style.width,height:e.style.height};return e.makeClipping(),new Effect.Scale(e,5,Object.extend({scaleContent:!1,scaleX:!1,afterFinishInternal:function(n){new Effect.Scale(e,1,{scaleContent:!1,scaleY:!1,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(t)}})}},arguments[1]||{}))},Effect.Morph=Class.create(Effect.Base,{initialize:function(e){if(this.element=$(e),!this.element)throw Effect._elementDoesNotExistError;var t=Object.extend({style:{}},arguments[1]||{});if(Object.isString(t.style))if(t.style.include(":"))this.style=t.style.parseStyle();else{this.element.addClassName(t.style),this.style=$H(this.element.getStyles()),this.element.removeClassName(t.style);var n=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==n[e.key]}),t.afterFinishInternal=function(e){e.element.addClassName(e.options.style),e.transforms.each(function(t){e.element.style[t.style]=""})}}else this.style=$H(t.style);this.start(t)},setup:function(){function e(e){return(!e||["rgba(0, 0, 0, 0)","transparent"].include(e))&&(e="#ffffff"),e=e.parseColor(),$R(0,2).map(function(t){return parseInt(e.slice(2*t+1,2*t+3),16)})}this.transforms=this.style.map(function(t){var n=t[0],i=t[1],o=null;if("#zzzzzz"!=i.parseColor("#zzzzzz"))i=i.parseColor(),o="color";else if("opacity"==n)i=parseFloat(i),Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});else if(Element.CSS_LENGTH.test(i)){var r=i.match(/^([\+\-]?[0-9\.]+)(.*)$/);i=parseFloat(r[1]),o=3==r.length?r[2]:null}var s=this.element.getStyle(n);return{style:n.camelize(),originalValue:"color"==o?e(s):parseFloat(s||0),targetValue:"color"==o?e(i):i,unit:o}}.bind(this)).reject(function(e){return e.originalValue==e.targetValue||"color"!=e.unit&&(isNaN(e.originalValue)||isNaN(e.targetValue))})},update:function(e){for(var t,n={},i=this.transforms.length;i--;)n[(t=this.transforms[i]).style]="color"==t.unit?"#"+Math.round(t.originalValue[0]+(t.targetValue[0]-t.originalValue[0])*e).toColorPart()+Math.round(t.originalValue[1]+(t.targetValue[1]-t.originalValue[1])*e).toColorPart()+Math.round(t.originalValue[2]+(t.targetValue[2]-t.originalValue[2])*e).toColorPart():(t.originalValue+(t.targetValue-t.originalValue)*e).toFixed(3)+(null===t.unit?"":t.unit);this.element.setStyle(n,!0)}}),Effect.Transform=Class.create({initialize:function(e){this.tracks=[],this.options=arguments[1]||{},this.addTracks(e)},addTracks:function(e){return e.each(function(e){e=$H(e);var t=e.values().first();this.tracks.push($H({ids:e.keys().first(),effect:Effect.Morph,options:{style:t}}))}.bind(this)),this},play:function(){return new Effect.Parallel(this.tracks.map(function(e){var t=e.get("ids"),n=e.get("effect"),i=e.get("options"),o=[$(t)||$$(t)].flatten();return o.map(function(e){return new n(e,Object.extend({sync:!0},i))})}).flatten(),this.options)}}),Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex"),Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/,String.__parseStyleElement=document.createElement("div"),String.prototype.parseStyle=function(){var e,t=$H();return Prototype.Browser.WebKit?e=new Element("div",{style:this}).style:(String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>',e=String.__parseStyleElement.childNodes[0].style),Element.CSS_PROPERTIES.each(function(n){e[n]&&t.set(n,e[n])}),Prototype.Browser.IE&&this.include("opacity")&&t.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]),t},document.defaultView&&document.defaultView.getComputedStyle?Element.getStyles=function(e){var t=document.defaultView.getComputedStyle($(e),null);return Element.CSS_PROPERTIES.inject({},function(e,n){return e[n]=t[n],e})}:Element.getStyles=function(e){e=$(e);var t,n=e.currentStyle;return t=Element.CSS_PROPERTIES.inject({},function(e,t){return e[t]=n[t],e}),t.opacity||(t.opacity=e.getOpacity()),t},Effect.Methods={morph:function(e,t){return e=$(e),new Effect.Morph(e,Object.extend({style:t},arguments[2]||{})),e},visualEffect:function(e,t,n){e=$(e);var i=t.dasherize().camelize(),o=i.charAt(0).toUpperCase()+i.substring(1);return new Effect[o](e,n),e},highlight:function(e,t){return e=$(e),new Effect.Highlight(e,t),e}},$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(e){Effect.Methods[e]=function(t,n){return t=$(t),Effect[e.charAt(0).toUpperCase()+e.substring(1)](t,n),t}}),$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(e){Effect.Methods[e]=Element[e]}),Element.addMethods(Effect.Methods);var InlineFlash={_templateString:'<div id="header_#{message_type}_container"><div class="box noticeBox #{extra_classes}"><a href="#" onclick="$(this).up().up().hide()" class="right"><img src=\'/assets/layout/delete.png\' alt=\'Dismiss\' /></a>#{message}</div><br/></div>',showNotice:function(e){this._showFlash({message_type:"notice",message:e})},showError:function(e){this._showFlash({message_type:"error",extra_classes:"errorBox",message:e})},hideFlash:function(){this.flashContainer||(this.flashContainer=$("flashContainer")),this.flashContainer||(this.flashContainer=$("flashMessageContainer")),this.flashContainer.update("")},_showFlash:function(e){this.flashContainer||(this.flashContainer=$("flashContainer")),this.flashContainer||(this.flashContainer=$("flashMessageContainer")),this._template||(this._template=new Template(this._templateString)),this.flashContainer.update(this._template.evaluate(e))}};Element.Methods.cumulativeScrollOffset=function(e){var t=$j(document);if($j(".suggestedAuthorsContainer").length){var n=$j(".suggestedAuthorsContainer"),i=n.scrollLeft()+t.scrollLeft(),o=n.scrollTop()+t.scrollTop();return new Element.Offset(i,o)}return new Element.Offset(t.scrollLeft(),t.scrollTop())};var _={};
// Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
if(function(e){var t={};e.debounce=function(e,t,n){var i,o;return function(){var r=this,s=arguments,a=function(){i=null,n||(o=e.apply(r,s))},l=n&&!i;return clearTimeout(i),i=setTimeout(a,t),l&&(o=e.apply(r,s)),o}};var n=Array.prototype,i=n.slice,o=n.forEach,r=Object.keys,s=e.each=e.forEach=function(n,i,r){if(null!=n)if(o&&n.forEach===o)n.forEach(i,r);else if(n.length===+n.length){for(var s=0,a=n.length;a>s;s++)if(i.call(r,n[s],s,n)===t)return}else for(var l=e.keys(n),s=0,a=l.length;a>s;s++)if(i.call(r,n[l[s]],l[s],n)===t)return};e.defaults=function(e){return s(i.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/\{\{(.+?)\}\}/g,escape:/<%-([\s\S]+?)%>/g};var a=/(.)^/,l={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},c=/\\|'|\r|\n|\t|\u2028|\u2029/g;e.keys=r||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var n=[];for(var i in t)e.has(t,i)&&n.push(i);return n},e.invert=function(t){for(var n={},i=e.keys(t),o=0,r=i.length;r>o;o++)n[t[i[o]]]=i[o];return n};var u={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};u.unescape=e.invert(u.escape);var h={escape:new RegExp("["+e.keys(u.escape).join("")+"]","g"),unescape:new RegExp("("+e.keys(u.unescape).join("|")+")","g")};e.each(["escape","unescape"],function(t){e[t]=function(e){return null==e?"":(""+e).replace(h[t],function(e){return u[t][e]})}}),e.template=function(t,n,i){var o;i=e.defaults({},i,e.templateSettings);var r=new RegExp([(i.escape||a).source,(i.interpolate||a).source,(i.evaluate||a).source].join("|")+"|$","g"),s=0,u="__p+='";t.replace(r,function(e,n,i,o,r){return u+=t.slice(s,r).replace(c,function(e){return"\\"+l[e]}),n&&(u+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(u+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),o&&(u+="';\n"+o+"\n__p+='"),s=r+e.length,e}),u+="';\n",i.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{o=new Function(i.variable||"obj","_",u)}catch(h){throw h.source=u,h}if(n)return o(n,e);var d=function(t){return o.call(this,t,e)};return d.source="function("+(i.variable||"obj")+"){\n"+u+"}",d},s(["Arguments","Function","String","Number","Date","RegExp"],function(t){e["is"+t]=function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}})}(_),SignedOutExperiment=function(e){var t,n=e,i=.04,o=[],r=!0,s=function(e){i=e},a=function(e,t){void 0===l(e)&&(cell={},cell.name=e,cell.callback=t,o.push(cell))},l=function(e){return $j.grep(o,function(t){return t.name===e})[0]},c=function(){var e=Math.floor(Math.random()*o.length);return o[e]},u=function(){Cookies.set(n+"Cell",t.name,i)},h=function(){if(t=l(Cookies.get(n+"Cell")),void 0!==t)u();else if(r)return t=c(),$j.post("/track/track",{tid:n+"_cell_"+t.name},null,"script").done(function(){u()});return jQuery.Deferred().resolve().promise()},d=function(){r=!1},f=function(){h().done(function(){void 0!==t&&t.callback()})};return{setDurationDays:s,addCell:a,runExperiment:f,preventNewCookie:d}},/*
Copyright (c) 2009 Victor Stanciu - http://www.victorstanciu.ro

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.


2010-07-06 kueda Updated to support AJAX slide loading.

*/
Carousel=Class.create(Abstract,{initialize:function(e,t,n,i){if(this.scrolling=!1,this.scroller=$(e),this.slides=t,this.controls=n,this.options=Object.extend({duration:1,auto:!1,frequency:3,visibleSlides:1,controlClassName:"carousel-control",jumperClassName:"carousel-jumper",disabledClassName:"carousel-disabled",selectedClassName:"carousel-selected",circular:!1,wheel:!0,effect:"scroll",transition:"sinoidal"},i||{}),"fade"==this.options.effect&&(this.options.circular=!0),this.slides.each(function(e,t){e._index=t}),this.controls&&this.controls.invoke("observe","click",this.click.bind(this)),this.options.wheel&&this.scroller.observe("mousewheel",this.wheel.bindAsEventListener(this)).observe("DOMMouseScroll",this.wheel.bindAsEventListener(this)),this.options.auto&&this.start(),this.options.initial){var o=this.slides.indexOf($(this.options.initial));o>this.options.visibleSlides-1&&this.options.visibleSlides>1&&o>this.slides.length-(this.options.visibleSlides+1)&&(o=this.slides.length-this.options.visibleSlides),this.moveTo(this.slides[o])}},click:function(event){this.stop();var element=event.findElement("a");element.hasClassName(this.options.disabledClassName)||(element.hasClassName(this.options.controlClassName)?eval("this."+element.rel+"()"):element.hasClassName(this.options.jumperClassName)&&(this.moveTo(element.rel),this.options.selectedClassName&&(this.controls.invoke("removeClassName",this.options.selectedClassName),element.addClassName(this.options.selectedClassName)))),this.deactivateControls(),event.stop()},moveTo:function(e){this.options.beforeMove&&"function"==typeof this.options.beforeMove&&this.options.beforeMove(e),this.previous=this.current?this.current:this.slides[0],this.current=$(e);var t=this.scroller.cumulativeOffset(),n=this.current.cumulativeOffset();switch(this.scrolling&&this.scrolling.cancel(),this.options.effect){case"fade":this.scrolling=new Effect.Opacity(this.scroller,{from:1,to:0,duration:this.options.duration,afterFinish:function(){this.scroller.scrollLeft=n[0]-t[0],this.scroller.scrollTop=n[1]-t[1],new Effect.Opacity(this.scroller,{from:0,to:1,duration:this.options.duration,afterFinish:function(){this.controls&&this.activateControls(),this.options.afterMove&&"function"==typeof this.options.afterMove&&this.options.afterMove()}.bind(this)})}.bind(this)});break;case"scroll":default:var i;switch(this.options.transition){case"spring":i=Effect.Transitions.spring;break;case"sinoidal":default:i=Effect.Transitions.sinoidal}this.scrolling=new Effect.SmoothScroll(this.scroller,{duration:this.options.duration,x:n[0]-t[0],y:n[1]-t[1],transition:i,afterFinish:function(){this.controls&&this.activateControls(),this.options.afterMove&&"function"==typeof this.options.afterMove&&this.options.afterMove(),this.scrolling=!1}.bind(this)})}return!1},prev:function(){if(this.current)var e=this.current._index,t=0==e?this.options.circular?this.slides.length-1:0:e-1;else var t=this.options.circular?this.slides.length-1:0;t==this.slides.length-1&&this.options.circular&&"fade"!=this.options.effect&&(this.scroller.scrollLeft=(this.slides.length-1)*this.slides.first().getWidth(),this.scroller.scrollTop=(this.slides.length-1)*this.slides.first().getHeight(),t=this.slides.length-2),this.moveTo(this.slides[t])},next:function(){if(this.current)var e=this.current._index,t=this.slides.length-1==e?this.options.circular?0:e:e+1;else var t=1;if(0==t&&this.options.circular&&"fade"!=this.options.effect&&(this.scroller.scrollLeft=0,this.scroller.scrollTop=0,t=1),t>this.slides.length-(this.options.visibleSlides+1)&&(t=this.slides.length-this.options.visibleSlides),this.options.beforeNext&&"function"==typeof this.options.beforeNext){var n=this.options.beforeNext(this,e,t);if(0==n)return!1}if(this.options.url&&(null==e||e==t||t>=this.slides.length)){(null==e||e==t)&&(t+=1);var i=new Element("div",{"class":this.slides[0].className+" loading"}).update(this.options.loading||"loading...");i._index=t,$(this.slides[0]).up().appendChild(i),this.slides[t]=i;var o=this,r=Object.extend({parameters:{},onSuccess:function(e){$(i).up().insert(e.responseText);var n=$(i).next();o.slides[t]=n,n._index=t,o.current=n,$(i).remove()}},this.options.ajaxOptions||{}),s=t+1;"string"==typeof r.parameters?r.parameters="page="+s+"&"+r.parameters:r.parameters.page=s,new Ajax.Request(this.options.url,r)}this.moveTo(this.slides[t])},first:function(){this.moveTo(this.slides[0])},last:function(){this.moveTo(this.slides[this.slides.length-1])},toggle:function(){return this.previous?void this.moveTo(this.slides[this.previous._index]):!1},stop:function(){this.timer&&clearTimeout(this.timer)},start:function(){this.periodicallyUpdate()},pause:function(){this.stop(),this.activateControls()},resume:function(e){if(e){var t=e.relatedTarget||e.toElement;t&&(this.slides.include(t)||this.slides.any(function(e){return t.descendantOf(e)}))||this.start()}else this.start()},periodicallyUpdate:function(){null!=this.timer&&(clearTimeout(this.timer),this.next()),this.timer=setTimeout(this.periodicallyUpdate.bind(this),1e3*this.options.frequency)},wheel:function(e){e.cancelBubble=!0,e.stop();var t=0;return e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),this.scrolling||(this.deactivateControls(),t>0?this.prev():this.next()),Math.round(t)},deactivateControls:function(){this.controls.invoke("addClassName",this.options.disabledClassName)},activateControls:function(){this.controls.invoke("removeClassName",this.options.disabledClassName)}}),Effect.SmoothScroll=Class.create(),Object.extend(Object.extend(Effect.SmoothScroll.prototype,Effect.Base.prototype),{initialize:function(e){this.element=$(e);var t=Object.extend({x:0,y:0,mode:"absolute"},arguments[1]||{});this.start(t)},setup:function(){this.options.continuous&&!this.element._ext&&(this.element.cleanWhitespace(),this.element._ext=!0,this.element.appendChild(this.element.firstChild)),this.originalLeft=this.element.scrollLeft,this.originalTop=this.element.scrollTop,"absolute"==this.options.mode&&(this.options.x-=this.originalLeft,this.options.y-=this.originalTop)},update:function(e){this.element.scrollLeft=this.options.x*e+this.originalLeft,this.element.scrollTop=this.options.y*e+this.originalTop}}),"undefined"==typeof Effect)throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(e,t,n){e=$(e),this.element=e,this.update=$(t),this.hasFocus=!1,this.changed=!1,this.active=!1,this.index=0,this.entryCount=0,this.oldElementValue=this.element.value,this.setOptions?this.setOptions(n):this.options=n||{},this.options.paramName=this.options.paramName||this.element.name,this.options.tokens=this.options.tokens||[],this.options.frequency=this.options.frequency||.4,this.options.minChars=this.options.minChars||1,this.options.onShow=this.options.onShow||function(e,t){t.style.position&&"absolute"!=t.style.position||(t.style.position="absolute",Position.clone(e,t,{setHeight:!1,offsetTop:e.offsetHeight})),Effect.Appear(t,{duration:.15})},this.options.onHide=this.options.onHide||function(e,t){new Effect.Fade(t,{duration:.15})},"string"==typeof this.options.tokens&&(this.options.tokens=new Array(this.options.tokens)),this.options.tokens.include("\n")||this.options.tokens.push("\n"),this.observer=null,this.element.setAttribute("autocomplete","off"),Element.hide(this.update),Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this)),Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){"none"==Element.getStyle(this.update,"display")&&this.options.onShow(this.element,this.update),!this.iefix&&Prototype.Browser.IE&&"absolute"==Element.getStyle(this.update,"position")&&(new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>'),this.iefix=$(this.update.id+"_iefix")),this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height}),this.iefix.style.zIndex=1,this.update.style.zIndex=2,Element.show(this.iefix)},hide:function(){this.stopIndicator(),"none"!=Element.getStyle(this.update,"display")&&this.options.onHide(this.element,this.update),this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(e){if(this.active)switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(e);case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else if(e.keyCode==Event.KEY_TAB||e.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&0==e.keyCode)return;this.changed=!0,this.hasFocus=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},activate:function(){this.changed=!1,this.hasFocus=!0,this.getUpdatedChoices()},onHover:function(e){var t=Event.findElement(e,"LI");this.index!=t.autocompleteIndex&&(this.index=t.autocompleteIndex,this.render()),Event.stop(e)},onClick:function(e){var t=Event.findElement(e,"LI");this.index=t.autocompleteIndex,this.selectEntry(),this.hide()},onBlur:function(e){setTimeout(this.hide.bind(this),250),this.hasFocus=!1,this.active=!1},render:function(){if(this.entryCount>0){for(var e=0;e<this.entryCount;e++)this.index==e?Element.addClassName(this.getEntry(e),"selected"):Element.removeClassName(this.getEntry(e),"selected");this.hasFocus&&(this.show(),this.active=!0)}else this.active=!1,this.hide()},markPrevious:function(){this.index>0?(this.index--,this.elementAbovePage()&&this.getEntry(this.index).scrollIntoView(!0)):(this.index=this.entryCount-1,this.elementBelowPage()&&this.getEntry(this.index).scrollIntoView(!1))},markNext:function(){this.index<this.entryCount-1?(this.index++,this.elementBelowPage()&&this.getEntry(this.index).scrollIntoView(!1)):(this.index=0,this.elementAbovePage()&&this.getEntry(this.index).scrollIntoView(!0))},elementAbovePage:function(){var e=$j(this.getEntry(this.index)).offset().top,t=$j(window).scrollTop();return t>e},elementBelowPage:function(){var e=$j(window).scrollTop()+$j(window).height(),t=$j(this.getEntry(this.index)).offset().top+$j(this.getEntry(this.index)).height();return t>e},getEntry:function(e){return this.update.firstChild.childNodes[e]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=!1,this.updateElement(this.getCurrentEntry())},updateElement:function(e){if(this.options.updateElement)return void this.options.updateElement(e);var t="";if(this.options.select){var n=$(e).select("."+this.options.select)||[];n.length>0&&(t=Element.collectTextNodes(n[0],this.options.select))}else t=Element.collectTextNodesIgnoreClass(e,"informal");var i=this.getTokenBounds();if(-1!=i[0]){var o=this.element.value.substr(0,i[0]),r=this.element.value.substr(i[0]).match(/^\s+/);r&&(o+=r[0]),this.element.value=o+t+this.element.value.substr(i[1])}else this.element.value=t;this.oldElementValue=this.element.value,this.element.focus(),this.options.afterUpdateElement&&this.options.afterUpdateElement(this.element,e)},updateChoices:function(e){if(!this.changed&&this.hasFocus){if(this.update.innerHTML=e,Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.down()),this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var t=0;t<this.entryCount;t++){var n=this.getEntry(t);n.autocompleteIndex=t,this.addObservers(n)}}else this.entryCount=0;this.stopIndicator(),this.index=0,1==this.entryCount&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render()}},addObservers:function(e){Event.observe(e,"mouseover",this.onHover.bindAsEventListener(this)),Event.observe(e,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=!1,this.tokenBounds=null,this.getToken().length>=this.options.minChars?this.getUpdatedChoices():(this.active=!1,this.hide()),this.oldElementValue=this.element.value},getToken:function(){var e=this.getTokenBounds();return this.element.value.substring(e[0],e[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var e=this.element.value;if(e.strip().empty())return[-1,0];for(var t,n=arguments.callee.getFirstDifferencePos(e,this.oldElementValue),i=n==this.oldElementValue.length?1:0,o=-1,r=e.length,s=0,a=this.options.tokens.length;a>s;++s)t=e.lastIndexOf(this.options.tokens[s],n+i-1),t>o&&(o=t),t=e.indexOf(this.options.tokens[s],n+i),-1!=t&&r>t&&(r=t);return this.tokenBounds=[o+1,r]}}),Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(e,t){for(var n=Math.min(e.length,t.length),i=0;n>i;++i)if(e[i]!=t[i])return i;return n},Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){this.baseInitialize(e,t,i),this.options.asynchronous=!0,this.options.onComplete=this.onComplete.bind(this),this.options.defaultParams=this.options.parameters||null,this.url=n},getUpdatedChoices:function(){this.startIndicator();var e=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,e):e,this.options.defaultParams&&(this.options.parameters+="&"+this.options.defaultParams),new Ajax.Request(this.url,this.options)},onComplete:function(e){this.updateChoices(e.responseText)}}),Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){this.baseInitialize(e,t,i),this.options.array=n},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(e){this.options=Object.extend({choices:10,partialSearch:!0,partialChars:2,ignoreCase:!0,fullSearch:!1,selector:function(e){for(var t=[],n=[],i=e.getToken(),o=0;o<e.options.array.length&&t.length<e.options.choices;o++)for(var r=e.options.array[o],s=e.options.ignoreCase?r.toLowerCase().indexOf(i.toLowerCase()):r.indexOf(i);-1!=s;){if(0==s&&r.length!=i.length){t.push("<li><strong>"+r.substr(0,i.length)+"</strong>"+r.substr(i.length)+"</li>");break}if(i.length>=e.options.partialChars&&e.options.partialSearch&&-1!=s&&(e.options.fullSearch||/\s/.test(r.substr(s-1,1)))){n.push("<li>"+r.substr(0,s)+"<strong>"+r.substr(s,i.length)+"</strong>"+r.substr(s+i.length)+"</li>");break}s=e.options.ignoreCase?r.toLowerCase().indexOf(i.toLowerCase(),s+1):r.indexOf(i,s+1)}return n.length&&(t=t.concat(n.slice(0,e.options.choices-t.length))),"<ul>"+t.join("")+"</ul>"}},e||{})}}),Field.scrollFreeActivate=function(e){setTimeout(function(){Field.activate(e)},1)},Ajax.InPlaceEditor=Class.create({initialize:function(e,t,n){this.url=t,this.element=e=$(e),this.prepareOptions(),this._controls={},arguments.callee.dealWithDeprecatedOptions(n),Object.extend(this.options,n||{}),!this.options.formId&&this.element.id&&(this.options.formId=this.element.id+"-inplaceeditor",$(this.options.formId)&&(this.options.formId="")),this.options.externalControl&&(this.options.externalControl=$(this.options.externalControl)),this.options.externalControl||(this.options.externalControlOnly=!1),this._originalBackground=this.element.getStyle("background-color")||"transparent",this.element.title=this.options.clickToEditText,this._boundCancelHandler=this.handleFormCancellation.bind(this),this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this),this._boundFailureHandler=this.handleAJAXFailure.bind(this),this._boundSubmitHandler=this.handleFormSubmission.bind(this),this._boundWrapperHandler=this.wrapUp.bind(this),this.registerListeners()},checkForEscapeOrReturn:function(e){!this._editing||e.ctrlKey||e.altKey||e.shiftKey||(Event.KEY_ESC==e.keyCode?this.handleFormCancellation(e):Event.KEY_RETURN==e.keyCode&&this.handleFormSubmission(e))},createControl:function(e,t,n){var i=this.options[e+"Control"],o=this.options[e+"Text"];if("button"==i){var r=document.createElement("input");r.type="submit",r.value=o,r.className="editor_"+e+"_button","cancel"==e&&(r.onclick=this._boundCancelHandler),this._form.appendChild(r),this._controls[e]=r}else if("link"==i){var s=document.createElement("a");s.href="#",s.appendChild(document.createTextNode(o)),s.onclick="cancel"==e?this._boundCancelHandler:this._boundSubmitHandler,s.className="editor_"+e+"_link",n&&(s.className+=" "+n),this._form.appendChild(s),this._controls[e]=s}},createEditField:function(){var e,t=this.options.loadTextURL?this.options.loadingText:this.getText();if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){e=document.createElement("input"),e.type="text";var n=this.options.size||this.options.cols||0;n>0&&(e.size=n)}else e=document.createElement("textarea"),e.rows=1>=this.options.rows?this.options.autoRows:this.options.rows,e.cols=this.options.cols||40;e.name=this.options.paramName,e.value=t,e.className="editor_field",this.options.submitOnBlur&&(e.onblur=this._boundSubmitHandler),this._controls.editor=e,this.options.loadTextURL&&this.loadExternalText(),this._form.appendChild(this._controls.editor)},createForm:function(){function e(e,n){var i=t.options["text"+e+"Controls"];i&&n!==!1&&t._form.appendChild(document.createTextNode(i))}var t=this;this._form=$(document.createElement("form")),this._form.id=this.options.formId,this._form.addClassName(this.options.formClassName),this._form.onsubmit=this._boundSubmitHandler,this.createEditField(),"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br")),this.options.onFormCustomization&&this.options.onFormCustomization(this,this._form),e("Before",this.options.okControl||this.options.cancelControl),this.createControl("ok",this._boundSubmitHandler),e("Between",this.options.okControl&&this.options.cancelControl),this.createControl("cancel",this._boundCancelHandler,"editor_cancel"),e("After",this.options.okControl||this.options.cancelControl)},destroy:function(){this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML),this.leaveEditMode(),this.unregisterListeners()},enterEditMode:function(e){this._saving||this._editing||(this._editing=!0,this.triggerCallback("onEnterEditMode"),this.options.externalControl&&this.options.externalControl.hide(),this.element.hide(),this.createForm(),this.element.parentNode.insertBefore(this._form,this.element),this.options.loadTextURL||this.postProcessEditField(),e&&Event.stop(e))},enterHover:function(e){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName),this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(e){this.triggerCallback("onFailure",e),this._oldInnerHTML&&(this.element.innerHTML=this._oldInnerHTML,this._oldInnerHTML=null)},handleFormCancellation:function(e){this.wrapUp(),e&&Event.stop(e)},handleFormSubmission:function(e){var t=this._form,n=$F(this._controls.editor);this.prepareSubmission();var i=this.options.callback(t,n)||"";if(Object.isString(i)&&(i=i.toQueryParams()),i.editorId=this.element.id,this.options.htmlResponse){var o=Object.extend({evalScripts:!0},this.options.ajaxOptions);Object.extend(o,{parameters:i,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Updater({success:this.element},this.url,o)}else{var o=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(o,{parameters:i,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler}),new Ajax.Request(this.url,o)}e&&Event.stop(e)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName),this.removeForm(),this.leaveHover(),this.element.style.backgroundColor=this._originalBackground,this.element.show(),this.options.externalControl&&this.options.externalControl.show(),this._saving=!1,this._editing=!1,this._oldInnerHTML=null,this.triggerCallback("onLeaveEditMode")},leaveHover:function(e){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName),this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName),this._controls.editor.disabled=!0;var e=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(e,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(e){this._form.removeClassName(this.options.loadingClassName);var t=e.responseText;this.options.stripLoadedTextTags&&(t=t.stripTags()),this._controls.editor.value=t,this._controls.editor.disabled=!1,this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler}),new Ajax.Request(this.options.loadTextURL,e)},postProcessEditField:function(){var e=this.options.fieldPostCreation;e&&$(this._controls.editor)["focus"==e?"focus":"activate"]()},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions),Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks),[this._extraDefaultOptions].flatten().compact().each(function(e){Object.extend(this.options,e)}.bind(this))},prepareSubmission:function(){this._saving=!0,this.removeForm(),this.leaveHover(),this.showSaving()},registerListeners:function(){this._listeners={};var e;$H(Ajax.InPlaceEditor.Listeners).each(function(t){e=this[t.value].bind(this),this._listeners[t.key]=e,this.options.externalControlOnly||this.element.observe(t.key,e),this.options.externalControl&&this.options.externalControl.observe(t.key,e)}.bind(this))},removeForm:function(){this._form&&(this._form.remove(),this._form=null,this._controls={})},showSaving:function(){this._oldInnerHTML=this.element.innerHTML,this.element.innerHTML=this.options.savingText,this.element.addClassName(this.options.savingClassName),this.element.style.backgroundColor=this._originalBackground,this.element.show()},triggerCallback:function(e,t){"function"==typeof this.options[e]&&this.options[e](this,t)},unregisterListeners:function(){$H(this._listeners).each(function(e){this.options.externalControlOnly||this.element.stopObserving(e.key,e.value),this.options.externalControl&&this.options.externalControl.stopObserving(e.key,e.value)}.bind(this))},wrapUp:function(e){this.leaveEditMode(),this._boundComplete(e,this.element)}}),Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy}),Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,e,t,n){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions,$super(e,t,n)},createEditField:function(){var e=document.createElement("select");e.name=this.options.paramName,e.size=1,this._controls.editor=e,this._collection=this.options.collection||[],this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText(),this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName),this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js))throw"Server returned an invalid collection representation.";this._collection=eval(js),this.checkForExternalText()}.bind(this),onFailure:this.onFailure}),new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(e){this._controls.editor.disabled=!0;var t=this._controls.editor.firstChild;t||(t=document.createElement("option"),t.value="",this._controls.editor.appendChild(t),t.selected=!0),t.update((e||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText(),this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var e=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(e,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(e){this._text=e.responseText.strip(),this.buildOptionList()}.bind(this),onFailure:this.onFailure}),new Ajax.Request(this.options.loadTextURL,e)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName),this._collection=this._collection.map(function(e){return 2===e.length?e:[e,e].flatten()});var e="value"in this.options?this.options.value:this._text,t=this._collection.any(function(t){return t[0]==e}.bind(this));this._controls.editor.update("");var n;this._collection.each(function(i,o){n=document.createElement("option"),n.value=i[0],n.selected=t?i[0]==e:0==o,n.appendChild(document.createTextNode(i[1])),this._controls.editor.appendChild(n)}.bind(this)),this._controls.editor.disabled=!1,Field.scrollFreeActivate(this._controls.editor)}}),
//**** DEPRECATION LAYER FOR InPlace[Collection]Editor! ****
//**** API and convert your code to it ASAP!            ****
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(e){function t(t,n){t in e||void 0===n||(e[t]=n)}e&&(t("cancelControl",e.cancelLink?"link":e.cancelButton?"button":e.cancelLink==e.cancelButton==0?!1:void 0),t("okControl",e.okLink?"link":e.okButton?"button":e.okLink==e.okButton==0?!1:void 0),t("highlightColor",e.highlightcolor),t("highlightEndColor",e.highlightendcolor))},Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:!1,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:!0,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:!1,submitOnBlur:!1,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(e){return Form.serialize(e)},onComplete:function(e,t){new Effect.Highlight(t,{startcolor:this.options.highlightColor,keepBackgroundImage:!0})},onEnterEditMode:null,onEnterHover:function(e){e.element.style.backgroundColor=e.options.highlightColor,e._effect&&e._effect.cancel()},onFailure:function(e,t){alert("Error communication with the server: "+e.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(e){e._effect=new Effect.Highlight(e.element,{startcolor:e.options.highlightColor,endcolor:e.options.highlightEndColor,restorecolor:e._originalBackground,keepBackgroundImage:!0})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}}),Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."},Form.Element.DelayedObserver=Class.create({initialize:function(e,t,n){this.delay=t||.5,this.element=$(e),this.callback=n,this.timer=null,this.lastValue=$F(this.element),Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(e){this.lastValue!=$F(this.element)&&(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onTimerEvent.bind(this),1e3*this.delay),this.lastValue=$F(this.element))},onTimerEvent:function(){this.timer=null,this.callback(this.element,$F(this.element))}});var DatePickerUtils={oneDayInMs:864e5,_daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],getMonthDays:function(e,t){return 0!=e%4||0==e%100&&0!=e%400||1!=t?this._daysInMonth[t]:29},parseDate:function(e){var t=DatePickerUtils.ansiDateToObject(e);if(!t){parseFloat(e);t=new Date,t.setTime(t.getTime()+e*this.oneDayInMs)}return t},dateObjectToAnsi:function(e){return e?e.getFullYear().toPaddedString(4)+"-"+(e.getMonth()+1).toPaddedString(2)+"-"+e.getDate().toPaddedString(2):null},ansiDateToObject:function(e){var t=null,n=String(e).match(/^(\d+)-0*(\d+)-0*(\d+)$/);return n&&(t=new Date(n[1],n[2]-1,n[3])),t},yearMonthToAnsiStub:function(e,t){return e.toPaddedString(4)+"-"+(t+1).toPaddedString(2)+"-"},noDatesBefore:function(e){return new DatePickerFilter(function(t,n){for(var i=DatePickerUtils.dateObjectToAnsi(DatePickerUtils.parseDate(e)),o=new Array,r=DatePickerUtils.getMonthDays(t,n),s=DatePickerUtils.yearMonthToAnsiStub(t,n),a=1;r>=a;a++)o[a]=i>s+a.toPaddedString(2);return o},function(t,n){var i=DatePickerUtils.dateObjectToAnsi(DatePickerUtils.parseDate(e)),o=DatePickerUtils.yearMonthToAnsiStub(t,n)+DatePickerUtils.getMonthDays(t,n);return o>=i})},noDatesAfter:function(e){return new DatePickerFilter(function(t,n){for(var i=DatePickerUtils.dateObjectToAnsi(DatePickerUtils.parseDate(e)),o=new Array,r=DatePickerUtils.getMonthDays(t,n),s=DatePickerUtils.yearMonthToAnsiStub(t,n),a=1;r>=a;a++)o[a]=i<s+a.toPaddedString(2);return o},function(t,n){var i=DatePickerUtils.dateObjectToAnsi(DatePickerUtils.parseDate(e)),o=DatePickerUtils.yearMonthToAnsiStub(t,n)+"01";return i>=o})},noWeekends:function(){return new DatePickerFilter(function(e,t){for(var n=new Array,i=DatePickerUtils.getMonthDays(e,t),o=new Date(e,t,1),r=1;i>=r;o.setFullYear(e,t,++r))n[r]=o.getDay()%6==0;return n},null)}},DatePickerFormatter=Class.create();DatePickerFormatter.prototype={initialize:function(e,t){Object.isUndefined(e)&&(e=["yyyy","mm","dd"]),Object.isUndefined(t)&&(t="-"),this._format=e,this.separator=t,this._formatYearIndex=e.indexOf("yyyy"),this._formatMonthIndex=e.indexOf("mm"),this._formatDayIndex=e.indexOf("dd"),this._yearRegexp=/^\d{4}$/,this._monthRegexp=/^0\d|1[012]|\d$/,this._dayRegexp=/^0\d|[12]\d|3[01]|\d$/},match:function(e){var t=e.split(this.separator);if(t.length<3)return!1;var n=t[this._formatYearIndex].match(this._yearRegexp);if(!n)return!1;n=n[0];var i=t[this._formatMonthIndex].match(this._monthRegexp);if(!i)return!1;i=i[0];var o=t[this._formatDayIndex].match(this._dayRegexp);return o?(o=o[0],[n,i,o]):!1},currentDate:function(){var e=new Date;return this.dateToString(e.getFullYear(),e.getMonth()+1,e.getDate())},dateToString:function(e,t,n,i){Object.isUndefined(i)&&(i=this.separator);var o=[0,0,0];return o[this._formatYearIndex]=e,o[this._formatMonthIndex]=t.toPaddedString(2),o[this._formatDayIndex]=n.toPaddedString(2),o.join(i)}};var DatePickerFilter=Class.create();DatePickerFilter.prototype={initialize:function(e,t){e&&(this.badDates=e),t&&(this.validMonthP=t)},badDates:null,validMonthP:null,/* Using "append" we can string filters together, such as "before date a",
     "after date b", and "not on weekends".  Note: this changes the current
     DatePickerFilter rather than returning a new one.
     Caveat Integrator: This uses closures. These can cause memory leaks (in
     IE) so be careful!
  */
append:function(e){if(this.badDates){if(e.badDates){var t=this.badDates;this.badDates=function(n,i){for(var o=t(n,i),r=e.badDates(n,i),s=0;s<o.length;s++)o[s]=o[s]||r[s];return o}}}else this.badDates=e.badDates;if(this.validMonthP){if(e.validMonthP){var n=this.validMonthP;this.validMonthP=function(t,i){return n(t,i)&&e.validMonthP(t,i)}}}else this.validMonthP=e.validMonthP;return this}};var DatePicker=Class.create();
// Copyright (c) 2005-2008 Thomas Fuchs (http://script.aculo.us, http://mir.aculo.us)
if(DatePicker.prototype={Version:"1.0.0",_relative:null,_div:null,_zindex:1,_keepFieldEmpty:!1,_dateFormat:null,_language:"en",_language_month:$H({fr:["Janvier","F&#233;vrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","D&#233;cembre"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],sp:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],it:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],de:["Januar","Februar","M&#228;rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],pt:["Janeiro","Fevereiro","Mar&#231;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],hu:["Janu&#225;r","Febru&#225;r","M&#225;rcius","&#193;prilis","M&#225;jus","J&#250;nius","J&#250;lius","Augusztus","Szeptember","Okt&#243;ber","November","December"],lt:["Sausis","Vasaris","Kovas","Balandis","Gegu&#382;&#279;","Bir&#382;elis","Liepa","Rugj&#363;tis","Rus&#279;jis","Spalis","Lapkritis","Gruodis"],nl:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dk:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],no:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],lv:["Janv&#257;ris","Febru&#257;ris","Marts","Apr&#299;lis","Maijs","J&#363;nijs","J&#363;lijs","Augusts","Septembris","Oktobris","Novembris","Decemberis"],ja:["1&#26376;","2&#26376;","3&#26376;","4&#26376;","5&#26376;","6&#26376;","7&#26376;","8&#26376;","9&#26376;","10&#26376;","11&#26376;","12&#26376;"],fi:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kes&#228;kuu","Hein&#228;kuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],ro:["Ianuarie","Februarie","Martie","Aprilie","Mai","Junie","Julie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],zh:["1&#32;&#26376;","2&#32;&#26376;","3&#32;&#26376;","4&#32;&#26376;","5&#32;&#26376;","6&#32;&#26376;","7&#32;&#26376;","8&#32;&#26376;","9&#32;&#26376;","10&#26376;","11&#26376;","12&#26376;"],sv:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],pl:["Stycze\u0144","Luty","Marzec","Kwiecie\u0144","Maj","Czerwiec","Lipiec","Sierpie\u0144","Wrzesie\u0144","Pa\u017adziernik","Listopad","Grudzie\u0144"]}),_language_day:$H({fr:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],en:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],sp:["Lun","Mar","Mie","Jue","Vie","S&#224;b","Dom"],it:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],de:["Mon","Die","Mit","Don","Fre","Sam","Son"],pt:["Seg","Ter","Qua","Qui","Sex","S&#225;","Dom"],hu:["H&#233;","Ke","Sze","Cs&#252;","P&#233;","Szo","Vas"],lt:["Pir","Ant","Tre","Ket","Pen","&Scaron;e&scaron;","Sek"],nl:["ma","di","wo","do","vr","za","zo"],dk:["Man","Tir","Ons","Tor","Fre","L&#248;r","S&#248;n"],no:["Man","Tir","Ons","Tor","Fre","L&#248;r","Sun"],lv:["P","O","T","C","Pk","S","Sv"],ja:["&#26376;","&#28779;","&#27700;","&#26408;","&#37329;","&#22303;","&#26085;"],fi:["Ma","Ti","Ke","To","Pe","La","Su"],ro:["Lun","Mar","Mie","Joi","Vin","Sam","Dum"],zh:["&#21608;&#19968;","&#21608;&#20108;","&#21608;&#19977;","&#21608;&#22235;","&#21608;&#20116;","&#21608;&#20845;","&#21608;&#26085;"],sv:["M&#229;n","Tis","Ons","Tor","Fre","L&#246;r","S&#246;n"],pl:["Pon","Wt","\u015ar","Czw","Pt","Sob","Nie"]}),_language_close:$H({fr:"fermer",en:"close",sp:"cierre",it:"fine",de:"schliessen",pt:"fim",hu:"bez&#225;r",lt:"u&#382;daryti",nl:"sluiten",dk:"luk",no:"lukk",lv:"aizv&#275;rt",ja:"&#38281;&#12376;&#12427;",fi:"sulje",ro:"inchide",zh:"&#20851;&#32;&#38381",sv:"st&#228;ng",pl:"zamknij"}),_language_date_format:$H({en:[["mm","dd","yyyy"],"/"],lt:[["yyyy","mm","dd"],"-"],fr:[["dd","mm","yyyy"],"/"],sp:[["dd","mm","yyyy"],"/"],it:[["dd","mm","yyyy"],"/"],de:[["dd","mm","yyyy"],"/"],pt:[["dd","mm","yyyy"],"/"],hu:[["dd","mm","yyyy"],"/"],nl:[["dd","mm","yyyy"],"/"],dk:[["dd","mm","yyyy"],"/"],no:[["dd","mm","yyyy"],"/"],lv:[["dd","mm","yyyy"],"/"],ja:[["yyyy","mm","dd"],"-"],fi:[["dd","mm","yyyy"],"."],ro:[["dd","mm","yyyy"],"/"],zh:[["yyyy","mm","dd"],"-"],sv:[["dd","mm","yyyy"],"/"],pl:[["yyyy","mm","dd"],"-"]}),_todayDate:new Date,_currentDate:null,_clickCallback:Prototype.emptyFunction,_cellCallback:Prototype.emptyFunction,_dateFilter:new DatePickerFilter,_id_datepicker:null,_topOffset:30,_leftOffset:0,_isPositionned:!1,_relativePosition:!0,_setPositionTop:0,_setPositionLeft:0,_bodyAppend:!1,_showEffect:"appear",_showDuration:.2,_enableShowEffect:!0,_closeEffect:"fade",_closeEffectDuration:.2,_enableCloseEffect:!0,_closeTimer:null,_enableCloseOnBlur:!1,_afterClose:Prototype.emptyFunction,getMonthLocale:function(e){return this._language_month.get(this._language)[e]},getLocaleClose:function(){return this._language_close.get(this._language)},_initCurrentDate:function(){this._dateFormat||(this._dateFormat=this._language_date_format.get(this._language)),this._df=new DatePickerFormatter(this._dateFormat[0],this._dateFormat[1]),this._currentDate=$F(this._relative),this._df.match(this._currentDate)||(this._currentDate=this._df.currentDate(),this._keepFieldEmpty||($(this._relative).value=this._currentDate));var e=this._df.match(this._currentDate);this._currentYear=Number(e[0]),this._currentMonth=Number(e[1])-1,this._currentDay=Number(e[2])},initialize:function(e){this._relative=e.relative,e.language&&(this._language=e.language),this._zindex=e.zindex?parseInt(Number(e.zindex)):1,Object.isUndefined(e.keepFieldEmpty)||(this._keepFieldEmpty=e.keepFieldEmpty),Object.isFunction(e.clickCallback)&&(this._clickCallback=e.clickCallback),Object.isUndefined(e.leftOffset)||(this._leftOffset=parseInt(e.leftOffset)),Object.isUndefined(e.topOffset)||(this._topOffset=parseInt(e.topOffset)),Object.isUndefined(e.relativePosition)||(this._relativePosition=e.relativePosition),Object.isUndefined(e.showEffect)||(this._showEffect=e.showEffect),Object.isUndefined(e.enableShowEffect)||(this._enableShowEffect=e.enableShowEffect),Object.isUndefined(e.showDuration)||(this._showDuration=e.showDuration),Object.isUndefined(e.closeEffect)||(this._closeEffect=e.closeEffect),Object.isUndefined(e.enableCloseEffect)||(this._enableCloseEffect=e.enableCloseEffect),Object.isUndefined(e.closeEffectDuration)||(this._closeEffectDuration=e.closeEffectDuration),Object.isFunction(e.afterClose)&&(this._afterClose=e.afterClose),Object.isUndefined(e.externalControl)||(this._externalControl=e.externalControl),Object.isUndefined(e.dateFormat)||(this._dateFormat=e.dateFormat),Object.isFunction(e.cellCallback)&&(this._cellCallback=e.cellCallback),this._setPositionTop=e.setPositionTop?parseInt(Number(e.setPositionTop)):0,this._setPositionLeft=e.setPositionLeft?parseInt(Number(e.setPositionLeft)):0,!Object.isUndefined(e.enableCloseOnBlur)&&e.enableCloseOnBlur&&(this._enableCloseOnBlur=!0),!Object.isUndefined(e.dateFilter)&&e.dateFilter&&(this._dateFilter=e.dateFilter),!Object.isUndefined(e.disablePastDate)&&e.disablePastDate?this._dateFilter.append(DatePickerUtils.noDatesBefore(0)):!Object.isUndefined(e.disableFutureDate)&&e.disableFutureDate&&this._dateFilter.append(DatePickerUtils.noDatesAfter(0)),this._id_datepicker="datepicker-"+this._relative,this._id_datepicker_prev=this._id_datepicker+"-prev",this._id_datepicker_next=this._id_datepicker+"-next",this._id_datepicker_hdr=this._id_datepicker+"-header",this._id_datepicker_ftr=this._id_datepicker+"-footer",this._div=new Element("div",{id:this._id_datepicker,className:"datepicker",style:"display: none; z-index:"+this._zindex}),this._div.innerHTML='<table><thead><tr><th width="10px" id="'+this._id_datepicker_prev+'" style="cursor: pointer;">&nbsp;&lt;&lt;&nbsp;</th><th id="'+this._id_datepicker_hdr+'" colspan="5"></th><th width="10px" id="'+this._id_datepicker_next+'" style="cursor: pointer;">&nbsp;&gt;&gt;&nbsp;</th></tr></thead><tbody id="'+this._id_datepicker+'-tbody"></tbody><tfoot><tr><td colspan="7" id="'+this._id_datepicker_ftr+'"></td></tr></tfoot></table>',Event.observe(this._relative,"click",this.click.bindAsEventListener(this),!1),document.observe("dom:loaded",this.load.bindAsEventListener(this),!1),this._enableCloseOnBlur&&(Event.observe(this._relative,"blur",function(e){this._closeTimer||(this._closeTimer=this.close.bind(this).delay(1))}.bindAsEventListener(this)),Event.observe(this._div,"click",function(e){Field.focus(this._relative),this.checkClose.bind(this).delay(.1)}.bindAsEventListener(this)))},load:function(){if(this._externalControl&&Event.observe(this._externalControl,"click",this.click.bindAsEventListener(this),!1),this._relativeAppend)$(this._relative).parentNode&&(this._div.innerHTML=this._wrap_in_iframe(this._div.innerHTML),$(this._relative).parentNode.appendChild(this._div));else{var e=document.getElementsByTagName("body").item(0);if(e&&(this._div.innerHTML=this._wrap_in_iframe(this._div.innerHTML),e.appendChild(this._div)),this._relativePosition){var t=Element.cumulativeOffset($(this._relative));this.setPosition(t[1],t[0])}else(this._setPositionTop||this._setPositionLeft)&&this.setPosition(this._setPositionTop,this._setPositionLeft)}this._initCurrentDate(),$(this._id_datepicker_ftr).innerHTML=this.getLocaleClose(),Event.observe($(this._id_datepicker_prev),"click",this.prevMonth.bindAsEventListener(this),!1),Event.observe($(this._id_datepicker_next),"click",this.nextMonth.bindAsEventListener(this),!1),Event.observe($(this._id_datepicker_ftr),"click",this.close.bindAsEventListener(this),!1),Event.observe($(document),"click",this.documentClick.bindAsEventListener(this),!1)},_wrap_in_iframe:function(e){return Prototype.Browser.IE?"<div style='height:167px;width:185px;background-color:white;align:left'><iframe width='100%' height='100%' marginwidth='0' marginheight='0' frameborder='0' src='about:blank' style='filter:alpha(Opacity=50);'></iframe><div style='position:absolute;background-color:white;top:2px;left:2px;width:180px'>"+e+"</div></div>":e},visible:function(){return $(this._id_datepicker).visible()},click:function(){if(null==$(this._id_datepicker)&&this.load(),!this._isPositionned&&this._relativePosition){var a_lt=Element.cumulativeOffset($(this._relative));$(this._id_datepicker).setStyle({left:Number(a_lt[0]+this._leftOffset)+"px",top:Number(a_lt[1]+this._topOffset)+"px"}),this._isPositionned=!0}this.visible()||(this._initCurrentDate(),this._redrawCalendar()),eval(this._clickCallback()),this._enableShowEffect?new Effect.toggle(this._id_datepicker,this._showEffect,{duration:this._showDuration}):$(this._id_datepicker).show()},close:function(){if(this.visible()){if(this.checkClose(),this._enableCloseEffect)switch(this._closeEffect){case"puff":new Effect.Puff(this._id_datepicker,{duration:this._closeEffectDuration});break;case"blindUp":new Effect.BlindUp(this._id_datepicker,{duration:this._closeEffectDuration});break;case"dropOut":new Effect.DropOut(this._id_datepicker,{duration:this._closeEffectDuration});break;case"switchOff":new Effect.SwitchOff(this._id_datepicker,{duration:this._closeEffectDuration});break;case"squish":new Effect.Squish(this._id_datepicker,{duration:this._closeEffectDuration});break;case"fold":new Effect.Fold(this._id_datepicker,{duration:this._closeEffectDuration});break;case"shrink":new Effect.Shrink(this._id_datepicker,{duration:this._closeEffectDuration});break;default:new Effect.Fade(this._id_datepicker,{duration:this._closeEffectDuration})}else $(this._id_datepicker).hide();eval(this._afterClose())}},checkClose:function(){this._closeTimer&&(window.clearTimeout(this._closeTimer),this._closeTimer=null)},documentClick:function(e){var t=e.element();t==this._div||t==$(this._relative)||t==$(this._externalControl)||t.descendantOf(this._div)||this.close()},setDateFormat:function(e,t){Object.isUndefined(e)&&(e=this._dateFormat[0]),Object.isUndefined(t)&&(t=this._dateFormat[1]),this._dateFormat=[e,t]},setPosition:function(e,t){var n={top:"0px",left:"0px"};Object.isUndefined(e)||(n.top=Number(e)+this._topOffset+"px"),Object.isUndefined(t)||(n.left=Number(t)+this._leftOffset+"px"),$(this._id_datepicker).setStyle(n),this._isPositionned=!0},_buildCalendar:function(){var e=$(this._id_datepicker+"-tbody");try{for(;e.hasChildNodes();)e.removeChild(e.childNodes[0])}catch(t){}var n=new Element("tr");this._language_day.get(this._language).each(function(e){var t=new Element("td");t.innerHTML=e,t.className="wday",n.appendChild(t)}),e.appendChild(n);for(var i=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],o=this._currentMonth,r=this._currentYear,s=new Date(r,o,1,12),a=(s.getDay()+6)%7,l=DatePickerUtils.getMonthDays(r,o),c=1,u=this._dateFilter.badDates?this._dateFilter.badDates(r,o):[],h=a;7>h;h++)i[0][h]={d:c,m:o,y:r,b:u[c]},c++;for(var d=this._prevMonthYear(),f=DatePickerUtils.getMonthDays(d[1],d[0]),h=0;a>h;h++)i[0][h]={d:Number(f-a+h+1),m:Number(d[0]),y:d[1],c:"outbound",b:!0};for(var p=!1,m=1;6>m;m++)for(var h=0;7>h;h++)i[m][h]={d:c,m:o,y:r,c:p?"outbound":c==this._todayDate.getDate()&&o==this._todayDate.getMonth()&&r==this._todayDate.getFullYear()?"today":null,b:p||u[c]},c++,c>l&&(c=1,p=!0,this._currentMonth+1>11?(o=0,r+=1):o+=1);for(var m=0;6>m;m++){for(var g=new Element("tr"),h=0;7>h;h++){var v=i[m][h],b=new Element("td"),y=$A([this._relative,this._df.dateToString(v.y,v.m+1,v.d,"-")]).join("-");b.setAttribute("id",y),v.c&&(b.className=v.c),this._bindCellOnClick(b,v.b,v.c),b.innerHTML=v.d,g.appendChild(b)}e.appendChild(g)}return e},_bindCellOnClick:function(e,t,n){if(t)e.className=n?"nclick_"+n:"nclick";else{var i=this;e.onclick=function(){$(i._relative).value=String($(this).readAttribute("id")).replace(i._relative+"-","").replace(/-/g,i._df.separator),i._cellCallback&&i._cellCallback(this),i.close()}}},_nextMonthYear:function(){var e=this._currentMonth,t=this._currentYear;return e+1>11?(e=0,t+=1):e+=1,[e,t]},nextMonth:function(){this._maybeRedrawMonth(this._nextMonthYear())},_prevMonthYear:function(){var e=this._currentMonth,t=this._currentYear;return 0>e-1?(e=11,t-=1):e-=1,[e,t]},prevMonth:function(){this._maybeRedrawMonth(this._prevMonthYear())},_maybeRedrawMonth:function(e){var t=e[0],n=e[1];(!this._dateFilter.validMonthP||this._dateFilter.validMonthP(n,t))&&(this._currentMonth=t,this._currentYear=n,this._redrawCalendar())},_redrawCalendar:function(){this._setLocaleHdr(),this._buildCalendar()},_setLocaleHdr:function(){var e=this._nextMonthYear();$(this._id_datepicker_next).setAttribute("title",this.getMonthLocale(e[0])+" "+e[1]);var t=this._prevMonthYear();$(this._id_datepicker_prev).setAttribute("title",this.getMonthLocale(t[0])+" "+t[1]),$(this._id_datepicker_hdr).update("&nbsp;&nbsp;&nbsp;"+this.getMonthLocale(this._currentMonth)+"&nbsp;"+this._currentYear+"&nbsp;&nbsp;&nbsp;")}},Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";var Droppables={drops:[],remove:function(e){this.drops=this.drops.reject(function(t){return t.element==$(e)})},add:function(e){e=$(e);var t=Object.extend({greedy:!0,hoverclass:null,tree:!1},arguments[1]||{});if(t.containment){t._containers=[];var n=t.containment;Object.isArray(n)?n.each(function(e){t._containers.push($(e))}):t._containers.push($(n))}t.accept&&(t.accept=[t.accept].flatten()),Element.makePositioned(e),t.element=e,this.drops.push(t)},findDeepestChild:function(e){for(deepest=e[0],i=1;i<e.length;++i)Element.isParent(e[i].element,deepest.element)&&(deepest=e[i]);return deepest},isContained:function(e,t){var n;return n=t.tree?e.treeNode:e.parentNode,t._containers.detect(function(e){return n==e})},isAffected:function(e,t,n){return n.element!=t&&(!n._containers||this.isContained(t,n))&&(!n.accept||Element.classNames(t).detect(function(e){return n.accept.include(e)}))&&Position.within(n.element,e[0],e[1])},deactivate:function(e){e.hoverclass&&Element.removeClassName(e.element,e.hoverclass),this.last_active=null},activate:function(e){e.hoverclass&&Element.addClassName(e.element,e.hoverclass),this.last_active=e},show:function(e,t){if(this.drops.length){var n,i=[];this.drops.each(function(n){Droppables.isAffected(e,t,n)&&i.push(n)}),i.length>0&&(n=Droppables.findDeepestChild(i)),this.last_active&&this.last_active!=n&&this.deactivate(this.last_active),n&&(Position.within(n.element,e[0],e[1]),n.onHover&&n.onHover(t,n.element,Position.overlap(n.overlap,n.element)),n!=this.last_active&&Droppables.activate(n))}},fire:function(e,t){return this.last_active?(Position.prepare(),this.isAffected([Event.pointerX(e),Event.pointerY(e)],t,this.last_active)&&this.last_active.onDrop?(this.last_active.onDrop(t,this.last_active.element,e),!0):void 0):void 0},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(e){0==this.drags.length&&(this.eventMouseUp=this.endDrag.bindAsEventListener(this),this.eventMouseMove=this.updateDrag.bindAsEventListener(this),this.eventKeypress=this.keyPress.bindAsEventListener(this),Event.observe(document,"mouseup",this.eventMouseUp),Event.observe(document,"mousemove",this.eventMouseMove),Event.observe(document,"keypress",this.eventKeypress)),this.drags.push(e)},unregister:function(e){this.drags=this.drags.reject(function(t){return t==e}),0==this.drags.length&&(Event.stopObserving(document,"mouseup",this.eventMouseUp),Event.stopObserving(document,"mousemove",this.eventMouseMove),Event.stopObserving(document,"keypress",this.eventKeypress))},activate:function(e){e.options.delay?this._timeout=setTimeout(function(){Draggables._timeout=null,window.focus(),Draggables.activeDraggable=e}.bind(this),e.options.delay):(window.focus(),this.activeDraggable=e)},deactivate:function(){this.activeDraggable=null},updateDrag:function(e){if(this.activeDraggable){var t=[Event.pointerX(e),Event.pointerY(e)];this._lastPointer&&this._lastPointer.inspect()==t.inspect()||(this._lastPointer=t,this.activeDraggable.updateDrag(e,t))}},endDrag:function(e){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this.activeDraggable&&(this._lastPointer=null,this.activeDraggable.endDrag(e),this.activeDraggable=null)},keyPress:function(e){this.activeDraggable&&this.activeDraggable.keyPress(e)},addObserver:function(e){this.observers.push(e),this._cacheObserverCallbacks()},removeObserver:function(e){this.observers=this.observers.reject(function(t){return t.element==e}),this._cacheObserverCallbacks()},notify:function(e,t,n){this[e+"Count"]>0&&this.observers.each(function(i){i[e]&&i[e](e,t,n)}),t.options[e]&&t.options[e](t,n)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(e){Draggables[e+"Count"]=Draggables.observers.select(function(t){return t[e]}).length})}},Draggable=Class.create({initialize:function(e){var t={handle:!1,reverteffect:function(e,t,n){var i=.02*Math.sqrt(Math.abs(2^t)+Math.abs(2^n));new Effect.Move(e,{x:-n,y:-t,duration:i,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var t=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:.2,from:.7,to:t,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=!1}})},zindex:1e3,revert:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,snap:!1,delay:0};(!arguments[1]||Object.isUndefined(arguments[1].endeffect))&&Object.extend(t,{starteffect:function(e){e._opacity=Element.getOpacity(e),Draggable._dragging[e]=!0,new Effect.Opacity(e,{duration:.2,from:e._opacity,to:.7})}});var n=Object.extend(t,arguments[1]||{});this.element=$(e),n.handle&&Object.isString(n.handle)&&(this.handle=this.element.down("."+n.handle,0)),this.handle||(this.handle=$(n.handle)),this.handle||(this.handle=this.element),!n.scroll||n.scroll.scrollTo||n.scroll.outerHTML||(n.scroll=$(n.scroll),this._isScrollChild=Element.childOf(this.element,n.scroll)),Element.makePositioned(this.element),this.options=n,this.dragging=!1,this.eventMouseDown=this.initDrag.bindAsEventListener(this),Event.observe(this.handle,"mousedown",this.eventMouseDown),Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown),Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(e){if((Object.isUndefined(Draggable._dragging[this.element])||!Draggable._dragging[this.element])&&Event.isLeftClick(e)){var t=Event.element(e);if((tag_name=t.tagName.toUpperCase())&&("INPUT"==tag_name||"SELECT"==tag_name||"OPTION"==tag_name||"BUTTON"==tag_name||"TEXTAREA"==tag_name))return;var n=[Event.pointerX(e),Event.pointerY(e)],i=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(e){return n[e]-i[e]}),Draggables.activate(this),Event.stop(e)}},startDrag:function(e){if(this.dragging=!0,this.delta||(this.delta=this.currentDelta()),this.options.zindex&&(this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0),this.element.style.zIndex=this.options.zindex),this.options.ghosting&&(this._clone=this.element.cloneNode(!0),this._originallyAbsolute="absolute"==this.element.getStyle("position"),this._originallyAbsolute||Position.absolutize(this.element),this.element.parentNode.insertBefore(this._clone,this.element)),this.options.scroll)if(this.options.scroll==window){var t=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=t.left,this.originalScrollTop=t.top}else this.originalScrollLeft=this.options.scroll.scrollLeft,this.originalScrollTop=this.options.scroll.scrollTop;Draggables.notify("onStart",this,e),this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(event,pointer){if(this.dragging||this.startDrag(event),this.options.quiet||(Position.prepare(),Droppables.show(pointer,this.element)),Draggables.notify("onDrag",this,event),this.draw(pointer),this.options.change&&this.options.change(this),this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))p=[left,top,left+width,top+height];else p=Position.page(this.options.scroll),p[0]+=this.options.scroll.scrollLeft+Position.deltaX,p[1]+=this.options.scroll.scrollTop+Position.deltaY,p.push(p[0]+this.options.scroll.offsetWidth),p.push(p[1]+this.options.scroll.offsetHeight);var speed=[0,0];pointer[0]<p[0]+this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)),pointer[1]<p[1]+this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)),pointer[0]>p[2]-this.options.scrollSensitivity&&(speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)),pointer[1]>p[3]-this.options.scrollSensitivity&&(speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)),this.startScrolling(speed)}Prototype.Browser.WebKit&&window.scrollBy(0,0),Event.stop(event)},finishDrag:function(e,t){if(this.dragging=!1,this.options.quiet){Position.prepare();var n=[Event.pointerX(e),Event.pointerY(e)];Droppables.show(n,this.element)}this.options.ghosting&&(this._originallyAbsolute||Position.relativize(this.element),delete this._originallyAbsolute,Element.remove(this._clone),this._clone=null);var i=!1;t&&(i=Droppables.fire(e,this.element),i||(i=!1)),i&&this.options.onDropped&&this.options.onDropped(this.element),Draggables.notify("onEnd",this,e);var o=this.options.revert;o&&Object.isFunction(o)&&(o=o(this.element));var r=this.currentDelta();o&&this.options.reverteffect?(0==i||"failure"!=o)&&this.options.reverteffect(this.element,r[1]-this.delta[1],r[0]-this.delta[0]):this.delta=r,this.options.zindex&&(this.element.style.zIndex=this.originalZ),this.options.endeffect&&this.options.endeffect(this.element),Draggables.deactivate(this),Droppables.reset()},keyPress:function(e){e.keyCode==Event.KEY_ESC&&(this.finishDrag(e,!1),Event.stop(e))},endDrag:function(e){this.dragging&&(this.stopScrolling(),this.finishDrag(e,!0),Event.stop(e))},draw:function(e){var t=Position.cumulativeOffset(this.element);if(this.options.ghosting){var n=Position.realOffset(this.element);t[0]+=n[0]-Position.deltaX,t[1]+=n[1]-Position.deltaY}var i=this.currentDelta();t[0]-=i[0],t[1]-=i[1],this.options.scroll&&this.options.scroll!=window&&this._isScrollChild&&(t[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft,t[1]-=this.options.scroll.scrollTop-this.originalScrollTop);var o=[0,1].map(function(n){return e[n]-t[n]-this.offset[n]}.bind(this));this.options.snap&&(o=Object.isFunction(this.options.snap)?this.options.snap(o[0],o[1],this):Object.isArray(this.options.snap)?o.map(function(e,t){return(e/this.options.snap[t]).round()*this.options.snap[t]}.bind(this)):o.map(function(e){return(e/this.options.snap).round()*this.options.snap}.bind(this)));var r=this.element.style;this.options.constraint&&"horizontal"!=this.options.constraint||(r.left=o[0]+"px"),this.options.constraint&&"vertical"!=this.options.constraint||(r.top=o[1]+"px"),"hidden"==r.visibility&&(r.visibility="")},stopScrolling:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null,Draggables._lastScrollPointer=null)},startScrolling:function(e){(e[0]||e[1])&&(this.scrollSpeed=[e[0]*this.options.scrollSpeed,e[1]*this.options.scrollSpeed],this.lastScrolled=new Date,this.scrollInterval=setInterval(this.scroll.bind(this),10))},scroll:function(){var current=new Date,delta=current-this.lastScrolled;if(this.lastScrolled=current,this.options.scroll==window){with(this._getWindowScroll(this.options.scroll))if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1e3;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}else this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1e3,this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1e3;Position.prepare(),Droppables.show(Draggables._lastPointer,this.element),Draggables.notify("onDrag",this),this._isScrollChild&&(Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer),Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1e3,Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1e3,Draggables._lastScrollPointer[0]<0&&(Draggables._lastScrollPointer[0]=0),Draggables._lastScrollPointer[1]<0&&(Draggables._lastScrollPointer[1]=0),this.draw(Draggables._lastScrollPointer)),this.options.change&&this.options.change(this)},_getWindowScroll:function(w){var T,L,W,H;with(w.document)w.document.documentElement&&documentElement.scrollTop?(T=documentElement.scrollTop,L=documentElement.scrollLeft):w.document.body&&(T=body.scrollTop,L=body.scrollLeft),w.innerWidth?(W=w.innerWidth,H=w.innerHeight):w.document.documentElement&&documentElement.clientWidth?(W=documentElement.clientWidth,H=documentElement.clientHeight):(W=body.offsetWidth,H=body.offsetHeight);return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(e,t){this.element=$(e),this.observer=t,this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark(),this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(e){for(;"BODY"!=e.tagName.toUpperCase();){if(e.id&&Sortable.sortables[e.id])return e;e=e.parentNode}},options:function(e){return(e=Sortable._findRootElement($(e)))?Sortable.sortables[e.id]:void 0},destroy:function(e){e=$(e);var t=Sortable.sortables[e.id];t&&(Draggables.removeObserver(t.element),t.droppables.each(function(e){Droppables.remove(e)}),t.draggables.invoke("destroy"),delete Sortable.sortables[t.element.id])},create:function(e){e=$(e);var t=Object.extend({element:e,tag:"li",dropOnEmpty:!1,tree:!1,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:e,handle:!1,only:!1,delay:0,hoverclass:null,ghosting:!1,quiet:!1,scroll:!1,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:!1,handles:!1,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(e);var n={revert:!0,quiet:t.quiet,scroll:t.scroll,scrollSpeed:t.scrollSpeed,scrollSensitivity:t.scrollSensitivity,delay:t.delay,ghosting:t.ghosting,constraint:t.constraint,handle:t.handle};t.starteffect&&(n.starteffect=t.starteffect),t.reverteffect?n.reverteffect=t.reverteffect:t.ghosting&&(n.reverteffect=function(e){e.style.top=0,e.style.left=0}),t.endeffect&&(n.endeffect=t.endeffect),t.zindex&&(n.zindex=t.zindex);var i={overlap:t.overlap,containment:t.containment,tree:t.tree,hoverclass:t.hoverclass,onHover:Sortable.onHover},o={onHover:Sortable.onEmptyHover,overlap:t.overlap,containment:t.containment,hoverclass:t.hoverclass};Element.cleanWhitespace(e),t.draggables=[],t.droppables=[],(t.dropOnEmpty||t.tree)&&(Droppables.add(e,o),t.droppables.push(e)),(t.elements||this.findElements(e,t)||[]).each(function(o,r){var s=t.handles?$(t.handles[r]):t.handle?$(o).select("."+t.handle)[0]:o;t.draggables.push(new Draggable(o,Object.extend(n,{handle:s}))),Droppables.add(o,i),t.tree&&(o.treeNode=e),t.droppables.push(o)}),t.tree&&(Sortable.findTreeElements(e,t)||[]).each(function(n){Droppables.add(n,o),n.treeNode=e,t.droppables.push(n)}),this.sortables[e.id]=t,Draggables.addObserver(new SortableObserver(e,t.onUpdate))},findElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.tag)},findTreeElements:function(e,t){return Element.findChildren(e,t.only,t.tree?!0:!1,t.treeTag)},onHover:function(e,t,n){if(!(Element.isParent(t,e)||n>.33&&.66>n&&Sortable.options(t).tree))if(n>.5){if(Sortable.mark(t,"before"),t.previousSibling!=e){var i=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,t),t.parentNode!=i&&Sortable.options(i).onChange(e),Sortable.options(t.parentNode).onChange(e)}}else{Sortable.mark(t,"after");var o=t.nextSibling||null;if(o!=e){var i=e.parentNode;e.style.visibility="hidden",t.parentNode.insertBefore(e,o),t.parentNode!=i&&Sortable.options(i).onChange(e),Sortable.options(t.parentNode).onChange(e)}}},onEmptyHover:function(e,t,n){var i=e.parentNode,o=Sortable.options(t);if(!Element.isParent(t,e)){var r,s=Sortable.findElements(t,{tag:o.tag,only:o.only}),a=null;if(s){var l=Element.offsetSize(t,o.overlap)*(1-n);for(r=0;r<s.length;r+=1){if(!(l-Element.offsetSize(s[r],o.overlap)>=0)){if(l-Element.offsetSize(s[r],o.overlap)/2>=0){a=r+1<s.length?s[r+1]:null;break}a=s[r];break}l-=Element.offsetSize(s[r],o.overlap)}}t.insertBefore(e,a),Sortable.options(i).onChange(e),o.onChange(e)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(e,t){var n=Sortable.options(e.parentNode);if(!n||n.ghosting){Sortable._marker||(Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"}),document.getElementsByTagName("body").item(0).appendChild(Sortable._marker));var i=Position.cumulativeOffset(e);Sortable._marker.setStyle({left:i[0]+"px",top:i[1]+"px"}),"after"==t&&("horizontal"==n.overlap?Sortable._marker.setStyle({left:i[0]+e.clientWidth+"px"}):Sortable._marker.setStyle({top:i[1]+e.clientHeight+"px"})),Sortable._marker.show()}},_tree:function(e,t,n){for(var i=Sortable.findElements(e,t)||[],o=0;o<i.length;++o){var r=i[o].id.match(t.format);if(r){var s={id:encodeURIComponent(r?r[1]:null),element:e,parent:n,children:[],position:n.children.length,container:$(i[o]).down(t.treeTag)};s.container&&this._tree(s.container,t,s),n.children.push(s)}}return n},tree:function(e){e=$(e);var t=this.options(e),n=Object.extend({tag:t.tag,treeTag:t.treeTag,only:t.only,name:e.id,format:t.format},arguments[1]||{}),i={id:null,parent:null,children:[],container:e,position:0};return Sortable._tree(e,n,i)},_constructIndex:function(e){var t="";do e.id&&(t="["+e.position+"]"+t);while(null!=(e=e.parent));return t},sequence:function(e){e=$(e);var t=Object.extend(this.options(e),arguments[1]||{});return $(this.findElements(e,t)||[]).map(function(e){return e.id.match(t.format)?e.id.match(t.format)[1]:""})},setSequence:function(e,t){e=$(e);var n=Object.extend(this.options(e),arguments[2]||{}),i={};this.findElements(e,n).each(function(e){e.id.match(n.format)&&(i[e.id.match(n.format)[1]]=[e,e.parentNode]),e.parentNode.removeChild(e)}),t.each(function(e){var t=i[e];t&&(t[1].appendChild(t[0]),delete i[e])})},serialize:function(e){e=$(e);var t=Object.extend(Sortable.options(e),arguments[1]||{}),n=encodeURIComponent(arguments[1]&&arguments[1].name?arguments[1].name:e.id);return t.tree?Sortable.tree(e,arguments[1]).children.map(function(e){return[n+Sortable._constructIndex(e)+"[id]="+encodeURIComponent(e.id)].concat(e.children.map(arguments.callee));
}).flatten().join("&"):Sortable.sequence(e,arguments[1]).map(function(e){return n+"[]="+encodeURIComponent(e)}).join("&")}};Element.isParent=function(e,t){return e.parentNode&&e!=t?e.parentNode==t?!0:Element.isParent(e.parentNode,t):!1},Element.findChildren=function(e,t,n,i){if(!e.hasChildNodes())return null;i=i.toUpperCase(),t&&(t=[t].flatten());var o=[];return $A(e.childNodes).each(function(e){if(!e.tagName||e.tagName.toUpperCase()!=i||t&&!Element.classNames(e).detect(function(e){return t.include(e)})||o.push(e),n){var r=Element.findChildren(e,t,n,i);r&&o.push(r)}}),o.length>0?o.flatten():[]},Element.offsetSize=function(e,t){return e["offset"+("vertical"==t||"height"==t?"Height":"Width")]},/*
 * File:        jquery.dataTables.min.js
 * Version:     1.10.4
 * Author:      Allan Jardine (www.sprymedia.co.uk)
 * Info:        www.datatables.net
 *
 * Copyright (C) 2008-2015, SpryMedia Ltd.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(e,t,n){var i=function(i){function o(e){var t,n,r={};i.each(e,function(i){(t=i.match(/^([^A-Z]+?)([A-Z])/))&&-1!=="a aa ai ao as b fn i m o s ".indexOf(t[1]+" ")&&(n=i.replace(t[0],t[2].toLowerCase()),r[n]=i,"o"===t[1]&&o(e[i]))}),e._hungarianMap=r}function r(e,t,s){e._hungarianMap||o(e);var a;i.each(t,function(o){a=e._hungarianMap[o],a===n||!s&&t[a]!==n||("o"===a.charAt(0)?(t[a]||(t[a]={}),i.extend(!0,t[a],t[o]),r(e[a],t[a],s)):t[a]=t[o])})}function s(e){var t=Ve.defaults.oLanguage,n=e.sZeroRecords;!e.sEmptyTable&&n&&"No data available in table"===t.sEmptyTable&&Pe(e,e,"sZeroRecords","sEmptyTable"),!e.sLoadingRecords&&n&&"Loading..."===t.sLoadingRecords&&Pe(e,e,"sZeroRecords","sLoadingRecords"),e.sInfoThousands&&(e.sThousands=e.sInfoThousands),(e=e.sDecimal)&&ze(e)}function a(e){if(pt(e,"ordering","bSort"),pt(e,"orderMulti","bSortMulti"),pt(e,"orderClasses","bSortClasses"),pt(e,"orderCellsTop","bSortCellsTop"),pt(e,"order","aaSorting"),pt(e,"orderFixed","aaSortingFixed"),pt(e,"paging","bPaginate"),pt(e,"pagingType","sPaginationType"),pt(e,"pageLength","iDisplayLength"),pt(e,"searching","bFilter"),e=e.aoSearchCols)for(var t=0,n=e.length;n>t;t++)e[t]&&r(Ve.models.oSearch,e[t])}function l(e){pt(e,"orderable","bSortable"),pt(e,"orderData","aDataSort"),pt(e,"orderSequence","asSorting"),pt(e,"orderDataType","sortDataType")}function c(e){var e=e.oBrowser,t=i("<div/>").css({position:"absolute",top:0,left:0,height:1,width:1,overflow:"hidden"}).append(i("<div/>").css({position:"absolute",top:1,left:1,width:100,overflow:"scroll"}).append(i('<div class="test"/>').css({width:"100%",height:10}))).appendTo("body"),n=t.find(".test");e.bScrollOversize=100===n[0].offsetWidth,e.bScrollbarLeft=1!==n.offset().left,t.remove()}function u(e,t,i,o,r,s){var a,l=!1;for(i!==n&&(a=i,l=!0);o!==r;)e.hasOwnProperty(o)&&(a=l?t(a,e[o],o,e):e[o],l=!0,o+=s);return a}function h(e,n){var o=Ve.defaults.column,r=e.aoColumns.length,o=i.extend({},Ve.models.oColumn,o,{nTh:n?n:t.createElement("th"),sTitle:o.sTitle?o.sTitle:n?n.innerHTML:"",aDataSort:o.aDataSort?o.aDataSort:[r],mData:o.mData?o.mData:r,idx:r});e.aoColumns.push(o),o=e.aoPreSearchCols,o[r]=i.extend({},Ve.models.oSearch,o[r]),d(e,r,null)}function d(e,t,o){var t=e.aoColumns[t],s=e.oClasses,a=i(t.nTh);if(!t.sWidthOrig){t.sWidthOrig=a.attr("width")||null;var c=(a.attr("style")||"").match(/width:\s*(\d+[pxem%]+)/);c&&(t.sWidthOrig=c[1])}o!==n&&null!==o&&(l(o),r(Ve.defaults.column,o),o.mDataProp!==n&&!o.mData&&(o.mData=o.mDataProp),o.sType&&(t._sManualType=o.sType),o.className&&!o.sClass&&(o.sClass=o.className),i.extend(t,o),Pe(t,o,"sWidth","sWidthOrig"),"number"==typeof o.iDataSort&&(t.aDataSort=[o.iDataSort]),Pe(t,o,"aDataSort"));var u=t.mData,h=k(u),d=t.mRender?k(t.mRender):null,o=function(e){return"string"==typeof e&&-1!==e.indexOf("@")};t._bAttrSrc=i.isPlainObject(u)&&(o(u.sort)||o(u.type)||o(u.filter)),t.fnGetData=function(e,t,i){var o=h(e,t,n,i);return d&&t?d(o,t,e,i):o},t.fnSetData=function(e,t,n){return j(u)(e,t,n)},"number"!=typeof u&&(e._rowReadObject=!0),e.oFeatures.bSort||(t.bSortable=!1,a.addClass(s.sSortableNone)),e=-1!==i.inArray("asc",t.asSorting),o=-1!==i.inArray("desc",t.asSorting),t.bSortable&&(e||o)?e&&!o?(t.sSortingClass=s.sSortableAsc,t.sSortingClassJUI=s.sSortJUIAscAllowed):!e&&o?(t.sSortingClass=s.sSortableDesc,t.sSortingClassJUI=s.sSortJUIDescAllowed):(t.sSortingClass=s.sSortable,t.sSortingClassJUI=s.sSortJUI):(t.sSortingClass=s.sSortableNone,t.sSortingClassJUI="")}function f(e){if(!1!==e.oFeatures.bAutoWidth){var t=e.aoColumns;ge(e);for(var n=0,i=t.length;i>n;n++)t[n].nTh.style.width=t[n].sWidth}t=e.oScroll,(""!==t.sY||""!==t.sX)&&pe(e),Be(e,null,"column-sizing",[e])}function p(e,t){var n=v(e,"bVisible");return"number"==typeof n[t]?n[t]:null}function m(e,t){var n=v(e,"bVisible"),n=i.inArray(t,n);return-1!==n?n:null}function g(e){return v(e,"bVisible").length}function v(e,t){var n=[];return i.map(e.aoColumns,function(e,i){e[t]&&n.push(i)}),n}function b(e){var t,i,o,r,s,a,l,c,u,h=e.aoColumns,d=e.aoData,f=Ve.ext.type.detect;for(t=0,i=h.length;i>t;t++)if(l=h[t],u=[],!l.sType&&l._sManualType)l.sType=l._sManualType;else if(!l.sType){for(o=0,r=f.length;r>o;o++){for(s=0,a=d.length;a>s&&(u[s]===n&&(u[s]=x(e,s,t,"type")),c=f[o](u[s],e),c||o===f.length-1)&&"html"!==c;s++);if(c){l.sType=c;break}}l.sType||(l.sType="string")}}function y(e,t,o,r){var s,a,l,c,u,d,f=e.aoColumns;if(t)for(s=t.length-1;s>=0;s--){d=t[s];var p=d.targets!==n?d.targets:d.aTargets;for(i.isArray(p)||(p=[p]),a=0,l=p.length;l>a;a++)if("number"==typeof p[a]&&0<=p[a]){for(;f.length<=p[a];)h(e);r(p[a],d)}else if("number"==typeof p[a]&&0>p[a])r(f.length+p[a],d);else if("string"==typeof p[a])for(c=0,u=f.length;u>c;c++)("_all"==p[a]||i(f[c].nTh).hasClass(p[a]))&&r(c,d)}if(o)for(s=0,e=o.length;e>s;s++)r(s,o[s])}function w(e,t,n,o){var r=e.aoData.length,s=i.extend(!0,{},Ve.models.oRow,{src:n?"dom":"data"});s._aData=t,e.aoData.push(s);for(var t=e.aoColumns,s=0,a=t.length;a>s;s++)n&&C(e,r,s,x(e,r,s)),t[s].sType=null;return e.aiDisplayMaster.push(r),(n||!e.oFeatures.bDeferRender)&&M(e,r,n,o),r}function S(e,t){var n;return t instanceof i||(t=i(t)),t.map(function(t,i){return n=D(e,i),w(e,n.data,i,n.cells)})}function x(e,t,i,o){var r=e.iDraw,s=e.aoColumns[i],a=e.aoData[t]._aData,l=s.sDefaultContent,i=s.fnGetData(a,o,{settings:e,row:t,col:i});if(i===n)return e.iDrawError!=r&&null===l&&(Ie(e,0,"Requested unknown parameter "+("function"==typeof s.mData?"{function}":"'"+s.mData+"'")+" for row "+t,4),e.iDrawError=r),l;if(i!==a&&null!==i||null===l){if("function"==typeof i)return i.call(a)}else i=l;return null===i&&"display"==o?"":i}function C(e,t,n,i){e.aoColumns[n].fnSetData(e.aoData[t]._aData,i,{settings:e,row:t,col:n})}function _(e){return i.map(e.match(/(\\.|[^\.])+/g),function(e){return e.replace(/\\./g,".")})}function k(e){if(i.isPlainObject(e)){var t={};return i.each(e,function(e,n){n&&(t[e]=k(n))}),function(e,i,o,r){var s=t[i]||t._;return s!==n?s(e,i,o,r):e}}if(null===e)return function(e){return e};if("function"==typeof e)return function(t,n,i,o){return e(t,n,i,o)};if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("[")||-1!==e.indexOf("("))){var o=function(e,t,i){var r,s;if(""!==i){s=_(i);for(var a=0,l=s.length;l>a;a++){if(i=s[a].match(mt),r=s[a].match(gt),i){for(s[a]=s[a].replace(mt,""),""!==s[a]&&(e=e[s[a]]),r=[],s.splice(0,a+1),s=s.join("."),a=0,l=e.length;l>a;a++)r.push(o(e[a],t,s));e=i[0].substring(1,i[0].length-1),e=""===e?r:r.join(e);break}if(r)s[a]=s[a].replace(gt,""),e=e[s[a]]();else{if(null===e||e[s[a]]===n)return n;e=e[s[a]]}}}return e};return function(t,n){return o(t,n,e)}}return function(t){return t[e]}}function j(e){if(i.isPlainObject(e))return j(e._);if(null===e)return function(){};if("function"==typeof e)return function(t,n,i){e(t,"set",n,i)};if("string"==typeof e&&(-1!==e.indexOf(".")||-1!==e.indexOf("[")||-1!==e.indexOf("("))){var t=function(e,i,o){var r,o=_(o);r=o[o.length-1];for(var s,a,l=0,c=o.length-1;c>l;l++){if(s=o[l].match(mt),a=o[l].match(gt),s){for(o[l]=o[l].replace(mt,""),e[o[l]]=[],r=o.slice(),r.splice(0,l+1),s=r.join("."),a=0,c=i.length;c>a;a++)r={},t(r,i[a],s),e[o[l]].push(r);return}a&&(o[l]=o[l].replace(gt,""),e=e[o[l]](i)),(null===e[o[l]]||e[o[l]]===n)&&(e[o[l]]={}),e=e[o[l]]}r.match(gt)?e[r.replace(gt,"")](i):e[r.replace(mt,"")]=i};return function(n,i){return t(n,i,e)}}return function(t,n){t[e]=n}}function $(e){return ct(e.aoData,"_aData")}function E(e){e.aoData.length=0,e.aiDisplayMaster.length=0,e.aiDisplay.length=0}function T(e,t,i){for(var o=-1,r=0,s=e.length;s>r;r++)e[r]==t?o=r:e[r]>t&&e[r]--;-1!=o&&i===n&&e.splice(o,1)}function A(e,t,i,o){var r,s=e.aoData[t],a=function(n,i){for(;n.childNodes.length;)n.removeChild(n.firstChild);n.innerHTML=x(e,t,i,"display")};if("dom"!==i&&(i&&"auto"!==i||"dom"!==s.src)){var l=s.anCells;if(l)if(o!==n)a(l[o],o);else for(i=0,r=l.length;r>i;i++)a(l[i],i)}else s._aData=D(e,s,o,o===n?n:s._aData).data;if(s._aSortData=null,s._aFilterData=null,a=e.aoColumns,o!==n)a[o].sType=null;else{for(i=0,r=a.length;r>i;i++)a[i].sType=null;N(s)}}function D(e,t,o,r){var s,a,l=[],c=t.firstChild,u=0,h=e.aoColumns,d=e._rowReadObject,r=r||d?{}:[],f=function(e,t){if("string"==typeof e){var n=e.indexOf("@");-1!==n&&(n=e.substring(n+1),j(e)(r,t.getAttribute(n)))}},e=function(e){(o===n||o===u)&&(s=h[u],a=i.trim(e.innerHTML),s&&s._bAttrSrc?(j(s.mData._)(r,a),f(s.mData.sort,e),f(s.mData.type,e),f(s.mData.filter,e)):d?(s._setter||(s._setter=j(s.mData)),s._setter(r,a)):r[u]=a),u++};if(c)for(;c;)t=c.nodeName.toUpperCase(),("TD"==t||"TH"==t)&&(e(c),l.push(c)),c=c.nextSibling;else for(l=t.anCells,c=0,t=l.length;t>c;c++)e(l[c]);return{data:r,cells:l}}function M(e,n,i,o){var r,s,a,l,c,u=e.aoData[n],h=u._aData,d=[];if(null===u.nTr){for(r=i||t.createElement("tr"),u.nTr=r,u.anCells=d,r._DT_RowIndex=n,N(u),l=0,c=e.aoColumns.length;c>l;l++)a=e.aoColumns[l],s=i?o[l]:t.createElement(a.sCellType),d.push(s),(!i||a.mRender||a.mData!==l)&&(s.innerHTML=x(e,n,l,"display")),a.sClass&&(s.className+=" "+a.sClass),a.bVisible&&!i?r.appendChild(s):!a.bVisible&&i&&s.parentNode.removeChild(s),a.fnCreatedCell&&a.fnCreatedCell.call(e.oInstance,s,x(e,n,l),h,n,l);Be(e,"aoRowCreatedCallback",null,[r,h,n])}u.nTr.setAttribute("role","row")}function N(e){var t=e.nTr,n=e._aData;if(t){if(n.DT_RowId&&(t.id=n.DT_RowId),n.DT_RowClass){var o=n.DT_RowClass.split(" ");e.__rowc=e.__rowc?ft(e.__rowc.concat(o)):o,i(t).removeClass(e.__rowc.join(" ")).addClass(n.DT_RowClass)}n.DT_RowData&&i(t).data(n.DT_RowData)}}function I(e){var t,n,o,r,s,a=e.nTHead,l=e.nTFoot,c=0===i("th, td",a).length,u=e.oClasses,h=e.aoColumns;for(c&&(r=i("<tr/>").appendTo(a)),t=0,n=h.length;n>t;t++)s=h[t],o=i(s.nTh).addClass(s.sClass),c&&o.appendTo(r),e.oFeatures.bSort&&(o.addClass(s.sSortingClass),!1!==s.bSortable&&(o.attr("tabindex",e.iTabIndex).attr("aria-controls",e.sTableId),Ee(e,s.nTh,t))),s.sTitle!=o.html()&&o.html(s.sTitle),He(e,"header")(e,o,s,u);if(c&&B(e.aoHeader,a),i(a).find(">tr").attr("role","row"),i(a).find(">tr>th, >tr>td").addClass(u.sHeaderTH),i(l).find(">tr>th, >tr>td").addClass(u.sFooterTH),null!==l)for(e=e.aoFooter[0],t=0,n=e.length;n>t;t++)s=h[t],s.nTf=e[t].cell,s.sClass&&i(s.nTf).addClass(s.sClass)}function P(e,t,o){var r,s,a,l,c=[],u=[],h=e.aoColumns.length;if(t){for(o===n&&(o=!1),r=0,s=t.length;s>r;r++){for(c[r]=t[r].slice(),c[r].nTr=t[r].nTr,a=h-1;a>=0;a--)!e.aoColumns[a].bVisible&&!o&&c[r].splice(a,1);u.push([])}for(r=0,s=c.length;s>r;r++){if(e=c[r].nTr)for(;a=e.firstChild;)e.removeChild(a);for(a=0,t=c[r].length;t>a;a++)if(l=h=1,u[r][a]===n){for(e.appendChild(c[r][a].cell),u[r][a]=1;c[r+h]!==n&&c[r][a].cell==c[r+h][a].cell;)u[r+h][a]=1,h++;for(;c[r][a+l]!==n&&c[r][a].cell==c[r][a+l].cell;){for(o=0;h>o;o++)u[r+o][a+l]=1;l++}i(c[r][a].cell).attr("rowspan",h).attr("colspan",l)}}}}function F(e){var t=Be(e,"aoPreDrawCallback","preDraw",[e]);if(-1!==i.inArray(!1,t))de(e,!1);else{var t=[],o=0,r=e.asStripeClasses,s=r.length,a=e.oLanguage,l=e.iInitDisplayStart,c="ssp"==Ue(e),u=e.aiDisplay;e.bDrawing=!0,l!==n&&-1!==l&&(e._iDisplayStart=c?l:l>=e.fnRecordsDisplay()?0:l,e.iInitDisplayStart=-1);var l=e._iDisplayStart,h=e.fnDisplayEnd();if(e.bDeferLoading)e.bDeferLoading=!1,e.iDraw++,de(e,!1);else if(c){if(!e.bDestroying&&!U(e))return}else e.iDraw++;if(0!==u.length)for(a=c?e.aoData.length:h,c=c?0:l;a>c;c++){var d=u[c],f=e.aoData[d];if(null===f.nTr&&M(e,d),d=f.nTr,0!==s){var p=r[o%s];f._sRowStripe!=p&&(i(d).removeClass(f._sRowStripe).addClass(p),f._sRowStripe=p)}Be(e,"aoRowCallback",null,[d,f._aData,o,c]),t.push(d),o++}else o=a.sZeroRecords,1==e.iDraw&&"ajax"==Ue(e)?o=a.sLoadingRecords:a.sEmptyTable&&0===e.fnRecordsTotal()&&(o=a.sEmptyTable),t[0]=i("<tr/>",{"class":s?r[0]:""}).append(i("<td />",{valign:"top",colSpan:g(e),"class":e.oClasses.sRowEmpty}).html(o))[0];Be(e,"aoHeaderCallback","header",[i(e.nTHead).children("tr")[0],$(e),l,h,u]),Be(e,"aoFooterCallback","footer",[i(e.nTFoot).children("tr")[0],$(e),l,h,u]),r=i(e.nTBody),r.children().detach(),r.append(i(t)),Be(e,"aoDrawCallback","draw",[e]),e.bSorted=!1,e.bFiltered=!1,e.bDrawing=!1}}function O(e,t){var n=e.oFeatures,i=n.bFilter;n.bSort&&ke(e),i?J(e,e.oPreviousSearch):e.aiDisplay=e.aiDisplayMaster.slice(),!0!==t&&(e._iDisplayStart=0),e._drawHold=t,F(e),e._drawHold=!1}function L(e){var t=e.oClasses,n=i(e.nTable),n=i("<div/>").insertBefore(n),o=e.oFeatures,r=i("<div/>",{id:e.sTableId+"_wrapper","class":t.sWrapper+(e.nTFoot?"":" "+t.sNoFooter)});e.nHolding=n[0],e.nTableWrapper=r[0],e.nTableReinsertBefore=e.nTable.nextSibling;for(var s,a,l,c,u,h,d=e.sDom.split(""),f=0;f<d.length;f++){if(s=null,a=d[f],"<"==a){if(l=i("<div/>")[0],c=d[f+1],"'"==c||'"'==c){for(u="",h=2;d[f+h]!=c;)u+=d[f+h],h++;"H"==u?u=t.sJUIHeader:"F"==u&&(u=t.sJUIFooter),-1!=u.indexOf(".")?(c=u.split("."),l.id=c[0].substr(1,c[0].length-1),l.className=c[1]):"#"==u.charAt(0)?l.id=u.substr(1,u.length-1):l.className=u,f+=h}r.append(l),r=i(l)}else if(">"==a)r=r.parent();else if("l"==a&&o.bPaginate&&o.bLengthChange)s=le(e);else if("f"==a&&o.bFilter)s=V(e);else if("r"==a&&o.bProcessing)s=he(e);else if("t"==a)s=fe(e);else if("i"==a&&o.bInfo)s=ne(e);else if("p"==a&&o.bPaginate)s=ce(e);else if(0!==Ve.ext.feature.length)for(l=Ve.ext.feature,h=0,c=l.length;c>h;h++)if(a==l[h].cFeature){s=l[h].fnInit(e);break}s&&(l=e.aanFeatures,l[a]||(l[a]=[]),l[a].push(s),r.append(s))}n.replaceWith(r)}function B(e,t){var n,o,r,s,a,l,c,u,h,d,f=i(t).children("tr");for(e.splice(0,e.length),r=0,l=f.length;l>r;r++)e.push([]);for(r=0,l=f.length;l>r;r++)for(n=f[r],o=n.firstChild;o;){if("TD"==o.nodeName.toUpperCase()||"TH"==o.nodeName.toUpperCase()){for(u=1*o.getAttribute("colspan"),h=1*o.getAttribute("rowspan"),u=u&&0!==u&&1!==u?u:1,h=h&&0!==h&&1!==h?h:1,s=0,a=e[r];a[s];)s++;for(c=s,d=1===u?!0:!1,a=0;u>a;a++)for(s=0;h>s;s++)e[r+s][c+a]={cell:o,unique:d},e[r+s].nTr=n}o=o.nextSibling}}function R(e,t,n){var i=[];n||(n=e.aoHeader,t&&(n=[],B(n,t)));for(var t=0,o=n.length;o>t;t++)for(var r=0,s=n[t].length;s>r;r++)!n[t][r].unique||i[r]&&e.bSortCellsTop||(i[r]=n[t][r].cell);return i}function H(e,t,n){if(Be(e,"aoServerParams","serverParams",[t]),t&&i.isArray(t)){var o={},r=/(.*?)\[\]$/;i.each(t,function(e,t){var n=t.name.match(r);n?(n=n[0],o[n]||(o[n]=[]),o[n].push(t.value)):o[t.name]=t.value}),t=o}var s,a=e.ajax,l=e.oInstance;if(i.isPlainObject(a)&&a.data){s=a.data;var c=i.isFunction(s)?s(t):s,t=i.isFunction(s)&&c?c:i.extend(!0,t,c);delete a.data}c={data:t,success:function(t){var i=t.error||t.sError;i&&e.oApi._fnLog(e,0,i),e.json=t,Be(e,null,"xhr",[e,t]),n(t)},dataType:"json",cache:!1,type:e.sServerMethod,error:function(t,n){var i=e.oApi._fnLog;"parsererror"==n?i(e,0,"Invalid JSON response",1):4===t.readyState&&i(e,0,"Ajax error",7),de(e,!1)}},e.oAjaxData=t,Be(e,null,"preXhr",[e,t]),e.fnServerData?e.fnServerData.call(l,e.sAjaxSource,i.map(t,function(e,t){return{name:t,value:e}}),n,e):e.sAjaxSource||"string"==typeof a?e.jqXHR=i.ajax(i.extend(c,{url:a||e.sAjaxSource})):i.isFunction(a)?e.jqXHR=a.call(l,t,n,e):(e.jqXHR=i.ajax(i.extend(c,a)),a.data=s)}function U(e){return e.bAjaxDataGet?(e.iDraw++,de(e,!0),H(e,W(e),function(t){z(e,t)}),!1):!0}function W(e){var t,n,o,r,s=e.aoColumns,a=s.length,l=e.oFeatures,c=e.oPreviousSearch,u=e.aoPreSearchCols,h=[],d=_e(e);t=e._iDisplayStart,n=!1!==l.bPaginate?e._iDisplayLength:-1;var f=function(e,t){h.push({name:e,value:t})};f("sEcho",e.iDraw),f("iColumns",a),f("sColumns",ct(s,"sName").join(",")),f("iDisplayStart",t),f("iDisplayLength",n);var p={draw:e.iDraw,columns:[],order:[],start:t,length:n,search:{value:c.sSearch,regex:c.bRegex}};for(t=0;a>t;t++)o=s[t],r=u[t],n="function"==typeof o.mData?"function":o.mData,p.columns.push({data:n,name:o.sName,searchable:o.bSearchable,orderable:o.bSortable,search:{value:r.sSearch,regex:r.bRegex}}),f("mDataProp_"+t,n),l.bFilter&&(f("sSearch_"+t,r.sSearch),f("bRegex_"+t,r.bRegex),f("bSearchable_"+t,o.bSearchable)),l.bSort&&f("bSortable_"+t,o.bSortable);return l.bFilter&&(f("sSearch",c.sSearch),f("bRegex",c.bRegex)),l.bSort&&(i.each(d,function(e,t){p.order.push({column:t.col,dir:t.dir}),f("iSortCol_"+e,t.col),f("sSortDir_"+e,t.dir)}),f("iSortingCols",d.length)),s=Ve.ext.legacy.ajax,null===s?e.sAjaxSource?h:p:s?h:p}function z(e,t){var i=t.sEcho!==n?t.sEcho:t.draw,o=t.iTotalRecords!==n?t.iTotalRecords:t.recordsTotal,r=t.iTotalDisplayRecords!==n?t.iTotalDisplayRecords:t.recordsFiltered;if(i){if(1*i<e.iDraw)return;e.iDraw=1*i}for(E(e),e._iRecordsTotal=parseInt(o,10),e._iRecordsDisplay=parseInt(r,10),i=q(e,t),o=0,r=i.length;r>o;o++)w(e,i[o]);e.aiDisplay=e.aiDisplayMaster.slice(),e.bAjaxDataGet=!1,F(e),e._bInitComplete||se(e,t),e.bAjaxDataGet=!0,de(e,!1)}function q(e,t){var o=i.isPlainObject(e.ajax)&&e.ajax.dataSrc!==n?e.ajax.dataSrc:e.sAjaxDataProp;return"data"===o?t.aaData||t[o]:""!==o?k(o)(t):t}function V(e){var n=e.oClasses,o=e.sTableId,r=e.oLanguage,s=e.oPreviousSearch,a=e.aanFeatures,l='<input type="search" class="'+n.sFilterInput+'"/>',c=r.sSearch,c=c.match(/_INPUT_/)?c.replace("_INPUT_",l):c+l,n=i("<div/>",{id:a.f?null:o+"_filter","class":n.sFilter}).append(i("<label/>").append(c)),a=function(){var t=this.value?this.value:"";t!=s.sSearch&&(J(e,{sSearch:t,bRegex:s.bRegex,bSmart:s.bSmart,bCaseInsensitive:s.bCaseInsensitive}),e._iDisplayStart=0,F(e))},l=null!==e.searchDelay?e.searchDelay:"ssp"===Ue(e)?400:0,u=i("input",n).val(s.sSearch).attr("placeholder",r.sSearchPlaceholder).bind("keyup.DT search.DT input.DT paste.DT cut.DT",l?ve(a,l):a).bind("keypress.DT",function(e){return 13==e.keyCode?!1:void 0}).attr("aria-controls",o);return i(e.nTable).on("search.dt.DT",function(n,i){if(e===i)try{u[0]!==t.activeElement&&u.val(s.sSearch)}catch(o){}}),n[0]}function J(e,t,i){var o=e.oPreviousSearch,r=e.aoPreSearchCols,s=function(e){o.sSearch=e.sSearch,o.bRegex=e.bRegex,o.bSmart=e.bSmart,o.bCaseInsensitive=e.bCaseInsensitive};if(b(e),"ssp"!=Ue(e)){for(Q(e,t.sSearch,i,t.bEscapeRegex!==n?!t.bEscapeRegex:t.bRegex,t.bSmart,t.bCaseInsensitive),s(t),t=0;t<r.length;t++)G(e,r[t].sSearch,t,r[t].bEscapeRegex!==n?!r[t].bEscapeRegex:r[t].bRegex,r[t].bSmart,r[t].bCaseInsensitive);Y(e)}else s(t);e.bFiltered=!0,Be(e,null,"search",[e])}function Y(e){for(var t,n,i=Ve.ext.search,o=e.aiDisplay,r=0,s=i.length;s>r;r++){for(var a=[],l=0,c=o.length;c>l;l++)n=o[l],t=e.aoData[n],i[r](e,t._aFilterData,n,t._aData,l)&&a.push(n);o.length=0,o.push.apply(o,a)}}function G(e,t,n,i,o,r){if(""!==t)for(var s=e.aiDisplay,i=K(t,i,o,r),o=s.length-1;o>=0;o--)t=e.aoData[s[o]]._aFilterData[n],i.test(t)||s.splice(o,1)}function Q(e,t,n,i,o,r){var s,i=K(t,i,o,r),o=e.oPreviousSearch.sSearch,r=e.aiDisplayMaster;if(0!==Ve.ext.search.length&&(n=!0),s=Z(e),0>=t.length)e.aiDisplay=r.slice();else for((s||n||o.length>t.length||0!==t.indexOf(o)||e.bSorted)&&(e.aiDisplay=r.slice()),t=e.aiDisplay,n=t.length-1;n>=0;n--)i.test(e.aoData[t[n]]._sFilterRow)||t.splice(n,1)}function K(e,t,n,o){return e=t?e:X(e),n&&(e="^(?=.*?"+i.map(e.match(/"[^"]+"|[^ ]+/g)||"",function(e){if('"'===e.charAt(0))var t=e.match(/^"(.*)"$/),e=t?t[1]:e;return e.replace('"',"")}).join(")(?=.*?")+").*$"),RegExp(e,o?"i":"")}function X(e){return e.replace(nt,"\\$1")}function Z(e){var t,n,i,o,r,s,a,l,c=e.aoColumns,u=Ve.ext.type.search;for(t=!1,n=0,o=e.aoData.length;o>n;n++)if(l=e.aoData[n],!l._aFilterData){for(s=[],i=0,r=c.length;r>i;i++)t=c[i],t.bSearchable?(a=x(e,n,i,"filter"),u[t.sType]&&(a=u[t.sType](a)),null===a&&(a=""),"string"!=typeof a&&a.toString&&(a=a.toString())):a="",a.indexOf&&-1!==a.indexOf("&")&&(vt.innerHTML=a,a=bt?vt.textContent:vt.innerText),a.replace&&(a=a.replace(/[\r\n]/g,"")),s.push(a);l._aFilterData=s,l._sFilterRow=s.join("  "),t=!0}return t}function ee(e){return{search:e.sSearch,smart:e.bSmart,regex:e.bRegex,caseInsensitive:e.bCaseInsensitive}}function te(e){return{sSearch:e.search,bSmart:e.smart,bRegex:e.regex,bCaseInsensitive:e.caseInsensitive}}function ne(e){var t=e.sTableId,n=e.aanFeatures.i,o=i("<div/>",{"class":e.oClasses.sInfo,id:n?null:t+"_info"});return n||(e.aoDrawCallback.push({fn:ie,sName:"information"}),o.attr("role","status").attr("aria-live","polite"),i(e.nTable).attr("aria-describedby",t+"_info")),o[0]}function ie(e){var t=e.aanFeatures.i;if(0!==t.length){var n=e.oLanguage,o=e._iDisplayStart+1,r=e.fnDisplayEnd(),s=e.fnRecordsTotal(),a=e.fnRecordsDisplay(),l=a?n.sInfo:n.sInfoEmpty;a!==s&&(l+=" "+n.sInfoFiltered),l+=n.sInfoPostFix,l=oe(e,l),n=n.fnInfoCallback,null!==n&&(l=n.call(e.oInstance,e,o,r,s,a,l)),i(t).html(l)}}function oe(e,t){var n=e.fnFormatNumber,i=e._iDisplayStart+1,o=e._iDisplayLength,r=e.fnRecordsDisplay(),s=-1===o;return t.replace(/_START_/g,n.call(e,i)).replace(/_END_/g,n.call(e,e.fnDisplayEnd())).replace(/_MAX_/g,n.call(e,e.fnRecordsTotal())).replace(/_TOTAL_/g,n.call(e,r)).replace(/_PAGE_/g,n.call(e,s?1:Math.ceil(i/o))).replace(/_PAGES_/g,n.call(e,s?1:Math.ceil(r/o)))}function re(e){var t,n,i,o=e.iInitDisplayStart,r=e.aoColumns;if(n=e.oFeatures,e.bInitialised){for(L(e),I(e),P(e,e.aoHeader),P(e,e.aoFooter),de(e,!0),n.bAutoWidth&&ge(e),t=0,n=r.length;n>t;t++)i=r[t],i.sWidth&&(i.nTh.style.width=xe(i.sWidth));O(e),r=Ue(e),"ssp"!=r&&("ajax"==r?H(e,[],function(n){var i=q(e,n);for(t=0;t<i.length;t++)w(e,i[t]);e.iInitDisplayStart=o,O(e),de(e,!1),se(e,n)},e):(de(e,!1),se(e)))}else setTimeout(function(){re(e)},200)}function se(e,t){e._bInitComplete=!0,t&&f(e),Be(e,"aoInitComplete","init",[e,t])}function ae(e,t){var n=parseInt(t,10);e._iDisplayLength=n,Re(e),Be(e,null,"length",[e,n])}function le(e){for(var t=e.oClasses,n=e.sTableId,o=e.aLengthMenu,r=i.isArray(o[0]),s=r?o[0]:o,o=r?o[1]:o,r=i("<select/>",{name:n+"_length","aria-controls":n,"class":t.sLengthSelect}),a=0,l=s.length;l>a;a++)r[0][a]=new Option(o[a],s[a]);var c=i("<div><label/></div>").addClass(t.sLength);return e.aanFeatures.l||(c[0].id=n+"_length"),c.children().append(e.oLanguage.sLengthMenu.replace("_MENU_",r[0].outerHTML)),i("select",c).val(e._iDisplayLength).bind("change.DT",function(){ae(e,i(this).val()),F(e)}),i(e.nTable).bind("length.dt.DT",function(t,n,o){e===n&&i("select",c).val(o)}),c[0]}function ce(e){var t=e.sPaginationType,n=Ve.ext.pager[t],o="function"==typeof n,r=function(e){F(e)},t=i("<div/>").addClass(e.oClasses.sPaging+t)[0],s=e.aanFeatures;return o||n.fnInit(e,t,r),s.p||(t.id=e.sTableId+"_paginate",e.aoDrawCallback.push({fn:function(e){if(o){var t,i=e._iDisplayStart,a=e._iDisplayLength,l=e.fnRecordsDisplay(),c=-1===a,i=c?0:Math.ceil(i/a),a=c?1:Math.ceil(l/a),l=n(i,a),c=0;for(t=s.p.length;t>c;c++)He(e,"pageButton")(e,s.p[c],c,l,i,a)}else n.fnUpdate(e,r)},sName:"pagination"})),t}function ue(e,t,n){var i=e._iDisplayStart,o=e._iDisplayLength,r=e.fnRecordsDisplay();return 0===r||-1===o?i=0:"number"==typeof t?(i=t*o,i>r&&(i=0)):"first"==t?i=0:"previous"==t?(i=o>=0?i-o:0,0>i&&(i=0)):"next"==t?r>i+o&&(i+=o):"last"==t?i=Math.floor((r-1)/o)*o:Ie(e,0,"Unknown paging action: "+t,5),t=e._iDisplayStart!==i,e._iDisplayStart=i,t&&(Be(e,null,"page",[e]),n&&F(e)),t}function he(e){return i("<div/>",{id:e.aanFeatures.r?null:e.sTableId+"_processing","class":e.oClasses.sProcessing}).html(e.oLanguage.sProcessing).insertBefore(e.nTable)[0]}function de(e,t){e.oFeatures.bProcessing&&i(e.aanFeatures.r).css("display",t?"block":"none"),Be(e,null,"processing",[e,t])}function fe(e){var t=i(e.nTable);t.attr("role","grid");var n=e.oScroll;if(""===n.sX&&""===n.sY)return e.nTable;var o=n.sX,r=n.sY,s=e.oClasses,a=t.children("caption"),l=a.length?a[0]._captionSide:null,c=i(t[0].cloneNode(!1)),u=i(t[0].cloneNode(!1)),h=t.children("tfoot");n.sX&&"100%"===t.attr("width")&&t.removeAttr("width"),h.length||(h=null),n=i("<div/>",{"class":s.sScrollWrapper}).append(i("<div/>",{"class":s.sScrollHead}).css({overflow:"hidden",position:"relative",border:0,width:o?o?xe(o):null:"100%"}).append(i("<div/>",{"class":s.sScrollHeadInner}).css({"box-sizing":"content-box",width:n.sXInner||"100%"}).append(c.removeAttr("id").css("margin-left",0).append("top"===l?a:null).append(t.children("thead"))))).append(i("<div/>",{"class":s.sScrollBody}).css({overflow:"auto",height:r?xe(r):null,width:o?xe(o):null}).append(t)),h&&n.append(i("<div/>",{"class":s.sScrollFoot}).css({overflow:"hidden",border:0,width:o?o?xe(o):null:"100%"}).append(i("<div/>",{"class":s.sScrollFootInner}).append(u.removeAttr("id").css("margin-left",0).append("bottom"===l?a:null).append(t.children("tfoot")))));var t=n.children(),d=t[0],s=t[1],f=h?t[2]:null;return o&&i(s).scroll(function(){var e=this.scrollLeft;d.scrollLeft=e,h&&(f.scrollLeft=e)}),e.nScrollHead=d,e.nScrollBody=s,e.nScrollFoot=f,e.aoDrawCallback.push({fn:pe,sName:"scrolling"}),n[0]}function pe(e){var t,n,o,r,s,a,l=e.oScroll,c=l.sX,u=l.sXInner,h=l.sY,d=l.iBarWidth,f=i(e.nScrollHead),m=f[0].style,g=f.children("div"),v=g[0].style,b=g.children("table"),g=e.nScrollBody,y=i(g),w=g.style,S=i(e.nScrollFoot).children("div"),x=S.children("table"),C=i(e.nTHead),_=i(e.nTable),k=_[0],j=k.style,$=e.nTFoot?i(e.nTFoot):null,E=e.oBrowser,T=E.bScrollOversize,A=[],D=[],M=[],N=function(e){e=e.style,e.paddingTop="0",e.paddingBottom="0",e.borderTopWidth="0",e.borderBottomWidth="0",e.height=0};_.children("thead, tfoot").remove(),s=C.clone().prependTo(_),t=C.find("tr"),o=s.find("tr"),s.find("th, td").removeAttr("tabindex"),$&&(r=$.clone().prependTo(_),n=$.find("tr"),r=r.find("tr")),c||(w.width="100%",f[0].style.width="100%"),i.each(R(e,s),function(t,n){a=p(e,t),n.style.width=e.aoColumns[a].sWidth}),$&&me(function(e){e.style.width=""},r),l.bCollapse&&""!==h&&(w.height=y[0].offsetHeight+C[0].offsetHeight+"px"),f=_.outerWidth(),""===c?(j.width="100%",T&&(_.find("tbody").height()>g.offsetHeight||"scroll"==y.css("overflow-y"))&&(j.width=xe(_.outerWidth()-d))):""!==u?j.width=xe(u):f==y.width()&&y.height()<_.height()?(j.width=xe(f-d),_.outerWidth()>f-d&&(j.width=xe(f))):j.width=xe(f),f=_.outerWidth(),me(N,o),me(function(e){M.push(e.innerHTML),A.push(xe(i(e).css("width")))},o),me(function(e,t){e.style.width=A[t]},t),i(o).height(0),$&&(me(N,r),me(function(e){D.push(xe(i(e).css("width")))},r),me(function(e,t){e.style.width=D[t]},n),i(r).height(0)),me(function(e,t){e.innerHTML='<div class="dataTables_sizing" style="height:0;overflow:hidden;">'+M[t]+"</div>",e.style.width=A[t]},o),$&&me(function(e,t){e.innerHTML="",e.style.width=D[t]},r),_.outerWidth()<f?(n=g.scrollHeight>g.offsetHeight||"scroll"==y.css("overflow-y")?f+d:f,T&&(g.scrollHeight>g.offsetHeight||"scroll"==y.css("overflow-y"))&&(j.width=xe(n-d)),(""===c||""!==u)&&Ie(e,1,"Possible column misalignment",6)):n="100%",w.width=xe(n),m.width=xe(n),$&&(e.nScrollFoot.style.width=xe(n)),!h&&T&&(w.height=xe(k.offsetHeight+d)),h&&l.bCollapse&&(w.height=xe(h),l=c&&k.offsetWidth>g.offsetWidth?d:0,k.offsetHeight<g.offsetHeight&&(w.height=xe(k.offsetHeight+l))),l=_.outerWidth(),b[0].style.width=xe(l),v.width=xe(l),b=_.height()>g.clientHeight||"scroll"==y.css("overflow-y"),E="padding"+(E.bScrollbarLeft?"Left":"Right"),v[E]=b?d+"px":"0px",$&&(x[0].style.width=xe(l),S[0].style.width=xe(l),S[0].style[E]=b?d+"px":"0px"),y.scroll(),!e.bSorted&&!e.bFiltered||e._drawHold||(g.scrollTop=0)}function me(e,t,n){for(var i,o,r=0,s=0,a=t.length;a>s;){for(i=t[s].firstChild,o=n?n[s].firstChild:null;i;)1===i.nodeType&&(n?e(i,o,r):e(i,r),r++),i=i.nextSibling,o=n?o.nextSibling:null;s++}}function ge(t){var n,o,r=t.nTable,s=t.aoColumns,a=t.oScroll,l=a.sY,c=a.sX,u=a.sXInner,h=s.length,a=v(t,"bVisible"),d=i("th",t.nTHead),p=r.getAttribute("width"),m=r.parentNode,b=!1;for(n=0;n<a.length;n++)o=s[a[n]],null!==o.sWidth&&(o.sWidth=be(o.sWidthOrig,m),b=!0);if(b||c||l||h!=g(t)||h!=d.length){h=i(r).clone().empty().css("visibility","hidden").removeAttr("id").append(i(t.nTHead).clone(!1)).append(i(t.nTFoot).clone(!1)).append(i("<tbody><tr/></tbody>")),h.find("tfoot th, tfoot td").css("width","");var y=h.find("tbody tr"),d=R(t,h.find("thead")[0]);for(n=0;n<a.length;n++)o=s[a[n]],d[n].style.width=null!==o.sWidthOrig&&""!==o.sWidthOrig?xe(o.sWidthOrig):"";if(t.aoData.length)for(n=0;n<a.length;n++)b=a[n],o=s[b],i(we(t,b)).clone(!1).append(o.sContentPadding).appendTo(y);if(h.appendTo(m),c&&u?h.width(u):c?(h.css("width","auto"),h.width()<m.offsetWidth&&h.width(m.offsetWidth)):l?h.width(m.offsetWidth):p&&h.width(p),ye(t,h[0]),c){for(n=u=0;n<a.length;n++)o=s[a[n]],l=i(d[n]).outerWidth(),u+=null===o.sWidthOrig?l:parseInt(o.sWidth,10)+l-i(d[n]).width();h.width(xe(u)),r.style.width=xe(u)}for(n=0;n<a.length;n++)o=s[a[n]],(l=i(d[n]).width())&&(o.sWidth=xe(l));r.style.width=xe(h.css("width")),h.remove()}else for(n=0;h>n;n++)s[n].sWidth=xe(d.eq(n).width());p&&(r.style.width=xe(p)),!p&&!c||t._reszEvt||(i(e).bind("resize.DT-"+t.sInstance,ve(function(){f(t)})),t._reszEvt=!0)}function ve(e,t){var i,o,r=t!==n?t:200;return function(){var t=this,s=+new Date,a=arguments;i&&i+r>s?(clearTimeout(o),o=setTimeout(function(){i=n,e.apply(t,a)},r)):i?(i=s,e.apply(t,a)):i=s}}function be(e,n){if(!e)return 0;var o=i("<div/>").css("width",xe(e)).appendTo(n||t.body),r=o[0].offsetWidth;return o.remove(),r}function ye(e,t){var n=e.oScroll;(n.sX||n.sY)&&(n=n.sX?0:n.iBarWidth,t.style.width=xe(i(t).outerWidth()-n))}function we(e,t){var n=Se(e,t);if(0>n)return null;var o=e.aoData[n];return o.nTr?o.anCells[t]:i("<td/>").html(x(e,n,t,"display"))[0]}function Se(e,t){for(var n,i=-1,o=-1,r=0,s=e.aoData.length;s>r;r++)n=x(e,r,t,"display")+"",n=n.replace(yt,""),n.length>i&&(i=n.length,o=r);return o}function xe(e){return null===e?"0px":"number"==typeof e?0>e?"0px":e+"px":e.match(/\d$/)?e+"px":e}function Ce(){if(!Ve.__scrollbarWidth){var e=i("<p/>").css({width:"100%",height:200,padding:0})[0],t=i("<div/>").css({position:"absolute",top:0,left:0,width:200,height:150,padding:0,overflow:"hidden",visibility:"hidden"}).append(e).appendTo("body"),n=e.offsetWidth;t.css("overflow","scroll"),e=e.offsetWidth,n===e&&(e=t[0].clientWidth),t.remove(),Ve.__scrollbarWidth=n-e}return Ve.__scrollbarWidth}function _e(e){var t,o,r,s,a,l,c=[],u=e.aoColumns;t=e.aaSortingFixed,o=i.isPlainObject(t);var h=[];for(r=function(e){e.length&&!i.isArray(e[0])?h.push(e):h.push.apply(h,e)},i.isArray(t)&&r(t),o&&t.pre&&r(t.pre),r(e.aaSorting),o&&t.post&&r(t.post),e=0;e<h.length;e++)for(l=h[e][0],r=u[l].aDataSort,t=0,o=r.length;o>t;t++)s=r[t],a=u[s].sType||"string",h[e]._idx===n&&(h[e]._idx=i.inArray(h[e][1],u[s].asSorting)),c.push({src:l,col:s,dir:h[e][1],index:h[e]._idx,type:a,formatter:Ve.ext.type.order[a+"-pre"]});return c}function ke(e){var t,n,i,o,r=[],s=Ve.ext.type.order,a=e.aoData,l=0,c=e.aiDisplayMaster;for(b(e),o=_e(e),t=0,n=o.length;n>t;t++)i=o[t],i.formatter&&l++,Ae(e,i.col);if("ssp"!=Ue(e)&&0!==o.length){for(t=0,n=c.length;n>t;t++)r[c[t]]=t;l===o.length?c.sort(function(e,t){var n,i,s,l,c=o.length,u=a[e]._aSortData,h=a[t]._aSortData;for(s=0;c>s;s++)if(l=o[s],n=u[l.col],i=h[l.col],n=i>n?-1:n>i?1:0,0!==n)return"asc"===l.dir?n:-n;return n=r[e],i=r[t],i>n?-1:n>i?1:0}):c.sort(function(e,t){var n,i,l,c,u=o.length,h=a[e]._aSortData,d=a[t]._aSortData;for(l=0;u>l;l++)if(c=o[l],n=h[c.col],i=d[c.col],c=s[c.type+"-"+c.dir]||s["string-"+c.dir],n=c(n,i),0!==n)return n;return n=r[e],i=r[t],i>n?-1:n>i?1:0})}e.bSorted=!0}function je(e){for(var t,n,i=e.aoColumns,o=_e(e),e=e.oLanguage.oAria,r=0,s=i.length;s>r;r++){n=i[r];var a=n.asSorting;t=n.sTitle.replace(/<.*?>/g,"");var l=n.nTh;l.removeAttribute("aria-sort"),n.bSortable&&(0<o.length&&o[0].col==r?(l.setAttribute("aria-sort","asc"==o[0].dir?"ascending":"descending"),n=a[o[0].index+1]||a[0]):n=a[0],t+="asc"===n?e.sSortAscending:e.sSortDescending),l.setAttribute("aria-label",t)}}function $e(e,t,o,r){var s=e.aaSorting,a=e.aoColumns[t].asSorting,l=function(e,t){var o=e._idx;return o===n&&(o=i.inArray(e[1],a)),o+1<a.length?o+1:t?null:0};"number"==typeof s[0]&&(s=e.aaSorting=[s]),o&&e.oFeatures.bSortMulti?(o=i.inArray(t,ct(s,"0")),-1!==o?(t=l(s[o],!0),null===t?s.splice(o,1):(s[o][1]=a[t],s[o]._idx=t)):(s.push([t,a[0],0]),s[s.length-1]._idx=0)):s.length&&s[0][0]==t?(t=l(s[0]),s.length=1,s[0][1]=a[t],s[0]._idx=t):(s.length=0,s.push([t,a[0]]),s[0]._idx=0),O(e),"function"==typeof r&&r(e)}function Ee(e,t,n,i){var o=e.aoColumns[n];Oe(t,{},function(t){!1!==o.bSortable&&(e.oFeatures.bProcessing?(de(e,!0),setTimeout(function(){$e(e,n,t.shiftKey,i),"ssp"!==Ue(e)&&de(e,!1)},0)):$e(e,n,t.shiftKey,i))})}function Te(e){var t,n,o=e.aLastSort,r=e.oClasses.sSortColumn,s=_e(e),a=e.oFeatures;if(a.bSort&&a.bSortClasses){for(a=0,t=o.length;t>a;a++)n=o[a].src,i(ct(e.aoData,"anCells",n)).removeClass(r+(2>a?a+1:3));for(a=0,t=s.length;t>a;a++)n=s[a].src,i(ct(e.aoData,"anCells",n)).addClass(r+(2>a?a+1:3))}e.aLastSort=s}function Ae(e,t){var n,i=e.aoColumns[t],o=Ve.ext.order[i.sSortDataType];o&&(n=o.call(e.oInstance,e,t,m(e,t)));for(var r,s=Ve.ext.type.order[i.sType+"-pre"],a=0,l=e.aoData.length;l>a;a++)i=e.aoData[a],i._aSortData||(i._aSortData=[]),(!i._aSortData[t]||o)&&(r=o?n[a]:x(e,a,t,"sort"),i._aSortData[t]=s?s(r):r)}function De(e){if(e.oFeatures.bStateSave&&!e.bDestroying){var t={time:+new Date,start:e._iDisplayStart,length:e._iDisplayLength,
order:i.extend(!0,[],e.aaSorting),search:ee(e.oPreviousSearch),columns:i.map(e.aoColumns,function(t,n){return{visible:t.bVisible,search:ee(e.aoPreSearchCols[n])}})};Be(e,"aoStateSaveParams","stateSaveParams",[e,t]),e.oSavedState=t,e.fnStateSaveCallback.call(e.oInstance,e,t)}}function Me(e){var t,n,o=e.aoColumns;if(e.oFeatures.bStateSave){var r=e.fnStateLoadCallback.call(e.oInstance,e);if(r&&r.time&&(t=Be(e,"aoStateLoadParams","stateLoadParams",[e,r]),-1===i.inArray(!1,t)&&(t=e.iStateDuration,!(t>0&&r.time<+new Date-1e3*t)&&o.length===r.columns.length))){for(e.oLoadedState=i.extend(!0,{},r),e._iDisplayStart=r.start,e.iInitDisplayStart=r.start,e._iDisplayLength=r.length,e.aaSorting=[],i.each(r.order,function(t,n){e.aaSorting.push(n[0]>=o.length?[0,n[1]]:n)}),i.extend(e.oPreviousSearch,te(r.search)),t=0,n=r.columns.length;n>t;t++){var s=r.columns[t];o[t].bVisible=s.visible,i.extend(e.aoPreSearchCols[t],te(s.search))}Be(e,"aoStateLoaded","stateLoaded",[e,r])}}}function Ne(e){var t=Ve.settings,e=i.inArray(e,ct(t,"nTable"));return-1!==e?t[e]:null}function Ie(t,n,i,o){if(i="DataTables warning: "+(null!==t?"table id="+t.sTableId+" - ":"")+i,o&&(i+=". For more information about this error, please see http://datatables.net/tn/"+o),n)e.console&&console.log&&console.log(i);else{if(t=Ve.ext,"alert"!=(t.sErrMode||t.errMode))throw Error(i);alert(i)}}function Pe(e,t,o,r){i.isArray(o)?i.each(o,function(n,o){i.isArray(o)?Pe(e,t,o[0],o[1]):Pe(e,t,o)}):(r===n&&(r=o),t[o]!==n&&(e[r]=t[o]))}function Fe(e,t,n){var o,r;for(r in t)t.hasOwnProperty(r)&&(o=t[r],i.isPlainObject(o)?(i.isPlainObject(e[r])||(e[r]={}),i.extend(!0,e[r],o)):e[r]=n&&"data"!==r&&"aaData"!==r&&i.isArray(o)?o.slice():o);return e}function Oe(e,t,n){i(e).bind("click.DT",t,function(t){e.blur(),n(t)}).bind("keypress.DT",t,function(e){13===e.which&&(e.preventDefault(),n(e))}).bind("selectstart.DT",function(){return!1})}function Le(e,t,n,i){n&&e[t].push({fn:n,sName:i})}function Be(e,t,n,o){var r=[];return t&&(r=i.map(e[t].slice().reverse(),function(t){return t.fn.apply(e.oInstance,o)})),null!==n&&i(e.nTable).trigger(n+".dt",o),r}function Re(e){var t=e._iDisplayStart,n=e.fnDisplayEnd(),i=e._iDisplayLength;t>=n&&(t=n-i),t-=t%i,(-1===i||0>t)&&(t=0),e._iDisplayStart=t}function He(e,t){var n=e.renderer,o=Ve.ext.renderer[t];return i.isPlainObject(n)&&n[t]?o[n[t]]||o._:"string"==typeof n?o[n]||o._:o._}function Ue(e){return e.oFeatures.bServerSide?"ssp":e.ajax||e.sAjaxSource?"ajax":"dom"}function We(e,t){var n=[],n=Ft.numbers_length,i=Math.floor(n/2);return n>=t?n=ht(0,t):i>=e?(n=ht(0,n-2),n.push("ellipsis"),n.push(t-1)):(e>=t-1-i?n=ht(t-(n-2),t):(n=ht(e-1,e+2),n.push("ellipsis"),n.push(t-1)),n.splice(0,0,"ellipsis"),n.splice(0,0,0)),n.DT_el="span",n}function ze(e){i.each({num:function(t){return Ot(t,e)},"num-fmt":function(t){return Ot(t,e,it)},"html-num":function(t){return Ot(t,e,Ze)},"html-num-fmt":function(t){return Ot(t,e,Ze,it)}},function(t,n){Je.type.order[t+e+"-pre"]=n,t.match(/^html\-/)&&(Je.type.search[t+e]=Je.type.search.html)})}function qe(e){return function(){var t=[Ne(this[Ve.ext.iApiIndex])].concat(Array.prototype.slice.call(arguments));return Ve.ext.internal[e].apply(this,t)}}var Ve,Je,Ye,Ge,Qe,Ke={},Xe=/[\r\n]/g,Ze=/<.*?>/g,et=/^[\w\+\-]/,tt=/[\w\+\-]$/,nt=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\|\\$|\\^|\\-)","g"),it=/[',$\u00a3\u20ac\u00a5%\u2009\u202F]/g,ot=function(e){return e&&!0!==e&&"-"!==e?!1:!0},rt=function(e){var t=parseInt(e,10);return!isNaN(t)&&isFinite(e)?t:null},st=function(e,t){return Ke[t]||(Ke[t]=RegExp(X(t),"g")),"string"==typeof e&&"."!==t?e.replace(/\./g,"").replace(Ke[t],"."):e},at=function(e,t,n){var i="string"==typeof e;return t&&i&&(e=st(e,t)),n&&i&&(e=e.replace(it,"")),ot(e)||!isNaN(parseFloat(e))&&isFinite(e)},lt=function(e,t,n){return ot(e)?!0:(ot(e)||"string"==typeof e)&&at(e.replace(Ze,""),t,n)?!0:null},ct=function(e,t,i){var o=[],r=0,s=e.length;if(i!==n)for(;s>r;r++)e[r]&&e[r][t]&&o.push(e[r][t][i]);else for(;s>r;r++)e[r]&&o.push(e[r][t]);return o},ut=function(e,t,i,o){var r=[],s=0,a=t.length;if(o!==n)for(;a>s;s++)e[t[s]][i]&&r.push(e[t[s]][i][o]);else for(;a>s;s++)r.push(e[t[s]][i]);return r},ht=function(e,t){var i,o=[];t===n?(t=0,i=e):(i=t,t=e);for(var r=t;i>r;r++)o.push(r);return o},dt=function(e){for(var t=[],n=0,i=e.length;i>n;n++)e[n]&&t.push(e[n]);return t},ft=function(e){var t,n,i,o=[],r=e.length,s=0;n=0;e:for(;r>n;n++){for(t=e[n],i=0;s>i;i++)if(o[i]===t)continue e;o.push(t),s++}return o},pt=function(e,t,i){e[t]!==n&&(e[i]=e[t])},mt=/\[.*?\]$/,gt=/\(\)$/,vt=i("<div>")[0],bt=vt.textContent!==n,yt=/<.*?>/g;Ve=function(e){this.$=function(e,t){return this.api(!0).$(e,t)},this._=function(e,t){return this.api(!0).rows(e,t).data()},this.api=function(e){return new Ye(e?Ne(this[Je.iApiIndex]):this)},this.fnAddData=function(e,t){var o=this.api(!0),r=i.isArray(e)&&(i.isArray(e[0])||i.isPlainObject(e[0]))?o.rows.add(e):o.row.add(e);return(t===n||t)&&o.draw(),r.flatten().toArray()},this.fnAdjustColumnSizing=function(e){var t=this.api(!0).columns.adjust(),i=t.settings()[0],o=i.oScroll;e===n||e?t.draw(!1):(""!==o.sX||""!==o.sY)&&pe(i)},this.fnClearTable=function(e){var t=this.api(!0).clear();(e===n||e)&&t.draw()},this.fnClose=function(e){this.api(!0).row(e).child.hide()},this.fnDeleteRow=function(e,t,i){var o=this.api(!0),e=o.rows(e),r=e.settings()[0],s=r.aoData[e[0][0]];return e.remove(),t&&t.call(this,r,s),(i===n||i)&&o.draw(),s},this.fnDestroy=function(e){this.api(!0).destroy(e)},this.fnDraw=function(e){this.api(!0).draw(!e)},this.fnFilter=function(e,t,i,o,r,s){r=this.api(!0),null===t||t===n?r.search(e,i,o,s):r.column(t).search(e,i,o,s),r.draw()},this.fnGetData=function(e,t){var i=this.api(!0);if(e!==n){var o=e.nodeName?e.nodeName.toLowerCase():"";return t!==n||"td"==o||"th"==o?i.cell(e,t).data():i.row(e).data()||null}return i.data().toArray()},this.fnGetNodes=function(e){var t=this.api(!0);return e!==n?t.row(e).node():t.rows().nodes().flatten().toArray()},this.fnGetPosition=function(e){var t=this.api(!0),n=e.nodeName.toUpperCase();return"TR"==n?t.row(e).index():"TD"==n||"TH"==n?(e=t.cell(e).index(),[e.row,e.columnVisible,e.column]):null},this.fnIsOpen=function(e){return this.api(!0).row(e).child.isShown()},this.fnOpen=function(e,t,n){return this.api(!0).row(e).child(t,n).show().child()[0]},this.fnPageChange=function(e,t){var i=this.api(!0).page(e);(t===n||t)&&i.draw(!1)},this.fnSetColumnVis=function(e,t,i){e=this.api(!0).column(e).visible(t),(i===n||i)&&e.columns.adjust().draw()},this.fnSettings=function(){return Ne(this[Je.iApiIndex])},this.fnSort=function(e){this.api(!0).order(e).draw()},this.fnSortListener=function(e,t,n){this.api(!0).order.listener(e,t,n)},this.fnUpdate=function(e,t,i,o,r){var s=this.api(!0);return i===n||null===i?s.row(t).data(e):s.cell(t,i).data(e),(r===n||r)&&s.columns.adjust(),(o===n||o)&&s.draw(),0},this.fnVersionCheck=Je.fnVersionCheck;var t=this,o=e===n,u=this.length;o&&(e={}),this.oApi=this.internal=Je.internal;for(var f in Ve.ext.internal)f&&(this[f]=qe(f));return this.each(function(){var f,p={},p=u>1?Fe(p,e,!0):e,m=0,g=this.getAttribute("id"),v=!1,b=Ve.defaults;if("table"!=this.nodeName.toLowerCase())Ie(null,0,"Non-table node initialisation ("+this.nodeName+")",2);else{a(b),l(b.column),r(b,b,!0),r(b.column,b.column,!0),r(b,p);var x=Ve.settings,m=0;for(f=x.length;f>m;m++){if(x[m].nTable==this){if(f=p.bRetrieve!==n?p.bRetrieve:b.bRetrieve,o||f)return x[m].oInstance;if(p.bDestroy!==n?p.bDestroy:b.bDestroy){x[m].oInstance.fnDestroy();break}return void Ie(x[m],0,"Cannot reinitialise DataTable",3)}if(x[m].sTableId==this.id){x.splice(m,1);break}}(null===g||""===g)&&(this.id=g="DataTables_Table_"+Ve.ext._unique++);var C=i.extend(!0,{},Ve.models.oSettings,{nTable:this,oApi:t.internal,oInit:p,sDestroyWidth:i(this)[0].style.width,sInstance:g,sTableId:g});x.push(C),C.oInstance=1===t.length?t:i(this).dataTable(),a(p),p.oLanguage&&s(p.oLanguage),p.aLengthMenu&&!p.iDisplayLength&&(p.iDisplayLength=i.isArray(p.aLengthMenu[0])?p.aLengthMenu[0][0]:p.aLengthMenu[0]),p=Fe(i.extend(!0,{},b),p),Pe(C.oFeatures,p,"bPaginate bLengthChange bFilter bSort bSortMulti bInfo bProcessing bAutoWidth bSortClasses bServerSide bDeferRender".split(" ")),Pe(C,p,["asStripeClasses","ajax","fnServerData","fnFormatNumber","sServerMethod","aaSorting","aaSortingFixed","aLengthMenu","sPaginationType","sAjaxSource","sAjaxDataProp","iStateDuration","sDom","bSortCellsTop","iTabIndex","fnStateLoadCallback","fnStateSaveCallback","renderer","searchDelay",["iCookieDuration","iStateDuration"],["oSearch","oPreviousSearch"],["aoSearchCols","aoPreSearchCols"],["iDisplayLength","_iDisplayLength"],["bJQueryUI","bJUI"]]),Pe(C.oScroll,p,[["sScrollX","sX"],["sScrollXInner","sXInner"],["sScrollY","sY"],["bScrollCollapse","bCollapse"]]),Pe(C.oLanguage,p,"fnInfoCallback"),Le(C,"aoDrawCallback",p.fnDrawCallback,"user"),Le(C,"aoServerParams",p.fnServerParams,"user"),Le(C,"aoStateSaveParams",p.fnStateSaveParams,"user"),Le(C,"aoStateLoadParams",p.fnStateLoadParams,"user"),Le(C,"aoStateLoaded",p.fnStateLoaded,"user"),Le(C,"aoRowCallback",p.fnRowCallback,"user"),Le(C,"aoRowCreatedCallback",p.fnCreatedRow,"user"),Le(C,"aoHeaderCallback",p.fnHeaderCallback,"user"),Le(C,"aoFooterCallback",p.fnFooterCallback,"user"),Le(C,"aoInitComplete",p.fnInitComplete,"user"),Le(C,"aoPreDrawCallback",p.fnPreDrawCallback,"user"),g=C.oClasses,p.bJQueryUI?(i.extend(g,Ve.ext.oJUIClasses,p.oClasses),p.sDom===b.sDom&&"lfrtip"===b.sDom&&(C.sDom='<"H"lfr>t<"F"ip>'),C.renderer?i.isPlainObject(C.renderer)&&!C.renderer.header&&(C.renderer.header="jqueryui"):C.renderer="jqueryui"):i.extend(g,Ve.ext.classes,p.oClasses),i(this).addClass(g.sTable),(""!==C.oScroll.sX||""!==C.oScroll.sY)&&(C.oScroll.iBarWidth=Ce()),!0===C.oScroll.sX&&(C.oScroll.sX="100%"),C.iInitDisplayStart===n&&(C.iInitDisplayStart=p.iDisplayStart,C._iDisplayStart=p.iDisplayStart),null!==p.iDeferLoading&&(C.bDeferLoading=!0,m=i.isArray(p.iDeferLoading),C._iRecordsDisplay=m?p.iDeferLoading[0]:p.iDeferLoading,C._iRecordsTotal=m?p.iDeferLoading[1]:p.iDeferLoading);var _=C.oLanguage;i.extend(!0,_,p.oLanguage),""!==_.sUrl&&(i.ajax({dataType:"json",url:_.sUrl,success:function(e){s(e),r(b.oLanguage,e),i.extend(!0,_,e),re(C)},error:function(){re(C)}}),v=!0),null===p.asStripeClasses&&(C.asStripeClasses=[g.sStripeOdd,g.sStripeEven]);var m=C.asStripeClasses,k=i("tbody tr:eq(0)",this);-1!==i.inArray(!0,i.map(m,function(e){return k.hasClass(e)}))&&(i("tbody tr",this).removeClass(m.join(" ")),C.asDestroyStripes=m.slice());var j,x=[],m=this.getElementsByTagName("thead");if(0!==m.length&&(B(C.aoHeader,m[0]),x=R(C)),null===p.aoColumns)for(j=[],m=0,f=x.length;f>m;m++)j.push(null);else j=p.aoColumns;for(m=0,f=j.length;f>m;m++)h(C,x?x[m]:null);if(y(C,p.aoColumnDefs,j,function(e,t){d(C,e,t)}),k.length){var $=function(e,t){return e.getAttribute("data-"+t)?t:null};i.each(D(C,k[0]).cells,function(e,t){var i=C.aoColumns[e];if(i.mData===e){var o=$(t,"sort")||$(t,"order"),r=$(t,"filter")||$(t,"search");(null!==o||null!==r)&&(i.mData={_:e+".display",sort:null!==o?e+".@data-"+o:n,type:null!==o?e+".@data-"+o:n,filter:null!==r?e+".@data-"+r:n},d(C,e))}})}var E=C.oFeatures;if(p.bStateSave&&(E.bStateSave=!0,Me(C,p),Le(C,"aoDrawCallback",De,"state_save")),p.aaSorting===n)for(x=C.aaSorting,m=0,f=x.length;f>m;m++)x[m][1]=C.aoColumns[m].asSorting[0];if(Te(C),E.bSort&&Le(C,"aoDrawCallback",function(){if(C.bSorted){var e=_e(C),t={};i.each(e,function(e,n){t[n.src]=n.dir}),Be(C,null,"order",[C,e,t]),je(C)}}),Le(C,"aoDrawCallback",function(){(C.bSorted||"ssp"===Ue(C)||E.bDeferRender)&&Te(C)},"sc"),c(C),m=i(this).children("caption").each(function(){this._captionSide=i(this).css("caption-side")}),f=i(this).children("thead"),0===f.length&&(f=i("<thead/>").appendTo(this)),C.nTHead=f[0],f=i(this).children("tbody"),0===f.length&&(f=i("<tbody/>").appendTo(this)),C.nTBody=f[0],f=i(this).children("tfoot"),0===f.length&&0<m.length&&(""!==C.oScroll.sX||""!==C.oScroll.sY)&&(f=i("<tfoot/>").appendTo(this)),0===f.length||0===f.children().length?i(this).addClass(g.sNoFooter):0<f.length&&(C.nTFoot=f[0],B(C.aoFooter,C.nTFoot)),p.aaData)for(m=0;m<p.aaData.length;m++)w(C,p.aaData[m]);else(C.bDeferLoading||"dom"==Ue(C))&&S(C,i(C.nTBody).children("tr"));C.aiDisplay=C.aiDisplayMaster.slice(),C.bInitialised=!0,!1===v&&re(C)}}),t=null,this};var wt=[],St=Array.prototype,xt=function(e){var t,n,o=Ve.settings,r=i.map(o,function(e){return e.nTable});return e?e.nTable&&e.oApi?[e]:e.nodeName&&"table"===e.nodeName.toLowerCase()?(t=i.inArray(e,r),-1!==t?[o[t]]:null):e&&"function"==typeof e.settings?e.settings().toArray():("string"==typeof e?n=i(e):e instanceof i&&(n=e),n?n.map(function(){return t=i.inArray(this,r),-1!==t?o[t]:null}).toArray():void 0):[]};Ye=function(e,t){if(!this instanceof Ye)throw"DT API must be constructed as a new object";var n=[],o=function(e){(e=xt(e))&&n.push.apply(n,e)};if(i.isArray(e))for(var r=0,s=e.length;s>r;r++)o(e[r]);else o(e);this.context=ft(n),t&&this.push.apply(this,t.toArray?t.toArray():t),this.selector={rows:null,cols:null,opts:null},Ye.extend(this,this,wt)},Ve.Api=Ye,Ye.prototype={concat:St.concat,context:[],each:function(e){for(var t=0,n=this.length;n>t;t++)e.call(this,this[t],t,this);return this},eq:function(e){var t=this.context;return t.length>e?new Ye(t[e],this[e]):null},filter:function(e){var t=[];if(St.filter)t=St.filter.call(this,e,this);else for(var n=0,i=this.length;i>n;n++)e.call(this,this[n],n,this)&&t.push(this[n]);return new Ye(this.context,t)},flatten:function(){var e=[];return new Ye(this.context,e.concat.apply(e,this.toArray()))},join:St.join,indexOf:St.indexOf||function(e,t){for(var n=t||0,i=this.length;i>n;n++)if(this[n]===e)return n;return-1},iterator:function(e,t,i,o){var r,s,a,l,c,u,h,d=[],f=this.context,p=this.selector;for("string"==typeof e&&(o=i,i=t,t=e,e=!1),s=0,a=f.length;a>s;s++){var m=new Ye(f[s]);if("table"===t)r=i.call(m,f[s],s),r!==n&&d.push(r);else if("columns"===t||"rows"===t)r=i.call(m,f[s],this[s],s),r!==n&&d.push(r);else if("column"===t||"column-rows"===t||"row"===t||"cell"===t)for(h=this[s],"column-rows"===t&&(u=$t(f[s],p.opts)),l=0,c=h.length;c>l;l++)r=h[l],r="cell"===t?i.call(m,f[s],r.row,r.column,s,l):i.call(m,f[s],r,s,l,u),r!==n&&d.push(r)}return d.length||o?(e=new Ye(f,e?d.concat.apply([],d):d),t=e.selector,t.rows=p.rows,t.cols=p.cols,t.opts=p.opts,e):this},lastIndexOf:St.lastIndexOf||function(e,t){return this.indexOf.apply(this.toArray.reverse(),arguments)},length:0,map:function(e){var t=[];if(St.map)t=St.map.call(this,e,this);else for(var n=0,i=this.length;i>n;n++)t.push(e.call(this,this[n],n));return new Ye(this.context,t)},pluck:function(e){return this.map(function(t){return t[e]})},pop:St.pop,push:St.push,reduce:St.reduce||function(e,t){return u(this,e,t,0,this.length,1)},reduceRight:St.reduceRight||function(e,t){return u(this,e,t,this.length-1,-1,-1)},reverse:St.reverse,selector:null,shift:St.shift,sort:St.sort,splice:St.splice,toArray:function(){return St.slice.call(this)},to$:function(){return i(this)},toJQuery:function(){return i(this)},unique:function(){return new Ye(this.context,ft(this))},unshift:St.unshift},Ye.extend=function(e,t,n){if(t&&(t instanceof Ye||t.__dt_wrapper)){var o,r,s,a=function(e,t,n){return function(){var i=t.apply(e,arguments);return Ye.extend(i,i,n.methodExt),i}};for(o=0,r=n.length;r>o;o++)s=n[o],t[s.name]="function"==typeof s.val?a(e,s.val,s):i.isPlainObject(s.val)?{}:s.val,t[s.name].__dt_wrapper=!0,Ye.extend(e,t[s.name],s.propExt)}},Ye.register=Ge=function(e,t){if(i.isArray(e))for(var n=0,o=e.length;o>n;n++)Ye.register(e[n],t);else for(var r,s,a=e.split("."),l=wt,n=0,o=a.length;o>n;n++){r=(s=-1!==a[n].indexOf("()"))?a[n].replace("()",""):a[n];var c;e:{c=0;for(var u=l.length;u>c;c++)if(l[c].name===r){c=l[c];break e}c=null}c||(c={name:r,val:{},methodExt:[],propExt:[]},l.push(c)),n===o-1?c.val=t:l=s?c.methodExt:c.propExt}},Ye.registerPlural=Qe=function(e,t,o){Ye.register(e,o),Ye.register(t,function(){var e=o.apply(this,arguments);return e===this?this:e instanceof Ye?e.length?i.isArray(e[0])?new Ye(e.context,e[0]):e[0]:n:e})},Ge("tables()",function(e){var t;if(e){t=Ye;var n=this.context;if("number"==typeof e)e=[n[e]];else var o=i.map(n,function(e){return e.nTable}),e=i(o).filter(e).map(function(){var e=i.inArray(this,o);return n[e]}).toArray();t=new t(e)}else t=this;return t}),Ge("table()",function(e){var e=this.tables(e),t=e.context;return t.length?new Ye(t[0]):e}),Qe("tables().nodes()","table().node()",function(){return this.iterator("table",function(e){return e.nTable},1)}),Qe("tables().body()","table().body()",function(){return this.iterator("table",function(e){return e.nTBody},1)}),Qe("tables().header()","table().header()",function(){return this.iterator("table",function(e){return e.nTHead},1)}),Qe("tables().footer()","table().footer()",function(){return this.iterator("table",function(e){return e.nTFoot},1)}),Qe("tables().containers()","table().container()",function(){return this.iterator("table",function(e){return e.nTableWrapper},1)}),Ge("draw()",function(e){return this.iterator("table",function(t){O(t,!1===e)})}),Ge("page()",function(e){return e===n?this.page.info().page:this.iterator("table",function(t){ue(t,e)})}),Ge("page.info()",function(){if(0===this.context.length)return n;var e=this.context[0],t=e._iDisplayStart,i=e._iDisplayLength,o=e.fnRecordsDisplay(),r=-1===i;return{page:r?0:Math.floor(t/i),pages:r?1:Math.ceil(o/i),start:t,end:e.fnDisplayEnd(),length:i,recordsTotal:e.fnRecordsTotal(),recordsDisplay:o}}),Ge("page.len()",function(e){return e===n?0!==this.context.length?this.context[0]._iDisplayLength:n:this.iterator("table",function(t){ae(t,e)})});var Ct=function(e,t,n){if("ssp"==Ue(e)?O(e,t):(de(e,!0),H(e,[],function(n){E(e);for(var n=q(e,n),i=0,o=n.length;o>i;i++)w(e,n[i]);O(e,t),de(e,!1)})),n){var i=new Ye(e);i.one("draw",function(){n(i.ajax.json())})}};Ge("ajax.json()",function(){var e=this.context;return 0<e.length?e[0].json:void 0}),Ge("ajax.params()",function(){var e=this.context;return 0<e.length?e[0].oAjaxData:void 0}),Ge("ajax.reload()",function(e,t){return this.iterator("table",function(n){Ct(n,!1===t,e)})}),Ge("ajax.url()",function(e){var t=this.context;return e===n?0===t.length?n:(t=t[0],t.ajax?i.isPlainObject(t.ajax)?t.ajax.url:t.ajax:t.sAjaxSource):this.iterator("table",function(t){i.isPlainObject(t.ajax)?t.ajax.url=e:t.ajax=e})}),Ge("ajax.url().load()",function(e,t){return this.iterator("table",function(n){Ct(n,!1===t,e)})});var _t=function(e,t){var o,r,s,a,l,c,u=[];for(o=typeof e,e&&"string"!==o&&"function"!==o&&e.length!==n||(e=[e]),s=0,a=e.length;a>s;s++)for(r=e[s]&&e[s].split?e[s].split(","):[e[s]],l=0,c=r.length;c>l;l++)(o=t("string"==typeof r[l]?i.trim(r[l]):r[l]))&&o.length&&u.push.apply(u,o);return u},kt=function(e){return e||(e={}),e.filter&&!e.search&&(e.search=e.filter),{search:e.search||"none",order:e.order||"current",page:e.page||"all"}},jt=function(e){for(var t=0,n=e.length;n>t;t++)if(0<e[t].length)return e[0]=e[t],e.length=1,e.context=[e.context[t]],e;return e.length=0,e},$t=function(e,t){var n,o,r,s=[],a=e.aiDisplay;n=e.aiDisplayMaster;var l=t.search;if(o=t.order,r=t.page,"ssp"==Ue(e))return"removed"===l?[]:ht(0,n.length);if("current"==r)for(n=e._iDisplayStart,o=e.fnDisplayEnd();o>n;n++)s.push(a[n]);else if("current"==o||"applied"==o)s="none"==l?n.slice():"applied"==l?a.slice():i.map(n,function(e){return-1===i.inArray(e,a)?e:null});else if("index"==o||"original"==o)for(n=0,o=e.aoData.length;o>n;n++)"none"==l?s.push(n):(r=i.inArray(n,a),(-1===r&&"removed"==l||r>=0&&"applied"==l)&&s.push(n));return s};Ge("rows()",function(e,t){e===n?e="":i.isPlainObject(e)&&(t=e,e="");var t=kt(t),o=this.iterator("table",function(n){var o=t;return _t(e,function(e){var t=rt(e);if(null!==t&&!o)return[t];var r=$t(n,o);return null!==t&&-1!==i.inArray(t,r)?[t]:e?"function"==typeof e?i.map(r,function(t){var i=n.aoData[t];return e(t,i._aData,i.nTr)?t:null}):(t=dt(ut(n.aoData,r,"nTr")),e.nodeName&&-1!==i.inArray(e,t)?[e._DT_RowIndex]:i(t).filter(e).map(function(){return this._DT_RowIndex}).toArray()):r})},1);return o.selector.rows=e,o.selector.opts=t,o}),Ge("rows().nodes()",function(){return this.iterator("row",function(e,t){return e.aoData[t].nTr||n},1)}),Ge("rows().data()",function(){return this.iterator(!0,"rows",function(e,t){return ut(e.aoData,t,"_aData")},1)}),Qe("rows().cache()","row().cache()",function(e){return this.iterator("row",function(t,n){var i=t.aoData[n];return"search"===e?i._aFilterData:i._aSortData},1)}),Qe("rows().invalidate()","row().invalidate()",function(e){return this.iterator("row",function(t,n){A(t,n,e)})}),Qe("rows().indexes()","row().index()",function(){return this.iterator("row",function(e,t){return t},1)}),Qe("rows().remove()","row().remove()",function(){var e=this;return this.iterator("row",function(t,n,o){var r=t.aoData;r.splice(n,1);for(var s=0,a=r.length;a>s;s++)null!==r[s].nTr&&(r[s].nTr._DT_RowIndex=s);i.inArray(n,t.aiDisplay),T(t.aiDisplayMaster,n),T(t.aiDisplay,n),T(e[o],n,!1),Re(t)})}),Ge("rows.add()",function(e){var t=this.iterator("table",function(t){var n,i,o,r=[];for(i=0,o=e.length;o>i;i++)n=e[i],n.nodeName&&"TR"===n.nodeName.toUpperCase()?r.push(S(t,n)[0]):r.push(w(t,n));return r},1),n=this.rows(-1);return n.pop(),n.push.apply(n,t.toArray()),n}),Ge("row()",function(e,t){return jt(this.rows(e,t))}),Ge("row().data()",function(e){var t=this.context;return e===n?t.length&&this.length?t[0].aoData[this[0]]._aData:n:(t[0].aoData[this[0]]._aData=e,A(t[0],this[0],"data"),this)}),Ge("row().node()",function(){var e=this.context;return e.length&&this.length?e[0].aoData[this[0]].nTr||null:null}),Ge("row.add()",function(e){e instanceof i&&e.length&&(e=e[0]);var t=this.iterator("table",function(t){return e.nodeName&&"TR"===e.nodeName.toUpperCase()?S(t,e)[0]:w(t,e)});return this.row(t[0])});var Et=function(e,t){var i=e.context;i.length&&(i=i[0].aoData[t!==n?t:e[0]],i._details&&(i._details.remove(),i._detailsShow=n,i._details=n))},Tt=function(e,t){var n=e.context;if(n.length&&e.length){var i=n[0].aoData[e[0]];if(i._details){(i._detailsShow=t)?i._details.insertAfter(i.nTr):i._details.detach();var o=n[0],r=new Ye(o),s=o.aoData;r.off("draw.dt.DT_details column-visibility.dt.DT_details destroy.dt.DT_details"),0<ct(s,"_details").length&&(r.on("draw.dt.DT_details",function(e,t){o===t&&r.rows({page:"current"}).eq(0).each(function(e){e=s[e],e._detailsShow&&e._details.insertAfter(e.nTr)})}),r.on("column-visibility.dt.DT_details",function(e,t){if(o===t)for(var n,i=g(t),r=0,a=s.length;a>r;r++)n=s[r],n._details&&n._details.children("td[colspan]").attr("colspan",i)}),r.on("destroy.dt.DT_details",function(e,t){if(o===t)for(var n=0,i=s.length;i>n;n++)s[n]._details&&Et(r,n)}))}}};Ge("row().child()",function(e,t){var o=this.context;if(e===n)return o.length&&this.length?o[0].aoData[this[0]]._details:n;if(!0===e)this.child.show();else if(!1===e)Et(this);else if(o.length&&this.length){var r=o[0],o=o[0].aoData[this[0]],s=[],a=function(e,t){if(e.nodeName&&"tr"===e.nodeName.toLowerCase())s.push(e);else{var n=i("<tr><td/></tr>").addClass(t);i("td",n).addClass(t).html(e)[0].colSpan=g(r),s.push(n[0])}};if(i.isArray(e)||e instanceof i)for(var l=0,c=e.length;c>l;l++)a(e[l],t);else a(e,t);o._details&&o._details.remove(),o._details=i(s),o._detailsShow&&o._details.insertAfter(o.nTr)}return this}),Ge(["row().child.show()","row().child().show()"],function(){return Tt(this,!0),this}),Ge(["row().child.hide()","row().child().hide()"],function(){return Tt(this,!1),this}),Ge(["row().child.remove()","row().child().remove()"],function(){return Et(this),this}),Ge("row().child.isShown()",function(){var e=this.context;return e.length&&this.length?e[0].aoData[this[0]]._detailsShow||!1:!1});var At=/^(.+):(name|visIdx|visible)$/,Dt=function(e,t,n,i,o){for(var n=[],i=0,r=o.length;r>i;i++)n.push(x(e,o[i],t));return n};Ge("columns()",function(e,t){e===n?e="":i.isPlainObject(e)&&(t=e,e="");var t=kt(t),o=this.iterator("table",function(n){var o=e,r=t,s=n.aoColumns,a=ct(s,"sName"),l=ct(s,"nTh");return _t(o,function(e){var t=rt(e);if(""===e)return ht(s.length);if(null!==t)return[t>=0?t:s.length+t];if("function"==typeof e){var o=$t(n,r);return i.map(s,function(t,i){return e(i,Dt(n,i,0,0,o),l[i])?i:null})}var c="string"==typeof e?e.match(At):"";if(!c)return i(l).filter(e).map(function(){return i.inArray(this,l)}).toArray();switch(c[2]){case"visIdx":case"visible":if(t=parseInt(c[1],10),0>t){var u=i.map(s,function(e,t){return e.bVisible?t:null});return[u[u.length+t]]}return[p(n,t)];case"name":return i.map(a,function(e,t){return e===c[1]?t:null})}})},1);return o.selector.cols=e,o.selector.opts=t,o}),Qe("columns().header()","column().header()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].nTh},1)}),Qe("columns().footer()","column().footer()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].nTf},1)}),Qe("columns().data()","column().data()",function(){return this.iterator("column-rows",Dt,1)}),Qe("columns().dataSrc()","column().dataSrc()",function(){return this.iterator("column",function(e,t){return e.aoColumns[t].mData},1)}),Qe("columns().cache()","column().cache()",function(e){return this.iterator("column-rows",function(t,n,i,o,r){return ut(t.aoData,r,"search"===e?"_aFilterData":"_aSortData",n)},1)}),Qe("columns().nodes()","column().nodes()",function(){return this.iterator("column-rows",function(e,t,n,i,o){return ut(e.aoData,o,"anCells",t)},1)}),Qe("columns().visible()","column().visible()",function(e,t){return this.iterator("column",function(o,r){if(e===n)return o.aoColumns[r].bVisible;var s,a,l,c=o.aoColumns,u=c[r],h=o.aoData;if(e!==n&&u.bVisible!==e){if(e){var d=i.inArray(!0,ct(c,"bVisible"),r+1);for(s=0,a=h.length;a>s;s++)l=h[s].nTr,c=h[s].anCells,l&&l.insertBefore(c[r],c[d]||null)}else i(ct(o.aoData,"anCells",r)).detach();u.bVisible=e,P(o,o.aoHeader),P(o,o.aoFooter),(t===n||t)&&(f(o),(o.oScroll.sX||o.oScroll.sY)&&pe(o)),Be(o,null,"column-visibility",[o,r,e]),De(o)}})}),Qe("columns().indexes()","column().index()",function(e){return this.iterator("column",function(t,n){return"visible"===e?m(t,n):n},1)}),Ge("columns.adjust()",function(){return this.iterator("table",function(e){f(e)},1)}),Ge("column.index()",function(e,t){if(0!==this.context.length){var n=this.context[0];if("fromVisible"===e||"toData"===e)return p(n,t);if("fromData"===e||"toVisible"===e)return m(n,t)}}),Ge("column()",function(e,t){return jt(this.columns(e,t))}),Ge("cells()",function(e,t,o){if(i.isPlainObject(e)&&(typeof e.row!==n?(o=t,t=null):(o=e,e=null)),i.isPlainObject(t)&&(o=t,t=null),null===t||t===n)return this.iterator("table",function(t){var r,s,a,l,c,u,h,d=e,f=kt(o),p=t.aoData,m=$t(t,f),f=dt(ut(p,m,"anCells")),g=i([].concat.apply([],f)),v=t.aoColumns.length;return _t(d,function(e){var o="function"==typeof e;if(null===e||e===n||o){for(s=[],a=0,l=m.length;l>a;a++)for(r=m[a],c=0;v>c;c++)u={row:r,column:c},o?(h=t.aoData[r],e(u,x(t,r,c),h.anCells[c])&&s.push(u)):s.push(u);return s}return i.isPlainObject(e)?[e]:g.filter(e).map(function(e,t){return r=t.parentNode._DT_RowIndex,{row:r,column:i.inArray(t,p[r].anCells)}}).toArray()})});var r,s,a,l,c,u=this.columns(t,o),h=this.rows(e,o),d=this.iterator("table",function(e,t){for(r=[],s=0,a=h[t].length;a>s;s++)for(l=0,c=u[t].length;c>l;l++)r.push({row:h[t][s],column:u[t][l]});return r},1);return i.extend(d.selector,{cols:t,rows:e,opts:o}),d}),Qe("cells().nodes()","cell().node()",function(){return this.iterator("cell",function(e,t,i){return(e=e.aoData[t].anCells)?e[i]:n},1)}),Ge("cells().data()",function(){return this.iterator("cell",function(e,t,n){return x(e,t,n)},1)}),Qe("cells().cache()","cell().cache()",function(e){return e="search"===e?"_aFilterData":"_aSortData",this.iterator("cell",function(t,n,i){return t.aoData[n][e][i]},1)}),Qe("cells().render()","cell().render()",function(e){return this.iterator("cell",function(t,n,i){return x(t,n,i,e)},1)}),Qe("cells().indexes()","cell().index()",function(){return this.iterator("cell",function(e,t,n){return{row:t,column:n,columnVisible:m(e,n)}},1)}),Qe("cells().invalidate()","cell().invalidate()",function(e){return this.iterator("cell",function(t,n,i){A(t,n,e,i)})}),Ge("cell()",function(e,t,n){return jt(this.cells(e,t,n))}),Ge("cell().data()",function(e){var t=this.context,i=this[0];return e===n?t.length&&i.length?x(t[0],i[0].row,i[0].column):n:(C(t[0],i[0].row,i[0].column,e),A(t[0],i[0].row,"data",i[0].column),this)}),Ge("order()",function(e,t){var o=this.context;return e===n?0!==o.length?o[0].aaSorting:n:("number"==typeof e?e=[[e,t]]:i.isArray(e[0])||(e=Array.prototype.slice.call(arguments)),this.iterator("table",function(t){t.aaSorting=e.slice()}))}),Ge("order.listener()",function(e,t,n){return this.iterator("table",function(i){Ee(i,e,t,n)})}),Ge(["columns().order()","column().order()"],function(e){var t=this;return this.iterator("table",function(n,o){var r=[];i.each(t[o],function(t,n){r.push([n,e])}),n.aaSorting=r})}),Ge("search()",function(e,t,o,r){var s=this.context;return e===n?0!==s.length?s[0].oPreviousSearch.sSearch:n:this.iterator("table",function(n){n.oFeatures.bFilter&&J(n,i.extend({},n.oPreviousSearch,{sSearch:e+"",bRegex:null===t?!1:t,bSmart:null===o?!0:o,bCaseInsensitive:null===r?!0:r}),1)})}),Qe("columns().search()","column().search()",function(e,t,o,r){return this.iterator("column",function(s,a){var l=s.aoPreSearchCols;return e===n?l[a].sSearch:void(s.oFeatures.bFilter&&(i.extend(l[a],{sSearch:e+"",bRegex:null===t?!1:t,bSmart:null===o?!0:o,bCaseInsensitive:null===r?!0:r}),J(s,s.oPreviousSearch,1)))})}),Ge("state()",function(){return this.context.length?this.context[0].oSavedState:null}),Ge("state.clear()",function(){return this.iterator("table",function(e){e.fnStateSaveCallback.call(e.oInstance,e,{})})}),Ge("state.loaded()",function(){return this.context.length?this.context[0].oLoadedState:null}),Ge("state.save()",function(){return this.iterator("table",function(e){De(e)})}),Ve.versionCheck=Ve.fnVersionCheck=function(e){for(var t,n,i=Ve.version.split("."),e=e.split("."),o=0,r=e.length;r>o;o++)if(t=parseInt(i[o],10)||0,n=parseInt(e[o],10)||0,t!==n)return t>n;return!0},Ve.isDataTable=Ve.fnIsDataTable=function(e){var t=i(e).get(0),n=!1;return i.each(Ve.settings,function(e,i){(i.nTable===t||i.nScrollHead===t||i.nScrollFoot===t)&&(n=!0)}),n},Ve.tables=Ve.fnTables=function(e){return i.map(Ve.settings,function(t){return!e||e&&i(t.nTable).is(":visible")?t.nTable:void 0})},Ve.util={throttle:ve,escapeRegex:X},Ve.camelToHungarian=r,Ge("$()",function(e,t){var n=this.rows(t).nodes(),n=i(n);return i([].concat(n.filter(e).toArray(),n.find(e).toArray()))}),i.each(["on","one","off"],function(e,t){Ge(t+"()",function(){var e=Array.prototype.slice.call(arguments);e[0].match(/\.dt\b/)||(e[0]+=".dt");var n=i(this.tables().nodes());return n[t].apply(n,e),this})}),Ge("clear()",function(){return this.iterator("table",function(e){E(e)})}),Ge("settings()",function(){return new Ye(this.context,this.context)}),Ge("data()",function(){return this.iterator("table",function(e){return ct(e.aoData,"_aData")}).flatten()}),Ge("destroy()",function(t){return t=t||!1,this.iterator("table",function(n){var o,r=n.nTableWrapper.parentNode,s=n.oClasses,a=n.nTable,l=n.nTBody,c=n.nTHead,u=n.nTFoot,h=i(a),l=i(l),d=i(n.nTableWrapper),f=i.map(n.aoData,function(e){return e.nTr});n.bDestroying=!0,Be(n,"aoDestroyCallback","destroy",[n]),t||new Ye(n).columns().visible(!0),d.unbind(".DT").find(":not(tbody *)").unbind(".DT"),i(e).unbind(".DT-"+n.sInstance),a!=c.parentNode&&(h.children("thead").detach(),h.append(c)),u&&a!=u.parentNode&&(h.children("tfoot").detach(),h.append(u)),h.detach(),d.detach(),n.aaSorting=[],n.aaSortingFixed=[],Te(n),i(f).removeClass(n.asStripeClasses.join(" ")),i("th, td",c).removeClass(s.sSortable+" "+s.sSortableAsc+" "+s.sSortableDesc+" "+s.sSortableNone),n.bJUI&&(i("th span."+s.sSortIcon+", td span."+s.sSortIcon,c).detach(),i("th, td",c).each(function(){var e=i("div."+s.sSortJUIWrapper,this);i(this).append(e.contents()),e.detach()})),!t&&r&&r.insertBefore(a,n.nTableReinsertBefore),l.children().detach(),l.append(f),h.css("width",n.sDestroyWidth).removeClass(s.sTable),(o=n.asDestroyStripes.length)&&l.children().each(function(e){i(this).addClass(n.asDestroyStripes[e%o])}),r=i.inArray(n,Ve.settings),-1!==r&&Ve.settings.splice(r,1)})}),Ve.version="1.10.4",Ve.settings=[],Ve.models={},Ve.models.oSearch={bCaseInsensitive:!0,sSearch:"",bRegex:!1,bSmart:!0},Ve.models.oRow={nTr:null,anCells:null,_aData:[],_aSortData:null,_aFilterData:null,_sFilterRow:null,_sRowStripe:"",src:null},Ve.models.oColumn={idx:null,aDataSort:null,asSorting:null,bSearchable:null,bSortable:null,bVisible:null,_sManualType:null,_bAttrSrc:!1,fnCreatedCell:null,fnGetData:null,fnSetData:null,mData:null,mRender:null,nTh:null,nTf:null,sClass:null,sContentPadding:null,
sDefaultContent:null,sName:null,sSortDataType:"std",sSortingClass:null,sSortingClassJUI:null,sTitle:null,sType:null,sWidth:null,sWidthOrig:null},Ve.defaults={aaData:null,aaSorting:[[0,"asc"]],aaSortingFixed:[],ajax:null,aLengthMenu:[10,25,50,100],aoColumns:null,aoColumnDefs:null,aoSearchCols:[],asStripeClasses:null,bAutoWidth:!0,bDeferRender:!1,bDestroy:!1,bFilter:!0,bInfo:!0,bJQueryUI:!1,bLengthChange:!0,bPaginate:!0,bProcessing:!1,bRetrieve:!1,bScrollCollapse:!1,bServerSide:!1,bSort:!0,bSortMulti:!0,bSortCellsTop:!1,bSortClasses:!0,bStateSave:!1,fnCreatedRow:null,fnDrawCallback:null,fnFooterCallback:null,fnFormatNumber:function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,this.oLanguage.sThousands)},fnHeaderCallback:null,fnInfoCallback:null,fnInitComplete:null,fnPreDrawCallback:null,fnRowCallback:null,fnServerData:null,fnServerParams:null,fnStateLoadCallback:function(e){try{return JSON.parse((-1===e.iStateDuration?sessionStorage:localStorage).getItem("DataTables_"+e.sInstance+"_"+location.pathname))}catch(t){}},fnStateLoadParams:null,fnStateLoaded:null,fnStateSaveCallback:function(e,t){try{(-1===e.iStateDuration?sessionStorage:localStorage).setItem("DataTables_"+e.sInstance+"_"+location.pathname,JSON.stringify(t))}catch(n){}},fnStateSaveParams:null,iStateDuration:7200,iDeferLoading:null,iDisplayLength:10,iDisplayStart:0,iTabIndex:0,oClasses:{},oLanguage:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sDecimal:"",sThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sSearchPlaceholder:"",sUrl:"",sZeroRecords:"No matching records found"},oSearch:i.extend({},Ve.models.oSearch),sAjaxDataProp:"data",sAjaxSource:null,sDom:"lfrtip",searchDelay:null,sPaginationType:"simple_numbers",sScrollX:"",sScrollXInner:"",sScrollY:"",sServerMethod:"GET",renderer:null},o(Ve.defaults),Ve.defaults.column={aDataSort:null,iDataSort:-1,asSorting:["asc","desc"],bSearchable:!0,bSortable:!0,bVisible:!0,fnCreatedCell:null,mData:null,mRender:null,sCellType:"td",sClass:"",sContentPadding:"",sDefaultContent:null,sName:"",sSortDataType:"std",sTitle:null,sType:null,sWidth:null},o(Ve.defaults.column),Ve.models.oSettings={oFeatures:{bAutoWidth:null,bDeferRender:null,bFilter:null,bInfo:null,bLengthChange:null,bPaginate:null,bProcessing:null,bServerSide:null,bSort:null,bSortMulti:null,bSortClasses:null,bStateSave:null},oScroll:{bCollapse:null,iBarWidth:0,sX:null,sXInner:null,sY:null},oLanguage:{fnInfoCallback:null},oBrowser:{bScrollOversize:!1,bScrollbarLeft:!1},ajax:null,aanFeatures:[],aoData:[],aiDisplay:[],aiDisplayMaster:[],aoColumns:[],aoHeader:[],aoFooter:[],oPreviousSearch:{},aoPreSearchCols:[],aaSorting:null,aaSortingFixed:[],asStripeClasses:null,asDestroyStripes:[],sDestroyWidth:0,aoRowCallback:[],aoHeaderCallback:[],aoFooterCallback:[],aoDrawCallback:[],aoRowCreatedCallback:[],aoPreDrawCallback:[],aoInitComplete:[],aoStateSaveParams:[],aoStateLoadParams:[],aoStateLoaded:[],sTableId:"",nTable:null,nTHead:null,nTFoot:null,nTBody:null,nTableWrapper:null,bDeferLoading:!1,bInitialised:!1,aoOpenRows:[],sDom:null,searchDelay:null,sPaginationType:"two_button",iStateDuration:0,aoStateSave:[],aoStateLoad:[],oSavedState:null,oLoadedState:null,sAjaxSource:null,sAjaxDataProp:null,bAjaxDataGet:!0,jqXHR:null,json:n,oAjaxData:n,fnServerData:null,aoServerParams:[],sServerMethod:null,fnFormatNumber:null,aLengthMenu:null,iDraw:0,bDrawing:!1,iDrawError:-1,_iDisplayLength:10,_iDisplayStart:0,_iRecordsTotal:0,_iRecordsDisplay:0,bJUI:null,oClasses:{},bFiltered:!1,bSorted:!1,bSortCellsTop:null,oInit:null,aoDestroyCallback:[],fnRecordsTotal:function(){return"ssp"==Ue(this)?1*this._iRecordsTotal:this.aiDisplayMaster.length},fnRecordsDisplay:function(){return"ssp"==Ue(this)?1*this._iRecordsDisplay:this.aiDisplay.length},fnDisplayEnd:function(){var e=this._iDisplayLength,t=this._iDisplayStart,n=t+e,i=this.aiDisplay.length,o=this.oFeatures,r=o.bPaginate;return o.bServerSide?!1===r||-1===e?t+i:Math.min(t+e,this._iRecordsDisplay):!r||n>i||-1===e?i:n},oInstance:null,sInstance:null,iTabIndex:0,nScrollHead:null,nScrollFoot:null,aLastSort:[],oPlugins:{}},Ve.ext=Je={classes:{},errMode:"alert",feature:[],search:[],internal:{},legacy:{ajax:null},pager:{},renderer:{pageButton:{},header:{}},order:{},type:{detect:[],search:{},order:{}},_unique:0,fnVersionCheck:Ve.fnVersionCheck,iApiIndex:0,oJUIClasses:{},sVersion:Ve.version},i.extend(Je,{afnFiltering:Je.search,aTypes:Je.type.detect,ofnSearch:Je.type.search,oSort:Je.type.order,afnSortData:Je.order,aoFeatures:Je.feature,oApi:Je.internal,oStdClasses:Je.classes,oPagination:Je.pager}),i.extend(Ve.ext.classes,{sTable:"dataTable",sNoFooter:"no-footer",sPageButton:"paginate_button",sPageButtonActive:"current",sPageButtonDisabled:"disabled",sStripeOdd:"odd",sStripeEven:"even",sRowEmpty:"dataTables_empty",sWrapper:"dataTables_wrapper",sFilter:"dataTables_filter",sInfo:"dataTables_info",sPaging:"dataTables_paginate paging_",sLength:"dataTables_length",sProcessing:"dataTables_processing",sSortAsc:"sorting_asc",sSortDesc:"sorting_desc",sSortable:"sorting",sSortableAsc:"sorting_asc_disabled",sSortableDesc:"sorting_desc_disabled",sSortableNone:"sorting_disabled",sSortColumn:"sorting_",sFilterInput:"",sLengthSelect:"",sScrollWrapper:"dataTables_scroll",sScrollHead:"dataTables_scrollHead",sScrollHeadInner:"dataTables_scrollHeadInner",sScrollBody:"dataTables_scrollBody",sScrollFoot:"dataTables_scrollFoot",sScrollFootInner:"dataTables_scrollFootInner",sHeaderTH:"",sFooterTH:"",sSortJUIAsc:"",sSortJUIDesc:"",sSortJUI:"",sSortJUIAscAllowed:"",sSortJUIDescAllowed:"",sSortJUIWrapper:"",sSortIcon:"",sJUIHeader:"",sJUIFooter:""});var Mt="",Mt="",Nt=Mt+"ui-state-default",It=Mt+"css_right ui-icon ui-icon-",Pt=Mt+"fg-toolbar ui-toolbar ui-widget-header ui-helper-clearfix";i.extend(Ve.ext.oJUIClasses,Ve.ext.classes,{sPageButton:"fg-button ui-button "+Nt,sPageButtonActive:"ui-state-disabled",sPageButtonDisabled:"ui-state-disabled",sPaging:"dataTables_paginate fg-buttonset ui-buttonset fg-buttonset-multi ui-buttonset-multi paging_",sSortAsc:Nt+" sorting_asc",sSortDesc:Nt+" sorting_desc",sSortable:Nt+" sorting",sSortableAsc:Nt+" sorting_asc_disabled",sSortableDesc:Nt+" sorting_desc_disabled",sSortableNone:Nt+" sorting_disabled",sSortJUIAsc:It+"triangle-1-n",sSortJUIDesc:It+"triangle-1-s",sSortJUI:It+"carat-2-n-s",sSortJUIAscAllowed:It+"carat-1-n",sSortJUIDescAllowed:It+"carat-1-s",sSortJUIWrapper:"DataTables_sort_wrapper",sSortIcon:"DataTables_sort_icon",sScrollHead:"dataTables_scrollHead "+Nt,sScrollFoot:"dataTables_scrollFoot "+Nt,sHeaderTH:Nt,sFooterTH:Nt,sJUIHeader:Pt+" ui-corner-tl ui-corner-tr",sJUIFooter:Pt+" ui-corner-bl ui-corner-br"});var Ft=Ve.ext.pager;i.extend(Ft,{simple:function(){return["previous","next"]},full:function(){return["first","previous","next","last"]},simple_numbers:function(e,t){return["previous",We(e,t),"next"]},full_numbers:function(e,t){return["first","previous",We(e,t),"next","last"]},_numbers:We,numbers_length:7}),i.extend(!0,Ve.ext.renderer,{pageButton:{_:function(e,n,o,r,s,a){var l,c,u=e.oClasses,h=e.oLanguage.oPaginate,d=0,f=function(t,n){var r,p,m,g,v=function(t){ue(e,t.data.action,!0)};for(r=0,p=n.length;p>r;r++)if(g=n[r],i.isArray(g))m=i("<"+(g.DT_el||"div")+"/>").appendTo(t),f(m,g);else{switch(c=l="",g){case"ellipsis":t.append("<span>&hellip;</span>");break;case"first":l=h.sFirst,c=g+(s>0?"":" "+u.sPageButtonDisabled);break;case"previous":l=h.sPrevious,c=g+(s>0?"":" "+u.sPageButtonDisabled);break;case"next":l=h.sNext,c=g+(a-1>s?"":" "+u.sPageButtonDisabled);break;case"last":l=h.sLast,c=g+(a-1>s?"":" "+u.sPageButtonDisabled);break;default:l=g+1,c=s===g?u.sPageButtonActive:""}l&&(m=i("<a>",{"class":u.sPageButton+" "+c,"aria-controls":e.sTableId,"data-dt-idx":d,tabindex:e.iTabIndex,id:0===o&&"string"==typeof g?e.sTableId+"_"+g:null}).html(l).appendTo(t),Oe(m,{action:g},v),d++)}};try{var p=i(t.activeElement).data("dt-idx");f(i(n).empty(),r),null!==p&&i(n).find("[data-dt-idx="+p+"]").focus()}catch(m){}}}}),i.extend(Ve.ext.type.detect,[function(e,t){var n=t.oLanguage.sDecimal;return at(e,n)?"num"+n:null},function(e){if(e&&!(e instanceof Date)&&(!et.test(e)||!tt.test(e)))return null;var t=Date.parse(e);return null!==t&&!isNaN(t)||ot(e)?"date":null},function(e,t){var n=t.oLanguage.sDecimal;return at(e,n,!0)?"num-fmt"+n:null},function(e,t){var n=t.oLanguage.sDecimal;return lt(e,n)?"html-num"+n:null},function(e,t){var n=t.oLanguage.sDecimal;return lt(e,n,!0)?"html-num-fmt"+n:null},function(e){return ot(e)||"string"==typeof e&&-1!==e.indexOf("<")?"html":null}]),i.extend(Ve.ext.type.search,{html:function(e){return ot(e)?e:"string"==typeof e?e.replace(Xe," ").replace(Ze,""):""},string:function(e){return ot(e)?e:"string"==typeof e?e.replace(Xe," "):e}});var Ot=function(e,t,n,i){return 0===e||e&&"-"!==e?(t&&(e=st(e,t)),e.replace&&(n&&(e=e.replace(n,"")),i&&(e=e.replace(i,""))),1*e):-(1/0)};return i.extend(Je.type.order,{"date-pre":function(e){return Date.parse(e)||0},"html-pre":function(e){return ot(e)?"":e.replace?e.replace(/<.*?>/g,"").toLowerCase():e+""},"string-pre":function(e){return ot(e)?"":"string"==typeof e?e.toLowerCase():e.toString?e.toString():""},"string-asc":function(e,t){return t>e?-1:e>t?1:0},"string-desc":function(e,t){return t>e?1:e>t?-1:0}}),ze(""),i.extend(!0,Ve.ext.renderer,{header:{_:function(e,t,n,o){i(e.nTable).on("order.dt.DT",function(i,r,s,a){e===r&&(i=n.idx,t.removeClass(n.sSortingClass+" "+o.sSortAsc+" "+o.sSortDesc).addClass("asc"==a[i]?o.sSortAsc:"desc"==a[i]?o.sSortDesc:n.sSortingClass))})},jqueryui:function(e,t,n,o){i("<div/>").addClass(o.sSortJUIWrapper).append(t.contents()).append(i("<span/>").addClass(o.sSortIcon+" "+n.sSortingClassJUI)).appendTo(t),i(e.nTable).on("order.dt.DT",function(i,r,s,a){e===r&&(i=n.idx,t.removeClass(o.sSortAsc+" "+o.sSortDesc).addClass("asc"==a[i]?o.sSortAsc:"desc"==a[i]?o.sSortDesc:n.sSortingClass),t.find("span."+o.sSortIcon).removeClass(o.sSortJUIAsc+" "+o.sSortJUIDesc+" "+o.sSortJUI+" "+o.sSortJUIAscAllowed+" "+o.sSortJUIDescAllowed).addClass("asc"==a[i]?o.sSortJUIAsc:"desc"==a[i]?o.sSortJUIDesc:n.sSortingClassJUI))})}}}),Ve.render={number:function(e,t,n,i){return{display:function(o){var r=0>o?"-":"",o=Math.abs(parseFloat(o)),s=parseInt(o,10),o=n?t+(o-s).toFixed(n).substring(2):"";return r+(i||"")+s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e)+o}}}},i.extend(Ve.ext.internal,{_fnExternApiFunc:qe,_fnBuildAjax:H,_fnAjaxUpdate:U,_fnAjaxParameters:W,_fnAjaxUpdateDraw:z,_fnAjaxDataSrc:q,_fnAddColumn:h,_fnColumnOptions:d,_fnAdjustColumnSizing:f,_fnVisibleToColumnIndex:p,_fnColumnIndexToVisible:m,_fnVisbleColumns:g,_fnGetColumns:v,_fnColumnTypes:b,_fnApplyColumnDefs:y,_fnHungarianMap:o,_fnCamelToHungarian:r,_fnLanguageCompat:s,_fnBrowserDetect:c,_fnAddData:w,_fnAddTr:S,_fnNodeToDataIndex:function(e,t){return t._DT_RowIndex!==n?t._DT_RowIndex:null},_fnNodeToColumnIndex:function(e,t,n){return i.inArray(n,e.aoData[t].anCells)},_fnGetCellData:x,_fnSetCellData:C,_fnSplitObjNotation:_,_fnGetObjectDataFn:k,_fnSetObjectDataFn:j,_fnGetDataMaster:$,_fnClearTable:E,_fnDeleteIndex:T,_fnInvalidate:A,_fnGetRowElements:D,_fnCreateTr:M,_fnBuildHead:I,_fnDrawHead:P,_fnDraw:F,_fnReDraw:O,_fnAddOptionsHtml:L,_fnDetectHeader:B,_fnGetUniqueThs:R,_fnFeatureHtmlFilter:V,_fnFilterComplete:J,_fnFilterCustom:Y,_fnFilterColumn:G,_fnFilter:Q,_fnFilterCreateSearch:K,_fnEscapeRegex:X,_fnFilterData:Z,_fnFeatureHtmlInfo:ne,_fnUpdateInfo:ie,_fnInfoMacros:oe,_fnInitialise:re,_fnInitComplete:se,_fnLengthChange:ae,_fnFeatureHtmlLength:le,_fnFeatureHtmlPaginate:ce,_fnPageChange:ue,_fnFeatureHtmlProcessing:he,_fnProcessingDisplay:de,_fnFeatureHtmlTable:fe,_fnScrollDraw:pe,_fnApplyToChildren:me,_fnCalculateColumnWidths:ge,_fnThrottle:ve,_fnConvertToWidth:be,_fnScrollingWidthAdjust:ye,_fnGetWidestNode:we,_fnGetMaxLenString:Se,_fnStringToCss:xe,_fnScrollBarWidth:Ce,_fnSortFlatten:_e,_fnSort:ke,_fnSortAria:je,_fnSortListener:$e,_fnSortAttachListener:Ee,_fnSortingClasses:Te,_fnSortData:Ae,_fnSaveState:De,_fnLoadState:Me,_fnSettingsFromNode:Ne,_fnLog:Ie,_fnMap:Pe,_fnBindAction:Oe,_fnCallbackReg:Le,_fnCallbackFire:Be,_fnLengthOverflow:Re,_fnRenderer:He,_fnDataSource:Ue,_fnRowAttributes:N,_fnCalculateEnd:function(){}}),i.fn.dataTable=Ve,i.fn.dataTableSettings=Ve.settings,i.fn.dataTableExt=Ve.ext,i.fn.DataTable=function(e){return i(this).dataTable(e).api()},i.each(Ve,function(e,t){i.fn.DataTable[e]=t}),i.fn.dataTable};"function"==typeof define&&define.amd?define("datatables",["jquery"],i):"object"==typeof exports?i(require("jquery")):jQuery&&!jQuery.fn.dataTable&&i(jQuery)}(window,document),/*

Live searching of shelves, as used in, e.g., the shelf menu of the 'want to
read' button.

Adapted from:

https://github.com/nakajima/jquery-livesearch

(c) Copyright 2009 Pat Nakajima

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
*/
function(e){function t(t){return(val=this.val())?e(t).filter(':containsi("'+val+'")'):!1}jQuery.expr[":"].containsi=jQuery.expr.createPseudo(function(e){return function(t){return toShelfName(jQuery(t).text()).toUpperCase().indexOf(toShelfName(e).toUpperCase())>=0}});var n=function(e){this.callbacks={},e(this)};n.prototype.all=function(e){this.callbacks.all=e},n.prototype.reset=function(e){this.callbacks.reset=e},n.prototype.empty=function(e){this.callbacks.empty=e},n.prototype.results=function(e){this.callbacks.results=e},e.fn.search=function i(o,r,s){function a(){if(result=t.call(e(this),o)){l.all&&l.all.call(this,result);var n=result.size()>0?"results":"empty";return l[n]&&l[n].call(this,result)}return l.all&&l.all.call(this,e(o)),l.reset&&l.reset.call(this)}var i=new n(s),l=i.callbacks;e(document).on("keyup click",r,a)}}(jQuery),function(e,t,n){function i(e){var t={},i=/^jQuery\d+$/;return n.each(e.attributes,function(e,n){n.specified&&!i.test(n.name)&&(t[n.name]=n.value)}),t}function o(e,i){var o=this,r=n(o);if(o.value==r.attr("placeholder")&&r.hasClass("placeholder"))if(r.data("placeholder-password")){if(r=r.hide().next().show().attr("id",r.removeAttr("id").data("placeholder-id")),e===!0)return r[0].value=i;r.focus()}else o.value="",r.removeClass("placeholder"),o==t.activeElement&&o.select()}function r(){var e,t=this,r=n(t),s=this.id;if(""==t.value){if("password"==t.type){if(!r.data("placeholder-textinput")){try{e=r.clone().attr({type:"text"})}catch(a){e=n("<input>").attr(n.extend(i(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":!0,"placeholder-id":s}).bind("focus.placeholder",o),r.data({"placeholder-textinput":e,"placeholder-id":s}).before(e)}r=r.removeAttr("id").hide().prev().attr("id",s).show()}r.addClass("placeholder"),r[0].value=r.attr("placeholder")}else r.removeClass("placeholder")}var s,a,l="placeholder"in t.createElement("input"),c="placeholder"in t.createElement("textarea"),u=n.fn,h=n.valHooks;l&&c?(a=u.placeholder=function(){return this},a.input=a.textarea=!0):(a=u.placeholder=function(){var e=this;return e.filter((l?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":o,"blur.placeholder":r}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},a.input=l,a.textarea=c,s={get:function(e){var t=n(e);return t.data("placeholder-enabled")&&t.hasClass("placeholder")?"":e.value},set:function(e,i){var s=n(e);return s.data("placeholder-enabled")?(""==i?(e.value=i,e!=t.activeElement&&r.call(e)):s.hasClass("placeholder")?o.call(e,!0,i)||(e.value=i):e.value=i,s):e.value=i}},l||(h.input=s),c||(h.textarea=s),n(function(){n(t).delegate("form","submit.placeholder",function(){var e=n(".placeholder",this).each(o);setTimeout(function(){e.each(r)},10)})}),n(e).bind("beforeunload.placeholder",function(){n(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery);var Lightbox={lightboxType:null,lightboxCurrentContentID:null,savePreviousContent:!1,hiddenSelects:[],keepPreviousBox:function(){var e=$("boxContents");if(this.savePreviousContent){var t=$("boxContentsLeftovers");e.childElements().each(function(e){t.appendChild(e)})}},showBoxString:function(e,t,n,i){this.setLightboxDimensions(t,n),this.lightboxType="string";var o=$("boxContents");return this.keepPreviousBox(),o.update(e),this.showBox(),!1},showBoxImage:function(e,t,n){this.lightboxType="image",this.setLightboxDimensions(t,n);var i=$("boxContents");i.update("");var o=document.createElement("img");return o.setAttribute("id","lightboxImage"),i.appendChild(o),imgPreload=new Image,imgPreload.onload=function(){o.src=e,Lightbox.showBox()},imgPreload.src=e,!1},showBoxByID:function(e,t,n,i){this.lightboxType="id",this.lightboxCurrentContentID=e,this.setLightboxDimensions(t,n);var o=$(e),r=$("boxContents");return this.keepPreviousBox(),r.update(o),o.show(),this.showBox(arguments[arguments.length-1]),this.savePreviousContent=!0,!1},showBoxByAJAX:function(e,t,n){this.lightboxType="ajax",this.setLightboxDimensions(t,n);var i=$("boxContents");this.keepPreviousBox();new Ajax.Updater(i,e,{method:"get"});return this.showBox(),!1},setLightboxDimensions:function(e,t){var n=this.getPageDimensions();e&&(e<n[0]?$("box").style.width=e+"px":$("box").style.width=n[0]-50+"px"),t&&(t<n[1]?$("box").setStyle({"min-height":t+"px"}):$("box").setStyle({"min-height":n[1]-50+"px"}))},showBox:function(e){this.savePreviousContent=!1;var t=$("box").fire("Lightbox:showBox");return t.stopped?!1:(Prototype.Browser.IE&&this.hideSelects(),Element.show("overlay"),this.center("box"),"function"==typeof e&&e(this),$gr.shared.reviewDraftDataCollection.attachTo(".js-reviewUserText"),!1)},hideSelects:function(){$$("select").invoke("setStyle",{visibility:"hidden"}),$$("select").invoke("addClassName","hiddenForLightBox"),$$("#box select").invoke("setStyle",{visibility:"visible"}),$$("#box select").invoke("removeClassName","hiddenForLightBox")},restoreSelects:function(){$$(".hiddenForLightBox").invoke("setStyle",{visibility:"visible"})},hideBox:function(e){var t=$("box").fire("Lightbox:hideBox");if(t.stopped)return!1;$("boxContents");return"squish"==e?Effect.Squish("box"):"dropout"==e?Effect.DropOut("box",{afterFinish:function(){$j("#box").trigger("ui.modal.hideComplete")}}):Element.hide("box"),Element.hide("overlay"),Prototype.Browser.IE&&this.restoreSelects(),!1},getPageDimensions:function(){var e,t;window.innerHeight&&window.scrollMaxY?(e=document.body.scrollWidth,t=window.innerHeight+window.scrollMaxY):document.body.scrollHeight>document.body.offsetHeight?(e=document.body.scrollWidth,t=document.body.scrollHeight):(e=document.body.offsetWidth,t=document.body.offsetHeight);var n,i;return self.innerHeight?(n=self.innerWidth,i=self.innerHeight):document.documentElement&&document.documentElement.clientHeight?(n=document.documentElement.clientWidth,i=document.documentElement.clientHeight):document.body&&(n=document.body.clientWidth,i=document.body.clientHeight),i>t?pageHeight=i:pageHeight=t,n>e?pageWidth=n:pageWidth=e,arrayPageSize=new Array(n,i,pageWidth,pageHeight),arrayPageSize},center:function(e){try{e=document.getElementById(e)}catch(t){return}var n=this.getPageDimensions(),i=n[0],o=n[1];$("overlay").style.height=n[3]+"px",e.style.position="absolute",e.style.zIndex=100089;var r=0;document.documentElement&&document.documentElement.scrollTop?r=document.documentElement.scrollTop:document.body&&document.body.scrollTop?r=document.body.scrollTop:window.pageYOffset?r=window.pageYOffset:window.scrollY&&(r=window.scrollY);var s=Element.getDimensions(e),a=(i-s.width)/2,l=(o-s.height)/2+r;a=0>a?0:a,l=0>l?0:l,e.style.left=a+"px",e.style.top=l+"px",Element.show(e),n=this.getPageDimensions(),$("overlay").style.height=n[3]+"px"}};$j(document).on("click","[data-lightbox=true]",function(e){var t=$j(e.target),n=e.target.href.match(/#(.*)/)[1];Lightbox.showBoxByID(n,t.data("width"),t.data("height"),Boolean(t.data("no-close-link"))),e.preventDefault()});/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */
var hexcase=0,b64pad="",chrsz=8;/*! modernizr 3.3.1 (Custom Build) | MIT *
 * http://modernizr.com/download/?-cssanimations-csstransforms-touchevents-hasevent-prefixes-setclasses-teststyles !*/
!function(e,t,n){function i(e,t){return typeof e===t}function o(){var e,t,n,o,r,s,a;for(var l in y)if(y.hasOwnProperty(l)){if(e=[],t=y[l],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(o=i(t.fn,"function")?t.fn():t.fn,r=0;r<e.length;r++)s=e[r],a=s.split("."),1===a.length?S[a[0]]=o:(!S[a[0]]||S[a[0]]instanceof Boolean||(S[a[0]]=new Boolean(S[a[0]])),S[a[0]][a[1]]=o),b.push((o?"":"no-")+a.join("-"))}}function r(e){var t=C.className,n=S._config.classPrefix||"";if(_&&(t=t.baseVal),S._config.enableJSClass){var i=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(i,"$1"+n+"js$2")}S._config.enableClasses&&(t+=" "+n+e.join(" "+n),_?C.className.baseVal=t:C.className=t)}function s(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):_?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function a(){var e=t.body;return e||(e=s(_?"svg":"body"),e.fake=!0),e}function l(e,n,i,o){var r,l,c,u,h="modernizr",d=s("div"),f=a();if(parseInt(i,10))for(;i--;)c=s("div"),c.id=o?o[i]:h+(i+1),d.appendChild(c);return r=s("style"),r.type="text/css",r.id="s"+h,(f.fake?f:d).appendChild(r),f.appendChild(d),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(t.createTextNode(e)),d.id=h,f.fake&&(f.style.background="",f.style.overflow="hidden",u=C.style.overflow,C.style.overflow="hidden",C.appendChild(f)),l=n(d,e),f.fake?(f.parentNode.removeChild(f),C.style.overflow=u,C.offsetHeight):d.parentNode.removeChild(d),!!l}function c(e,t){return!!~(""+e).indexOf(t)}function u(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}function h(e,t){return function(){return e.apply(t,arguments)}}function d(e,t,n){var o;for(var r in e)if(e[r]in t)return n===!1?e[r]:(o=t[e[r]],i(o,"function")?h(o,n||t):o);return!1}function f(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function p(t,i){var o=t.length;if("CSS"in e&&"supports"in e.CSS){for(;o--;)if(e.CSS.supports(f(t[o]),i))return!0;return!1}if("CSSSupportsRule"in e){for(var r=[];o--;)r.push("("+f(t[o])+":"+i+")");return r=r.join(" or "),l("@supports ("+r+") { #modernizr { position: absolute; } }",function(e){return"absolute"==getComputedStyle(e,null).position})}return n}function m(e,t,o,r){function a(){h&&(delete D.style,delete D.modElem)}if(r=i(r,"undefined")?!1:r,!i(o,"undefined")){var l=p(e,o);if(!i(l,"undefined"))return l}for(var h,d,f,m,g,v=["modernizr","tspan"];!D.style;)h=!0,D.modElem=s(v.shift()),D.style=D.modElem.style;for(f=e.length,d=0;f>d;d++)if(m=e[d],g=D.style[m],c(m,"-")&&(m=u(m)),D.style[m]!==n){if(r||i(o,"undefined"))return a(),"pfx"==t?m:!0;try{D.style[m]=o}catch(b){}if(D.style[m]!=g)return a(),"pfx"==t?m:!0}return a(),!1}function g(e,t,n,o,r){var s=e.charAt(0).toUpperCase()+e.slice(1),a=(e+" "+E.join(s+" ")+s).split(" ");return i(t,"string")||i(t,"undefined")?m(a,t,o,r):(a=(e+" "+T.join(s+" ")+s).split(" "),d(a,t,n))}function v(e,t,i){return g(e,n,n,t,i)}var b=[],y=[],w={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){y.push({name:e,fn:t,options:n})},addAsyncTest:function(e){y.push({name:null,fn:e})}},S=function(){};S.prototype=w,S=new S;var x=w._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];w._prefixes=x;var C=t.documentElement,_="svg"===C.nodeName.toLowerCase(),k=function(){function e(e,t){var o;return e?(t&&"string"!=typeof t||(t=s(t||"div")),e="on"+e,o=e in t,!o&&i&&(t.setAttribute||(t=s("div")),t.setAttribute(e,""),o="function"==typeof t[e],t[e]!==n&&(t[e]=n),t.removeAttribute(e)),o):!1}var i=!("onblur"in t.documentElement);return e}();w.hasEvent=k;var j=w.testStyles=l;S.addTest("touchevents",function(){var n;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)n=!0;else{var i=["@media (",x.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");j(i,function(e){n=9===e.offsetTop})}return n});var $="Moz O ms Webkit",E=w._config.usePrefixes?$.split(" "):[];w._cssomPrefixes=E;var T=w._config.usePrefixes?$.toLowerCase().split(" "):[];w._domPrefixes=T;var A={elem:s("modernizr")};S._q.push(function(){delete A.elem});var D={style:A.elem.style};S._q.unshift(function(){delete D.style}),w.testAllProps=g,w.testAllProps=v,S.addTest("cssanimations",v("animationName","a",!0)),S.addTest("csstransforms",function(){return-1===navigator.userAgent.indexOf("Android 2.")&&v("transform","scale(1)",!0)}),o(),r(b),delete w.addTest,delete w.addAsyncTest;for(var M=0;M<S._q.length;M++)S._q[M]();e.Modernizr=S}(window,document);
//  Copyright (c) 2008-2009 Nick Stakenburg (http://www.nickstakenburg.com)
var Prototip={Version:"2.2.0.1"},Tips={options:{paths:{images:"/assets/prototip/",javascript:"/assets/prototip/"},zIndex:6e3}};eval(function(e,t,n,i,o,r){if(o=function(e){return(t>e?"":o(parseInt(e/t)))+((e%=t)>35?String.fromCharCode(e+29):e.toString(36))},!"".replace(/^/,String)){for(;n--;)r[o(n)]=i[n]||o(n);i=[function(e){return r[e]}],o=function(){return"\\w+"},n=1}for(;n--;)i[n]&&(e=e.replace(new RegExp("\\b"+o(n)+"\\b","g"),i[n]));return e}('M.10(11,{4p:"1.6.1",2I:{24:!!X.4q("24").3q},3r:p(a){4r{X.4s("<2g 3s=\'3t/1y\' 1C=\'"+a+"\'><\\/2g>")}4t(b){$$("4u")[0].J(I G("2g",{1C:a,3s:"3t/1y"}))}},3u:p(){3.3v("2J");q a=/1D([\\w\\d-2K.]+)?\\.3w(.*)/;3.2L=(($$("2g[1C]").4v(p(b){K b.1C.25(a)})||{}).1C||"").2M(a,"");s.26=(p(b){K{T:(/^(3x?:\\/\\/|\\/)/.3y(b.T))?b.T:3.2L+b.T,1y:(/^(3x?:\\/\\/|\\/)/.3y(b.1y))?b.1y:3.2L+b.1y}}.1d(3))(s.9.26);3.3r(s.26.1y+"3z.3w");o(!3.2I.24){o(X.4w>=8&&!X.3A.2h){X.3A.2N("2h","4x:4y-4z-4A:4B","#2i#3B")}Y{X.1a("3C:2O",p(){q b=X.4C();b.4D="2h\\\\:*{4E:2P(#2i#3B)}"})}}s.2j();G.1a(2Q,"2R",3.2R)},3v:p(a){o((4F 2Q[a]=="4G")||(3.2S(2Q[a].4H)<3.2S(3["3D"+a]))){3E("11 4I "+a+" >= "+3["3D"+a]);}},2S:p(a){q b=a.2M(/2K.*|\\./g,"");b=4J(b+"0".4K(4-b.1Q));K a.4L("2K")>-1?b-1:b},2T:p(a){K(a>0)?(-1*a):(a).4M()},2R:p(){s.3F()}});M.10(s,(p(){p a(b){o(!b){K}b.3G();o(b.13){b.E.1E();o(s.1i){b.1l.1E()}}s.1m=s.1m.3H(b)}K{1m:[],15:[],2j:p(){3.2k=3.1n},27:{B:"2U",2U:"B",u:"1o",1o:"u",1R:"1R",1b:"1e",1e:"1b"},3I:{H:"1b",F:"1e"},2V:p(b){K!!1S[1]?3.27[b]:b},1i:(p(c){q b=I 4N("4O ([\\\\d.]+)").4P(c);K b?(3J(b[1])<7):U})(4Q.4R),2W:(2J.4S.4T&&!X.4U),2N:p(b){3.1m.28(b)},1E:p(d){q g,e=[];1T(q c=0,b=3.1m.1Q;c<b;c++){q f=3.1m[c];o(!g&&f.C==$(d)){g=f}Y{o(!f.C.3K){e.28(f)}}}a(g);1T(q c=0,b=e.1Q;c<b;c++){q f=e[c];a(f)}d.1D=29},3F:p(){1T(q c=0,b=3.1m.1Q;c<b;c++){a(3.1m[c])}},2l:p(d){o(d==3.3L){K}o(3.15.1Q===0){3.2k=3.9.1n;1T(q c=0,b=3.1m.1Q;c<b;c++){3.1m[c].E.r({1n:3.9.1n})}}d.E.r({1n:3.2k++});o(d.Q){d.Q.r({1n:3.2k})}3.3L=d},3M:p(b){3.2X(b);3.15.28(b)},2X:p(b){3.15=3.15.3H(b)},3N:p(){s.15.1F("S")},V:p(c,g){c=$(c),g=$(g);q l=M.10({1c:{x:0,y:0},N:U},1S[2]||{});q e=l.1t||g.2m();e.B+=l.1c.x;e.u+=l.1c.y;q d=l.1t?[0,0]:g.3O(),b=X.1z.2n(),h=l.1t?"1U":"17";e.B+=(-1*(d[0]-b[0]));e.u+=(-1*(d[1]-b[1]));o(l.1t){q f=[0,0];f.H=0;f.F=0}q j={C:c.1V()},k={C:M.2a(e)};j[h]=l.1t?f:g.1V();k[h]=M.2a(e);1T(q i 3P k){3Q(l[i]){R"4V":R"4W":k[i].B+=j[i].H;18;R"4X":k[i].B+=(j[i].H/2);18;R"4Y":k[i].B+=j[i].H;k[i].u+=(j[i].F/2);18;R"4Z":R"51":k[i].u+=j[i].F;18;R"52":R"53":k[i].B+=j[i].H;k[i].u+=j[i].F;18;R"54":k[i].B+=(j[i].H/2);k[i].u+=j[i].F;18;R"55":k[i].u+=(j[i].F/2);18}}e.B+=-1*(k.C.B-k[h].B);e.u+=-1*(k.C.u-k[h].u);o(l.N){c.r({B:e.B+"v",u:e.u+"v"})}K e}}})());s.2j();q 56=57.3R({2j:p(c,e){3.C=$(c);o(!3.C){3E("11: G 58 59, 5a 3R a 13.");K}s.1E(3.C);q a=(M.2o(e)||M.2Y(e)),b=a?1S[2]||[]:e;3.1p=a?e:29;o(b.1W){b=M.10(M.2a(11.2Z[b.1W]),b)}3.9=M.10(M.10({1j:U,1f:0,30:"#5b",1k:0,L:s.9.L,19:s.9.5c,1u:!(b.W&&b.W=="1X")?0.14:U,1q:U,1g:"1G",3S:U,V:b.V,1c:b.V?{x:0,y:0}:{x:16,y:16},1H:(b.V&&!b.V.1t)?1h:U,W:"2p",D:U,1W:"2i",17:3.C,12:U,1z:(b.V&&!b.V.1t)?U:1h,H:U},11.2Z["2i"]),b);3.17=$(3.9.17);3.1k=3.9.1k;3.1f=(3.1k>3.9.1f)?3.1k:3.9.1f;o(3.9.T){3.T=3.9.T.3T("://")?3.9.T:s.26.T+3.9.T}Y{3.T=s.26.T+"3z/"+(3.9.1W||"")+"/"}o(!3.T.5d("/")){3.T+="/"}o(M.2o(3.9.D)){3.9.D={N:3.9.D}}o(3.9.D.N){3.9.D=M.10(M.2a(11.2Z[3.9.1W].D)||{},3.9.D);3.9.D.N=[3.9.D.N.25(/[a-z]+/)[0].2q(),3.9.D.N.25(/[A-Z][a-z]+/)[0].2q()];3.9.D.1A=["B","2U"].5e(3.9.D.N[0])?"1b":"1e";3.1r={1b:U,1e:U}}o(3.9.1j){3.9.1j.9=M.10({31:2J.5f},3.9.1j.9||{})}o(3.9.V.1t){q d=3.9.V.1s.25(/[a-z]+/)[0].2q();3.1U=s.27[d]+s.27[3.9.V.1s.25(/[A-Z][a-z]+/)[0].2q()].2r()}3.3U=(s.2W&&3.1k);3.3V();s.2N(3);3.3W();11.10(3)},3V:p(){3.E=I G("P",{L:"1D"}).r({1n:s.9.1n});o(3.3U){3.E.S=p(){3.r("B:-3X;u:-3X;1I:2s;");K 3};3.E.O=p(){3.r("1I:15");K 3};3.E.15=p(){K(3.32("1I")=="15"&&3J(3.32("u").2M("v",""))>-5g)}}3.E.S();o(s.1i){3.1l=I G("5h",{L:"1l",1C:"1y:U;",5i:0}).r({2t:"2b",1n:s.9.1n-1,5j:0})}o(3.9.1j){3.1Y=3.1Y.33(3.34)}3.1s=I G("P",{L:"1p"});3.12=I G("P",{L:"12"}).S();o(3.9.19||(3.9.1g.C&&3.9.1g.C=="19")){3.19=I G("P",{L:"2c"}).1Z(3.T+"2c.2u")}},2v:p(){o(X.2O){3.35();3.3Y=1h;K 1h}Y{o(!3.3Y){X.1a("3C:2O",3.35);K U}}},35:p(){$(X.36).J(3.E);o(s.1i){$(X.36).J(3.1l)}o(3.9.1j){$(X.36).J(3.Q=I G("P",{L:"5k"}).1Z(3.T+"Q.5l").S())}q g="E";o(3.9.D.N){3.D=I G("P",{L:"5m"}).r({F:3.9.D[3.9.D.1A=="1e"?"F":"H"]+"v"});q b=3.9.D.1A=="1b";3[g].J(3.37=I G("P",{L:"5n 2w"}).J(3.3Z=I G("P",{L:"5o 2w"})));3.D.J(3.1J=I G("P",{L:"5p"}).r({F:3.9.D[b?"H":"F"]+"v",H:3.9.D[b?"F":"H"]+"v"}));o(s.1i&&!3.9.D.N[1].40().3T("5q")){3.1J.r({2t:"5r"})}g="3Z"}o(3.1f){q d=3.1f,f;3[g].J(3.20=I G("5s",{L:"20"}).J(3.21=I G("38",{L:"21 39"}).r("F: "+d+"v").J(I G("P",{L:"2x 5t"}).J(I G("P",{L:"22"}))).J(f=I G("P",{L:"5u"}).r({F:d+"v"}).J(I G("P",{L:"41"}).r({1v:"0 "+d+"v",F:d+"v"}))).J(I G("P",{L:"2x 5v"}).J(I G("P",{L:"22"})))).J(3.3a=I G("38",{L:"3a 39"}).J(3.3b=I G("P",{L:"3b"}).r("2y: 0 "+d+"v"))).J(3.42=I G("38",{L:"42 39"}).r("F: "+d+"v").J(I G("P",{L:"2x 5w"}).J(I G("P",{L:"22"}))).J(f.5x(1h)).J(I G("P",{L:"2x 5y"}).J(I G("P",{L:"22"})))));g="3b";q c=3.20.3c(".22");$w("5z 5A 5B 5C").43(p(j,h){o(3.1k>0){11.44(c[h],j,{1K:3.9.30,1f:d,1k:3.9.1k})}Y{c[h].2z("45")}c[h].r({H:d+"v",F:d+"v"}).2z("22"+j.2r())}.1d(3));3.20.3c(".41",".3a",".45").1F("r",{1K:3.9.30})}3[g].J(3.13=I G("P",{L:"13 "+3.9.L}).J(3.23=I G("P",{L:"23"}).J(3.12)));o(3.9.H){q e=3.9.H;o(M.5D(e)){e+="v"}3.13.r("H:"+e)}o(3.D){q a={};a[3.9.D.1A=="1b"?"u":"1o"]=3.D;3.E.J(a);3.2e()}3.13.J(3.1s);o(!3.9.1j){3.3d({12:3.9.12,1p:3.1p})}},3d:p(e){q a=3.E.32("1I");3.E.r("F:1L;H:1L;1I:2s").O();o(3.1f){3.21.r("F:0");3.21.r("F:0")}o(e.12){3.12.O().46(e.12);3.23.O()}Y{o(!3.19){3.12.S();3.23.S()}}o(M.2Y(e.1p)){e.1p.O()}o(M.2o(e.1p)||M.2Y(e.1p)){3.1s.46(e.1p)}3.13.r({H:3.13.47()+"v"});3.E.r("1I:15").O();3.13.O();q c=3.13.1V(),b={H:c.H+"v"},d=[3.E];o(s.1i){d.28(3.1l)}o(3.19){3.12.O().J({u:3.19});3.23.O()}o(e.12||3.19){3.23.r("H: 3e%")}b.F=29;3.E.r({1I:a});3.1s.2z("2w");o(e.12||3.19){3.12.2z("2w")}o(3.1f){3.21.r("F:"+3.1f+"v");3.21.r("F:"+3.1f+"v");b="H: "+(c.H+2*3.1f)+"v";d.28(3.20)}d.1F("r",b);o(3.D){3.2e();o(3.9.D.1A=="1b"){3.E.r({H:3.E.47()+3.9.D.F+"v"})}}3.E.S()},3W:p(){3.3f=3.1Y.1w(3);3.48=3.S.1w(3);o(3.9.1H&&3.9.W=="2p"){3.9.W="3g"}o(3.9.W&&3.9.W==3.9.1g){3.1M=3.49.1w(3);3.C.1a(3.9.W,3.1M)}o(3.19){3.19.1a("3g",p(d){d.1Z(3.T+"5E.2u")}.1d(3,3.19)).1a("3h",p(d){d.1Z(3.T+"2c.2u")}.1d(3,3.19))}q c={C:3.1M?[]:[3.C],17:3.1M?[]:[3.17],1s:3.1M?[]:[3.E],19:[],2b:[]},a=3.9.1g.C;3.3i=a||(!3.9.1g?"2b":"C");3.1N=c[3.3i];o(!3.1N&&a&&M.2o(a)){3.1N=3.1s.3c(a)}$w("O S").43(p(g){q f=g.2r(),d=(3.9[g+"4a"].5F||3.9[g+"4a"]);o(d=="3g"){d=="3j"}Y{o(d=="3h"){d=="1G"}}3[g+"5G"]=d}.1d(3));o(!3.1M&&3.9.W){3.C.1a(3.9.W,3.3f)}o(3.1N&&3.9.1g){3.1N.1F("1a",3.5H,3.48)}o(!3.9.1H&&3.9.W=="1X"){3.2A=3.N.1w(3);3.C.1a("2p",3.2A)}3.4b=3.S.33(p(f,e){q d=e.5I(".2c");o(d){d.5J();e.5K();f(e)}}).1w(3);o(3.19||(3.9.1g&&(3.9.1g.C==".2c"))){3.E.1a("1X",3.4b)}o(3.9.W!="1X"&&(3.3i!="C")){3.2B=p(){3.1B("O")}.1w(3);3.C.1a("1G",3.2B)}o(3.9.1g||3.9.1q){q b=[3.C,3.E];3.3k=p(){s.2l(3);3.2C()}.1w(3);3.3l=3.1q.1w(3);b.1F("1a","3j",3.3k).1F("1a","1G",3.3l)}o(3.9.1j&&3.9.W!="1X"){3.2D=3.4c.1w(3);3.C.1a("1G",3.2D)}},3G:p(){o(3.9.W&&3.9.W==3.9.1g){3.C.1x(3.9.W,3.1M)}Y{o(3.9.W){3.C.1x(3.9.W,3.3f)}o(3.1N&&3.9.1g){3.1N.1F("1x")}}o(3.2A){3.C.1x("2p",3.2A)}o(3.2B){3.C.1x("3h",3.2B)}3.E.1x();o(3.9.1g||3.9.1q){3.C.1x("3j",3.3k).1x("1G",3.3l)}o(3.2D){3.C.1x("1G",3.2D)}},34:p(c,b){o(!3.13){o(!3.2v()){K}}3.N(b);o(3.2E){K}Y{o(3.4d){c(b);K}}3.2E=1h;q e=b.5L(),d={2f:{1O:e.x,1P:e.y}};q a=M.2a(3.9.1j.9);a.31=a.31.33(p(g,f){3.3d({12:3.9.12,1p:f.5M});3.N(d);(p(){g(f);q h=(3.Q&&3.Q.15());o(3.Q){3.1B("Q");3.Q.1E();3.Q=29}o(h){3.O()}3.4d=1h;3.2E=29}.1d(3)).1u(0.6)}.1d(3));3.5N=G.O.1u(3.9.1u,3.Q);3.E.S();3.2E=1h;3.Q.O();3.5O=(p(){I 5P.5Q(3.9.1j.2P,a)}.1d(3)).1u(3.9.1u);K U},4c:p(){3.1B("Q")},1Y:p(a){o(!3.13){o(!3.2v()){K}}3.N(a);o(3.E.15()){K}3.1B("O");3.5R=3.O.1d(3).1u(3.9.1u)},1B:p(a){o(3[a+"4e"]){5S(3[a+"4e"])}},O:p(){o(3.E.15()){K}o(s.1i){3.1l.O()}o(3.9.3S){s.3N()}s.3M(3);3.13.O();3.E.O();o(3.D){3.D.O()}3.C.4f("1D:5T")},1q:p(a){o(3.9.1j){o(3.Q&&3.9.W!="1X"){3.Q.S()}}o(!3.9.1q){K}3.2C();3.5U=3.S.1d(3).1u(3.9.1q)},2C:p(){o(3.9.1q){3.1B("1q")}},S:p(){3.1B("O");3.1B("Q");o(!3.E.15()){K}3.4g()},4g:p(){o(s.1i){3.1l.S()}o(3.Q){3.Q.S()}3.E.S();(3.20||3.13).O();s.2X(3);3.C.4f("1D:2s")},49:p(a){o(3.E&&3.E.15()){3.S(a)}Y{3.1Y(a)}},2e:p(){q c=3.9.D,b=1S[0]||3.1r,d=s.2V(c.N[0],b[c.1A]),f=s.2V(c.N[1],b[s.27[c.1A]]),a=3.1k||0;3.1J.1Z(3.T+d+f+".2u");o(c.1A=="1b"){q e=(d=="B")?c.F:0;3.37.r("B: "+e+"v;");3.1J.r({"2F":d});3.D.r({B:0,u:(f=="1o"?"3e%":f=="1R"?"50%":0),5V:(f=="1o"?-1*c.H:f=="1R"?-0.5*c.H:0)+(f=="1o"?-1*a:f=="u"?a:0)+"v"})}Y{3.37.r(d=="u"?"1v: 0; 2y: "+c.F+"v 0 0 0;":"2y: 0; 1v: 0 0 "+c.F+"v 0;");3.D.r(d=="u"?"u: 0; 1o: 1L;":"u: 1L; 1o: 0;");3.1J.r({1v:0,"2F":f!="1R"?f:"2b"});o(f=="1R"){3.1J.r("1v: 0 1L;")}Y{3.1J.r("1v-"+f+": "+a+"v;")}o(s.2W){o(d=="1o"){3.D.r({N:"4h",5W:"5X",u:"1L",1o:"1L","2F":"B",H:"3e%",1v:(-1*c.F)+"v 0 0 0"});3.D.1W.2t="4i"}Y{3.D.r({N:"4j","2F":"2b",1v:0})}}}3.1r=b},N:p(b){o(!3.13){o(!3.2v()){K}}s.2l(3);o(s.1i){q a=3.E.1V();o(!3.2G||3.2G.F!=a.F||3.2G.H!=a.H){3.1l.r({H:a.H+"v",F:a.F+"v"})}3.2G=a}o(3.9.V){q j,h;o(3.1U){q k=X.1z.2n(),c=b.2f||{};q g,i=2;3Q(3.1U.40()){R"5Y":R"5Z":g={x:0-i,y:0-i};18;R"60":g={x:0,y:0-i};18;R"61":R"62":g={x:i,y:0-i};18;R"63":g={x:i,y:0};18;R"64":R"65":g={x:i,y:i};18;R"66":g={x:0,y:i};18;R"67":R"68":g={x:0-i,y:i};18;R"69":g={x:0-i,y:0};18}g.x+=3.9.1c.x;g.y+=3.9.1c.y;j=M.10({1c:g},{C:3.9.V.1s,1U:3.1U,1t:{u:c.1P||2H.1P(b)-k.u,B:c.1O||2H.1O(b)-k.B}});h=s.V(3.E,3.17,j);o(3.9.1z){q n=3.3m(h),m=n.1r;h=n.N;h.B+=m.1e?2*11.2T(g.x-3.9.1c.x):0;h.u+=m.1e?2*11.2T(g.y-3.9.1c.y):0;o(3.D&&(3.1r.1b!=m.1b||3.1r.1e!=m.1e)){3.2e(m)}}h={B:h.B+"v",u:h.u+"v"};3.E.r(h)}Y{j=M.10({1c:3.9.1c},{C:3.9.V.1s,17:3.9.V.17});h=s.V(3.E,3.17,M.10({N:1h},j));h={B:h.B+"v",u:h.u+"v"}}o(3.Q){q e=s.V(3.Q,3.17,M.10({N:1h},j))}o(s.1i){3.1l.r(h)}}Y{q f=3.17.2m(),c=b.2f||{},h={B:((3.9.1H)?f[0]:c.1O||2H.1O(b))+3.9.1c.x,u:((3.9.1H)?f[1]:c.1P||2H.1P(b))+3.9.1c.y};o(!3.9.1H&&3.C!==3.17){q d=3.C.2m();h.B+=-1*(d[0]-f[0]);h.u+=-1*(d[1]-f[1])}o(!3.9.1H&&3.9.1z){q n=3.3m(h),m=n.1r;h=n.N;o(3.D&&(3.1r.1b!=m.1b||3.1r.1e!=m.1e)){3.2e(m)}}h={B:h.B+"v",u:h.u+"v"};3.E.r(h);o(3.Q){3.Q.r(h)}o(s.1i){3.1l.r(h)}}},3m:p(c){q e={1b:U,1e:U},d=3.E.1V(),b=X.1z.2n(),a=X.1z.1V(),g={B:"H",u:"F"};1T(q f 3P g){o((c[f]+d[g[f]]-b[f])>a[g[f]]){c[f]=c[f]-(d[g[f]]+(2*3.9.1c[f=="B"?"x":"y"]));o(3.D){e[s.3I[g[f]]]=1h}}}K{N:c,1r:e}}});M.10(11,{44:p(d,g){q j=1S[2]||3.9,f=j.1k,c=j.1f,e={u:(g.4k(0)=="t"),B:(g.4k(1)=="l")};o(3.2I.24){q b=I G("24",{L:"6a"+g.2r(),H:c+"v",F:c+"v"});d.J(b);q i=b.3q("2d");i.6b=j.1K;i.6c((e.B?f:c-f),(e.u?f:c-f),f,0,6d.6e*2,1h);i.6f();i.4l((e.B?f:0),0,c-f,c);i.4l(0,(e.u?f:0),c,c-f)}Y{q h;d.J(h=I G("P").r({H:c+"v",F:c+"v",1v:0,2y:0,2t:"4i",N:"4h",6g:"2s"}));q a=I G("2h:6h",{6i:j.1K,6j:"6k",6l:j.1K,6m:(f/c*0.5).6n(2)}).r({H:2*c-1+"v",F:2*c-1+"v",N:"4j",B:(e.B?0:(-1*c))+"v",u:(e.u?0:(-1*c))+"v"});h.J(a);a.4m=a.4m}}});G.6o({1Z:p(c,b){c=$(c);q a=M.10({4n:"u B",3n:"6p-3n",3o:"6q",1K:""},1S[2]||{});c.r(s.1i?{6r:"6s:6t.6u.6v(1C=\'"+b+"\'\', 3o=\'"+a.3o+"\')"}:{6w:a.1K+" 2P("+b+") "+a.4n+" "+a.3n});K c}});11.3p={4o:p(a){o(a.C&&!a.C.3K){K 1h}K U},O:p(){o(11.3p.4o(3)){K}s.2l(3);3.2C();q d={};o(3.9.V){d.2f={1O:0,1P:0}}Y{q a=3.17.2m(),c=3.17.3O(),b=X.1z.2n();a.B+=(-1*(c[0]-b[0]));a.u+=(-1*(c[1]-b[1]));d.2f={1O:a.B,1P:a.u}}o(3.9.1j){3.34(d)}Y{3.1Y(d)}3.1q()}};11.10=p(a){a.C.1D={};M.10(a.C.1D,{O:11.3p.O.1d(a),S:a.S.1d(a),1E:s.1E.1d(s,a.C)})};11.3u();',62,405,"|||this||||||options|||||||||||||||if|function|var|setStyle|Tips||top|px||||||left|element|stem|wrapper|height|Element|width|new|insert|return|className|Object|position|show|div|loader|case|hide|images|false|hook|showOn|document|else||extend|Prototip|title|tooltip||visible||target|break|closeButton|observe|horizontal|offset|bind|vertical|border|hideOn|true|fixIE|ajax|radius|iframeShim|tips|zIndex|bottom|content|hideAfter|stemInverse|tip|mouse|delay|margin|bindAsEventListener|stopObserving|javascript|viewport|orientation|clearTimer|src|prototip|remove|invoke|mouseleave|fixed|visibility|stemImage|backgroundColor|auto|eventToggle|hideTargets|pointerX|pointerY|length|middle|arguments|for|mouseHook|getDimensions|style|click|showDelayed|setPngBackground|borderFrame|borderTop|prototip_Corner|toolbar|canvas|match|paths|_inverse|push|null|clone|none|close||positionStem|fakePointer|script|ns_vml|default|initialize|zIndexTop|raise|cumulativeOffset|getScrollOffsets|isString|mousemove|toLowerCase|capitalize|hidden|display|png|build|clearfix|prototip_CornerWrapper|padding|addClassName|eventPosition|eventCheckDelay|cancelHideAfter|ajaxHideEvent|ajaxContentLoading|float|iframeShimDimensions|Event|support|Prototype|_|path|replace|add|loaded|url|window|unload|convertVersionString|toggleInt|right|inverseStem|WebKit419|removeVisible|isElement|Styles|borderColor|onComplete|getStyle|wrap|ajaxShow|_build|body|stemWrapper|li|borderRow|borderMiddle|borderCenter|select|_update|100|eventShow|mouseover|mouseout|hideElement|mouseenter|activityEnter|activityLeave|getPositionWithinViewport|repeat|sizingMethod|Methods|getContext|insertScript|type|text|start|require|js|https|test|styles|namespaces|VML|dom|REQUIRED_|throw|removeAll|deactivate|without|_stemTranslation|parseFloat|parentNode|_highest|addVisibile|hideAll|cumulativeScrollOffset|in|switch|create|hideOthers|include|fixSafari2|setup|activate|9500px|_isBuilding|stemBox|toUpperCase|prototip_Between|borderBottom|each|createCorner|prototip_Fill|update|getWidth|eventHide|toggle|On|buttonEvent|ajaxHide|ajaxContentLoaded|Timer|fire|afterHide|relative|block|absolute|charAt|fillRect|outerHTML|align|hold|REQUIRED_Prototype|createElement|try|write|catch|head|find|documentMode|urn|schemas|microsoft|com|vml|createStyleSheet|cssText|behavior|typeof|undefined|Version|requires|parseInt|times|indexOf|abs|RegExp|MSIE|exec|navigator|userAgent|Browser|WebKit|evaluate|topRight|rightTop|topMiddle|rightMiddle|bottomLeft||leftBottom|bottomRight|rightBottom|bottomMiddle|leftMiddle|Tip|Class|not|available|cannot|000000|closeButtons|endsWith|member|emptyFunction|9500|iframe|frameBorder|opacity|prototipLoader|gif|prototip_Stem|prototip_StemWrapper|prototip_StemBox|prototip_StemImage|MIDDLE|inline|ul|prototip_CornerWrapperTopLeft|prototip_BetweenCorners|prototip_CornerWrapperTopRight|prototip_CornerWrapperBottomLeft|cloneNode|prototip_CornerWrapperBottomRight|tl|tr|bl|br|isNumber|close_hover|event|Action|hideAction|findElement|blur|stop|pointer|responseText|loaderTimer|ajaxTimer|Ajax|Request|showTimer|clearTimeout|shown|hideAfterTimer|marginTop|clear|both|LEFTTOP|TOPLEFT|TOPMIDDLE|TOPRIGHT|RIGHTTOP|RIGHTMIDDLE|RIGHTBOTTOM|BOTTOMRIGHT|BOTTOMMIDDLE|BOTTOMLEFT|LEFTBOTTOM|LEFTMIDDLE|cornerCanvas|fillStyle|arc|Math|PI|fill|overflow|roundrect|fillcolor|strokeWeight|1px|strokeColor|arcSize|toFixed|addMethods|no|scale|filter|progid|DXImageTransform|Microsoft|AlphaImageLoader|background".split("|"),0,{})),Array.prototype.map||(Array.prototype.map=function(e,t){for(var n=this.length,i=new Array(n),o=0;n>o;o++)o in this&&(i[o]=e.call(t,this[o],o,this));return i}),Array.prototype.filter||(Array.prototype.filter=function(e,t){for(var n=this.length,i=new Array,o=0;n>o;o++)if(o in this){var r=this[o];e.call(t,r,o,this)&&i.push(r)}return i}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=this.length>>>0,i=0;n>i;i++)i in this&&e.call(t,this[i],i,this)}),Array.prototype.reduce||(Array.prototype.reduce=function(e,t){var n=this.length;if(!n&&1==arguments.length)throw new Error("reduce: empty array, no initial value");var i=0;if(arguments.length<2)for(;;){if(i in this){t=this[i++];break}if(++i>=n)throw new Error("reduce: no values, no initial value")}for(;n>i;i++)i in this&&(t=e(t,this[i],i,this));return t}),Date.__parse__=Date.parse,Date.parse=function(e,t){if(1==arguments.length)return Date.__parse__(e);var n=1970,i=0,o=1,r=0,s=0,a=0,l=[function(){}];t=t.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&"),t=t.replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%b":return l.push(function(e){i={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[e]}),"([A-Za-z]+)";case"%h":case"%B":return l.push(function(e){i={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[e]}),"([A-Za-z]+)";case"%e":case"%d":return l.push(function(e){o=e}),"([0-9]+)";case"%H":return l.push(function(e){r=e}),"([0-9]+)";case"%m":return l.push(function(e){i=e-1}),"([0-9]+)";case"%M":return l.push(function(e){s=e}),"([0-9]+)";case"%S":return l.push(function(e){a=e}),"([0-9]+)";case"%y":return l.push(function(e){e=Number(e),n=e+(e>=0&&69>e?2e3:e>=69&&100>e?1900:0)}),"([0-9]+)";case"%Y":return l.push(function(e){n=e}),"([0-9]+)";case"%%":return l.push(function(){}),"%"}return e});var c=e.match(t);return c&&c.forEach(function(e,t){l[t](e)}),new Date(n,i,o,r,s,a)},Date.prototype.toLocaleFormat?Date.prototype.format=Date.prototype.toLocaleFormat:Date.prototype.format=function(e){function t(e,t){return 10>e?(t||"0")+e:e}var n=this;return e.replace(/%[a-zA-Z0-9]/g,function(e){switch(e){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][n.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][n.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][n.getMonth()];case"%c":return n.toLocaleString();case"%C":return t(Math.floor(n.getFullYear()/100)%100);case"%d":return t(n.getDate());case"%x":case"%D":return t(n.getMonth()+1)+"/"+t(n.getDate())+"/"+t(n.getFullYear()%100);case"%e":return t(n.getDate()," ");case"%H":return t(n.getHours());case"%I":var i=n.getHours()%12;return i?t(i):12;case"%m":return t(n.getMonth()+1);case"%M":return t(n.getMinutes());case"%n":return"\n";case"%p":return n.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var i=n.getHours()%12;return(i?t(i):12)+":"+t(n.getMinutes())+":"+t(n.getSeconds())+" "+(n.getHours()<12?"AM":"PM");case"%R":return t(n.getHours())+":"+t(n.getMinutes());case"%S":return t(n.getSeconds());case"%t":return"	";case"%u":var o=n.getDay();return o?o:1;case"%w":return n.getDay();case"%y":return t(n.getFullYear()%100);case"%Y":return n.getFullYear();case"%%":return"%"}return e})};var pv=function(){function map(e,t){var n={};return t?e.map(function(e,i){return n.index=i,t.call(n,e)}):e.slice()}function argv(e){for(var t=[];e;)t.push(e.scene[e.index].data),e=e.parent;return t}var pv={};pv.extend=function(e){function t(){}return t.prototype=e.prototype||e,new t};try{eval("pv.parse = function(x) x;")}catch(e){pv.parse=function(e){for(var t,n,i=new RegExp("function(\\s+\\w+)?\\([^)]*\\)\\s*","mg"),o=0,r="";t=i.exec(e);){var s=t.index+t[0].length;if("{"!=e.charAt(s--)){r+=e.substring(o,s)+"{return ",o=s;for(var a=0;a>=0&&s<e.length;s++){var l=e.charAt(s);switch(l){case'"':case"'":for(;++s<e.length&&(n=e.charAt(s))!=l;)"\\"==n&&s++;break;case"[":case"(":a++;break;case"]":case")":a--;break;case";":case",":0==a&&a--}}r+=pv.parse(e.substring(o,--s))+";}",o=s}i.lastIndex=s}return r+=e.substring(o)}}pv.identity=function(e){return e},pv.index=function(){return this.index},pv.child=function(){return this.childIndex},pv.parent=function(){return this.parent.index},pv.range=function(e,t,n){if(1==arguments.length&&(t=e,e=0),void 0==n)n=1;else if(!n)throw new Error("step must be non-zero");var i,o=[],r=0;if(0>n)for(;(i=e+n*r++)>t;)o.push(i);else for(;(i=e+n*r++)<t;)o.push(i);return o},pv.random=function(e,t,n){return 1==arguments.length&&(t=e,e=0),void 0==n&&(n=1),n?Math.floor(Math.random()*(t-e)/n)*n+e:Math.random()*(t-e)+e},pv.repeat=function(e,t){return 1==arguments.length&&(t=2),pv.blend(pv.range(t).map(function(){return e}))},pv.cross=function(e,t){for(var n=[],i=0,o=e.length,r=t.length;o>i;i++)for(var s=0,a=e[i];r>s;s++)n.push([a,t[s]]);return n},pv.blend=function(e){return Array.prototype.concat.apply([],e)},pv.transpose=function(e){var t=e.length,n=pv.max(e,function(e){return e.length});if(n>t){e.length=n;for(var i=t;n>i;i++)e[i]=new Array(t);for(var i=0;t>i;i++)for(var o=i+1;n>o;o++){var r=e[i][o];e[i][o]=e[o][i],e[o][i]=r}}else{for(var i=0;n>i;i++)e[i].length=t;for(var i=0;t>i;i++)for(var o=0;i>o;o++){var r=e[i][o];e[i][o]=e[o][i],e[o][i]=r}}e.length=n;for(var i=0;n>i;i++)e[i].length=t;return e},pv.keys=function(e){var t=[];for(var n in e)t.push(n);return t},pv.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},pv.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},pv.normalize=function(e,t){for(var n=map(e,t),i=pv.sum(n),o=0;o<n.length;o++)n[o]/=i;return n},pv.sum=function(e,t){var n={};return e.reduce(t?function(e,i,o){return n.index=o,e+t.call(n,i)}:function(e,t){return e+t},0)},pv.max=function(e,t){return t==pv.index?e.length-1:Math.max.apply(null,t?map(e,t):e)},pv.max.index=function(e,t){if(t==pv.index)return e.length-1;t||(t=pv.identity);for(var n=-1,i=-(1/0),o={},r=0;r<e.length;r++){o.index=r;var s=t.call(o,e[r]);s>i&&(i=s,n=r)}return n},pv.min=function(e,t){return t==pv.index?0:Math.min.apply(null,t?map(e,t):e)},pv.min.index=function(e,t){if(t==pv.index)return 0;t||(t=pv.identity);for(var n=-1,i=1/0,o={},r=0;r<e.length;r++){o.index=r;var s=t.call(o,e[r]);i>s&&(i=s,n=r)}return n},pv.mean=function(e,t){return pv.sum(e,t)/e.length},pv.median=function(e,t){if(t==pv.index)return(e.length-1)/2;if(e=map(e,t).sort(pv.naturalOrder),e.length%2)return e[Math.floor(e.length/2)];var n=e.length/2;return(e[n-1]+e[n])/2},pv.dict=function(e,t){for(var n={},i={},o=0;o<e.length;o++)if(o in e){var r=e[o];i.index=o,n[r]=t.call(i,r)}return n},pv.permute=function(e,t,n){n||(n=pv.identity);var i=new Array(t.length),o={};return t.forEach(function(t,r){o.index=t,i[r]=n.call(o,e[t])}),i},pv.numerate=function(e,t){t||(t=pv.identity);var n={},i={};return e.forEach(function(e,o){i.index=o,n[t.call(i,e)]=o}),n},pv.naturalOrder=function(e,t){return t>e?-1:e>t?1:0},pv.reverseOrder=function(e,t){return e>t?-1:t>e?1:0},pv.css=function(e,t){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]},pv.ns={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink"},pv.version={major:3,minor:1},pv.error=function(e){"undefined"==typeof console?alert(e):console.error(e)},pv.listen=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},pv.log=function(e,t){return Math.log(e)/Math.log(t)},pv.logSymmetric=function(e,t){return 0==e?0:0>e?-pv.log(-e,t):pv.log(e,t)},pv.logAdjusted=function(e,t){var n=0>e;return t>e&&(e+=(t-e)/t),n?-pv.log(e,t):pv.log(e,t)},pv.logFloor=function(e,t){return e>0?Math.pow(t,Math.floor(pv.log(e,t))):-Math.pow(t,-Math.floor(-pv.log(-e,t)))},pv.logCeil=function(e,t){return e>0?Math.pow(t,Math.ceil(pv.log(e,t))):-Math.pow(t,-Math.ceil(-pv.log(-e,t)))},pv.search=function(e,t,n){n||(n=pv.identity);for(var i=0,o=e.length-1;o>=i;){var r=i+o>>1,s=n(e[r]);if(t>s)i=r+1;else{if(!(s>t))return r;o=r-1}}return-i-1},pv.search.index=function(e,t,n){var i=pv.search(e,t,n);return 0>i?-i-1:i},pv.tree=function(e){return new pv.Tree(e)},pv.Tree=function(e){this.array=e},pv.Tree.prototype.keys=function(e){return this.k=e,this},pv.Tree.prototype.value=function(e){return this.v=e,this},pv.Tree.prototype.map=function(){for(var e={},t={},n=0;n<this.array.length;n++){t.index=n;for(var i=this.array[n],o=this.k.call(t,i),r=e,s=0;s<o.length-1;s++)r=r[o[s]]||(r[o[s]]={});r[o[s]]=this.v?this.v.call(t,i):i}return e},pv.nest=function(e){return new pv.Nest(e)},pv.Nest=function(e){this.array=e,this.keys=[]},pv.Nest.prototype.key=function(e){return this.keys.push(e),this},pv.Nest.prototype.sortKeys=function(e){return this.keys[this.keys.length-1].order=e||pv.naturalOrder,this},pv.Nest.prototype.sortValues=function(e){return this.order=e||pv.naturalOrder,this},pv.Nest.prototype.map=function(){for(var e,t={},n=[],i=0;i<this.array.length;i++){var o=this.array[i],r=t;for(e=0;e<this.keys.length-1;e++){var s=this.keys[e](o);r[s]||(r[s]={}),r=r[s]}if(s=this.keys[e](o),!r[s]){var a=[];n.push(a),r[s]=a}r[s].push(o)}if(this.order)for(var e=0;e<n.length;e++)n[e].sort(this.order);return t},pv.Nest.prototype.entries=function(){function e(t){var n=[];for(var i in t){var o=t[i];n.push({key:i,values:o instanceof Array?o:e(o)})}return n}function t(e,n){var i=this.keys[n].order;if(i&&e.sort(function(e,t){return i(e.key,t.key)}),++n<this.keys.length)for(var o=0;o<e.length;o++)t.call(this,e[o].values,n);return e}return t.call(this,e(this.map()),0)},pv.Nest.prototype.rollup=function(e){function t(n){for(var i in n){var o=n[i];o instanceof Array?n[i]=e(o):t(o)}return n}return t(this.map())},pv.flatten=function(e){return new pv.Flatten(e)},pv.Flatten=function(e){this.map=e,this.keys=[]},pv.Flatten.prototype.key=function(e,t){return this.keys.push({name:e,value:t}),this},pv.Flatten.prototype.array=function(){function e(o,r){if(r<i.length-1)for(var s in o)n.push(s),e(o[s],r+1),n.pop();else t.push(n.concat(o))}var t=[],n=[],i=this.keys;return e(this.map,0),t.map(function(e){for(var t={},n=0;n<i.length;n++){var o=i[n],r=e[n];t[o.name]=o.value?o.value.call(null,r):r}return t})},pv.vector=function(e,t){return new pv.Vector(e,t)},pv.Vector=function(e,t){this.x=e,this.y=t},pv.Vector.prototype.perp=function(){return new pv.Vector(-this.y,this.x)},pv.Vector.prototype.norm=function(){var e=this.length();return this.times(e?1/e:1)},pv.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},pv.Vector.prototype.times=function(e){return new pv.Vector(this.x*e,this.y*e)},pv.Vector.prototype.plus=function(e,t){return 1==arguments.length?new pv.Vector(this.x+e.x,this.y+e.y):new pv.Vector(this.x+e,this.y+t)},pv.Vector.prototype.minus=function(e,t){return 1==arguments.length?new pv.Vector(this.x-e.x,this.y-e.y):new pv.Vector(this.x-e,this.y-t)},pv.Vector.prototype.dot=function(e,t){return 1==arguments.length?this.x*e.x+this.y*e.y:this.x*e+this.y*t},pv.Scale=function(){},pv.Scale.interpolator=function(e,t){return"number"==typeof e?function(n){return n*(t-e)+e}:(e=pv.color(e).rgb(),t=pv.color(t).rgb(),function(n){var i=e.a*(1-n)+t.a*n;return 1e-5>i&&(i=0),0==e.a?pv.rgb(t.r,t.g,t.b,i):0==t.a?pv.rgb(e.r,e.g,e.b,i):pv.rgb(Math.round(e.r*(1-n)+t.r*n),Math.round(e.g*(1-n)+t.g*n),Math.round(e.b*(1-n)+t.b*n),i)})},pv.Scale.linear=function(){function e(e){var n=pv.search(t,e);return 0>n&&(n=-n-2),n=Math.max(0,Math.min(i.length-1,n)),i[n]((e-t[n])/(t[n+1]-t[n]))}var t=[0,1],n=[0,1],i=[pv.identity],o=0;return e.domain=function(e,n,i){return arguments.length?(e instanceof Array?(arguments.length<2&&(n=pv.identity),arguments.length<3&&(i=n),t=[pv.min(e,n),pv.max(e,i)]):t=Array.prototype.slice.call(arguments),this):t},e.range=function(){if(arguments.length){n=Array.prototype.slice.call(arguments),i=[];for(var e=0;e<n.length-1;e++)i.push(pv.Scale.interpolator(n[e],n[e+1]));return this}return n},e.invert=function(e){var o=pv.search(n,e);return 0>o&&(o=-o-2),o=Math.max(0,Math.min(i.length-1,o)),(e-n[o])/(n[o+1]-n[o])*(t[o+1]-t[o])+t[o]},e.ticks=function(){var e=t[0],n=t[t.length-1],i=n-e,r=pv.logCeil(i/10,10);2>i/r?r/=5:5>i/r&&(r/=2);var s=Math.ceil(e/r)*r,a=Math.floor(n/r)*r;return o=Math.max(0,-Math.floor(pv.log(r,10)+.01)),pv.range(s,a+r,r)},e.tickFormat=function(e){return e.toFixed(o)},e.nice=function(){var e=t[0],n=t[t.length-1],i=Math.pow(10,Math.round(Math.log(n-e)/Math.log(10))-1);return t=[Math.floor(e/i)*i,Math.ceil(n/i)*i],this},e.by=function(t){function n(){return e(t.apply(this,arguments))}for(var i in e)n[i]=e[i];return n},e.domain.apply(e,arguments),e},pv.Scale.log=function(){function e(e){var o=pv.search(n,e);return 0>o&&(o=-o-2),o=Math.max(0,Math.min(s.length-1,o)),s[o]((t(e)-i[o])/(i[o+1]-i[o]))}function t(e){return pv.logSymmetric(e,o)}var n=[1,10],i=[0,1],o=10,r=[0,1],s=[pv.identity];return e.domain=function(e,o,r){return arguments.length?(e instanceof Array?(arguments.length<2&&(o=pv.identity),arguments.length<3&&(r=o),n=[pv.min(e,o),pv.max(e,r)]):n=Array.prototype.slice.call(arguments),i=n.map(t),this):n},e.range=function(){if(arguments.length){r=Array.prototype.slice.call(arguments),s=[];for(var e=0;e<r.length-1;e++)s.push(pv.Scale.interpolator(r[e],r[e+1]));return this}return r},e.invert=function(e){var t=pv.search(r,e);0>t&&(t=-t-2),t=Math.max(0,Math.min(s.length-1,t));var a=i[t]+(e-r[t])/(r[t+1]-r[t])*(i[t+1]-i[t]);return n[t]<0?-Math.pow(o,-a):Math.pow(o,a)},e.ticks=function(){for(var e=Math.floor(i[0]),t=Math.ceil(i[1]),r=[],s=e;t>s;s++){var a=Math.pow(o,s);n[0]<0&&(a=-a);for(var l=1;o>l;l++)r.push(a*l)}return r.push(Math.pow(o,t)),r[0]<n[0]&&r.shift(),r[r.length-1]>n[1]&&r.pop(),r},e.tickFormat=function(e){return e.toPrecision(1)},e.nice=function(){return n=[pv.logFloor(n[0],o),pv.logCeil(n[1],o)],i=n.map(t),this},e.base=function(e){return arguments.length?(o=e,i=n.map(t),this):o},e.by=function(t){function n(){return e(t.apply(this,arguments))}for(var i in e)n[i]=e[i];return n},e.domain.apply(e,arguments),e},pv.Scale.ordinal=function(){function e(e){return e in n||(n[e]=t.push(e)-1),i[n[e]%i.length]}var t=[],n={},i=[];return e.domain=function(e,i){if(arguments.length){e=e instanceof Array?arguments.length>1?map(e,i):e:Array.prototype.slice.call(arguments),t=[];for(var o={},r=0;r<e.length;r++){var s=e[r];s in o||(o[s]=!0,t.push(s))}return n=pv.numerate(t),this}return t},e.range=function(e,t){return arguments.length?(i=e instanceof Array?arguments.length>1?map(e,t):e:Array.prototype.slice.call(arguments),"string"==typeof i[0]&&(i=i.map(pv.color)),this):i},e.split=function(e,t){var n=(t-e)/this.domain().length;return i=pv.range(e+n/2,t,n),this},e.splitFlush=function(e,t){var n=this.domain().length,o=(t-e)/(n-1);return i=1==n?[(e+t)/2]:pv.range(e,t+o/2,o),this},e.splitBanded=function(e,t,n){if(arguments.length<3&&(n=1),0>n){var o=this.domain().length,r=-n*o,s=t-e-r,a=s/(o+1);i=pv.range(e+a,t,a-n),i.band=-n}else{var l=(t-e)/(this.domain().length+(1-n));i=pv.range(e+l*(1-n),t,l),i.band=l*n}return this},e.by=function(t){function n(){return e(t.apply(this,arguments))}for(var i in e)n[i]=e[i];return n},e.domain.apply(e,arguments),e},pv.color=function(e){function t(e){var t=parseFloat(e);return"%"==e[e.length-1]?Math.round(2.55*t):t}if(!e||"transparent"==e)return pv.rgb(0,0,0,0);if(e instanceof pv.Color)return e;var n=/([a-z]+)\((.*)\)/i.exec(e);if(n){var i=n[2].split(","),o=1;switch(n[1]){case"hsla":case"rgba":o=parseFloat(i[3])}switch(n[1]){case"hsla":case"hsl":var r=parseFloat(i[0]),s=parseFloat(i[1])/100,a=parseFloat(i[2])/100;return new pv.Color.Hsl(r,s,a,o).rgb();case"rgba":case"rgb":var l=t(i[0]),c=t(i[1]),u=t(i[2]);return pv.rgb(l,c,u,o)}}if(e=pv.Color.names[e]||e,"#"==e.charAt(0)){var l,c,u;return 4==e.length?(l=e.charAt(1),l+=l,c=e.charAt(2),c+=c,u=e.charAt(3),u+=u):7==e.length&&(l=e.substring(1,3),c=e.substring(3,5),u=e.substring(5,7)),pv.rgb(parseInt(l,16),parseInt(c,16),parseInt(u,16),1)}return new pv.Color(e,1)},pv.Color=function(e,t){this.color=e,this.opacity=t},pv.Color.prototype.brighter=function(e){return this.rgb().brighter(e)},pv.Color.prototype.darker=function(e){return this.rgb().darker(e)},pv.rgb=function(e,t,n,i){return new pv.Color.Rgb(e,t,n,4==arguments.length?i:1)},pv.Color.Rgb=function(e,t,n,i){pv.Color.call(this,i?"rgb("+e+","+t+","+n+")":"none",i),this.r=e,this.g=t,this.b=n,this.a=i},pv.Color.Rgb.prototype=pv.extend(pv.Color),pv.Color.Rgb.prototype.red=function(e){return pv.rgb(e,this.g,this.b,this.a)},pv.Color.Rgb.prototype.green=function(e){return pv.rgb(this.r,e,this.b,this.a)},pv.Color.Rgb.prototype.blue=function(e){return pv.rgb(this.r,this.g,e,this.a)},pv.Color.Rgb.prototype.alpha=function(e){return pv.rgb(this.r,this.g,this.b,e)},pv.Color.Rgb.prototype.rgb=function(){return this},pv.Color.Rgb.prototype.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,o=30;return t||n||i?(t&&o>t&&(t=o),n&&o>n&&(n=o),i&&o>i&&(i=o),pv.rgb(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(i/e)),this.a)):pv.rgb(o,o,o,this.a)},pv.Color.Rgb.prototype.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),pv.rgb(Math.max(0,Math.floor(e*this.r)),Math.max(0,Math.floor(e*this.g)),Math.max(0,Math.floor(e*this.b)),this.a)},pv.hsl=function(e,t,n,i){return new pv.Color.Hsl(e,t,n,4==arguments.length?i:1)},pv.Color.Hsl=function(e,t,n,i){pv.Color.call(this,"hsl("+e+","+100*t+"%,"+100*n+"%)",i),this.h=e,this.s=t,this.l=n,this.a=i},pv.Color.Hsl.prototype=pv.extend(pv.Color),pv.Color.Hsl.prototype.hue=function(e){
return pv.hsl(e,this.s,this.l,this.a)},pv.Color.Hsl.prototype.saturation=function(e){return pv.hsl(this.h,e,this.l,this.a)},pv.Color.Hsl.prototype.lightness=function(e){return pv.hsl(this.h,this.s,e,this.a)},pv.Color.Hsl.prototype.alpha=function(e){return pv.hsl(this.h,this.s,this.l,e)},pv.Color.Hsl.prototype.rgb=function(){function e(e){return e>360?e-=360:0>e&&(e+=360),60>e?s+(r-s)*e/60:180>e?r:240>e?s+(r-s)*(240-e)/60:s}function t(t){return Math.round(255*e(t))}var n=this.h,i=this.s,o=this.l;n%=360,0>n&&(n+=360),i=Math.max(0,Math.min(i,1)),o=Math.max(0,Math.min(o,1));var r=.5>=o?o*(1+i):o+i-o*i,s=2*o-r;return pv.rgb(t(n+120),t(n),t(n-120),this.a)},pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},pv.colors=function(){var e=pv.Scale.ordinal();return e.range.apply(e,arguments),e},pv.Colors={},pv.Colors.category10=function(){var e=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");return e.domain.apply(e,arguments),e},pv.Colors.category20=function(){var e=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");return e.domain.apply(e,arguments),e},pv.Colors.category19=function(){var e=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");return e.domain.apply(e,arguments),e},pv.ramp=function(e,t){var n=pv.Scale.linear();return n.range.apply(n,arguments),n},pv.Scene=pv.SvgScene={},pv.SvgScene.updateAll=function(e){if(e.length){if(e[0].reverse&&"line"!=e.type&&"area"!=e.type){for(var t=pv.extend(e),n=0,i=e.length-1;i>=0;n++,i--)t[n]=e[i];e=t}this.removeSiblings(this[e.type](e))}},pv.SvgScene.create=function(e){return document.createElementNS(pv.ns.svg,e)},pv.SvgScene.expect=function(e,t){if(!t)return this.create(e);if("a"==t.tagName&&(t=t.firstChild),t.tagName==e)return t;var n=this.create(e);return t.parentNode.replaceChild(n,t),n},pv.SvgScene.append=function(e,t,n){return e.$scene={scenes:t,index:n},e=this.title(e,t[n]),e.parentNode||t.$g.appendChild(e),e.nextSibling},pv.SvgScene.title=function(e,t){var n=e.parentNode,i=String(t.title);return n&&"a"!=n.tagName&&(n=null),i?(n||(n=this.create("a"),e.parentNode&&e.parentNode.replaceChild(n,e),n.appendChild(e)),n.setAttributeNS(pv.ns.xlink,"title",i),n):(n&&n.parentNode.replaceChild(e,n),e)},pv.SvgScene.dispatch=function(e){var t=e.target.$scene;t&&(t.scenes.mark.dispatch(e.type,t.scenes,t.index),e.preventDefault())},pv.SvgScene.removeSiblings=function(e){for(;e;){var t=e.nextSibling;e.parentNode.removeChild(e),e=t}},pv.SvgScene.area=function(e){var t=e.$g.firstChild;if(!e.length)return t;var n=e[0];if(n.segmented)return this.areaSegment(e);if(!n.visible)return t;var i=pv.color(n.fillStyle),o=pv.color(n.strokeStyle);if(!i.opacity&&!o.opacity)return t;for(var r="",s="",a=0,l=e.length-1;l>=0;a++,l--){var c=e[a],u=e[l];if(r+=c.left+","+c.top+" ",s+=u.left+u.width+","+(u.top+u.height)+" ",a<e.length-1){var h=e[a+1],d=e[l-1];switch(n.interpolate){case"step-before":r+=c.left+","+h.top+" ",s+=d.left+d.width+","+(u.top+u.height)+" ";break;case"step-after":r+=h.left+","+c.top+" ",s+=u.left+u.width+","+(d.top+d.height)+" "}}}t=this.expect("polygon",t),t.setAttribute("cursor",n.cursor),t.setAttribute("points",r+s);var i=pv.color(n.fillStyle);t.setAttribute("fill",i.color),t.setAttribute("fill-opacity",i.opacity);var o=pv.color(n.strokeStyle);return t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",n.lineWidth),this.append(t,e,0)},pv.SvgScene.areaSegment=function(e){for(var t=e.$g.firstChild,n=0,i=e.length-1;i>n;n++){var o=e[n],r=e[n+1];if(o.visible&&r.visible){var s=pv.color(o.fillStyle),a=pv.color(o.strokeStyle);if(s.opacity||a.opacity){var l=o.left+","+o.top+" "+r.left+","+r.top+" "+(r.left+r.width)+","+(r.top+r.height)+" "+(o.left+o.width)+","+(o.top+o.height);t=this.expect("polygon",t),t.setAttribute("cursor",o.cursor),t.setAttribute("points",l),t.setAttribute("fill",s.color),t.setAttribute("fill-opacity",s.opacity),t.setAttribute("stroke",a.color),t.setAttribute("stroke-opacity",a.opacity),t.setAttribute("stroke-width",o.lineWidth),t=this.append(t,e,n)}}}return t},pv.SvgScene.bar=function(e){for(var t=e.$g.firstChild,n=0;n<e.length;n++){var i=e[n];if(i.visible){var o=pv.color(i.fillStyle),r=pv.color(i.strokeStyle);(o.opacity||r.opacity)&&(t=this.expect("rect",t),t.setAttribute("cursor",i.cursor),t.setAttribute("x",i.left),t.setAttribute("y",i.top),t.setAttribute("width",Math.max(1e-10,i.width)),t.setAttribute("height",Math.max(1e-10,i.height)),t.setAttribute("fill",o.color),t.setAttribute("fill-opacity",o.opacity),t.setAttribute("stroke",r.color),t.setAttribute("stroke-opacity",r.opacity),t.setAttribute("stroke-width",i.lineWidth),t=this.append(t,e,n))}}return t},pv.SvgScene.dot=function(e){function t(e){return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}for(var n=e.$g.firstChild,i=0;i<e.length;i++){var o=e[i];if(o.visible){var r=pv.color(o.fillStyle),s=pv.color(o.strokeStyle);if(r.opacity||s.opacity){var a=Math.sqrt(o.size),l="",c="";switch(o.shape){case"cross":l="M"+-a+","+-a+"L"+a+","+a+"M"+a+","+-a+"L"+-a+","+a;break;case"triangle":var u=a,h=2*a/Math.sqrt(3);l="M0,"+u+"L"+h+","+-u+" "+-h+","+-u+"Z";break;case"diamond":a*=Math.sqrt(2),l="M0,"+-a+"L"+a+",0 0,"+a+" "+-a+",0Z";break;case"square":l="M"+-a+","+-a+"L"+a+","+-a+" "+a+","+a+" "+-a+","+a+"Z";break;case"tick":l="M0,0L0,"+-o.size;break;default:o.lineWidth/2>a&&(c=t(o.lineWidth)),l=t(a)}var d="translate("+o.left+","+o.top+")"+(o.angle?" rotate("+180*o.angle/Math.PI+")":"");n=this.expect("path",n),n.setAttribute("d",l),n.setAttribute("transform",d),n.setAttribute("fill",r.color),n.setAttribute("fill-opacity",r.opacity),n.setAttribute("cursor",o.cursor),c?n.setAttribute("stroke","none"):(n.setAttribute("stroke",s.color),n.setAttribute("stroke-opacity",s.opacity),n.setAttribute("stroke-width",o.lineWidth)),n=this.append(n,e,i),c&&(n=this.expect("path",n),n.setAttribute("d",c),n.setAttribute("transform",d),n.setAttribute("fill",s.color),n.setAttribute("fill-opacity",s.opacity),n.setAttribute("cursor",o.cursor),n=this.append(n,e,i))}}}return n},pv.SvgScene.image=function(e){for(var t=e.$g.firstChild,n=0;n<e.length;n++){var i=e[n];i.visible&&(t=this.fill(t,e,n),t=this.expect("image",t),t.setAttribute("preserveAspectRatio","none"),t.setAttribute("x",i.left),t.setAttribute("y",i.top),t.setAttribute("width",i.width),t.setAttribute("height",i.height),t.setAttribute("cursor",i.cursor),t.setAttributeNS(pv.ns.xlink,"href",i.url),t=this.append(t,e,n),t=this.stroke(t,e,n))}return t},pv.SvgScene.label=function(e){for(var t=e.$g.firstChild,n=0;n<e.length;n++){var i=e[n];if(i.visible){var o=pv.color(i.textStyle);if(o.opacity){var r=0,s=0,a=0,l="start";switch(i.textBaseline){case"middle":a=".35em";break;case"top":a=".71em",s=i.textMargin;break;case"bottom":s="-"+i.textMargin}switch(i.textAlign){case"right":l="end",r="-"+i.textMargin;break;case"center":l="middle";break;case"left":r=i.textMargin}t=this.expect("text",t),t.setAttribute("pointer-events","none"),t.setAttribute("x",r),t.setAttribute("y",s),t.setAttribute("dy",a),t.setAttribute("text-anchor",l),t.setAttribute("transform","translate("+i.left+","+i.top+")"+(i.textAngle?" rotate("+180*i.textAngle/Math.PI+")":"")),t.setAttribute("fill",o.color),t.setAttribute("fill-opacity",o.opacity),t.style.font=i.font,t.style.textShadow=i.textShadow,t.firstChild?t.firstChild.nodeValue=i.text:t.appendChild(document.createTextNode(i.text)),t=this.append(t,e,n)}}}return t},pv.SvgScene.line=function(e){var t=e.$g.firstChild;if(e.length<2)return t;var n=e[0];if(n.segmented)return this.lineSegment(e);if(!n.visible)return t;var i=pv.color(n.fillStyle),o=pv.color(n.strokeStyle);if(!i.opacity&&!o.opacity)return t;for(var r="",s=0;s<e.length;s++){var a=e[s];if(r+=a.left+","+a.top+" ",s<e.length-1){var l=e[s+1];switch(n.interpolate){case"step-before":r+=a.left+","+l.top+" ";break;case"step-after":r+=l.left+","+a.top+" "}}}return t=this.expect("polyline",t),t.setAttribute("cursor",n.cursor),t.setAttribute("points",r),t.setAttribute("fill",i.color),t.setAttribute("fill-opacity",i.opacity),t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",n.lineWidth),this.append(t,e,0)},pv.SvgScene.lineSegment=function(e){function t(e,t,n,i){return e.plus(t.times(n.minus(e).dot(i.perp())/t.dot(i.perp())))}for(var n=e.$g.firstChild,i=0,o=e.length-1;o>i;i++){var r=e[i],s=e[i+1];if(r.visible&&s.visible){var a=pv.color(r.strokeStyle);if(a.opacity){var l=pv.vector(r.left,r.top),c=pv.vector(s.left,s.top),u=c.minus(l),h=u.perp().norm(),d=h.times(r.lineWidth/2),f=l.plus(d),p=c.plus(d),m=c.minus(d),g=l.minus(d);if(i>0){var v=e[i-1];if(v.visible){var b=l.minus(v.left,v.top).perp().norm().plus(h);g=t(l,b,g,u),f=t(l,b,f,u)}}if(o-1>i){var y=e[i+2];if(y.visible){var w=pv.vector(y.left,y.top).minus(c).perp().norm().plus(h);m=t(c,w,m,u),p=t(c,w,p,u)}}var u=f.x+","+f.y+" "+p.x+","+p.y+" "+m.x+","+m.y+" "+g.x+","+g.y;n=this.expect("polygon",n),n.setAttribute("cursor",r.cursor),n.setAttribute("points",u),n.setAttribute("fill",a.color),n.setAttribute("fill-opacity",a.opacity),n=this.append(n,e,i)}}}return n};var guid=0;pv.SvgScene.panel=function(e){for(var t=e.$g,n=t&&t.firstChild,i=0;i<e.length;i++){var o=e[i];if(o.visible){if(e.parent||(o.canvas.style.display="inline-block",t=o.canvas.firstChild,t||(t=o.canvas.appendChild(this.create("svg")),t.onclick=t.onmousedown=t.onmouseup=t.onmousemove=t.onmouseout=t.onmouseover=pv.SvgScene.dispatch),e.$g=t,t.setAttribute("width",o.width+o.left+o.right),t.setAttribute("height",o.height+o.top+o.bottom),"undefined"==typeof n&&(n=t.firstChild)),"hidden"==o.overflow){var r=this.expect("g",n),s=(guid++).toString(36);r.setAttribute("clip-path","url(#"+s+")"),r.parentNode||t.appendChild(r),e.$g=t=r,n=r.firstChild,n=this.expect("clipPath",n),n.setAttribute("id",s);var a=n.firstChild||n.appendChild(this.create("rect"));a.setAttribute("x",o.left),a.setAttribute("y",o.top),a.setAttribute("width",o.width),a.setAttribute("height",o.height),n.parentNode||t.appendChild(n),n=n.nextSibling}n=this.fill(n,e,i);for(var l=0;l<o.children.length;l++)o.children[l].$g=n=this.expect("g",n),n.setAttribute("transform","translate("+o.left+","+o.top+")"),this.updateAll(o.children[l]),n.parentNode||t.appendChild(n),n=n.nextSibling;n=this.stroke(n,e,i),"hidden"==o.overflow&&(e.$g=t=r.parentNode,n=r.nextSibling)}}return n},pv.SvgScene.fill=function(e,t,n){var i=t[n],o=pv.color(i.fillStyle);return o.opacity&&(e=this.expect("rect",e),e.setAttribute("x",i.left),e.setAttribute("y",i.top),e.setAttribute("width",i.width),e.setAttribute("height",i.height),e.setAttribute("cursor",i.cursor),e.setAttribute("fill",o.color),e.setAttribute("fill-opacity",o.opacity),e=this.append(e,t,n)),e},pv.SvgScene.stroke=function(e,t,n){var i=t[n],o=pv.color(i.strokeStyle);return o.opacity&&(e=this.expect("rect",e),e.setAttribute("x",i.left),e.setAttribute("y",i.top),e.setAttribute("width",Math.max(1e-10,i.width)),e.setAttribute("height",Math.max(1e-10,i.height)),e.setAttribute("cursor",i.cursor),e.setAttribute("fill","none"),e.setAttribute("stroke",o.color),e.setAttribute("stroke-opacity",o.opacity),e.setAttribute("stroke-width",i.lineWidth),e=this.append(e,t,n)),e},pv.SvgScene.rule=function(e){for(var t=e.$g.firstChild,n=0;n<e.length;n++){var i=e[n];if(i.visible){var o=pv.color(i.strokeStyle);o.opacity&&(t=this.expect("line",t),t.setAttribute("cursor",i.cursor),t.setAttribute("x1",i.left),t.setAttribute("y1",i.top),t.setAttribute("x2",i.left+i.width),t.setAttribute("y2",i.top+i.height),t.setAttribute("stroke",o.color),t.setAttribute("stroke-opacity",o.opacity),t.setAttribute("stroke-width",i.lineWidth),t=this.append(t,e,n))}}return t},pv.SvgScene.wedge=function(e){for(var t=e.$g.firstChild,n=0;n<e.length;n++){var i=e[n];if(i.visible){var o=pv.color(i.fillStyle),r=pv.color(i.strokeStyle);if(o.opacity||r.opacity){var s,a=i.innerRadius,l=i.outerRadius,c=Math.abs(i.angle);if(c>=2*Math.PI)s=a?"M0,"+l+"A"+l+","+l+" 0 1,1 0,"+-l+"A"+l+","+l+" 0 1,1 0,"+l+"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"Z":"M0,"+l+"A"+l+","+l+" 0 1,1 0,"+-l+"A"+l+","+l+" 0 1,1 0,"+l+"Z";else{var u=Math.min(i.startAngle,i.endAngle),h=Math.max(i.startAngle,i.endAngle),d=Math.cos(u),f=Math.cos(h),p=Math.sin(u),m=Math.sin(h);s=a?"M"+l*d+","+l*p+"A"+l+","+l+" 0 "+(c<Math.PI?"0":"1")+",1 "+l*f+","+l*m+"L"+a*f+","+a*m+"A"+a+","+a+" 0 "+(c<Math.PI?"0":"1")+",0 "+a*d+","+a*p+"Z":"M"+l*d+","+l*p+"A"+l+","+l+" 0 "+(c<Math.PI?"0":"1")+",1 "+l*f+","+l*m+"L0,0Z"}t=this.expect("path",t),t.setAttribute("fill-rule","evenodd"),t.setAttribute("cursor",i.cursor),t.setAttribute("transform","translate("+i.left+","+i.top+")"),t.setAttribute("d",s),t.setAttribute("fill",o.color),t.setAttribute("fill-opacity",o.opacity),t.setAttribute("stroke",r.color),t.setAttribute("stroke-opacity",r.opacity),t.setAttribute("stroke-width",i.lineWidth),t=this.append(t,e,n)}}}return t},pv.Mark=function(){this.$properties=[]},pv.Mark.prototype.properties={},pv.Mark.prototype.property=function(e){return this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties)),this.properties[e]=!0,pv.Mark.prototype[e]=function(t){return arguments.length?(this.$properties.push({name:e,type:"function"==typeof t?3:2,value:t}),this):this.scene[this.index][e]},this},pv.Mark.prototype.property("data").property("visible").property("left").property("right").property("top").property("bottom").property("cursor").property("title").property("reverse"),pv.Mark.prototype.childIndex=-1,pv.Mark.prototype.index=-1,pv.Mark.prototype.defaults=(new pv.Mark).data(function(e){return[e]}).visible(!0).reverse(!1).cursor("").title("");var defaultFillStyle=pv.Colors.category20().by(pv.parent),defaultStrokeStyle=pv.Colors.category10().by(pv.parent);pv.Mark.prototype.extend=function(e){return this.proto=e,this},pv.Mark.prototype.add=function(e){return this.parent.add(e).extend(this)},pv.Mark.prototype.def=function(e,t){return this.$properties.push({name:e,type:"function"==typeof t?1:0,value:t}),this},pv.Mark.prototype.anchor=function(e){var t=(new pv.Anchor).extend(this).name(e);return t.parent=this.parent,t},pv.Mark.prototype.anchorTarget=function(){for(var e=this;!(e instanceof pv.Anchor);)if(e=e.proto,!e)return null;return e.proto},pv.Mark.prototype.first=function(){return this.scene[0]},pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]},pv.Mark.prototype.sibling=function(){return 0==this.index?null:this.scene[this.index-1]},pv.Mark.prototype.cousin=function(){var e=this.parent,t=e&&e.sibling();return t&&t.children?t.children[this.childIndex][this.index]:null},pv.Mark.prototype.render=function(){this.bind(),this.build(),pv.Scene.updateAll(this.scene)},pv.Mark.prototype.bind=function(){function e(e){do for(var t=e.$properties,s=t.length-1;s>=0;s--){var a=t[s];if(!(a.name in o))switch(o[a.name]=1,a.name){case"data":n=a;break;case"visible":i=a;break;default:r[a.type].push(a)}}while(e=e.proto)}function t(e){return function(t){var n=this.scene.defs;return arguments.length?(void 0==t?delete n.locked[e]:n.locked[e]=!0,n.values[e]=t,this):n.values[e]}}var n,i,o={},r=[[],[],[],[]];e(this),e(this.defaults),r[1].reverse(),r[3].reverse();var s=this;do for(var a in s.properties)a in o||(o[a]=1,r[2].push({name:a,type:2,value:null}));while(s=s.proto);for(var l=r[0].concat(r[1]),c=0;c<l.length;c++){var u=l[c];this[u.name]=t(u.name)}this.binds={data:n,visible:i,defs:l,properties:pv.blend(r)}},pv.Mark.prototype.build=function(){var e=this.scene;e||(e=this.scene=[],e.mark=this,e.type=this.type,e.childIndex=this.childIndex,this.parent&&(e.parent=this.parent.scene,e.parentIndex=this.parent.index));var t=this.root.scene.data;if(t||(this.root.scene.data=t=argv(this.parent)),this.binds.defs.length){var n=e.defs;n||(e.defs=n={values:{},locked:{}});for(var i=0;i<this.binds.defs.length;i++){var o=this.binds.defs[i];if(!(o.name in n.locked)){var r=o.value;1==o.type&&(property=o.name,r=r.apply(this,t)),n.values[o.name]=r}}}var s=this.binds.data;switch(s.type){case 0:case 1:s=n.values.data;break;case 2:s=s.value;break;case 3:property="data",s=s.value.apply(this,t)}t.unshift(null),e.length=s.length;for(var i=0;i<s.length;i++){pv.Mark.prototype.index=this.index=i;var a=e[i];a||(e[i]=a={}),a.data=t[0]=s[i];var l=this.binds.visible;switch(l.type){case 0:case 1:l=n.values.visible;break;case 2:l=l.value;break;case 3:property="visible",l=l.value.apply(this,t)}(a.visible=l)&&this.buildInstance(a)}return t.shift(),delete this.index,pv.Mark.prototype.index=-1,this.parent||(e.data=null),this},pv.Mark.prototype.buildProperties=function(e,t){for(var n=0,i=t.length;i>n;n++){var o=t[n],r=o.value;switch(o.type){case 0:case 1:r=this.scene.defs.values[o.name];break;case 3:property=o.name,r=r.apply(this,this.root.scene.data)}e[o.name]=r}},pv.Mark.prototype.buildInstance=function(e){this.buildProperties(e,this.binds.properties),this.buildImplied(e)},pv.Mark.prototype.buildImplied=function(e){var t=e.left,n=e.right,i=e.top,o=e.bottom,r=this.properties,s=r.width?e.width:0,a=r.height?e.height:0,l=this.parent?this.parent.width():s+t+n;null==s?s=l-(n=n||0)-(t=t||0):null==n?n=l-s-(t=t||0):null==t&&(t=l-s-(n=n||0));var c=this.parent?this.parent.height():a+i+o;null==a?a=c-(i=i||0)-(o=o||0):null==o?o=c-a-(i=i||0):null==i&&(i=c-a-(o=o||0)),e.left=t,e.right=n,e.top=i,e.bottom=o,r.width&&(e.width=s),r.height&&(e.height=a)};var property,pageX=0,pageY=0;pv.listen(window,"mousemove",function(e){pageX=e.pageX,pageY=e.pageY}),pv.Mark.prototype.mouse=function(){var e=0,t=0,n=this instanceof pv.Panel?this:this.parent;do e+=n.left(),t+=n.top();while(n=n.parent);var i=this.root.canvas();do e+=i.offsetLeft,t+=i.offsetTop;while(i=i.offsetParent);return pv.vector(pageX-e,pageY-t)},pv.Mark.prototype.event=function(e,t){return this.$handlers||(this.$handlers={}),this.$handlers[e]=t,this},pv.Mark.prototype.dispatch=function(e,t,n){var i=this.$handlers&&this.$handlers[e];if(!i)return void(this.parent&&this.parent.dispatch(e,t.parent,t.parentIndex));try{var o=this;do o.index=n,o.scene=t,n=t.parentIndex,t=t.parent;while(o=o.parent);try{o=i.apply(this,this.root.scene.data=argv(this))}finally{this.root.scene.data=null}o instanceof pv.Mark&&o.render()}finally{var o=this;do o.parent&&delete o.scene,delete o.index;while(o=o.parent)}},pv.Anchor=function(){pv.Mark.call(this)},pv.Anchor.prototype=pv.extend(pv.Mark).property("name"),pv.Area=function(){pv.Mark.call(this)},pv.Area.prototype=pv.extend(pv.Mark).property("width").property("height").property("lineWidth").property("strokeStyle").property("fillStyle").property("segmented").property("interpolate"),pv.Area.prototype.type="area",pv.Area.prototype.defaults=(new pv.Area).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(defaultFillStyle).interpolate("linear"),pv.Area.prototype.anchor=function(e){var t=this;return pv.Mark.prototype.anchor.call(this,e).left(function(){switch(this.name()){case"bottom":case"top":case"center":return t.left()+t.width()/2;case"right":return t.left()+t.width()}return null}).right(function(){switch(this.name()){case"bottom":case"top":case"center":return t.right()+t.width()/2;case"left":return t.right()+t.width()}return null}).top(function(){switch(this.name()){case"left":case"right":case"center":return t.top()+t.height()/2;case"bottom":return t.top()+t.height()}return null}).bottom(function(){switch(this.name()){case"left":case"right":case"center":return t.bottom()+t.height()/2;case"top":return t.bottom()+t.height()}return null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})},pv.Area.prototype.buildImplied=function(e){null==e.height&&(e.height=0),null==e.width&&(e.width=0),pv.Mark.prototype.buildImplied.call(this,e)};var pv_Area_specials={left:1,top:1,right:1,bottom:1,width:1,height:1,name:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var e=this.binds,t=e.properties,n=e.specials=[],i=0,o=t.length;o>i;i++){var r=t[i];r.name in pv_Area_specials&&n.push(r)}},pv.Area.prototype.buildInstance=function(e){this.index&&!this.scene[0].segmented?(this.buildProperties(e,this.binds.specials),this.buildImplied(e)):pv.Mark.prototype.buildInstance.call(this,e)},pv.Bar=function(){pv.Mark.call(this)},pv.Bar.prototype=pv.extend(pv.Mark).property("width").property("height").property("lineWidth").property("strokeStyle").property("fillStyle"),pv.Bar.prototype.type="bar",pv.Bar.prototype.defaults=(new pv.Bar).extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(defaultFillStyle),pv.Bar.prototype.anchor=function(e){var t=this;return pv.Mark.prototype.anchor.call(this,e).left(function(){switch(this.name()){case"bottom":case"top":case"center":return t.left()+(this.properties.width?0:t.width()/2);case"right":return t.left()+t.width()}return null}).right(function(){switch(this.name()){case"bottom":case"top":case"center":return t.right()+(this.properties.width?0:t.width()/2);case"left":return t.right()+t.width()}return null}).top(function(){switch(this.name()){case"left":case"right":case"center":return t.top()+(this.properties.height?0:t.height()/2);case"bottom":return t.top()+t.height()}return null}).bottom(function(){switch(this.name()){case"left":case"right":case"center":return t.bottom()+(this.properties.height?0:t.height()/2);case"top":return t.bottom()+t.height()}return null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})},pv.Dot=function(){pv.Mark.call(this)},pv.Dot.prototype=pv.extend(pv.Mark).property("size").property("shape").property("angle").property("lineWidth").property("strokeStyle").property("fillStyle"),pv.Dot.prototype.type="dot",pv.Dot.prototype.defaults=(new pv.Dot).extend(pv.Mark.prototype.defaults).size(20).shape("circle").lineWidth(1.5).strokeStyle(defaultStrokeStyle),pv.Dot.prototype.anchor=function(e){var t=this;return pv.Mark.prototype.anchor.call(this,e).left(function(e){switch(this.name()){case"bottom":case"top":case"center":return t.left();case"right":return t.left()+t.radius()}return null}).right(function(e){switch(this.name()){case"bottom":case"top":case"center":return t.right();case"left":return t.right()+t.radius()}return null}).top(function(e){switch(this.name()){case"left":case"right":case"center":return t.top();case"bottom":return t.top()+t.radius()}return null}).bottom(function(e){switch(this.name()){case"left":case"right":case"center":return t.bottom();case"top":return t.bottom()+t.radius()}return null}).textAlign(function(e){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(e){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})},pv.Dot.prototype.radius=function(){return Math.sqrt(this.size())},pv.Label=function(){pv.Mark.call(this)},pv.Label.prototype=pv.extend(pv.Mark).property("text").property("font").property("textAngle").property("textStyle").property("textAlign").property("textBaseline").property("textMargin").property("textShadow"),pv.Label.prototype.type="label",pv.Label.prototype.defaults=(new pv.Label).extend(pv.Mark.prototype.defaults).text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3),pv.Line=function(){pv.Mark.call(this)},pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth").property("strokeStyle").property("fillStyle").property("segmented").property("interpolate"),pv.Line.prototype.type="line",pv.Line.prototype.defaults=(new pv.Line).extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(defaultStrokeStyle).interpolate("linear");var pv_Line_specials={left:1,top:1,right:1,bottom:1,name:1};return pv.Line.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var e=this.binds,t=e.properties,n=e.specials=[],i=0,o=t.length;o>i;i++){var r=t[i];r.name in pv_Line_specials&&n.push(r)}},pv.Line.prototype.buildInstance=function(e){this.index&&!this.scene[0].segmented?(this.buildProperties(e,this.binds.specials),this.buildImplied(e)):pv.Mark.prototype.buildInstance.call(this,e)},pv.Rule=function(){pv.Mark.call(this)},pv.Rule.prototype=pv.extend(pv.Mark).property("width").property("height").property("lineWidth").property("strokeStyle"),pv.Rule.prototype.type="rule",pv.Rule.prototype.defaults=(new pv.Rule).extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black"),pv.Rule.prototype.anchor=function(e){return pv.Bar.prototype.anchor.call(this,e).textAlign(function(e){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(e){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})},pv.Rule.prototype.buildImplied=function(e){var t=e.left,n=e.right;e.top,e.bottom;null!=e.width||null==t&&null==n||null!=n&&null!=t?e.height=0:e.width=0,pv.Mark.prototype.buildImplied.call(this,e)},pv.Panel=function(){pv.Bar.call(this),this.children=[],this.root=this,this.$dom=pv.Panel.$dom},pv.Panel.prototype=pv.extend(pv.Bar).property("canvas").property("overflow"),pv.Panel.prototype.type="panel",pv.Panel.prototype.defaults=(new pv.Panel).extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible"),pv.Panel.prototype.anchor=function(e){function t(){return 0}t.prototype=this,t.prototype.left=t.prototype.right=t.prototype.top=t.prototype.bottom=t;var n=pv.Bar.prototype.anchor.call(new t,e).data(function(e){return[e]});return n.parent=this,n},pv.Panel.prototype.add=function(e){var t=new e;return t.parent=this,t.root=this.root,t.childIndex=this.children.length,this.children.push(t),t},pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var e=0;e<this.children.length;e++)this.children[e].bind()},pv.Panel.prototype.buildInstance=function(e){pv.Bar.prototype.buildInstance.call(this,e),e.children||(e.children=[]);for(var t=0;t<this.children.length;t++)this.children[t].scene=e.children[t],this.children[t].build();for(var t=0;t<this.children.length;t++)e.children[t]=this.children[t].scene,delete this.children[t].scene;e.children.length=this.children.length},pv.Panel.prototype.buildImplied=function(e){function t(){for(var e=document.body;e.lastChild&&e.lastChild.tagName;)e=e.lastChild;return e==document.body?e:e.parentNode}if(!this.parent){var n=e.canvas;if(n){"string"==typeof n&&(n=document.getElementById(n)),n.$panel!=this&&(n.$panel=this,n.innerHTML="");var i,o;null==e.width&&(i=parseFloat(pv.css(n,"width")),e.width=i-e.left-e.right),null==e.height&&(o=parseFloat(pv.css(n,"height")),e.height=o-e.top-e.bottom)}else e.$canvas?n=e.$canvas:(n=e.$canvas=document.createElement("span"),this.$dom?this.$dom.parentNode.insertBefore(n,this.$dom):t().appendChild(n));e.canvas=n}pv.Bar.prototype.buildImplied.call(this,e)},pv.Image=function(){pv.Bar.call(this)},pv.Image.prototype=pv.extend(pv.Bar).property("url"),pv.Image.prototype.type="image",pv.Image.prototype.defaults=(new pv.Image).extend(pv.Bar.prototype.defaults).fillStyle(null),pv.Wedge=function(){pv.Mark.call(this)},pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle").property("endAngle").property("angle").property("innerRadius").property("outerRadius").property("lineWidth").property("strokeStyle").property("fillStyle"),pv.Wedge.prototype.type="wedge",pv.Wedge.prototype.defaults=(new pv.Wedge).extend(pv.Mark.prototype.defaults).startAngle(function(){var e=this.sibling();return e?e.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(defaultFillStyle.by(pv.index)),pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2},pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2},pv.Wedge.prototype.anchor=function(e){var t=this;return pv.Mark.prototype.anchor.call(this,e).left(function(){switch(this.name()){case"outer":return t.left()+t.outerRadius()*Math.cos(t.midAngle());case"inner":return t.left()+t.innerRadius()*Math.cos(t.midAngle());case"start":return t.left()+t.midRadius()*Math.cos(t.startAngle());case"center":return t.left()+t.midRadius()*Math.cos(t.midAngle());case"end":return t.left()+t.midRadius()*Math.cos(t.endAngle())}}).right(function(){switch(this.name()){case"outer":return t.right()+t.outerRadius()*Math.cos(t.midAngle());case"inner":return t.right()+t.innerRadius()*Math.cos(t.midAngle());case"start":return t.right()+t.midRadius()*Math.cos(t.startAngle());case"center":return t.right()+t.midRadius()*Math.cos(t.midAngle());case"end":return t.right()+t.midRadius()*Math.cos(t.endAngle())}}).top(function(){switch(this.name()){case"outer":return t.top()+t.outerRadius()*Math.sin(t.midAngle());case"inner":return t.top()+t.innerRadius()*Math.sin(t.midAngle());case"start":return t.top()+t.midRadius()*Math.sin(t.startAngle());case"center":return t.top()+t.midRadius()*Math.sin(t.midAngle());case"end":return t.top()+t.midRadius()*Math.sin(t.endAngle())}}).bottom(function(){switch(this.name()){case"outer":return t.bottom()+t.outerRadius()*Math.sin(t.midAngle());case"inner":return t.bottom()+t.innerRadius()*Math.sin(t.midAngle());case"start":return t.bottom()+t.midRadius()*Math.sin(t.startAngle());
case"center":return t.bottom()+t.midRadius()*Math.sin(t.midAngle());case"end":return t.bottom()+t.midRadius()*Math.sin(t.endAngle())}}).textAlign(function(){switch(this.name()){case"outer":return pv.Wedge.upright(t.midAngle())?"right":"left";case"inner":return pv.Wedge.upright(t.midAngle())?"left":"right"}return"center"}).textBaseline(function(){switch(this.name()){case"start":return pv.Wedge.upright(t.startAngle())?"top":"bottom";case"end":return pv.Wedge.upright(t.endAngle())?"bottom":"top"}return"middle"}).textAngle(function(){var e=0;switch(this.name()){case"center":case"inner":case"outer":e=t.midAngle();break;case"start":e=t.startAngle();break;case"end":e=t.endAngle()}return pv.Wedge.upright(e)?e:e+Math.PI})},pv.Wedge.upright=function(e){return e%=2*Math.PI,e=0>e?2*Math.PI+e:e,e<Math.PI/2||e>3*Math.PI/2},pv.Wedge.prototype.buildImplied=function(e){pv.Mark.prototype.buildImplied.call(this,e),null==e.endAngle&&(e.endAngle=e.startAngle+e.angle),null==e.angle&&(e.angle=e.endAngle-e.startAngle)},pv.Layout={},pv.Layout.grid=function(e){function t(){return this.parent.width()/o}function n(){return this.parent.height()/i}var i=e.length,o=e[0].length;return(new pv.Mark).data(pv.blend(e)).left(function(){return t.call(this)*(this.index%o)}).top(function(){return n.call(this)*Math.floor(this.index/o)}).width(t).height(n)},pv.Layout.stack=function(){function e(){for(var e,n,i=this.parent.index;i-->0&&!n;)e=this.parent.scene[i],e.visible&&(n=e.children[this.childIndex][this.index]);if(n)switch(property){case"bottom":return n.bottom+n.height;case"top":return n.top+n.height;case"left":return n.left+n.width;case"right":return n.right+n.width}return t.apply(this,arguments)}var t=function(){return 0};return e.offset=function(e){return t=e instanceof Function?e:function(){return e},this},e},pv.Layout.icicle=function(e){function t(e){var n={size:0,children:[],keys:a.slice()};for(var i in e){var o=e[i],r=l(o);a.push(i),o=isNaN(r)?t(o):{size:r,data:o,keys:a.slice()},n.children.push(o),n.size+=o.size,a.pop()}return n.children.sort(function(e,t){return t.size-e.size}),n}function n(e,t){return t=t?t+1:1,e.children?pv.max(e.children,function(e){return n(e,t)}):t}function i(e){if(e.children){o(e);for(var t=0;t<e.children.length;t++)i(e.children[t])}}function o(e){for(var t=e.left,n=0;n<e.children.length;n++){var i=e.children[n],r=i.size/e.size*e.width;i.left=t,i.top=e.top+e.height,i.width=r,i.height=e.height,i.depth=e.depth+1,t+=r,i.children&&o(i)}}function r(e,t){if(e.children)for(var n=0;n<e.children.length;n++)r(e.children[n],t);return t.push(e),t}function s(){var o=t(e);return o.top=0,o.left=0,o.width=this.parent.width(),o.height=this.parent.height()/n(o),o.depth=0,i(o),r(o,[]).reverse()}var a=[],l=Number,c=(new pv.Mark).data(s).left(function(e){return e.left}).top(function(e){return e.top}).width(function(e){return e.width}).height(function(e){return e.height});return c.root=function(e){return a=[e],this},c.size=function(e){return l=e,this},c},pv.Layout.sunburst=function(e){function t(e){var n={size:0,children:[],keys:u.slice()};for(var i in e){var o=e[i],r=h(o);u.push(i),o=isNaN(r)?t(o):{size:r,data:o,keys:u.slice()},n.children.push(o),n.size+=o.size,u.pop()}return n.children.sort(function(e,t){return t.size-e.size}),n}function n(e,t){return t=t?t+1:1,e.children?pv.max(e.children,function(e){return n(e,t)}):t}function i(e){if(e.children){o(e);for(var t=0;t<e.children.length;t++)i(e.children[t])}}function o(e){for(var t=e.startAngle,n=0;n<e.children.length;n++){var i=e.children[n],r=i.size/e.size*e.angle;i.startAngle=t,i.angle=r,i.endAngle=t+r,i.depth=e.depth+1,i.left=a/2,i.top=l/2,i.innerRadius=Math.max(0,i.depth-.5)*c,i.outerRadius=(i.depth+.5)*c,t+=r,i.children&&o(i)}}function r(e,t){if(e.children)for(var n=0;n<e.children.length;n++)r(e.children[n],t);return t.push(e),t}function s(){var o=t(e);return a=this.parent.width(),l=this.parent.height(),c=Math.min(a,l)/2/(n(o)-.5),o.left=a/2,o.top=l/2,o.startAngle=0,o.angle=2*Math.PI,o.endAngle=2*Math.PI,o.innerRadius=0,o.outerRadius=c,o.depth=0,i(o),r(o,[]).reverse()}var a,l,c,u=[],h=Number,d=(new pv.Mark).data(s).left(function(e){return e.left}).top(function(e){return e.top}).startAngle(function(e){return e.startAngle}).angle(function(e){return e.angle}).innerRadius(function(e){return e.innerRadius}).outerRadius(function(e){return e.outerRadius});return d.root=function(e){return u=[e],this},d.size=function(e){return h=e,this},d},pv.Layout.treemap=function(e){function t(e){return c?Math.round(e):e}function n(e){var t={size:0,children:[],keys:h.slice()};for(var i in e){var o=e[i],r=d(o);h.push(i),o=isNaN(r)?n(o):{size:r,data:o,keys:h.slice()},t.children.push(o),t.size+=o.size,h.pop()}return t.children.sort(function(e,t){return e.size-t.size}),t}function i(e,t){if(e.size*=t,e.children)for(var n=0;n<e.children.length;n++)i(e.children[n],t)}function o(e,t){for(var n=-(1/0),i=1/0,o=0,r=0;r<e.length;r++){var s=e[r].size;i>s&&(i=s),s>n&&(n=s),o+=s}return o*=o,t*=t,Math.max(t*n/o,o/(t*i))}function r(e){function n(e){for(var n=pv.sum(e,function(e){return e.size}),i=0==d?0:t(n/d),o=0,r=0;o<e.length;o++){var s=e[o],u=t(s.size/i);c==d?(s.left=a+r,s.top=l,s.width=u,s.height=i):(s.left=a,s.top=l+r,s.width=i,s.height=u),r+=u}c==d?(s&&(s.width+=c-r),l+=i,h-=i):(s&&(s.height+=h-r),a+=i,c-=i),d=Math.min(c,h)}var r=[],s=1/0,a=e.left+(u?u.left:0),l=e.top+(u?u.top:0),c=e.width-(u?u.left+u.right:0),h=e.height-(u?u.top+u.bottom:0),d=Math.min(c,h);i(e,c*h/e.size);for(var f=e.children.slice();f.length>0;){var p=f[f.length-1];if(p.size<=0)f.pop();else{r.push(p);var m=o(r,d);s>=m?(f.pop(),s=m):(r.pop(),n(r),r.length=0,s=1/0)}}if(r.length>0&&n(r),c==d)for(var g=0;g<r.length;g++)r[g].width+=c;else for(var g=0;g<r.length;g++)r[g].height+=h}function s(e){if(e.children){r(e);for(var t=0;t<e.children.length;t++){var n=e.children[t];n.depth=e.depth+1,s(n)}}}function a(e,t){if(e.children)for(var n=0;n<e.children.length;n++)a(e.children[n],t);return(u||!e.children)&&t.push(e),t}function l(){var t=n(e);return t.left=0,t.top=0,t.width=this.parent.width(),t.height=this.parent.height(),t.depth=0,s(t),a(t,[]).reverse()}var c,u,h=[],d=Number,f=(new pv.Mark).data(l).left(function(e){return e.left}).top(function(e){return e.top}).width(function(e){return e.width}).height(function(e){return e.height});return f.round=function(e){return c=e,this},f.inset=function(e,t,n,i){return 1==arguments.length&&(t=n=i=e),u={top:e,right:t,bottom:n,left:i},this},f.root=function(e){return h=[e],this},f.size=function(e){return d=e,this},f},pv}();if(pv.listen(window,"load",function(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length;t++){var n=e[t];if("text/javascript+protovis"==n.type){try{pv.Panel.$dom=n,window.eval(pv.parse(n.textContent||n.innerHTML))}catch(i){pv.error(i)}delete pv.Panel.$dom}}}),/*!
 * string_score.js: String Scoring Algorithm 0.1.10
 *
 * http://joshaven.com/string_score
 * https://github.com/joshaven/string_score
 *
 * Copyright (C) 2009-2011 Joshaven Potter <yourtech@gmail.com>
 * Special thanks to all of the contributors listed here https://github.com/joshaven/string_score
 * MIT license: http://www.opensource.org/licenses/mit-license.php
 *
 * Date: Tue Mar 1 2011
*/
String.prototype.score=function(e,t){if(this==e)return 1;if(""==e)return 0;for(var n,i,o,r,s,a,l,c,u,h=0,d=e.length,f=this,p=f.length,m=1,g=0;d>g;++g){if(a=e.charAt(g),l=f.indexOf(a.toLowerCase()),c=f.indexOf(a.toUpperCase()),u=Math.min(l,c),s=u>-1?u:Math.max(l,c),-1===s){if(t){m+=1-t;continue}return 0}r=.1,f[s]===a&&(r+=.1),0===s?(r+=.6,0===g&&(n=1)):" "===f.charAt(s-1)&&(r+=.8),f=f.substring(s+1,p),h+=r}return i=h/d,o=(i*(d/p)+i)/2,o/=m,n&&1>o+.15&&(o+=.15),o},"undefined"==typeof deconcept)var deconcept={};"undefined"==typeof deconcept.util&&(deconcept.util={}),"undefined"==typeof deconcept.SWFObjectUtil&&(deconcept.SWFObjectUtil={}),deconcept.SWFObject=function(e,t,n,i,o,r,s,a,l,c){if(document.getElementById){this.DETECT_KEY=c?c:"detectflash",this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY),this.params={},this.variables={},this.attributes=[],e&&this.setAttribute("swf",e),t&&this.setAttribute("id",t),n&&this.setAttribute("width",n),i&&this.setAttribute("height",i),o&&this.setAttribute("version",new deconcept.PlayerVersion(o.toString().split("."))),this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion(),!window.opera&&document.all&&this.installedVer.major>7&&(deconcept.unloadSet||(deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){},__flash_savedUnloadHandler=function(){},window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)},window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload),deconcept.unloadSet=!0)),r&&this.addParam("bgcolor",r);var u=s?s:"high";this.addParam("quality",u),this.setAttribute("useExpressInstall",!1),this.setAttribute("doExpressInstall",!1);var h=a?a:window.location;this.setAttribute("xiRedirectUrl",h),this.setAttribute("redirectUrl",""),l&&this.setAttribute("redirectUrl",l)}},deconcept.SWFObject.prototype={useExpressInstall:function(e){this.xiSWFPath=e?e:"expressinstall.swf",this.setAttribute("useExpressInstall",!0)},setAttribute:function(e,t){this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]||""},addParam:function(e,t){this.params[e]=t},getParams:function(){return this.params},addVariable:function(e,t){this.variables[e]=t},getVariable:function(e){return this.variables[e]||""},getVariables:function(){return this.variables},getVariablePairs:function(){var e,t=[],n=this.getVariables();for(e in n)t[t.length]=e+"="+n[e];return t},getSWFHTML:function(){var e="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","PlugIn"),this.setAttribute("swf",this.xiSWFPath)),e='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+(this.getAttribute("style")||"")+'"',e+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var t=this.getParams();for(var n in t)e+=[n]+'="'+t[n]+'" ';var i=this.getVariablePairs().join("&");i.length>0&&(e+='flashvars="'+i+'"'),e+="/>"}else{this.getAttribute("doExpressInstall")&&(this.addVariable("MMplayerType","ActiveX"),this.setAttribute("swf",this.xiSWFPath)),e='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+(this.getAttribute("style")||"")+'">',e+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var o=this.getParams();for(var n in o)e+='<param name="'+n+'" value="'+o[n]+'" />';var r=this.getVariablePairs().join("&");r.length>0&&(e+='<param name="flashvars" value="'+r+'" />'),e+="</object>"}return e},write:function(e){if(this.getAttribute("useExpressInstall")){var t=new deconcept.PlayerVersion([6,0,65]);this.installedVer.versionIsValid(t)&&!this.installedVer.versionIsValid(this.getAttribute("version"))&&(this.setAttribute("doExpressInstall",!0),this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl"))),document.title=document.title.slice(0,47)+" - Flash Player Installation",this.addVariable("MMdoctitle",document.title))}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n="string"==typeof e?document.getElementById(e):e;return n.innerHTML=this.getSWFHTML(),!0}return""!=this.getAttribute("redirectUrl")&&document.location.replace(this.getAttribute("redirectUrl")),!1}},deconcept.SWFObjectUtil.getPlayerVersion=function(){var e=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var t=navigator.plugins["Shockwave Flash"];t&&t.description&&(e=new deconcept.PlayerVersion(t.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".")))}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0)for(var n=1,i=3;n;)try{i++,n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+i),e=new deconcept.PlayerVersion([i,0,0])}catch(o){n=null}else{try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(o){try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");e=new deconcept.PlayerVersion([6,0,21]),n.AllowScriptAccess="always"}catch(o){if(6==e.major)return e}try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(o){}}null!=n&&(e=new deconcept.PlayerVersion(n.GetVariable("$version").split(" ")[1].split(",")))}return e},deconcept.PlayerVersion=function(e){this.major=null!=e[0]?parseInt(e[0]):0,this.minor=null!=e[1]?parseInt(e[1]):0,this.rev=null!=e[2]?parseInt(e[2]):0},deconcept.PlayerVersion.prototype.versionIsValid=function(e){return this.major<e.major?!1:this.major>e.major?!0:this.minor<e.minor?!1:this.minor>e.minor?!0:this.rev<e.rev?!1:!0},deconcept.util={getRequestParameter:function(e){var t=document.location.search||document.location.hash;if(null==e)return t;if(t)for(var n=t.substring(1).split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return n[i].substring(n[i].indexOf("=")+1);return""}},deconcept.SWFObjectUtil.cleanupSWFs=function(){for(var e=document.getElementsByTagName("OBJECT"),t=e.length-1;t>=0;t--){e[t].style.display="none";for(var n in e[t])"function"==typeof e[t][n]&&(e[t][n]=function(){})}},!document.getElementById&&document.all&&(document.getElementById=function(e){return document.all[e]});var getQueryParamValue=deconcept.util.getRequestParameter,FlashObject=deconcept.SWFObject,SWFObject=deconcept.SWFObject;!function(e,t,n){function i(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function o(e,n,o,r,a,l){var c,u,d=t.createElement("script");r=r||h.errorTimeout,d.src=e;for(u in o)d.setAttribute(u,o[u]);n=l?s:n||b,d.onreadystatechange=d.onload=function(){!c&&i(d.readyState)&&(c=1,n(),d.onload=d.onreadystatechange=null)},f(function(){c||(c=1,n(1))},r),D(),a?d.onload():p.parentNode.insertBefore(d,p)}function r(e,n,i,o,r,a){var l,c=t.createElement("link");o=o||h.errorTimeout,n=a?s:n||b,c.href=e,c.rel="stylesheet",c.type="text/css";for(l in i)c.setAttribute(l,i[l]);r||(D(),p.parentNode.insertBefore(c,p),f(n,0))}function s(){var e=g.shift();v=1,e?e.t?f(function(){("c"==e.t?h.injectCss:h.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),s()):v=0}function a(e,n,o,r,a,l,c){function u(t){if(!m&&i(d.readyState)&&(y.r=m=1,!v&&s(),t)){"img"!=e&&f(function(){S.removeChild(d)},50);for(var o in N[n])N[n].hasOwnProperty(o)&&N[n][o].onload();d.onload=d.onreadystatechange=null}}c=c||h.errorTimeout;var d=t.createElement(e),m=0,b=0,y={t:o,s:n,e:a,a:l,x:c};1===N[n]&&(b=1,N[n]=[]),"object"==e?(d.data=n,d.setAttribute("type","text/css")):(d.src=n,d.type=e),d.width=d.height="0",d.onerror=d.onload=d.onreadystatechange=function(){u.call(this,b)},g.splice(r,0,y),"img"!=e&&(b||2===N[n]?(D(),S.insertBefore(d,w?null:p),f(u,c)):N[n].push(d))}function l(e,t,n,i,o){return v=0,t=t||"j",T(e)?a("c"==t?j:k,e,t,this.i++,n,i,o):(g.splice(this.i++,0,e),1==g.length&&s()),this}function c(){var e=h;return e.loader={load:l,i:0},e}var u,h,d=t.documentElement,f=e.setTimeout,p=t.getElementsByTagName("script")[0],m={}.toString,g=[],v=0,b=function(){},y="MozAppearance"in d.style,w=y&&!!t.createRange().compareNode,S=w?d:p.parentNode,x=e.opera&&"[object Opera]"==m.call(e.opera),C=!!t.attachEvent&&!x,_="webkitAppearance"in d.style&&!("async"in t.createElement("script")),k=y?"object":C||_?"script":"img",j=C?"script":_?"img":k,$=Array.isArray||function(e){return"[object Array]"==m.call(e)},E=function(e){return Object(e)===e},T=function(e){return"string"==typeof e},A=function(e){return"[object Function]"==m.call(e)},D=function(){p&&p.parentNode||(p=t.getElementsByTagName("script")[0])},M=[],N={},I={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};h=function(e){function t(e){var t,n,i,o=e.split("!"),r=M.length,s=o.pop(),a=o.length,l={url:s,origUrl:s,prefixes:o};for(n=0;a>n;n++)i=o[n].split("="),t=I[i.shift()],t&&(l=t(l,i));for(n=0;r>n;n++)l=M[n](l);return l}function i(e){var t=e.split("?")[0];return t.substr(t.lastIndexOf(".")+1)}function o(e,o,r,s,a){var l=t(e),u=l.autoCallback;i(l.url);if(!l.bypass)return o&&(o=A(o)?o:o[e]||o[s]||o[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,o,r,s,a):(N[l.url]&&l.reexecute!==!0?l.noexec=!0:N[l.url]=1,e&&r.load(l.url,l.forceCSS||!l.forceJS&&"css"==i(l.url)?"c":n,l.noexec,l.attrs,l.timeout),(A(o)||A(u))&&r.load(function(){c(),o&&o(l.origUrl,a,s),u&&u(l.origUrl,a,s),N[l.url]=2}),void 0)}function r(e,t){function n(e,n){if(""===e||e){if(T(e))n||(c=function(){var e=[].slice.call(arguments);u.apply(this,e),h()}),o(e,c,t,0,s);else if(E(e)){i=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}();for(r in e)e.hasOwnProperty(r)&&(n||--i||(A(c)?c=function(){var e=[].slice.call(arguments);u.apply(this,e),h()}:c[r]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),h()}}(u[r])),o(e[r],c,t,r,s))}}else!n&&h()}var i,r,s=!!e.test,a=s?e.yep:e.nope,l=e.load||e.both,c=e.callback||b,u=c,h=e.complete||b;n(a,!!l||!!e.complete),l&&n(l),!l&&!!e.complete&&n("")}var s,a,l=this.yepnope.loader;if(T(e))o(e,0,l,0);else if($(e))for(s=0;s<e.length;s++)a=e[s],T(a)?o(a,0,l,0):$(a)?h(a):E(a)&&r(a,l);else E(e)&&r(e,l)},h.addPrefix=function(e,t){I[e]=t},h.addFilter=function(e){M.push(e)},h.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",u=function(){t.removeEventListener("DOMContentLoaded",u,0),t.readyState="complete"},0)),e.yepnope=c(),e.yepnope.executeStack=s,e.yepnope.injectJs=o,e.yepnope.injectCss=r}(this,document),function(e){e.addPrefix("css",function(e){return e.forceCSS=!0,e})}(this.yepnope);var gr={};reverseMerge=function(e,t){for(var n in t)void 0==e[n]&&(e[n]=t[n])},Element.parent=function(e){return e.ancestors()[0]},Element.addMethods({parent:Element.parent}),$j(document).on("click",".brown_comment .unblock",function(e){var t=$j(this).parents(".xhr_blocked");t.next("span").show(),t.hide(),e.preventDefault()}),$j(document).on("change",".sharingToggle.twitter",function(){$j(this).toggleClass("checked",$j(this).children("input[type=checkbox]").is(":checked"))}),$j(document).on("click",".acceptMessage",function(e){$j("#comment_form").show(),$j(".author_warning_message").hide(),e.preventDefault()}),$j(document).on("click",".jsShowSpoiler",function(e){var t=$j(e.target);e.preventDefault(),t.next(".spoilerContainer").show(),t.hide()}),$j(document).on("click",".jsHideSpoiler",function(e){var t=$j(e.target);e.preventDefault(),t.parent().prev(".jsShowSpoiler").show(),t.parent(".spoilerContainer").hide()});var SubmitShelfButtonHandler=Class.create();SubmitShelfButtonHandler.prototype={initialize:function(e,t,n,i,o,r){this.book_id=e,this.unique_id=o?o:e,this.url_params=r?r:{},this.signed_in=n,this.button=$("to_read_link_"+o),this.wtr_arrow=$("wtr_arrow_"+o),this.check_img_id=i,this.check_img=$(i),this.turn_off="none"!=this.check_img.style.display,this.shelf_name=t,this.button_text=null!=this.button?this.button.innerHTML:""},sendRequest:function(){if(!this.button||!this.button.hasClassName("ignored")){var e="/shelf/add_to_shelf?no_content=true&";this.turn_off&&(e="/shelf/remove_book?"),this.url_params.book_id=this.book_id,this.url_params.name=this.shelf_name,this.signed_in?new Ajax.Request(e,{asynchronous:!0,evalScripts:!0,parameters:this.url_params,onComplete:function(e){this.button&&(this.button.update(this.button_text),check_img=$(this.check_img_id),this.turn_off?(this.button.removeClassName("minor"),check_img.hide(),this.wtr_arrow&&this.wtr_arrow.show(),this.button.title="Add to your "+this.shelf_name+" shelf."):(this.button.addClassName("minor"),check_img.show(),this.button.title="Remove from your "+this.shelf_name+" shelf."))}.bind(this),onLoading:function(e){this.button.update("saving..."),this.wtr_arrow&&this.wtr_arrow.hide()}.bind(this)}):document.location=e}}};var YahooOauthPopup={open:function(){var e="/import/yahoo_login";return window.open(e,"yahoo_oauth","width=475,height=435"),!1},close:function(e){window.opener.location.href=e,window.close()}},Popover=Class.create({initialize:function(e,t){this.targetID=e,this.containerID=t,$(e).observe("click",this.togglePopover.bindAsEventListener(this)),Popover.popovers.push(this)},openPopover:function(){return $(this.targetID).addClassName("active"),$(this.containerID).show(),Prototype.Browser.IE&&$(this.targetID).up("form").descendants().each(function(e){e.match("select")&&e.hide()}),Event.observe(document,"click",Popover.handleOpenPopoverClicks),!1},closePopover:function(){return $(this.targetID).removeClassName("active"),$(this.containerID).hide(),Prototype.Browser.IE&&$(this.targetID).up("form").descendants().each(function(e){e.match("select")&&e.show()}),Event.stopObserving(document,"click",Popover.handleOpenPopoverClicks),!1},togglePopover:function(){return $(this.targetID).hasClassName("active")?this.closePopover():this.openPopover(),!1}});Popover.popovers=[],Popover.closePopovers=function(){for(var e=Popover.popovers.length-1;e>=0;e--)Popover.popovers[e].closePopover();return!1},Popover.handleOpenPopoverClicks=function(e){return e.target.hasClassName("popoverTarget")||e.target.hasClassName("popoverContainer")||null!=e.target.up(".popoverTarget")||null!=e.target.up(".popoverContainer")||Popover.closePopovers(),!1},function(){var e={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},t={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};Event.simulate=function(n,i){var o,r=Object.extend(t,arguments[2]||{}),s=null;n=$(n);for(var a in e)if(e[a].test(i)){s=a;break}if(!s)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(o=document.createEvent(s),"HTMLEvents"==s?o.initEvent(i,r.bubbles,r.cancelable):o.initMouseEvent(i,r.bubbles,r.cancelable,document.defaultView,r.button,r.pointerX,r.pointerY,r.pointerX,r.pointerY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,n),n.dispatchEvent(o)):(r.clientX=r.pointerX,r.clientY=r.pointerY,o=Object.extend(document.createEventObject(),r),n.fireEvent("on"+i,o)),n},Element.addMethods({simulate:Event.simulate})}(),function(){Element.scaleToMaxWidth=function(e,t){e=$(e);var n=e.width,i=e.height;return e.width>t&&(e.width=t,e.height=i/n*t),e},Element.scaleToMaxHeight=function(e,t){e=$(e);var n=e.width,i=e.height;return e.height>t&&(e.height=t,e.width=n/i*t),e},Element.addMethods({scaleToMaxWidth:Element.scaleToMaxWidth}),Element.addMethods({scaleToMaxHeight:Element.scaleToMaxHeight})}(),function(){Element.slideToggle=function(e,t){return e.visible()?e.slideUp(t):e.slideDown(t),e},Element.addMethods({slideToggle:Element.slideToggle})}(),function(){Element.showFloatingBox=function(e,t){return e.visible()||($$(".floatingBox").invoke("hideFloatingBox"),e.show()),document.observe("click",FloatingBox.handleFloatingBoxClicks),e},Element.hideFloatingBox=function(e,t){return $(e).visible()?(e.hide(),document.stopObserving("click",FloatingBox.handleFloatingBoxClicks),e):void 0},Element.toggleFloatingBox=function(e,t){return e.visible()?e.hideFloatingBox():e.showFloatingBox(),e},Element.addMethods({showFloatingBox:Element.showFloatingBox}),Element.addMethods({hideFloatingBox:Element.hideFloatingBox}),Element.addMethods({toggleFloatingBox:Element.toggleFloatingBox})}(),function(){FloatingBox={},FloatingBox.handleFloatingBoxClicks=function(e){var t=e.element();t.hasClassName("floatingBox")||t.hasClassName("floatingBoxLink")||null!=t.up(".floatingBox")||($$(".floatingBox").invoke("hideFloatingBox"),document.stopObserving("click",ShelfChooser.handleShelfChooserClicks))}}(),function(){Element.toggleInnerHTML=function(e,t,n){return e.innerHTML==t?e.innerHTML=n:e.innerHTML=t,e},Element.addMethods({toggleInnerHTML:Element.toggleInnerHTML})}();var ShelfChooser=Class.create({initialize:function(e,t,n,i){this.options=Object.extend(i||{},this.defaultOptions),this.style=this.options.style||"standard",this.element=e,"string"==typeof this.element&&(this.element=$(this.element)),this.shelfNames=n,this.entryCount=n.length,this.bookId=t,this.chosen=this.options.chosen||[],this.chosen.sort(),this.exclusive=this.options.exclusive||[],this.url=this.options.url,this.onEsc=this.options.onEsc,this.afterChoose=this.options.afterChoose,this.setupMarkup();var o="keydown";(Prototype.Browser.Gecko||Prototype.Browser.Opera)&&(o="keypress"),Event.observe(this.element,o,this.onKeyPress.bindAsEventListener(this)),ShelfChooser.registry.push(this)},setupMarkup:function(){this.element.addClassName("shelfChooserInput"),this.element.setAttribute("autocomplete","off"),this.wrapper=this.element.wrap("div",{id:this.wrapperId(),"class":"shelfChooser uitext"});var e=(this.wrapper,"choose shelves..."),t="close",n="right greyText";"kcw2853"===this.style&&(e="Choose shelves...",t="Close",n="right"),this.chooseButton=new Element("a",{href:"#","class":"actionLinkLite chooseShelvesLink"}).update(e),this.wrapper.insert({top:this.chooseButton}),this.chooseButton.observe("click",this.toggle.bindAsEventListener(this)),this.chooserWrapper=this.element.wrap("div",{id:this.domId("chooser"),"class":"shelfChooserWrapper"}),this.chooserWrapper.hide();var i=new Element("a",{href:"#","class":"greyText"}).update(e);this.chooserWrapper.insert({top:i}),i.observe("click",this.close.bindAsEventListener(this)),i=new Element("a",{href:"#","class":n}).update(t),this.chooserWrapper.insert({top:i}),i.observe("click",this.close.bindAsEventListener(this)),this.shelvesWrapper=new Element("ul",{"class":"shelves"}),this.chooserWrapper.insert(this.shelvesWrapper);for(var o=0;o<this.shelfNames.length;o++)this.shelvesWrapper.insert(this.buildShelfLi(this.shelfNames[o]));if(this.selectChosen(),this.newShelfButton=new Element("a",{href:"#","class":"actionLinkLite newShelfButton"}).update("Add <span>new</span> shelf"),this.newShelfButtonLi=new Element("li",{"class":"visible newShelfButtonLi",alt:"_NEWSHELFBUTTON"}),this.newShelfButtonLi.observe("click",this.addNewShelf.bindAsEventListener(this)),this.newShelfButtonLi.appendChild(this.newShelfButton),this.newShelfField=new Element("div"),this.newShelfFieldSubmit=new Element("a",{href:"#","class":"gr-button gr-button--small"}).update("Add"),this.newShelfFieldSubmit.observe("click",function(e){return this.addNewShelf(),e.stop(),!1}.bindAsEventListener(this)),this.newShelfInput=new Element("input",{type:"text"}),this.newShelfInput.observe("keypress",function(e){return e.keyCode==Event.KEY_RETURN?(this.addNewShelf(e),e.stop(),!1):void 0}.bindAsEventListener(this)),this.newShelfField.appendChild(this.newShelfInput),this.newShelfField.appendChild(this.newShelfFieldSubmit),this.newShelfButtonLi.appendChild(this.newShelfField),this.newShelfField.hide(),this.newShelfWrapper=new Element("ul"),this.newShelfWrapper.insert(this.newShelfButtonLi),"undefined"!=typeof FB_COG_READ&&FB_COG_READ||"undefined"!=typeof FB_NONCONNECTED_SHOW_ICON&&FB_NONCONNECTED_SHOW_ICON){if(this.facebookToggleLabel=new Element("label",{"class":"facebookToggle right"}),this.facebookToggleCheckbox=new Element("input",{type:"checkbox",name:"cog_explicit",value:1}),FB_COG_READ&&this.facebookToggleCheckbox.setAttribute("checked","checked"),this.facebookToggleLogo=new Element("img",{src:"/assets/fb-icon.png",alt:"Facebook"}),FB_NONCONNECTED_SHOW_ICON)this.facebookToggleLabel.addClassName("disabled"),this.facebookToggleLogo.setAttribute("src","/assets/fb-icon-gray.png"),this.facebookToggleLogo.setAttribute("data-enabled-src","/assets/fb-icon.png");else{new Tip(this.facebookToggleLabel,'Check this box to post to your Facebook<br>\ntimeline when you shelve a book.<br>\n<a href="/user/edit?tab=apps">change your default</a>\n',{style:"goodreads",stem:"bottomLeft",hook:{tip:"bottomLeft",target:"topMiddle"},offset:{x:5,y:5},hideOn:!1,hideAfter:.05})}this.facebookToggleLabel.appendChild(this.facebookToggleCheckbox),this.facebookToggleLabel.appendChild(this.facebookToggleLogo),this.chooserWrapper.insert(this.facebookToggleLabel)}this.chooserWrapper.insert(this.newShelfWrapper),$j(document).on("touchstart",".shelfChooserWrapper > .shelves",function(e){this.shelfMenuScrollStartPos=$j(this).scrollTop()+e.originalEvent.touches[0].pageY}),$j(document).on("touchmove",".shelfChooserWrapper > .shelves",function(e){this.scrollTop=this.shelfMenuScrollStartPos-e.originalEvent.touches[0].pageY,e.preventDefault()}),(EnvironmentDetection.android.isICS()||EnvironmentDetection.android.isHC())&&$j(".shelfChooserWrapper > .shelves").css("overflow-y","hidden"),this.close()},toggle:function(e){return this.chooserWrapper.visible()?this.close(e):this.open(e)},open:function(e){return this.chooseButton.hide(),$$(".floatingBox").invoke("hide"),this.chooserWrapper.show(),this.chooserWrapper.addClassName("open floatingBox"),this.element.focus(),document.observe("click",ShelfChooser.handleShelfChooserClicks),"undefined"!=typeof e&&e.stop(),!1},close:function(e){return this.chooseButton.show(),this.chooserWrapper.removeClassName("open floatingBox"),this.chooserWrapper.hide(),this.element.clear(),this.unChooseShelf(),this.onObserverEvent(),this.newShelfButton.show(),this.newShelfField.hide(),document.stopObserving("click",ShelfChooser.handleShelfChooserClicks),this.options.afterClose&&this.options.afterClose(this),"undefined"!=typeof e&&e.stop(),!1},addNewShelf:function(e){var t=this.element.value||"";if(this.newShelfField.visible()||0==t.strip().length||this.shelfNames.indexOf(t)>=0)var t=this.newShelfField.down("input[type=text]").value||"";if(t=toShelfName(t),this.newShelfField.visible()&&this.shelfNames.indexOf(t)>=0)return this.chooseShelf(t,{submit:!1}),this.hideNewShelfForm(),!1;if(""==t.strip()||this.shelfNames.indexOf(t)>=0)return this.showNewShelfForm(),"undefined"!=typeof e&&e.stop(),!1;this.hideNewShelfForm(),this.shelfNames.push(t),this.shelfNames.sort();var n,i=this.buildShelfLi(t),o=this.shelfNames.indexOf(t)-1;if(0>o)n=this.shelvesWrapper.select("li.exclusive").last();else{do{var r=this.shelfNames[o],n=this.getShelfLi(r);o--}while(null!=n&&n.hasClassName("exclusive"));null==n&&(n=this.shelvesWrapper.select("li.exclusive").last())}return n.insert({after:i}),this.chooseShelf(t),this.markCurrent(),this.element.focus(),this.element.clear(),"undefined"!=typeof e&&e.stop(),!1},showNewShelfForm:function(){this.facebookToggleLabel&&this.facebookToggleLabel.hide(),this.newShelfButton.hide(),this.newShelfField.show(),this.newShelfField.down("input[type=text]").focus()},hideNewShelfForm:function(){this.facebookToggleLabel&&this.facebookToggleLabel.show(),this.newShelfButton.show(),this.newShelfField.hide(),this.newShelfField.down("input[type=text]").value=""},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry(),Event.stop(e);break;case Event.KEY_ESC:return this.chooserWrapper.hasClassName("open")&&this.close(),"function"==typeof this.onEsc&&this.onEsc(),void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e);default:if(this.currentShelfName=null,e.keyCode==Event.KEY_TAB||e.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&0==e.keyCode)return!1}return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency),!1},markNext:function(){var e=this.getCurrentEntry().next(".visible");if("undefined"==typeof e&&this.getCurrentEntry()!==this.newShelfButtonLi&&(e=this.newShelfButtonLi),e){var t=e.readAttribute("alt");this.currentShelfName=t,e.addClassName("hover"),this.shelvesWrapper.scrollTop+this.shelvesWrapper.getHeight()<e.offsetTop&&(this.shelvesWrapper.scrollTop+=e.getHeight())}},markPrevious:function(){var e=this.getCurrentEntry().previous(".visible");"undefined"==typeof e&&this.getCurrentEntry()===this.newShelfButtonLi&&(e=this.shelvesWrapper.select(".visible").last()),e&&(this.currentShelfName=e.readAttribute("alt"),e.addClassName("hover"),this.shelvesWrapper.scrollTop>e.offsetTop&&(this.shelvesWrapper.scrollTop-=e.getHeight()))},markCurrent:function(){var e=this.getCurrentEntry();e&&(this.render(),this.shelvesWrapper.scrollTop=e.offsetTop)},getCurrentEntry:function(){if(this.currentShelfName)return this.getShelfLi(this.currentShelfName);var e=this.shelvesWrapper.down("li.visible");return e?this.currentShelfName=e.readAttribute("alt"):(this.currentShelfName=this.shelfNames[0],e=this.getShelfLi(this.currentShelfName)),e},getShelfLi:function(e){return"_NEWSHELFBUTTON"==e?this.newShelfButton.up("li"):document.getElementById(this.domId("shelf_"+e))},selectEntry:function(){switch(this.currentShelfName){case"_NEWSHELFBUTTON":return this.addNewShelf(),!1;default:this.toggleShelf(this.getCurrentEntry().readAttribute("alt")),this.element.clear()}},selectChosen:function(){if("undefined"!=typeof this.chosen){for(var e=0;e<this.chosen.length;e++)this.chooseShelf(this.chosen[e],{submit:!1});this.currentShelfName=null}},unChooseAll:function(){for(var e=0;e<this.shelfNames.length;e++)this.unChooseShelf(this.shelfNames[e],{submit:!1,onlyUpdateUI:!0});this.currentShelfName=null},render:function(){this.shelvesWrapper.select("li").invoke("removeClassName","hover"),this.newShelfButtonLi.removeClassName("hover");var e=this.getCurrentEntry();e&&e.addClassName("hover")},onObserverEvent:function(){for(var e,t,n=toShelfName(this.element.value),i=this.shelfNames.length-1;i>=0;i--)e=this.shelfNames[i],t=this.getShelfLi(e),t.fastRemoveClassName("hover"),0==e.indexOf(n)?(t.fastAddClassName("visible"),t.show()):(t.fastRemoveClassName("visible"),t.hide());""==n.strip()||this.shelfNames.indexOf(n)>-1?this.newShelfButton.down("span").update("new"):(this.newShelfField.hide(),this.newShelfButton.show(),this.newShelfButton.down("span").update('<b>"'+n+'"</b>')),this.markCurrent()},wrapperId:function(){return"undefined"==typeof this.wrapper||this.wrapper.id.empty()?"shelfChooser"+this.bookId:this.wrapper.id},domId:function(e){return this.wrapperId()+(e||"")},buildShelfLi:function(e,t){var t=t||{},n=new Element("li",{id:this.domId("shelf_"+e),alt:e,"class":"visible"}),i=new Element("span");return i.update(e),n.observe("click",this.toggleShelf.bind(this,e,t)),this.exclusive.indexOf(e)>-1&&n.addClassName("exclusive"),n.insert(i),n},chooseShelf:function(e,t){if("_NEWSHELFBUTTON"==e)return!1;var t=Object.extend({submit:!0},t||{}),n=this.getShelfLi(e);if(n&&(n.hasClassName("exclusive")?(this.shelvesWrapper.select(".exclusive").invoke("removeClassName","exclusive_chosen"),n.addClassName("exclusive_chosen")):n.addClassName("chosen"),n.show()),this.currentShelfName=e,this.chooserWrapper.visible()&&this.element.focus(),this.chosen.indexOf(e)<0&&(this.chosen.push(e),this.chosen.sort()),this.exclusive.indexOf(e)>-1)for(var i=this.exclusive.length-1;i>=0;i--){var o=this.exclusive[i];if(o!=e){var r=this.chosen.indexOf(o);r>-1&&this.chosen.splice(r,1)}}return this.options.cacheChosen&&this.cacheChosen(),t.submit&&this.submitShelf(e),this.options.afterChoose&&this.options.afterChoose(e,this),!1},unChooseShelf:function(e,t){var t=Object.extend({submit:!0},t||{}),n=this.getShelfLi(e);if(null==n||n.hasClassName("exclusive_chosen"))return!1;if(n.removeClassName("chosen"),!t.onlyUpdateUI){var i=this.chosen.indexOf(e);i>-1&&this.chosen.splice(i,1)}return this.options.cacheChosen&&!t.onlyUpdateUI&&this.cacheChosen(),t.submit&&this.submitShelf(e,{remove:!0}),this.options.afterChoose&&this.options.afterChoose(e,this),!1},toggleShelf:function(e,t){var n=this.getShelfLi(e);return n.hasClassName("chosen")||n.hasClassName("exclusive_chosen")?this.unChooseShelf(e,t):this.chooseShelf(e,t)},submitShelf:function(e,t){if("_NEWSHELFBUTTON"==e)return!1;var n=$j(this.facebookToggleCheckbox).prop("checked");n="undefined"!=typeof n?n?1:0:null;var t=Object.extend({remove:!1},t||{}),i=Object.extend(this.options.ajaxOptions||{},{parameters:{book_id:this.bookId,name:e,explicit:n,a:t.remove?"remove":""}});new Ajax.Request(this.url,i)},summon:function(e,t){var n=Event.findElement(e),t=t||{};if(t.bookId&&(this.bookId=t.bookId),t.chosen)this.unChooseAll(),this.chosenByBookId&&this.chosenByBookId[this.bookId]?this.chosen=this.chosenByBookId[this.bookId]:(this.chosen=t.chosen,this.options.cacheChosen&&this.cacheChosen()),0==this.chosen.intersect(this.exclusive).length&&(this.chosen.push("read"),this.chosen.sort()),this.selectChosen();else{this.chosen=[],this.unChooseAll();var i=this.wrapper.down(".exclusive_chosen");i&&i.removeClassName("exclusive_chosen")}n.summon(this.wrapper),this.open(e)},cacheChosen:function(){return 0==this.chosen.length?!1:("undefined"==typeof this.chosenByBookId&&(this.chosenByBookId={}),void(this.chosenByBookId[this.bookId]=this.chosen.clone()))},defaultOptions:{url:"/shelf/add_to_shelf",frequency:.15}});!function(){ShelfChooser.registry=[],ShelfChooser.handleShelfChooserClicks=function(e){e.element().hasClassName("shelfChooser")||e.element().hasClassName("shelfChooserLink")||null!=e.element().up(".shelfChooser")||ShelfChooser.registry.invoke("close")}}(),function(){Element.shelfChooser=function(e,t,n,i){new ShelfChooser(e,t,n,i)},Element.addMethods({shelfChooser:Element.shelfChooser})}(),function(){Element.fastHasClassName=function(e,t){return e.className==t?!0:e.className.indexOf(t)>=0},Element.fastAddClassName=function(e,t){return e.fastHasClassName(t)?e:(e.className+=" "+t,e)},Element.fastRemoveClassName=function(e,t){return e.fastHasClassName(t)?(e.className=e.className.replace(t,""),e):e},Element.addMethods({fastHasClassName:Element.fastHasClassName}),Element.addMethods({fastAddClassName:Element.fastAddClassName}),Element.addMethods({fastRemoveClassName:Element.fastRemoveClassName})}();var Popup=Class.create({initialize:function(e){this.options={url:"#",width:300,height:300},Object.extend(this.options,e||{}),window.open(this.options.url,"","width="+this.options.width+",height="+this.options.height)}}),GR_Twitter={callback:null,askToConnect:function(e){var t="true";e&&(this.callback=e,t="callback"),new Popup({url:"/user/twitter_sign_in?popup="+t,width:775,height:550})},callback:function(e){e?this.callback&&this.callback():InlineFlash.showError("Twitter failed to respond. Please try again.")},publish:function(e,t,n){new Ajax.Request("/twitter_users/tweet",{method:"post",parameters:{authenticity_token:window._token,status:e,status_url:t},onSuccess:function(){n||InlineFlash.showNotice("Your status has been updated!")},onError:function(){n||InlineFlash.showError("We had a problem updating your status. Please try again.")}})}},GR_Amazon={askToConnect:function(e){new Popup({url:e,width:900,height:540})}};!function(){Element.summon=function(e,t,n){e=$(e),t=$(t),$(e).addClassName("floatingBoxLink");var n=n||{},i=$(t).offsetLeft,o=$(t).offsetTop,r=$(t).visible(),s=t.style.width+"",a=t.style.height+"",l=0;if($(e).viewportOffset()[0]+$(t).getWidth()>document.viewport.getWidth())var l=-1*$(t).getWidth()+$(e).getWidth();return"function"==typeof n.beforeSummon&&n.beforeSummon(e,t),$(t).absolutize(),$(t).clonePosition(e,{setWidth:n.setWidth,setHeight:n.setHeight,offsetTop:$(e).getHeight()+2,offsetLeft:l}),n.setWidth||t.setStyle({width:s}),n.setHeight||t.setStyle({height:a}),r&&(n.toggle||$(t).offsetLeft==i&&$(t).offsetTop==o)?($(t).hideFloatingBox(),!0):($(t).showFloatingBox(),void("function"==typeof n.afterSummon&&n.afterSummon(e,t)))},Element.addMethods({summon:Element.summon})}();var Labelize={handleClick:function(e,t,n){if(window.justSorted)return window.justSorted=!1,e.stop(),!0;var n=n||{};return"INPUT"==e.target.tagName&&"checkbox"!=e.target.type||"TEXTAREA"==e.target.tagName||"SELECT"==e.target.tagName||"A"==e.target.tagName?!0:(e.target!=t&&(t.checked=!t.checked),
t.checked?n.selectedClass&&this.fastAddClassName(n.selectedClass):n.selectedClass&&this.fastRemoveClassName(n.selectedClass),void(e.target!=t&&e.stop()))}};!function(){Element.labelize=function(e,t){var n=e.down("input"),t=t||{},i=t.cursor||"pointer";e.labelized()&&1!=t.force||(e.setStyle({cursor:i}),Labelize["_"+e.id+"_click"]=Labelize.handleClick.bindAsEventListener(e,n,t),e.observe("click",Labelize["_"+e.id+"_click"]))},Element.delabelize=function(e,t){if(e.labelized()){e.down("input");e.setStyle({cursor:"auto"}),Labelize["_"+e.id+"_click"]&&(e.stopObserving("click",Labelize["_"+e.id+"_click"]),Labelize["_"+e.id+"_click"]=null),t.selectedClass&&e.fastRemoveClassName(t.selectedClass)}},Element.labelized=function(e){return null!=Labelize["_"+e.id+"_click"]},Element.addMethods({labelize:Element.labelize,delabelize:Element.delabelize,labelized:Element.labelized})}(),function(){Element.dim=function(e){var t=$("dimElt");if(null==t){var t=new Element("div",{id:"dimElt"});document.body.appendChild(t),t.setStyle({position:"absolute",backgroundColor:"white",opacity:"0.5"}),t.hide()}t.clonePosition(e),t.appear()},Element.undim=function(e){$("dimElt").fade()},Element.addMethods({dim:Element.dim})}(),function(){Element.bookTip=function(e,t){var n,i,t=t||{},o=t.bookid||e.getAttribute("rel"),r=t.attach||"bottomRight",s=e.hasClassName("interactive"),a="";switch(delete t.bookid,delete t.attach,e.hasAttribute("origin")&&(a=e.getAttribute("origin")),r){case"bottomRight":n={target:"bottomRight",tip:"topLeft"},i="topLeft";break;case"bottomLeft":n={target:"bottomLeft",tip:"topRight"},i="topRight";break;case"left":n={target:"leftMiddle",tip:"rightMiddle"},i="rightMiddle";break;default:n={target:"bottomRight",tip:"topLeft"},i="topLeft"}s&&reverseMerge(t,{hideOn:!1,hideAfter:1});var l="/book/tip/"+o+"?";if(s&&(l+="interactive=1&"),void 0!=a&&a.length>0&&(l+="origin="+a),reverseMerge(t,{delay:1,style:"goodreads",ajax:{url:l,options:{method:"get"}},width:450,hook:n,stem:i}),!(parseInt(o)>0))throw"You must specify a book ID in JS or in the element.";new Tip(e,t)},Element.addMethods({bookTip:Element.bookTip})}();var current_tabs={},changeTab=function(e,t){if(current_tab=current_tabs[e],$(current_tab+"Link")&&$(t+"Link")){var n=$(current_tab);n&&n.hide();var i=$(current_tab+"Link");i&&(i.removeClassName("selectedTab"),i.addClassName("tab"));var o=$(t);o&&o.show();var r=$(t+"Link");r&&(r.removeClassName("tab"),r.addClassName("selectedTab")),current_tab=current_tabs[e]=t}};$j(function(){$j(document).on("click",".js-dhtmlTab",function(e){e.preventDefault();var t=$j(e.target);t.hasClass("selectedTab")||changeTab(t.data("tab-set"),t.data("tab-name"))})}),String.prototype.ordinalize=function(){return parseInt(this).ordinalize()},Number.prototype.ordinalize=function(){for(var e="th",t=this;t>100;)t-=100;if(10>t||t>13)switch(t%10){case 1:e="st";break;case 2:e="nd";break;case 3:e="rd"}return new String(this+e)},$j(function(){$j("#emailForm input[autofocus]").focus(),$grfb.init.done(function(){"connected"!=this.auth.status&&"not_authorized"!=this.auth.status&&$j(".fb-facepile").hide()})});var InfiniteScroll={isLoading:!1,isDone:!1,lastY:0,start:function(e){if(this.options=Object.extend({page:1,url:window.location.href.replace("format=html","format=js")},e||{}),this.url=this.options.url,this.page=this.options.page,this.url.match(/[\?&]page=\d+/)){var t=this.url.match(/[\?&](page=(\d+)&?)/);this.page=parseInt(t[2]),this.url=this.url.replace(t[1],"")}this.url.match(/per_page=\d+/)&&(this.url=this.url.replace(/per_page=\d+&?/,"")),Event.observe(window,"scroll",function(e){if(InfiniteScroll.lastY>window.pageYOffset+5)return void(InfiniteScroll.lastY=window.pageYOffset);InfiniteScroll.lastY=window.pageYOffset;var t=document.viewport.getScrollOffsets()[1]+document.viewport.getHeight();t>=document.body.scrollHeight-InfiniteScroll.getTriggerDistance()&&InfiniteScroll.load()});var n=document.viewport.getScrollOffsets()[1]+document.viewport.getHeight();n>=document.body.scrollHeight&&InfiniteScroll.load()},load:function(){return this.isLoading||this.isDone?!1:(this.isLoading=!0,void new Ajax.Request(this.url,{parameters:{page:InfiniteScroll.page+1},evalJS:!0,method:"get",onLoading:function(){return null==InfiniteScroll.options.loading?!0:void("function"==typeof InfiniteScroll.options.loading?InfiniteScroll.options.loading():$(InfiniteScroll.options.loading).show())},onComplete:function(e){InfiniteScroll.isLoading=!1,InfiniteScroll.page+=1,InfiniteScroll.options.loading&&"function"!=typeof InfiniteScroll.options.loading&&$(InfiniteScroll.options.loading)&&$(InfiniteScroll.options.loading).hide(),"function"==typeof InfiniteScroll.options.afterLoad&&InfiniteScroll.options.afterLoad(e)},on204:function(){InfiniteScroll.isDone=!0}}))},getTriggerDistance:function(){if(this.options.triggerDistance)return this.options.triggerDistance;var e=document.body.scrollHeight/2,t=3*document.viewport.getHeight();return e>t?t:e}};!function(){Element.modalDialog=function(e,t){e=$(e);var n=e.id+"_fader",i=$(n);if(i)$(i).update("").show();else{var i=$(n)||new Element("div",{id:e.id+"_fader","class":"modalDialogFader"});$(e).appendChild(i),$(i).absolutize(),Event.observe(window,"resize",function(){$(i).clonePosition(e)})}var o=new Element("div").setStyle({backgroundColor:"white",opacity:"0.8",width:"100%",height:"100%"});$(i).update(o),$(i).clonePosition(e);var r="string"==typeof t?new Element("div").update(t):$(t).show();$(i).appendChild(r),$(r).absoluteCenter()},Element.clearModalDialog=function(e){e=$(e),$(e.id+"_fader")&&$(e.id+"_fader").hide()},Element.absoluteCenter=function(e){var t=$(e).up();"absolute"!=t.getStyle("position")&&"relative"!=t.getStyle("position")&&t.setStyle("position","relative"),$(e).setStyle({position:"absolute",left:"50%",top:"50%",marginLeft:"-"+$(e).getWidth()/2+"px",marginTop:"-"+$(e).getHeight()/2+"px"})},Element.addMethods({modalDialog:Element.modalDialog}),Element.addMethods({clearModalDialog:Element.clearModalDialog}),Element.addMethods({absoluteCenter:Element.absoluteCenter})}();var BookAutocompleter=Class.create(Ajax.Autocompleter,{onKeyPress:function($super,e){this.active||e.keyCode!=Event.KEY_TAB&&e.keyCode!=Event.KEY_RETURN?$super(e):Event.stop(e)}}),BookSearchAutocompleter=Class.create(Ajax.Autocompleter,{selectEntry:function(){this.active=!1,this.index<0||this.updateElement(this.getCurrentEntry())},updateChoices:function(e){if(!this.changed&&this.hasFocus){if(this.update.innerHTML=e,Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.down()),this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var t=0;t<this.entryCount;t++){var n=this.getEntry(t);n.autocompleteIndex=t,this.addObservers(n)}}else this.entryCount=0;this.stopIndicator(),this.index=-1,1==this.entryCount&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render()}},onKeyPress:function(e){if(this.active)switch(e.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:if(this.selectEntry(),!(this.index>-1))return;Event.stop(e);case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else if(e.keyCode==Event.KEY_TAB||e.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&0==e.keyCode)return;this.changed=!0,this.hasFocus=!0,this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)}}),BookAutoCompleteField={setup:function(e,t,n){var i=BookAutoCompleteField.elementIds(e,t),n=n||{},o=n.url||"/book/auto_complete";n.url=null;var r=n.afterComplete;n.afterComplete=null;var s=n.autocompleterClass||BookAutocompleter;n.autocompleterClass=null;var a={afterUpdateElement:function(e,t){return""==t.id?void($(i.ac_field_id).value=""):($(i.ac_selected).show().down(".acItem").update(t.innerHTML),$(i.ac_wrapper).hide(),$(i.ac_target_id).value=t.id,void("function"==typeof r&&r(e,t)))},callback:function(e,t){return"q="+$F(i.ac_field_id)},indicator:i.ac_loading_id,minChars:3};n=Object.extend(a,n),window[i.ac_autocompleter_name]=new s(i.ac_field_id,i.ac_autocomplete_id,o,n)},clear:function(e,t,n){var i=BookAutoCompleteField.elementIds(e,t),n=n||{};$(i.ac_selected).hide(),$(i.ac_wrapper).show(),$(i.ac_target_id).value="",$(i.ac_field_id).addClassName("greyText").value=n.field_tip||"Start typing the name of a book...","function"==typeof n.after&&n.after()},remove:function(e,t){var n=BookAutoCompleteField.elementIds(e,t);$(n.ac_target_id).value="",$(n.ac_selected).fade({to:.2}),$(n.ac_selected).down(".controls").setStyle({visibility:"hidden"})},elementIds:function(e,t){return{ac_field_id:e,ac_target_id:t,ac_loading_id:e+"_loading",ac_autocomplete_id:e+"_auto_complete",ac_autocompleter_name:e+"_auto_completer",ac_wrapper:e+"_wrapper",ac_selected:e+"_selected"}}},HeaderNav={handleClickOffs:function(e){var t=e.element();t.hasClassName("subnav")||t.hasClassName("subnavlink")||null!=t.up(".subnav")||null!=t.up(".subnavlink")||($$("#siteheader .subnav").invoke("removeClassName","selected"),document.stopObserving("click",HeaderNav.handleClickOffs))},toggleSubnav:function(e){var t=$(e.target).up("li").select(".subnav");(t.length<=0||!t[0].hasClassName("selected"))&&$$("#siteheader .subnav").invoke("removeClassName","selected");for(var n=0;n<t.length;n++)subnav=t[n],subnav.toggleClassName("selected"),subnav.hasClassName("selected")&&document.observe("click",HeaderNav.handleClickOffs)},searchHeaderAfterUpdateElement:function(e,t){if(""==t.id){var n=t.down("a#autocompleteSearchLink");return void(n&&(window.location.href=n.getAttribute("href")))}var i=$$("#"+t.id+" .title")[0];i&&(e.value=i.innerHTML.stripTags().strip()),$j.post("/track_conversion_action",{event:"autocomplete_suggestion_accepted",options:{multiple:!0}}),window.location="/book/show/"+t.id+"?ac=1&from_search=1&from_nav=true"}};if(Element.activateAjaxPaginationLink=function(e){e.observe("click",function(e){new Ajax.Request(this.href,{method:"get",evalJS:!0});try{pageTracker._trackPageview(this.href)}catch(t){}e.stop()})},Element.activateAjaxPagination=function(e){e.select(".imagePaginationSm a").each(function(e){e.activateAjaxPaginationLink()})},Element.addMethods({activateAjaxPaginationLink:Element.activateAjaxPaginationLink}),Element.addMethods({activateAjaxPagination:Element.activateAjaxPagination}),document.observe("dom:loaded",function(){$$(".bookTipBottomRight").each(function(e){e.bookTip({attach:"bottomRight"})}),$$(".bookTipBottomLeft").each(function(e){e.bookTip({attach:"bottomLeft"})}),$$(".bookTipLeft").each(function(e){e.bookTip({attach:"left"})}),$$(".imagePaginationSm a").each(function(e){e.activateAjaxPaginationLink()})}),jQuery(document).ready(function(){if(jQuery("#pollForReload").length>0){var e=$j("#pollForReload").data("reload-link");setInterval(function(){jQuery.getScript(e)},1e4)}}),"undefined"==typeof $gr)var $gr={};$gr&&($gr.components={},$gr.communityQA={},$gr.giveaway={},$gr.shared={},$gr.user={}),Modernizr.touchevents?$gr.touch="touchstart":$gr.touch="click",$gr.components.slide=function(e,t){this.containerClassName=".sliderContainer",this.containerWidth=e,this.contentClassName=".slider",this.sliderNav=".navButton",this.sliderPrev=".sliderPrev",this.sliderNext=".sliderNext",this.sliderWidth=t,this.maxLeft=0,this.minLeft=0,this.newWidthSet=!1;var n=this,i=500,o=$j(this.contentClassName);this.setNavVisibility=function(e){"undefined"==typeof e&&o.length&&(e=o.position().left),e>n.minLeft?$j(n.sliderNext).show():$j(n.sliderNext).hide(),e<n.maxLeft?$j(n.sliderPrev).show():$j(n.sliderPrev).hide()},this.singleSlide=function(e){var t;o.stop(),"prev"===e?t=$j(this.contentClassName).position().left+4*this.containerWidth/5:"next"===e&&(t=$j(this.contentClassName).position().left-4*this.containerWidth/5),t=Math.min(t,n.maxLeft),t=Math.max(t,n.minLeft),n.setNavVisibility(t),$j(this.contentClassName).animate({left:t},i)},this.setNewWidth=function(){var t=0;$j(".slider .cover").each(function(){t+=$j(this).outerWidth()}),n.sliderWidth=t;var i=30;n.minLeft=Math.min(e-n.sliderWidth-i,n.maxLeft),$j(".slider").width(t+50),n.newWidthSet=!0},this.toggleBackground=function(e){$j(n.sliderNext).toggleClass("sliderBackground",e),$j(n.sliderPrev).toggleClass("sliderBackground",e)},$j(this.containerClassName).on("click",this.sliderNav,function(){var e;this.hasClassName("sliderNext")?e="next":this.hasClassName("sliderPrev")&&(e="prev"),n.first?(n.singleSlide(e,!0),n.first=void 0):n.singleSlide(e)}),$j(document).on("mouseenter",this.containerClassName,function(){n.toggleBackground(!0),n.setNavVisibility()}).on("mouseleave",this.containerClassName,function(){n.toggleBackground(!1),n.setNavVisibility()}),window.onload=function(){0!==o.length&&(n.setNewWidth(),n.setNavVisibility(),n.toggleBackground(!1))}},$gr.components.headerDropDown=function(){var e=function(e,n,i){var o=e.parent(".dropDownContainer").find(".dropDown").eq(0);e.parents(".generalNotice").length>0&&(e.removeClass("noticeOn"),e.find("span.notification").hide()),$j("#siteheader .selected").not(e).removeClass("selected"),$j("#siteheader .dropDown").not(o).hide(),e.toggleClass("selected"),o.toggle(),$j(document).on("click","body",t),"undefined"!=typeof e.data("request-url")&&o.is(":visible")&&$j.get(e.data("request-url"),{format:"js"}).done(function(e){var t=o.find(".dropDownMenu");t.html(e),$scrollableSection=t.find(n),_.isNumber(i)&&$scrollableSection&&($scrollableSection.css("max-height",i+"px"),$scrollableSection.css("overflow-y","scroll"))}).fail(function(){window.location.href=e.data("request-url")})},t=function(e){var n=$j(e.target);n.hasClass("dropDown")||n.hasClass("dropDownOpener")||n.hasClass("notification")||0!==n.parents(".dropDown").length||($j("#siteheader .dropDown").hide(),$j("#siteheader .selected").removeClass("selected"),$j(document).off("click",t))};return{toggleDropDown:e}}(),$j(document).on("click","#siteheader .dropDownOpener",function(e){var t=".dropdownScroller",n=$j(e.target);n.hasClass("notification")&&(n=n.parent(".dropDownOpener")),$gr.components.headerDropDown.toggleDropDown(n,t,400),e.preventDefault()}),$gr.components.friendRequests=function(){var e=function(e){var t=e.parents(".dropDown").eq(0),n=t.siblings(".dropDownOpener").eq(0).find(".notification");n.html(Number(n.text())-1),0===Number(n.text())&&n.hide(),$notificationWrapper=e.parents(".notificationWrapper"),$notificationWrapper.addClass("hide"),$notificationWrapper.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",$j.get("/friend/requests",{format:"js"}).done(function(e){t.find(".dropDownMenu").html(e)}))};return{reloadMenu:e}}(),$j(document).on("click",".friendsNotice .confirmRequest",function(e){$gr.components.friendRequests.reloadMenu($j(e.target)),e.preventDefault()}),$gr.components.stickyHeader=function(){var e,t,n=_.debounce(function(){e.toggleClass("scrolledPastWallpaper",t.scrollTop()>40)}),i=function(){$j(".home.stickyHeader").length>0&&(e=$j("body"),t=$j(document),$j(window).on("scroll",n))};return{init:i}}(),$gr.components.mentionInserter=function(){var e=function(e){this.textarea=e},t=function(e){n(this.textarea)?i(this.textarea,e):this.textarea.value+=e},n=function(e){return _.isNumber(e.selectionStart)},i=function(e,t){var n=e.selectionStart;o(t,e,n),r(t,e,n)},o=function(e,t,n){var i=t.value.substring(0,n),o=t.value.substring(n,t.value.length);t.value=i+e+o},r=function(e,t,n){var i=n+e.length;t.selectionStart=i,t.selectionEnd=i};return{setField:e,insertText:t}}(),$gr.components.explanationHighlighter=function(){var e,t=function(){var t=$j(this).data("term-name");e.find("."+t).addClass("highlighted")},n=function(){var t=$j(this).data("term-name");e.find("."+t).removeClass("highlighted")},i=function(i,o,r){e=$j("."+r),$j("."+o).find("."+i).hover(t,n)};return{init:i}}();var Cookies={get:function(e){var t=null;return jQuery.each(document.cookie.split("; "),function(n,i){var o=i.split("=");o[0]===e&&(t=o[1])}),t},set:function(e,t,n){n=n||365;var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3);var o="; expires="+i.toGMTString();document.cookie=e+"="+encodeURIComponent(t)+o+"; path=/"}},EnvironmentDetection=function(){var e=function(e){return null==navigator.userAgent.match(e)?!1:!0},t=function(){return e(/android 4\.0/i)},n=function(){return e(/android 3/i)},i=function(){for(var e,t=3,n=document.createElement("div"),i=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",i[0];);return t>4?t:e};return{android:{isICS:t,isHC:n},ie:i}}(),grPopup={};grPopup.show=function(e,t){var n=EnvironmentDetection.ie();"function"!=typeof t&&(t=$j.fn.show),e.each(function(){var e=$j(this);e.is(":visible")||(t.call(e),e.offset().left<$j(window).scrollLeft()?e.offset({left:$j(window).scrollLeft()}):$j(window).scrollLeft()+$j(window).innerWidth()<e.offset().left+e.outerWidth()&&e.offset({left:$j(window).scrollLeft()+$j(window).innerWidth()-e.outerWidth()}),void 0!==n&&8>n&&(container=e.closest(".wtrButtonContainer"),container.css("z-index",container.css("z-index")+1e3)))})},grPopup.hide=function(e,t){var n=EnvironmentDetection.ie();"function"!=typeof t&&(t=$j.fn.hide),e.each(function(){var e=$j(this);e.is(":visible")&&e.queue(function(e){t.call($j(this)),e()}).queue(function(e){$j(this).css("left",""),e()}).queue(function(e){void 0!==n&&8>n&&(container=$j(this).closest(".wtrButtonContainer"),container.css("z-index",container.css("z-index")-1e3)),e()})})},HoverIntent={},HoverIntent.onEnterIntent=function(e,t,n,i){"undefined"==typeof n&&(n=e);try{clearTimeout(n.leaveTimeout)}catch(o){}"undefined"==typeof i&&(i=HoverIntent.hoverDelay),n.hoverTimeout=window.setTimeout(function(){t.call(e)},i)},HoverIntent.onLeaveIntent=function(e,t,n,i){"undefined"==typeof n&&(n=e);try{clearTimeout(n.hoverTimeout)}catch(o){}"undefined"==typeof i&&(i=HoverIntent.hoverDelay),n.leaveTimeout=window.setTimeout(function(){t.call(e)},i)},HoverIntent.hoverDelay=250;var sourcesToHideBuyFeatures=["ebfg_gr","ebfg_fb","ebfg_fbm","ebfg_tw","ebfg_email","ebfg_sms"];$j(document).ready(function(){showBuyableFeatures()}),$j(document).on("tooltipHtmlConstructed",function(){showBuyableFeatures()}),WantToRead={},$j(function(){var e,t;WantToRead.shelfMenu=function(){return"object"==typeof e&&0!==e.length?e:e=$j(".wtrShelfMenu").first()},WantToRead.exclusiveShelfButtons=function(){return"object"==typeof t&&0!==t.length?t:t=WantToRead.shelfMenu().children(".wtrShelfList").children(".wtrExclusiveShelves").children("li").children("button")},WantToRead.resetShelfMenuStored=function(){e=$j(".wtrShelfMenu").first()}}),WantToRead.submitFormViaAjax=function(e,t,n){var i=e.serializeArray();e.find("button").each(function(e){i.push({name:$j(this).prop("name"),value:$j(this).attr("value")})}),i.push({name:"wtr_new",value:!0}),i.push({name:"wtr_button_id",value:e.closest(".wtrButtonContainer").prop("id")}),$j.ajax({type:"POST",url:e.prop("action"),data:i,dataType:"script"}).done(function(){"function"==typeof t&&t()}).fail(function(e){var t;if(e&&403===e.status){if(t=JSON.parse(e.responseText),t.redirect)return location.href=t.redirect,!0;alert("So sorry, but there was a problem completing your request. Please reload the page and try again.")}("function"!=typeof n||n(e)===!1)&&alert("So sorry, but there was a problem completing your request. Please reload the page and try again.")})},WantToRead.setupShelfVisibilityInMenu=function(e){var t=e.data("exclusive-shelf");if(WantToRead.shelfMenu().find("ul.wtrExclusiveShelves > li, ul.wtrNonExclusiveShelves > li").length>11?WantToRead.shelfMenu().find(".wtrShelfSearch").show():WantToRead.shelfMenu().find(".wtrShelfSearch").hide(),WantToRead.updateAddShelfReftags(WantToRead.shelfMenu()),WantToRead.exclusiveShelfButtons().show(),WantToRead.shelfMenu().find(".wtrNonExclusiveShelves input").prop("checked",!1),t){WantToRead.shelfMenu().find("button[value='"+t+"']").hide();var n=e.data("shelves");if(n)for(var i=n.toString().split(","),o=0;o<i.length;o++)WantToRead.shelfMenu().find("input[value='"+i[o]+"']").prop("checked",!0)}},WantToRead.showShelfMenu=function(e){var t=e.find(".wtrRight");WantToRead.resetShelfSearch();var n=t.find(".wtrShelfMenu");n.length>0&&n.get(0)!==WantToRead.shelfMenu().get(0)&&n.remove(),0==t.find("form.wtrAddShelf").length&&t.append(WantToRead.shelfMenu()),WantToRead.setupShelfVisibilityInMenu(t),grPopup.show(WantToRead.shelfMenu(),function(){this.slideDown("fast"),EnvironmentDetection.android.isICS()||EnvironmentDetection.android.isHC()||this.css("overflow-y","auto")})},WantToRead.hideShelfMenu=function(){var e=WantToRead.shelfMenu().find("form.wtrAddShelf input[name=name]"),t=WantToRead.shelfMenu().find(".wtrShelfSearchField");e.is(":focus")||0!==t.length&&t.is(":focus")||(grPopup.hide(WantToRead.shelfMenu(),function(){this.slideUp("fast")}),""===e.val()&&WantToRead.hideAddShelfForm())},WantToRead.toggleAddShelfForm=function(){var e=WantToRead.shelfMenu().find("form.wtrAddShelf");e.is(":visible")?WantToRead.hideAddShelfForm(e):WantToRead.showAddShelfForm(e)},WantToRead.showAddShelfForm=function(e){var t,n=WantToRead.shelfMenu().children(".wtrOtherShelfOptions"),i=WantToRead.shelfMenu().children(".wtrShelfList");e||(e=WantToRead.shelfMenu().find("form.wtrAddShelf")),e.show(),t=e.height(),WantToRead.shelfMenu().children(".wtrOtherShelfOptions").children(".facebookToggle").hide(),n.css("height",n.height()+t),i.css("max-height",parseInt(i.css("max-height"),10)-t)},WantToRead.hideAddShelfForm=function(e){var t,n=WantToRead.shelfMenu().children(".wtrOtherShelfOptions"),i=WantToRead.shelfMenu().children(".wtrShelfList");e||(e=WantToRead.shelfMenu().find("form.wtrAddShelf")),e.is(":visible")&&(t=e.height(),e.hide(),WantToRead.shelfMenu().children(".wtrOtherShelfOptions").children(".facebookToggle").show(),n.css("height",n.height()-t),i.css("max-height",parseInt(i.css("max-height"),10)+t))},WantToRead.showShelfSearchAddShelf=function(){var e=WantToRead.shelfMenu().find(".wtrShelfSearch > .wtrShelfSearchField").val(),t=WantToRead.shelfMenu().children(".wtrShelfList").children(".wtrShelfSearchAddShelf"),n=t.find("button");e=toShelfName(e),WantToRead.shelfMenu().find(".wtrShelfSearchAddShelf button[name=name]").val(e),WantToRead.shelfMenu().find(".wtrShelfSearchAddShelf .wtrButtonLabelShelfName").text(e),"want-to-read"!=e&&""!=e&&0===WantToRead.shelfMenu().find("ul.wtrExclusiveShelves > li[data-shelf-name='"+e+"'], ul.wtrNonExclusiveShelves > li[data-shelf-name='"+e+"']").length?(t.css("display","block"),n.is(":hidden")&&n.css("display","block")):t.css("display","none"),WantToRead.hideAddShelfForm(),WantToRead.shelfMenu().children(".wtrOtherShelfOptions").children("label.wtrAddShelf").hide()},WantToRead.hideShelfSearchAddShelf=function(){WantToRead.shelfMenu().find(".wtrShelfSearchAddShelf").hide(),WantToRead.shelfMenu().children(".wtrOtherShelfOptions").children("label.wtrAddShelf").show()},WantToRead.resetShelfSearch=function(){WantToRead.shelfMenu().find(".wtrShelfSearchField").val(""),WantToRead.shelfMenu().find(".wtrShelfSearchEmptyResults").css("display","none"),WantToRead.hideShelfSearchAddShelf(),WantToRead.shelfMenu().find("ul.wtrExclusiveShelves > li, ul.wtrNonExclusiveShelves > li").css("display","block").removeClass("topShelfSearchResult")},WantToRead.thankForRating=function(e){grPopup.show(e.find(".wtrPrompt.ratingThanks"),function(){this.fadeIn()}),window.setTimeout(function(){grPopup.hide(e.find(".wtrPrompt.ratingThanks"),function(){$j(this).fadeOut()})},6e3)},WantToRead.showPromptToReview=function(){$j(this).hasClass("wtrHasReview")||grPopup.show($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrPromptToReview"),function(){this.fadeIn()})},WantToRead.hidePromptToReview=function(){grPopup.hide($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrPromptToReview"),function(){this.fadeOut()})},WantToRead.showPromptToEditReview=function(){grPopup.show($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrPromptToEditReview"),function(){this.fadeIn()})},WantToRead.hidePromptToEditReview=function(){grPopup.hide($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrPromptToEditReview"),function(){this.fadeOut()})},WantToRead.showUserStatusPrompt=function(){grPopup.show($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrUserStatusPrompt"),function(){this.fadeIn()})},WantToRead.hideUserStatusPrompt=function(e){null!=e&&e.jquery||(e=$j(".wtrButtonContainer")),grPopup.hide(e.find(".wtrPrompt.wtrUserStatusPrompt"),function(){this.fadeOut()})},WantToRead.showNewUserStatusForm=function(e){grPopup.show(e.find(".wtrNewUserStatus")),e.find('.wtrNewUserStatus input[type="text"]').select()},WantToRead.hideNewUserStatusForm=function(e){grPopup.hide(e.find(".wtrFloatingBox.wtrNewUserStatus"),function(){this.fadeOut()})},WantToRead.showFormProgress=function(e){e.is("input")&&(e=e.parent()),e.find(".progressTrigger").hide(),e.find(".progressIndicator").show()},WantToRead.hideFormProgress=function(e){e.find(".progressIndicator").hide(),e.find(".progressTrigger").show()},WantToRead.showUserStatusConfirmation=function(e,t){e.find(".wtrUserStatusConfirmation").replaceWith(t),confirmation=e.find(".wtrUserStatusConfirmation"),grPopup.show(confirmation,function(){this.fadeIn()}),confirmation.on("mouseleave.wtrShowUserStatusConfirmation",function(e){confirmation.off("mouseleave.wtrShowUserStatusConfirmation"),grPopup.hide($j(this),function(){this.fadeOut()}),WantToRead.enablePrompts()})},WantToRead.showPromptToReorderShelf=function(){grPopup.show($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrReorderShelf"),function(){this.fadeIn()})},WantToRead.hidePromptToReorderShelf=function(){grPopup.hide($j(this).closest(".wtrButtonContainer").find(".wtrPrompt.wtrReorderShelf"),function(){this.fadeOut()})},WantToRead.activateReorderForm=function(e){e.find(".wtrPrompt.wtrReorderShelf").removeClass("wtrPrompt").addClass("wtrFloatingBox"),e.find(".saveShelfPosition").show(),e.find(".wtrReorderShelf .viewShelfLink").hide()},WantToRead.deactivateReorderForm=function(e){e.find(".wtrFloatingBox.wtrReorderShelf").removeClass("wtrFloatingBox").addClass("wtrPrompt"),e.find(".saveShelfPosition").hide(),e.find(".wtrReorderShelf .viewShelfLink").show()},WantToRead.enablePrompts=function(){WantToRead.disablePrompts(),$j(document).on({"mouseenter.wtrReviewPrompt":function(){HoverIntent.onEnterIntent(this,WantToRead.showPromptToReview)},"mouseleave.wtrReviewPrompt":function(){HoverIntent.onLeaveIntent(this,WantToRead.hidePromptToReview)}},".wtrLeft.wtrStatusRead, .wtrLeft.wtrStatusOtherShelf"),$j(document).on({"mouseenter.wtrReviewPrompt":function(){HoverIntent.onEnterIntent(this,WantToRead.showPromptToEditReview)},"mouseleave.wtrReviewPrompt":function(){HoverIntent.onLeaveIntent(this,WantToRead.hidePromptToEditReview)}},".wtrLeft.wtrStatusRead.wtrHasReview, .wtrLeft.wtrStatusOtherShelf.wtrHasReview"),$j(document).on({"mouseenter.wtrStatusPromptEvents":function(){HoverIntent.onEnterIntent(this,WantToRead.showUserStatusPrompt)},"mouseleave.wtrStatusPromptEvents":function(){HoverIntent.onLeaveIntent(this,WantToRead.hideUserStatusPrompt)}},".wtrButtonContainer .wtrLeft.wtrStatusReadingNow")},WantToRead.disablePrompts=function(e){$j(document).off("mouseenter.wtrReviewPrompt mouseleave.wtrReviewPrompt",".wtrLeft.wtrStatusRead, .wtrLeft.wtrStatusOtherShelf"),$j(document).off("mouseenter.wtrReviewPrompt mouseleave.wtrReviewPrompt",".wtrLeft.wtrStatusRead.wtrHasReview, .wtrLeft.wtrStatusOtherShelf.wtrHasReview"),$j(document).off("mouseenter.wtrStatusPromptEvents mouseleave.wtrStatusPromptEvents",".wtrButtonContainer .wtrLeft.wtrStatusReadingNow")},$j(function(){WantToRead.enablePrompts(),$j(".wtrButtonContainer input, .wtrButtonContainer textarea").placeholder(),$j(document).on("submit",".wtrButtonContainer form.wtrAddShelf, .wtrShelfSearchAddShelf > form",function(){var e=$j(this),t=e.closest(".wtrRight").find(".hiddenShelfForm"),n=t.find("[name='book_id']").val(),i=t.find("[name='unique_id']").val();e.find("[name='book_id']").val(n),e.find("[name='unique_id']").val(i),WantToRead.showFormProgress(e)}),$j(document).on("submit",".wtrButtonContainer form",function(e){e.preventDefault(),WantToRead.submitFormViaAjax($j(this),null,function(e){if(e&&403===e.status){var t=JSON.parse(e.responseText);if(t.redirect)return location.href=t.redirect,!0}return!1})}),$j(document).on("click",".wtrButtonContainer button.wtrUnshelve",function(e){e.preventDefault();var t=$j(this);window.confirm("Removing a book deletes your rating, review, etc. Remove this book from all your shelves?")&&(t.parents(".secondaryWtrButton").length>0?handleSecondaryWtrUnshelving(e):t.closest("form").submit())}),$j(document).on("click",".wtrButtonContainer button.wtrToRead",function(){WantToRead.showFormProgress($j(this).closest("form"))}),$j(document).on("mouseenter.wtrButton",".wtrButtonContainer .wtrRight",function(){HoverIntent.onEnterIntent(this,function(){WantToRead.showShelfMenu($j(this).closest(".wtrButtonContainer"))},WantToRead.shelfMenu())});var e=function(e){HoverIntent.onLeaveIntent(this,WantToRead.hideShelfMenu,WantToRead.shelfMenu(),e)};$j(document).on("mouseleave.wtrButton",".wtrButtonContainer .wtrRight",function(){var t=1e3,n=$j(this),i=n.find(".wtrShelfSearchField");(n.find("form.wtrAddShelf").is(":visible")||i.length>0&&i.val().length>0)&&(t=5e3),e(t)}),$j(document).on("click.wtrButton",".wtrButtonContainer button.wtrShelfButton",function(){WantToRead.shelfMenu().is(":animated")||(WantToRead.shelfMenu().is(":visible")?WantToRead.hideShelfMenu():WantToRead.showShelfMenu($j(this).closest(".wtrButtonContainer")))}),$j(".wtrShelfSearchField").search("ul.wtrExclusiveShelves > li > button, ul.wtrNonExclusiveShelves > li > label",".wtrShelfSearchField",function(e){var t="ul.wtrExclusiveShelves > li, ul.wtrNonExclusiveShelves > li";e.empty(function(){WantToRead.shelfMenu().find(t).css("display","none"),WantToRead.shelfMenu().find(".wtrShelfSearchEmptyResults").css("display","block"),WantToRead.showShelfSearchAddShelf()}),e.reset(function(){WantToRead.resetShelfSearch()}),e.results(function(e){WantToRead.shelfMenu().find(".wtrShelfSearchEmptyResults").css("display","none"),WantToRead.shelfMenu().find(t).css("display","none").removeClass("topShelfSearchResult"),e.parent().css("display","block"),(void 0===EnvironmentDetection.ie()||EnvironmentDetection.ie()>=9)&&e.not("button:hidden").first().parent().addClass("topShelfSearchResult"),WantToRead.showShelfSearchAddShelf()})}),(void 0===EnvironmentDetection.ie()||EnvironmentDetection.ie()>=9)&&$j(document).on("keydown",".wtrShelfMenu > .wtrShelfList > .wtrShelfSearch > .wtrShelfSearchField",function(e){13===e.which&&$j(this).val().length>0&&(e.preventDefault(),WantToRead.shelfMenu().find("ul.wtrExclusiveShelves > li > button:visible, ul.wtrNonExclusiveShelves > li > label > input:visible").first().click())}),$j(document).on("touchstart",".wtrShelfList",function(e){this.wtrScrollStartPos=$j(this).scrollTop()+e.originalEvent.touches[0].pageY}),$j(document).on("touchmove",".wtrShelfList",function(e){this.scrollTop=this.wtrScrollStartPos-e.originalEvent.touches[0].pageY,e.preventDefault()}),(EnvironmentDetection.android.isICS()||EnvironmentDetection.android.isHC())&&$j(".wtrButtonContainer .wtrShelfList").css("overflow-y","hidden"),$j(document).on({mouseenter:function(){HoverIntent.onEnterIntent(this,WantToRead.showPromptToReorderShelf)},mouseleave:function(){HoverIntent.onLeaveIntent(this,WantToRead.hidePromptToReorderShelf)}},".wtrButtonContainer .wtrLeft.wtrStatusToRead"),$j(document).on("click",".wtrButtonContainer .wtrReorderShelf form button[type=submit]",function(){WantToRead.showFormProgress($j(this).closest("form"))}),$j(document).on("click",".wtrExclusiveShelves button.wtrExclusiveShelf",function(){t($j(this))}),$j(document).on("change",".wtrNonExclusiveShelves input.wtrNonExclusiveShelf",function(e){t($j(this),!0)});var t=function(e,t){WantToRead.showFormProgress(e);var n=e.val(),i=e.closest(".wtrButtonContainer").find(".hiddenShelfForm"),o=e.closest(".wtrNewUserStatus, .wtrShelfMenu").find("input[name=cog_explicit]");if(o.length>0&&$j("<input>").attr({type:"hidden",name:"explicit",value:o.is(":checked")?1:0}).appendTo(i),0===i.length)return void alert("We're sorry, but there was a problem completing your request. Please reload the page and try again.");if(i.find("[name=name]").val(n),t){var r=e.prop("checked");i.find("[name=a]").val(r?"":"remove"),WantToRead.setShelfTypeReftag(i,"wtrnes")}else WantToRead.setShelfTypeReftag(i,"wtres"),i.find("[name=a]").val("");WantToRead.submitFormViaAjax(i)};$j(document).on("click",".wtrButtonContainer label.wtrAddShelf",function(){
WantToRead.toggleAddShelfForm()}),$j(document).on("focusin",".wtrButtonContainer .wtrPrompt.wtrUserStatusPrompt input[type=text]",function(){var e=$j(this).closest(".wtrButtonContainer");WantToRead.disablePrompts(),WantToRead.hideUserStatusPrompt(e),WantToRead.showNewUserStatusForm(e)}),$j(document).on("click",".wtrButtonContainer .wtrNewUserStatus form button[type=submit]",function(){WantToRead.showFormProgress($j(this).closest("form"))}),$j(document).on("click",".wtrButtonContainer div.wtrNewUserStatus form button[type=reset]",function(){buttonContainer=$j(this).closest(".wtrButtonContainer"),WantToRead.hideNewUserStatusForm(buttonContainer),WantToRead.enablePrompts()}),$j(document).on("click",".wtrButtonContainer .wtrNewUserStatusProgressTypeToggle",function(){var e=$j(this).closest(".wtrNewUserStatusProgress"),t=$j(this).closest(".wtrNewUserStatus").find(".wtrNewUserStatusProgress:hidden");e.find("input, button").prop("disabled",!0),e.hide(),t.find("input, button").prop("disabled",!1),t.show()}),$j(document).on("click",".wtrButtonContainer .wtrNewUserStatus button.wtrExclusiveShelf[value=read]",function(e){e.preventDefault(),window.confirm("Mark this book as read?")&&(t($j(this)),WantToRead.enablePrompts())}),$j(document).on("change",".wtrNewUserStatus .facebookToggle",function(e){var t=$j(this).find("input[type=checkbox]").is(":checked");$j(this).closest(".wtrButtonContainer").each(function(){$j(this).find(".cogExplicitHidden").val(t?1:0)})}),$j(document).on("click",".facebookToggle.disabled",function(e){var t=$j(this).closest("label"),n=t.children("img");$grfb.ensurePublishPermission().done(function(){t.removeClass("disabled"),t.children("input").prop("checked",!0),n.attr("src",n.data("enabled-src"));
// tip right away for users who are already connected -- sorry! We
new Tip(t.get(0),'Check this box to post to your Facebook<br>\ntimeline when you shelve a book.<br>\n<a href="/user/edit?tab=apps">change your default</a>\n',{style:"goodreads",stem:"bottomLeft",hook:{tip:"bottomLeft",target:"topMiddle"},offset:{x:5,y:5},hideOn:!1,hideAfter:.05})}),e.preventDefault()}),$j(document).on("focusin",".wtrButtonContainer input.shelfPosition",function(){$j(this).select(),WantToRead.activateReorderForm($j(this).closest(".wtrButtonContainer"))}),$j(document).on("click",".wtrButtonContainer div.wtrReorderShelf form button[type=reset]",function(){WantToRead.deactivateReorderForm($j(this).closest(".wtrButtonContainer"))})});var clearSecondaryWtrButton=function(e,t){var n=e.parents(".wtrButtonContainer").find(".wtrRight");n.data("exclusive-shelf",""),n.data("shelves",""),WantToRead.setupShelfVisibilityInMenu(n),n.removeClass("wtrDown"),n.addClass("wtrUp"),e.closest(".wtrLeft").replaceWith(t.wtr_button_left)},clearSecondaryRatingStars=function(e,t){var n=e.parents(".wtrButtonContainer").find(".ratingStars");n.replaceWith(t.rating_stars),n.removeClass("hasRating")},handleSecondaryWtrUnshelving=function(e){var t=$j(e.target),n=t.parents(".wtrButtonContainer").attr("id"),i=t.parents("form").attr("action"),o={format:"json",unique_id:n,use_secondary_wtr:!0};$j.ajax({url:i,type:"POST",dataType:"json",data:o,success:function(t){var n=$j(e.target);updateRateBooksHeaderAndFooter(t),clearSecondaryRatingStars(n,t),clearSecondaryWtrButton(n,t)}})};WantToRead.setShelfTypeReftag=function(e,t){var n=e.find(".wtrRefRightShelfMenu");n.length>0&&n.val(n.val().replace(/_wtr(es|nes)$/,"_"+t))},WantToRead.updateAddShelfReftags=function(e){var t=e.parents(".wtrButtonContainer"),n=t.find(".wtrRefRightShelfMenu").val();null!=n&&""!=n&&(e.find(".wtrShelfSearchAddRef").val(n.replace(/_wtres/,"_wtres")),e.find(".wtrAddSearchRef").val(n.replace(/_wtres/,"_wtrnes")),t.children(".wtrDown").length>0?t.find(".wtrExisting").val("true"):t.find(".wtrExisting").val("false"))},$j(function(){var e=document.createElement("input");jQuery.support.placeholder=!1,"placeholder"in e&&(jQuery.support.placeholder=!0)}),function(e){"use strict";e(function(){e.support.placeholder||e("[placeholder]").focus(function(){var t=e(this);t.val()===t.attr("placeholder")&&t.val("").removeClass("placeholder")}).blur(function(){var t=e(this);(""===t.val()||t.val()===t.attr("placeholder"))&&t.addClass("placeholder").val(t.attr("placeholder"))}).blur().parents("form").submit(function(){e(this).find("[placeholder]").each(function(){var t=e(this);t.val()===t.attr("placeholder")&&t.val("")})})})}(jQuery),$j(document).ready(function(){$j(".aboutHeaderImage").slideshow(),$j(".jobsValuesButton").each(function(){$j(this).hoverSwitch()})}),function(){var e,t=function(){e=$j(this),n(e)},n=function(e){e.hover(function(){var t=$j(document).find(".jobsValues.js-hoverSwitchHelper-active"),n=$j(".jobsValues#"+e.attr("id"));n.length&&(t.removeClass("js-hoverSwitchHelper-active"),n.addClass("js-hoverSwitchHelper-active"))})};$j.fn.hoverSwitch=function(){return t.apply(this)}}($j),function(){var e,t,n=5e3,i=function(){e=$j(this),t=setTimeout(function(){o(e)},n)},o=function(e){var i,r=e.find("img.active");0==r.length&&(r=e.find("img:last")),i=r.next("img").length?r.next("img"):e.find("img:first"),r.addClass("last-active"),i.css({opacity:0}),i.addClass("active"),i.animate({opacity:1},n/4,function(){r.removeClass("active last-active"),t=setTimeout(function(){o(e)},n)})};$j.fn.slideshow=function(){return i.apply(this)}}($j),document.observe("dom:loaded",function(){$("usersCreatedRecently")&&($("selectButtons").show(),$("selectSuspicious").observe("click",function(){select_all_suspicious_users()}),$("selectNone").observe("click",function(){deselect_all_users()}))}),$j(function(){$j("#deleteShelvesFilter").search("#deleteShelvesList > li > label","#deleteShelvesFilter",function(e){e.empty(function(){$j("#deleteShelvesList > li").addClass("initiallyHidden")}),e.reset(function(){$j("#deleteShelvesList > li").removeClass("initiallyHidden")}),e.results(function(e){$j("#deleteShelvesList > li").addClass("initiallyHidden"),e.parent().removeClass("initiallyHidden")})}),$j(".spamResultItemCheckbox").change(function(){updateSpamResultItemStyling()}),$j(".spamSearchSelectAll").change(function(){$j(".spamResultItemCheckbox").prop("checked",this.checked),$j(".spamSearchSelectAll").prop("checked",this.checked),updateSpamResultItemStyling()}),$j("#spamDeletionForm").submit(function(){var e=$j(".spamResultItemCheckbox:checked").length,t="You are about to delete ";return t+=e,t+=1==e?" item":" items",1==confirm(t)}),updateSpamResultItemStyling()}),$j(document).on("click","#deleteUsersButton",function(e){var t="",n=$j(document.createElement("textarea")).attr("name","multi_delete_note").attr("rows","4").attr("id","multi_delete_note").attr("cols","45"),i=$j(document.createElement("input")).attr("type","button").attr("value","Delete Users").attr("id","submitMultiDelete").attr("class","button");return e.preventDefault(),0===$j(".jsUserDeletionCheckbox:checkbox:checked").length?void alert("No users selected."):void((!$j(".jsToggleDeleteSockPuppet").is(":checked")||confirm("Please confirm that these are sock puppet users, and you want delete all content they have created."))&&(0==$j(".jsToggleDeleteSpam:checkbox:checked").length||confirm("Please confirm that these are spam users, and you want to delete all content that they have created. Please also confirm that you are not deleting librarians using this tool."))&&($j(".jsUserDeletionCheckbox:checkbox:checked").each(function(e,n){t+=$j(n).attr("data_user_name")+", "}),t=t.slice(0,-2),Lightbox.showBoxString("<h2>Confirm Multi-User Deletion</h2><br><b>Please enter a deletion reason:</b><br><br>"+n[0].outerHTML+"<br><br><b>Users to delete:</b> "+t+"<br><br>"+i[0].outerHTML+"<br><br><a href='#' id='cancelMultiDeleteLightbox'>Cancel</a>",500)))}),$j(document).on("click","#cancelMultiDeleteLightbox",function(e){e.preventDefault(),Lightbox.hideBox()}),$j(document).on("click","#submitMultiDelete",function(){$j("#multi_delete_note").hide(),$j("#deleteUsersForm").append($j("#multi_delete_note")),$j("#deleteUsersForm").trigger("submit",[!0])}),$j(document).on("click",".jsUserDeletionCheckbox:checkbox",function(){var e=$j(".jsUserDeletionCheckbox:checkbox:checked").length;0===e?$j("#userSelectAllToDeleteCheckbox").prop("indeterminate",!1).prop("checked",!1):e===$j(".jsUserDeletionCheckbox").length?$j("#userSelectAllToDeleteCheckbox").prop("indeterminate",!1).prop("checked",!0):$j("#userSelectAllToDeleteCheckbox").prop("indeterminate",!0).prop("checked",!1)}),$j(document).on("click","#userSelectAllToDeleteCheckbox",function(){$j(".jsUserDeletionCheckbox:checkbox:checked").length===$j(".jsUserDeletionCheckbox:checkbox").length?($j(".jsUserDeletionCheckbox:checkbox").prop("checked",!1),$j("#userSelectAllToDeleteCheckbox").prop("checked",!1)):($j(".jsUserDeletionCheckbox:checkbox").prop("checked",!0),$j("#userSelectAllToDeleteCheckbox").prop("checked",!0))}),$j(document).on("change","input.jsToggleDeleteSpam",function(e){$j(e.target).prop("checked")?($j("table.adminRecords .deleteSingleUser").hide(),$j("table.adminRecords .deleteSingleSpamUser").show(),$j("table.adminRecords .deleteSingleSockPuppet").hide(),$j(".jsToggleDeleteSockPuppet").prop("checked",!1)):($j("table.adminRecords .deleteSingleSpamUser").hide(),$j("table.adminRecords .deleteSingleUser").show())}),$j(document).on("change","input.jsToggleDeleteSockPuppet",function(e){$j(e.target).prop("checked")?($j("table.adminRecords .deleteSingleUser").hide(),$j("table.adminRecords .deleteSingleSpamUser").hide(),$j("table.adminRecords .deleteSingleSockPuppet").show(),$j(".jsToggleDeleteSpam").prop("checked",!1)):($j("table.adminRecords .deleteSingleUser").show(),$j("table.adminRecords .deleteSingleSockPuppet").hide())}),$j(document).on("click",".js-notifyFlagger",function(){var e=$j(this).data("admin-action"),t=$j(this).data("queued-item-id"),n=$j(this).data("ui");"show"===n?$j("#message_field-"+e+"-"+t).show():"hide"===n?$j("#message_field-"+e+"-"+t).hide():$j("#message_field-"+e+"-"+t).toggle()}),$j(function(){if(0==window.location.pathname.search("/book_blogger_award")){disable_subcategories();var e=$j("#categories input:checked").val();e&&set_subcategory_for_category(e),$j("#categories input").change(function(e){set_subcategory_for_category($j(e.target).val())}),$j(".pagination").length>0&&($j(".pagination").hide(),InfiniteScroll.start({loading:"infiniteLoading",afterLoad:function(e){$j("#entries").append(e.responseText)}})),$j(document).delegate("a.castVote","click",function(e){handle_vote_click(e,!1)}),$j(document).delegate("a.changeVote","click",function(e){handle_vote_click(e,!0)}),$j("#awardWidgetMarkup").select()}});var grBookContextSelection={populateBookSelectForQuotes:function(){grBookContextSelection.populateBookSelectOptions("quote_author_name","bookSelect"),grBookContextSelection.clearOptionsFrom($j("#bookChapterSelect"))},populateBookSelectOptions:function(e,t){var n,i,o,r,s,a,l,c,u=$j("#"+t),h=u.find("select");n=$j("#"+e),i=n.val(),o=$j("#authorSelectedUrl").val()+"?author="+encodeURI(i),r=$j.get(o),r.done(function(e){grBookContextSelection.clearOptionsFrom(u),e&&0!==e.length?(l=1===e.length?"one book":e.length+" books",$j("#bookSearchResults").text("We found "+l+" by "+i+"."),s=new Option("Select",null),h.append(s),$j.each(e,function(e,t){c=t.title.length>40?t.title.substring(0,37)+"...":t.title,a=new Option(c,t.id),h.append(a)}),u.removeClass("initiallyHidden")):u.addClass("initiallyHidden")})},clearOptionsFrom:function(e){var t=e.find("select");t.children("option").remove(),e.addClass("initiallyHidden")},populateBookChapterSelectOptions:function(e){var t,n=$j("#bookChapterSelect"),i=n.find("select");grBookContextSelection.clearOptionsFrom(n),t=e.is("span")?e.attr("book_id"):e.val();var o=$j("#bookSelectedUrl").val()+"?book="+t,r=$j.get(o);r.done(function(e){if(0===e.length)n.addClass("initiallyHidden");else{var t=new Option("Select",null);i.append(t),$j.each(e,function(e,t){var n=new Option(t.chapter_name,t.percent);i.append(n)}),n.removeClass("initiallyHidden")}})},showBookAndBookChapterSelectFields:function(){$j("#bookIdSelect option").size()>1&&$j("#bookSelect").removeClass("initiallyHidden"),$j("#bookLocationSelect option").size()>1&&$j("#bookChapterSelect").removeClass("initiallyHidden")},populateBookChapterSelectForTopics:function(e,t){var n=$j(".acItem.auto_complete_selected").children(".ac_book");grBookContextSelection.populateBookChapterSelectOptions(n)},clearBookChapterSelectOptionsForTopics:function(){grBookContextSelection.clearOptionsFrom($j("#bookChapterSelect"))}};$j(document).ready(function(){$j("#quote_body").focus(),grBookContextSelection.showBookAndBookChapterSelectFields();var e=$j(".sharingToggle"),t=e.children("input");$j("#bookIdSelect").on("change",function(n){bookIdField=$j(this),grBookContextSelection.populateBookChapterSelectOptions(bookIdField);var i="None"===bookIdField.val()||null===bookIdField.val();e.toggleClass("disabled",i),t.prop("disabled",i)}),$j("#quote_author_name").change(function(e){grBookContextSelection.populateBookSelectForQuotes()})});var refreshBookChapterEditButtons=function(){$j(".deleteExistingBookChapterButton").on("click",function(e){var t=$j(this);e.preventDefault();var n=$j.post(t.attr("href"),{_method:"delete"});n.done(function(){t.closest("tr").remove(),InlineFlash.showNotice("Chapter deleted")})}),$j(".deleteNewBookChapterButton").on("click",function(e){var t=$j(this);e.preventDefault();var n,i,o=t.closest("tr");o.hasClass("even")?(n="even",i="odd"):(n="odd",i="even");var r=o.nextAll(".chapter");r.removeClass("odd even"),r.filter(":even").addClass(n),r.filter(":odd").addClass(i),o.remove()})},enableAddBookChapterButton=function(){$j(".addNewBookChapterButton").on("click",function(e){var t=$j("#chapterEditTable .chapter").length,n=$j("#chapterEditTable .newChapter"),i=n.clone(!0);lastRow=$j("#chapterEditTable tr.chapter").last(),lastRow.hasClass("even")?n.addClass("odd"):n.addClass("even"),n.removeClass("newChapter hidden").addClass("chapter"),chapterRowId="chapterRow"+t,n.attr("id",chapterRowId),n.children("#chapterNumber").append(t),n.children("td").each(function(){var e=$j(this).children("input"),n=e.attr("name");newName="book_chapters["+t+"]["+n+"]",e.attr("name",newName)}),$j("#chapterEditTable .chapter:last").after(i)})},enableMakeDefaultChapterBookLink=function(){$j("#makeDefaultChapterBookLink").on("click",function(e){var t=$j(this);e.preventDefault();var n=$j.post(t.attr("href"),{_method:"post"});n.done(function(){t.replaceWith("This book's chapters are now the default for the associated work.")})})};$j(document).ready(function(){refreshBookChapterEditButtons(),enableAddBookChapterButton(),enableMakeDefaultChapterBookLink()}),$j(window).load(function(){$gr.shared.bookCarousel.attachTo(".bookCarousel")}),$j(function(){$gr.shared.newsfeedUpdateUI.attachTo(".js-newsfeed-container"),$gr.shared.attachNewsfeedComponents(),$gr.communityQA.readerQAForm.attachTo(".js-readerQAForm"),$gr.communityQA.shareToggle.attachTo(".js-shareToggle"),$gr.communityQA.facebookTimelinePoster.attachTo(".js-facebookTimelinePoster"),$gr.communityQA.editQAMessageForm.attachTo(".js-editQAMessageForm"),$gr.shared.notification.attachTo(".js-standalone-notification"),LoadMore.attachTo(".jsLoadMoreAnswered",{loadMoreContainerSelector:"#loadMoreContainerAnsweredQuestions",loadMoreActionSelector:".loadMoreActionAnsweredQuestions",loadMoreSelector:".jsLoadMoreAnswered"}),LoadMore.attachTo(".jsLoadMoreUnanswered",{loadMoreContainerSelector:"#loadMoreContainerUnansweredQuestions",loadMoreActionSelector:".loadMoreActionUnansweredQuestions",loadMoreSelector:"jsLoadMoreUnanswered"}),$gr.shared.toggleQaForm.attachTo(document),$gr.shared.authorDashboardQA.attachTo(".js-authorDashboardQA"),$gr.shared.editInPlaceController.attachTo(".communityAnswer.js-editInPlace",{editableElementSelector:".communityAnswerText",highlightElementSelector:".communityAnswerText",elementsToHideSelectors:".communityAnswererName, .communityAnswerText, .communityAnswerFooter"}),$gr.shared.editInPlaceController.attachTo("#helpBox.js-editInPlace",{editableElementSelector:".helpBoxTextContainer",highlightElementSelector:".helpBoxTextContainer",elementsToHideSelectors:".js-editInPlaceEnableAction"}),$gr.shared.dismissModuleUI.attachTo(".js-welcomeBanner",{dismissButtonSelector:".js-dismissWelcomeBanner",userPrefName:"show_welcome_banner",newPrefValue:0}),$gr.shared.editorialStoryForm.attachTo(".js-editorialStoryForm"),$gr.shared.audibleSampleButton.attachTo(window),$gr.shared.favoriteAuthor.attachTo(".authorDropdownMenu"),$gr.shared.notificationBanner.attachTo("#notificationBanner"),$gr.shared.reviewStatsSort.attachTo(".js-reviewStatsSort"),$gr.shared.reviewStatsChart.attachTo(".js-reviewStatsChart"),$gr.shared.asyncPreviewButton.attachTo(".asyncPreviewButtonContainer"),$gr.shared.asyncGlideButton.attachTo("#asyncBuyButtonContainer"),$gr.shared.authorAnswersSort.attachTo(".js-authorAnswersSort"),$gr.shared.inAppNotification.attachTo(".notificationWrapper"),$gr.shared.amazonPurchasesBanner.attachTo(".js-amazonRateBooksHeader"),$gr.shared.twitterDialog.attachTo(".twitterDialog"),$gr.shared.twitterCallbacks.attachTo(".mainContentContainer"),$gr.shared.confirmModal.attachTo(".js-confirmModal"),$gr.shared.modal.attachTo(".js-modal"),$gr.shared.modalTrigger.attachTo(".js-modalTrigger"),$gr.shared.checkBoxForm.attachTo(".js-genresForm",{checkedClass:"genreButtonChecked",checkBoxContainerSelector:".genreButton"}),$gr.shared.newsfeedTracking.attachTo(document,{trackingContainerSelector:".newsfeedUpdates"}),$gr.shared.previewableNewsfeedStoryForm.attachTo(".js-previewableNewsfeedStoryForm"),$gr.shared.challenge.attachTo(".challengeSteps"),$gr.shared.dataStoreUserPreferences.attachTo(document),$gr.shared.formBoxChecker.attachTo(".js-formBoxChecker",{massCheckAll:!0}),$gr.shared.openGlidePopup.attachTo(".glideButton"),$gr.shared.lazilyLoadedGlidePopup.attachTo(".js-lazyGlideContainer"),$gr.shared.favoriteGenre.attachTo(".js-favoriteGenre"),$gr.shared.reviewDraftDataCollection.attachTo(".js-reviewUserText"),$gr.shared.ratingDistTooltip.attachTo(".js-ratingDistTooltip"),$gr.shared.readingNote.attachTo(".js-readingNote"),$gr.shared.readingNote.attachTo(".js-readingNotesBanner"),$gr.shared.giveawayBookFindWidget.attachTo("#giveawayBookFindWidget"),$gr.shared.videoInline.attachTo(".js-videoInline")}),$j(document).on("lazyload:complete",function(){$gr.communityQA.readerQAForm.attachTo(".js-readerQAForm"),$gr.communityQA.shareToggle.attachTo(".js-shareToggle")}),$j(document).ready(function(){LoadMore.attachTo(".jsLoadMore")}),$gr.shared.attachNewsfeedComponents=function(e){e="undefined"==typeof e?"":e,$gr.shared.newsfeedNav.attachTo(e+".js-newsfeedNav"),$gr.shared.updateFiltersForm.attachTo(e+".js-updateFiltersForm"),$gr.shared.checkBoxForm.attachTo(e+".js-genresForm",{checkedClass:"genreButtonChecked",checkBoxContainerSelector:".genreButton"}),$gr.shared.relatedWorks.attachTo(e+".js-relatedWorksTrigger"),LoadMore.attachTo(e+".jsLoadMoreUpdates",{loadMoreContainerSelector:"#loadMoreContainerUpdates",loadMoreActionSelector:".loadMoreActionUpdates",loadMoreSelector:".jsLoadMoreUpdates"}),$gr.shared.newsfeedMenu.attachTo(".js-newsfeedStoryDropdown"),$gr.shared.tooltip.attachTo(e+".js-tooltipTrigger"),$gr.shared.dataTooltip.attachTo(e+".js-dataTooltip"),$gr.shared.modal.attachTo(e+".js-modal"),$gr.shared.modalTrigger.attachTo(e+".js-modalTrigger"),$gr.shared.followSuggestedAuthor.attachTo(e+".js-followSuggestedAuthor"),$gr.shared.authorFollow.attachTo(e+".js-AuthorFollow"),$gr.shared.libraryExport.attachTo(e+".js-LibraryExport"),$gr.shared.confirmNilReadAt.attachTo(e+".js-confirmNilReadAt"),$gr.shared.readingYear.attachTo(e+".js-readingYear")};var EnableButtons={enableButtons:function(e){return e.observe("click",function(t){$(e).up().request(),t.stop()}),$(e)}};Element.addMethods(EnableButtons),Element.enableButtons=function(e){e.observe("click",function(t){$(e).up("form").request(),t.stop()})},Element.addMethods({enableButtons:Element.enableButtons}),document.observe("dom:loaded",function(){enableAll(".relatedVoteAction"),enableAll(".ignoreRelatedWorkAction"),enableAll(".userNotInterestedWorkAction")}),$j(document).ready(function(){$j(".eventResponseForm").bind("ajax:beforeSend",function(){$j(this).find(".loadingImage").show()}).bind("ajax:success",function(e,t){var n=$j(this);n.closest(".respondEvent").hide(),n.find(".loadingImage").hide(),n.closest(".respondEvent").parent().find(".respondEventStatus").html(t)})}),$j(function(){function e(e){var t=e.parent(),n=e.closest(".expandableContainer");t.hide(),t.hasClass("fullContent")?n.find(".truncatedContent").show():n.find(".fullContent").show()}$j(document).on("click",".jsHide, .jsShow",function(t){t.preventDefault(),e($j(t.target))})}),$grfb=function(){var e="email, user_friends",t="publish_actions",n={grSession:!1,suppressAutoLogin:!1},i=$j.Deferred();window.fbAsyncInit=function(){FB.init({appId:n.appId,
// This is what makes login work! The cookie contains a signed request;
cookie:"localhost"===location.hostname?" ":!0,
// parse any social plugins on the page (misnomer! not related to XFBML!)
xfbml:!0,version:"v2.0"}),FB.getLoginStatus(function(e){$grfb.auth=e,i.resolveWith($grfb)}),FB.Event.subscribe("auth.authResponseChange",function(e){$grfb.auth=e})};var o=function(e){$j.extend(n,e),function(e,t,n){var i,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.src="//connect.facebook.net/en_US/sdk.js",o.parentNode.insertBefore(i,o))}(document,"script","facebook-jssdk")},r=function(o){o="object"==typeof o?o:{},o.withWritePermission=!0;var r,s,a=$j.Deferred(),c=e,u=n.publishEnabled;return o.withWritePermission&&(c+=","+t),FB.login(function(e){"object"==typeof e&&"connected"===e.status?a.resolve(e):a.reject(e)},{scope:c,auth_type:"rerequest"}),i.done(function(){"connected"!==this.auth.status||o.withWritePermission?n.publishEnabled=null:
// Warning! This might not be good enough; this will fail if the user
a.resolve(this.auth)}),a.done(function(){o.hasOwnProperty("trackingId")&&(r=$j.post("/track/track",{tid:o.trackingId})),n.grSession&&o.withWritePermission&&u===!1&&(s=$j.Deferred(),l().fail(function(){s.resolve()}).done(function(){
// they agreed! make sure the server knows
$j.post("/user/update_preferences",{user:{fb_cog_enabled:1}}).always(function(){s.resolve()})})),o.hasOwnProperty("redirect")&&$j.when(r,s).always(function(){window.location.href=o.redirect})}),a.promise()},s=function(){var e=$j.Deferred();return i.done(function(){"connected"===this.auth.status?FB.logout(function(){e.resolve()}):e.resolve()}),e.promise()},a=function(e){e="object"==typeof e?e:{};var t=$j.Deferred();if(n.publishEnabled===!0)t.resolve();else{var i={};i.withWritePermission=!0,r(i).always(function(){l().fail(function(){t.reject()}).done(function(){t.resolve()})})}return t.done(function(){e.hasOwnProperty("redirect")&&(window.location.href=e.redirect)}),t.promise()},l=function(){var e=$j.Deferred();return i.done(function(){"connected"===this.auth.status?n.publishEnabled===!0?e.resolve():n.publishEnabled===!1?e.reject():FB.api("/me/permissions",function(n){n.hasOwnProperty("data")?(write_perm_hash=$j(n.data).filter(function(e,n){return n.permission==t}),write_perm_hash.length>0&&"granted"==write_perm_hash[0].status?e.resolve():e.reject()):e.reject()}):e.reject()}),e.done(function(){n.publishEnabled=!0}).fail(function(){n.publishEnabled=!1}),e.promise()},c=function(e,t){t="object"==typeof t?t:{};var n=$j.Deferred(),i=e.split(","),o={scope:e,return_scopes:!0,auth_type:"rerequest"},r=function(e){if(e.hasOwnProperty("authResponse")&&e.authResponse.hasOwnProperty("grantedScopes")){var t=e.authResponse.grantedScopes.split(","),o=!0;$j.each(i,function(e,n){$j.inArray(n,t)<=-1&&(o=!1)}),o?n.resolve():n.reject()}else n.reject()};return FB.login(r,o),n.done(function(){t.hasOwnProperty("redirect")&&(window.location.href=t.redirect)}),n.fail(function(){t.hasOwnProperty("declinedRedirect")&&(window.location.href=t.declinedRedirect)}),n.promise()},u=function(){var e=$j.Deferred();return i.done(function(){"connected"===this.auth.status?FB.api("/me/permissions","DELETE",function(t){t===!0?(FB.getLoginStatus(),n.publishEnabled=!1,$j.post("/facebook_users/destroy").done(function(){e.resolve()}).fail(function(){e.reject()})):e.reject()}):"not_authorized"===this.auth.status?$j.post("/facebook_users/destroy").done(function(){e.resolve()}).fail(function(){e.reject()}):e.reject()}),e.promise()},h=function(e){var t=$j.Deferred();return i.done(function(){e.method="feed",FB.ui(e,function(e){t.resolve(e)})}),t.done(function(t){if(t&&"object"==typeof t&&t.hasOwnProperty("post_id")){var n;n=e.hasOwnProperty("trackingId")?e.trackingId:"fb_"+e.resource_type+"_feed_form_opp",$j.post("/track/track",{tid:n})}}),t.promise()},d=function(e){var t=$j.Deferred();return i.done(function(){e.method="send",FB.ui(e,function(e){e&&"object"==typeof e&&e.hasOwnProperty("success")?t.resolve(e):t.reject(e)})}),t.promise()},f=function(e){var t=$j.Deferred();return i.done(function(){FB.ui({method:"pagetab"},function(n){if(n&&"object"==typeof n&&n.hasOwnProperty("tabs_added")&&0!==n.tabs_added.length){for(facebook_page_id in n.tabs_added)if(n.tabs_added.hasOwnProperty(facebook_page_id)&&"object"==typeof e){var i={"facebook_page[facebook_page_id]":facebook_page_id,"facebook_page[page_type]":e.pageType};"g"===e.pageType&&(i["facebook_page[group_id]"]=e.groupId),$j.post("/facebook/page_tab",i)}t.resolve(n)}else t.reject(n)})}),t.promise()};return i.done(function(){var e=!0;window.Mobvious&&(e="mobile"!==window.Mobvious.device_type),n.grSession||n.suppressAutoLogin||"connected"===this.auth.status&&(e&&Lightbox.showBoxByID("fbSigninNotification"),$j.post("/track/track",{tid:"fb_auto_login"}).fail(function(){e&&Lightbox.hideBox()}).done(function(){location.reload()}))}),i.done(function(){n.publishEnabled=n.serverPublishEnabled}),i.done(function(){"not_authorized"===this.auth.status&&n.serverFBUser&&(n.brokenFbConnectionTracked||$j.post("/facebook_users/temp_track_broken_fb_connection"))}),i.done(function(){var e=$j.Deferred();"connected"===this.auth.status&&n.grSession&&!n.publishPermissionVerified&&(n.publishEnabled=null,l().done(function(){n.serverPublishEnabled?e.resolve():$j.post("/user/update_preferences",{user:{fb_cog_enabled:1},auto_repair:!0}).done(function(){e.resolve()})}).fail(function(){n.serverPublishEnabled?$j.post("/user/update_preferences",{user:{fb_cog_enabled:0},auto_repair:!0}).done(function(){e.resolve()}):e.resolve()})),e.done(function(){$j.post("/facebook_users/permissions_verified")}),i.done(function(){return"true"!==Cookies.get("fbl")?!1:"connected"===this.auth.status?!1:void $j.post("/user/sign_out?facebook_auto_logout=true").done(function(){var e=encodeURIComponent(location.pathname+location.search);window.location.href="/user/sign_in?returnurl="+e})})}),{init:i.promise(),initialize:o,login:r,logout:s,ensurePublishPermission:a,ensurePermission:c,checkPublishPermission:l,disconnect:u,feedDialog:h,sendDialog:d,pageTabDialog:f}}(),$j(document).on("click",".fbjsLogin",function(e){var t=$j(this),n=t.data();if(!n.hasOwnProperty("redirect")){var i=t.attr("href");""!==i&&(n.redirect=i)}$grfb.login(n),e.preventDefault()}),$j(document).on("click",".fbEnsurePermissions",function(e){var t=$j(this),n=t.data(),i=t.attr("href");n.hasOwnProperty("redirect")||""!==i&&(n.redirect=i),n.hasOwnProperty("permissions")?$grfb.ensurePermission(n.permissions,n):$grfb.login(n),e.preventDefault()}),$j(document).on("click",".fbjsLogout",function(e){var t=$grfb.logout(),n=$j(this).attr("href");""!==n&&t.done(function(){window.location.href=n}),e.preventDefault()}),$j(document).on("change",".fbjsPublishToggle",function(e){var t=$j(this),n=t.children("input[type=checkbox]"),i=n.is(":checked");t.toggleClass("checked",i),i&&$grfb.ensurePublishPermission().fail(function(){t.removeClass("checked"),n.prop("checked",!1)})}),$j(document).ready(function(){$j("#auto_add_fb_friends.autosave").click(function(){$j.post("/user/toggle_auto_add_fb_friends_pref",{auto_add_fb_friends:$j("#auto_add_fb_friends").is(":checked")}).success(function(){$j("#pref_status").html("Preference saved.").effect("highlight",{},2e3)}).error(function(){$j("#pref_status").html("There was an error saving your preference.").effect("highlight",{},2e3)})}),$j("body").on("submit","#confirmAutoAddForm",function(e){var t=$j(e.target);$j("#user_auto_add_fb_friends").prop("checked","true"==t.find("#auto_add_fb_friends_confirm").val()),$j.post(t.attr("action"),t.serialize()).success(function(){Lightbox.hideBox()}).error(function(){alert("There was an error saving your preference. Please try again.")}),e.preventDefault()})}),$j(document).ready(function(){$j(".js-choiceAdminPullDownNavigator").on("change",function(e){var t=e.target.value;$j.ajax({url:"/choiceawards/admin",type:"GET",dataType:"script",data:{slug:t}})})}),$gr.giveaway=function(){var e="required",t="disabled",n="checked",i=function(){var t=$j("<label>",{"for":"giveaway_book_id"});$j("#giveaway_book_isbn").val("").removeAttr(e),$j("#giveawayIsbnContainer").hide(),$j("#giveawayBookIdContainer").css("display","inline-block"),$j("#giveaway_book_id").prop(e,e),$j("#isbnTooltip").hide(),t.text("Book ID").attr({id:"giveawayBookIdLabel"}),$j("#giveawayBookIsbnLabel").replaceWith(t)},o=function(){var t=$j("<label>",{"for":"giveaway_book_isbn"});$j("#giveaway_book_id").val("").removeAttr(e),$j("#giveawayBookIdContainer").hide(),$j("#giveawayIsbnContainer").css("display","inline-block"),$j("#giveaway_book_isbn").prop(e,e),$j("#isbnTooltip").show(),t.text("ISBN/ISBN13").attr({id:"giveawayBookIsbnLabel"}),$j("#giveawayBookIdLabel").replaceWith(t)},r=function(){this.checked?$j("#giveawayTermsContainer").find("[data-id=listingTermsLink]").click():$j("#giveawayDetailSubmitButton").prop(t,t)},s=function(){this.checked?$j("#giveawayTermsContainer").find("[data-id=editingTermsLink]").click():$j("#giveawayDetailSubmitButton").prop(t,t)},a=function(){this.checked?$j("#giveawayTermsContainer").find("[data-id=entryTermsLink]").click():$j("#giveawayEntrySubmitButton").prop(t,t)},l=function(){$j("#listingTermsCheckBox").prop(n,!0);var e=$j("#editingTermsCheckBox");(e.is(":checked")||!e.is(":visible"))&&$j("#giveawayDetailSubmitButton").removeProp(t)},c=function(){$j("#editingTermsCheckBox").prop(n,!0),$j("#listingTermsCheckBox").is(":checked")&&$j("#giveawayDetailSubmitButton").removeProp(t)},u=function(){$j("#entryTermsCheckBox").prop(n,!0),$j("#giveawayEntrySubmitButton").removeProp(t)};return{changeToBookId:i,changeToIsbn:o,showListingTermsDialog:r,showEditingTermsDialog:s,showEntryTermsDialog:a,checkListingTerms:l,checkEditingTerms:c,checkEntryTerms:u}}(),$j(document).ready(function(){$j("#giveawayBookIdSwitchLink").click($gr.giveaway.changeToBookId),$j("#giveawayBookIsbnSwitchLink").click($gr.giveaway.changeToIsbn),$j("#listingTermsCheckBox").click($gr.giveaway.showListingTermsDialog),$j("#editingTermsCheckBox").click($gr.giveaway.showEditingTermsDialog),$j("#entryTermsCheckBox").click($gr.giveaway.showEntryTermsDialog),$j("#giveawayTermsContainer").find("[data-id=listingTermsLink]").click($gr.giveaway.checkListingTerms),$j("#giveawayTermsContainer").find("[data-id=editingTermsLink]").click($gr.giveaway.checkEditingTerms),$j("#giveawayTermsContainer").find("[data-id=entryTermsLink]").click($gr.giveaway.checkEntryTerms),""!==$j("#giveaway_book_id").val()?$gr.giveaway.changeToBookId():$gr.giveaway.changeToIsbn()}),void 0==window.gr&&(window.gr={}),window.gr.toggleStatusLink=function(e,t){var t=t||{},n=t.target||$$($(e).getAttribute("rel")).first(),i=$(n).down(".status_form_contents");!$(n).visible()||i&&!i.visible()?(t.callback instanceof Function&&t.callback.apply(e,t),this.openStatusLink(e)):this.closeStatusLink(e)},window.gr.closeStatusLink=function(e,t){var t=t||{},n=t.target||$$($(e).getAttribute("rel")).first();$(n).hide(),$(e).removeClassName("open")},window.gr.openStatusLink=function(e,t){var t=t||{},n=t.target||$$($(e).getAttribute("rel")).first(),i=$(e).up(".status_editor");i&&i.select(".toggleLink.open").each(function(e){gr.closeStatusLink(e)}),$(n).show();var o=$(n).down(".status_form_contents");o&&o.show(),$(e).addClassName("open")},window.gr.install_count_chars=function(e,t){var n="none"===$j(t).css("display");$j(document).on("keypress",e,function(e){n&&($j(t).show(),n=!1),window.countChars(e,t)})},window.gr.makeBigger=function(e){var t=$$(e)[0],n=parseInt(t.getStyle("height"));t.setStyle({height:n+200+"px"})},void 0==window.gr&&(window.gr={}),window.gr.RecommendedUIHelper=function(e){var t=this;return t.clear=function(){t.id_input().value="",t.name_input().value="",t.ui().hide(),t.autocomplete_wrapper().show(),t.name_input().focus()},t.clear_action=function(){return void 0===t._clear_action&&(t._clear_action=$$(".reviewForm .ui_recommended .clear_action").first()),t._clear_action},t.member=function(){return void 0===t._member&&(t._member=$$(".reviewForm .ui_recommended .member").first()),t._member},t.member_status=function(){return void 0===t._member_status&&(t._member_status=$$(".reviewForm .ui_recommended .member_status").first()),t._member_status},t.id_input=function(){return void 0===t._id_input&&(t._id_input=$$(".reviewForm #review_recommender_user_id1").first()),t._id_input},t.name_input=function(){return void 0===t._name_input&&(t._name_input=$$(".reviewForm #review_recommender_user_name1").first()),t._name_input},t.autocomplete_wrapper=function(){return void 0===t._ac&&(t._ac=$$(".reviewForm .autocomplete").first()),t._ac},t.ui=function(){return void 0===t._ui&&(t._ui=$$(".reviewForm .ui_recommended").first()),t._ui},t.after_update_element=function(e,n){t.id_input().value=n.id,t.id_input().setAttribute("id_for_name",n.innerHTML)},t.set_or_invalidate_id=function(){var e=!0;try{e=t.autocompleter.getCurrentEntry(),t.after_update_element(t.autocompleter.element,e)}catch(n){}t.id_input().getAttribute("id_for_name")!==t.name_input().value&&(t.id_input().value="")},t.non_member_entry=function(){t.autocomplete_wrapper().hide(),t.ui().show(),t.member().hide(),t.ui().select(".clear_action").first().show();var e=t.ui().select(".non_member").first();e.update(t.name_input().value),e.show(),t.id_input().value="",t.member_status().update("")},t.member_entry=function(){t.autocomplete_wrapper().hide(),t.ui().show(),t.ui().select(".non_member").first().hide(),t.ui().select(".clear_action").first().show(),t.member().update(t.name_input().value),t.member().setAttribute("href","/user/show/"+t.id_input().value),t.member().show(),t.member_status().update("(goodreads)")},t.on_focus_lost=function(){setTimeout(function(){0!=t.name_input().value&&(t.set_or_invalidate_id(),0==t.id_input().value?t.non_member_entry():t.member_entry())},100)},t.if_single_response_matches_name=function(e){if(t.autocompleter.hasFocus);else{var n=new Element("div").update(e.responseText);if(1===n.children[0].children.length){var i=n.children[0].children[0].id,o=n.children[0].children[0].innerHTML;t.name_input().value===o&&(t.id_input().value=i,t.member_entry())}}},!e.test==!0&&(t.autocompleter=new Ajax.Autocompleter("review_recommender_user_name1","review_recommender_user_name1_auto_complete",e.search_url,{indicator:"recommender_user_name1_indicator",afterUpdateElement:t.after_update_element,on200:t.if_single_response_matches_name}),Event.observe(t.name_input(),"blur",function(){t.on_focus_lost()}),Event.observe(t.clear_action(),"click",function(){t.clear()})),{clear_action:t.clear,no_member_found:t.non_member_entry,after_update_element:t.after_update_element,on_focus_lost:t.on_focus_lost}},$j(function(){$j("#showFlag").on("click",function(e){$j("#flagGroup").removeClass("initiallyHidden"),Lightbox.showBoxByID("flagGroup"),e.preventDefault()}),$j("#toggleFlagExplanation").on("click",function(e){$j("#flagExplanation").toggleClass("initiallyHidden"),e.preventDefault()})});var GroupJoiner=function(){var e={numGroupsShown:3,regpath:!1},t={},n=[],i=[],o="",r=!1,s=function(t,i,r){$j.extend(e,r),n=t,o=i,u().parent().addClass("groupsContainer").removeClass("initiallyHidden"),v(),m(),c(),a(),h()},a=function(){for(;i.length<e.numGroupsShown;){var t=n.pop();if(!t)break;i.push(t)}},l=function(e){var t=[];$j.each(i,function(n,i){i.status==e&&t.push(n)}),$j.each(t,function(e,t){var o=n.pop();o?i[t]=o:i.splice(t,1)})},c=function(){t={groupLi:_.template($j("#groupLiTemplate").html()),renderingGroupLi:_.template($j("#renderingGroupLiTemplate").html()),noResultsLi:_.template($j("#noResultsLiTemplate").html()),clear:'<div class="clear" />'}},u=function(){return $j("#"+o)},h=function(){var t=u();return 0===i.length?(t.html(g(null)),void(e.outOfGroupsCallback&&e.outOfGroupsCallback())):void $j.each(i,function(e,n){for(var i=$j(t.children("li")[e]);0!==i.length&&i.data("group-id")!==n.id;)i.remove(),i=$j(t.children("li")[e]);0===i.length?t.append(g(n)):n.invalidated&&(i.replaceWith(g(n)),n.invalidated=!1)})},d=function(e){$j.each(i,function(t,n){n.id===e&&(n.status="rendering",n.invalidated=!0)}),h(),r||(r=!0,window.setTimeout(function(){l("rendering"),h(),r=!1},1e3))},f=function(e){$j.post("/group/join/"+e,{user_subscription:{frequency:"D"}}),d(e)},p=function(t){e.regpath&&$j.post("/track_conversion_action",{event:"group_not_interested",options:{experiments:"join_groups",multiple:!0}}),d(t)},m=function(){u().on("click",".button",function(){f($j(this).data("group-id"))}),u().on("click",".groupNotInterested",function(){p($j(this).data("group-id"))})},g=function(e){return null===e?t.noResultsLi():"rendering"===e.status?t.renderingGroupLi(e):t.groupLi(e)},v=function(){u().empty()};return{init:s}},outOfGroupsCallback=function(){$j(".groupsContainer").addClass("initiallyHidden").removeClass("groupsContainer"),$j("#noMoreGroupsContainer").removeClass("initiallyHidden").addClass("groupsContainer")};$j(function(){var e="undefined"==typeof genreGroups||0==genreGroups.length,t="undefined"!=typeof featuredGroups;if(e&&t)GroupJoiner().init(featuredGroups,"midContainer",{numGroupsShown:4,outOfGroupsCallback:function(){$j.post("/track_conversion_action",{event:"featured_groups_only_exhausted",options:{experiments:"join_groups"}}),outOfGroupsCallback()},regpath:regpath});else if(t){var n=!1,i=!1;GroupJoiner().init(featuredGroups,"leftContainer",{regpath:regpath,outOfGroupsCallback:function(){$j.post("/track_conversion_action",{event:"featured_groups_exhausted",options:{experiments:"join_groups"}}),n=!0,n&&i&&outOfGroupsCallback()}}),GroupJoiner().init(genreGroups,"rightContainer",{regpath:regpath,outOfGroupsCallback:function(){$j.post("/track_conversion_action",{event:"genre_groups_exhausted",options:{experiments:"join_groups"}}),i=!0,n&&i&&outOfGroupsCallback()}})}}),Element.activateHideRatingsForRecs=function(e){e.observe("click",function(t){$(e).up("#ratingsForRecsBox").hide(),new Ajax.Request(e.href,{method:"GET"}),t.stop()})},Element.addMethods({activateHideRatingsForRecs:Element.activateHideRatingsForRecs}),document.observe("dom:loaded",function(){var e=$("hideRatingsForRecs");e&&e.activateHideRatingsForRecs()}),document.observe("dom:loaded",function(){$j(".readerImage").reflect({height:15}),$j("#signedOutHome .bookImgDiscovered").reflect({height:15})});var selected_quote=0;document.observe("dom:loaded",function(){null!=$("signedOutHome")&&null!=$("quotes")&&setInterval("changeQuote()",1e4)}),$j(function(){$gr.components.stickyHeader.init(),$j(".hidePurchasesModule").click(function(e){e.preventDefault(),$j.post("/user/update_preferences",{user:{show_amazon_import_prompt:0}}),$j(".amazonPurchasesModule").fadeOut()})}),$gr.hostedImage=function(){var e=20,t=2500,n="hostedImg",i=function(i,o){return o=o||{},e=o.retryMax||e,t=o.retryDelay||t,this.img=i,this.$img=$j(i),this.$img.removeProp("onload").removeProp("onerror"),this.$img.removeClass(n),this.src=this.$img.data("src"),this.style=this.$img.attr("style"),this.$loading=this.$img.next(),this.errorMsg=this.$img.data("error"),this.retryCount=0,this.$img.removeClass(n),this},o=function(){var e=this.src.indexOf("?")<0?"?":"&";return this.src+e+"v="+(new Date).getTime()},r=function(){if(this.retryCount++<=e)$gr.hostedImage.imageLoaded(this.img)?(clearInterval(this.timer),this.$loading.remove(),this.$img.show()):(this.img=document.createElement("img"),this.img.className=n+" escapedImg",this.img.style.display="none",this.img.src=this.s3Url(),this.$img.replaceWith(this.img),this.$img=$j(this.img),this.$img.attr("style",this.style));else{clearInterval(this.timer),this.$loading.remove();var t=document.createElement("span");t.innerHTML=this.errorMsg,this.$img.replaceWith(t)}},s=function(e,n){var o=this;return i.call(o,e,n),o.timer=setInterval(function(){r.apply(o)},t),o};return{load:s,s3Url:o,tryLoading:r}},$gr.hostedImage.imageLoaded=function(e){var t=!1;return t="object"==typeof e&&e.hasOwnProperty("tagName")&&"img"!==e.tagName.toLowerCase()?!1:void 0!==e.naturalWidth?e.naturalWidth>0:e.complete},function(e){e.fn.loadHostedImage=function(){if(!this.data("loading")){this.data("loading",!0);var e=$gr.hostedImage();return e.load(this.get(0)),this}}}(jQuery),function(e){"undefined"!=typeof e&&Ajax.Responders.register({onCreate:function(e){var t,n=$$("meta[name=request-id]")[0];n&&(t=n.readAttribute("content"),e.options.requestHeaders||(e.options.requestHeaders={}),e.options.requestHeaders["Related-Request-Id"]=t)}})}(Prototype),function(e){"undefined"!=typeof e&&e.ajaxPrefilter(function(t,n,i){var o=e("meta[name=request-id]").attr("content");o&&i.setRequestHeader("Related-Request-Id",o)})}(jQuery),$j(function(){likeComponent.init()});var likeComponent=function(){var e={likeActionSelector:".jsLike",loadingHtml:'<span class="loadingAnimation" style="display: inline"></span>'},t={},n=function(t){$j.extend(e,t),i()},i=function(){$j(document).on({"ajax:beforeSend":s,"ajax:success":a,"ajax:error":l},e.likeActionSelector)},o=function(){$j(document).off({"ajax:beforeSend":s,"ajax:success":a,"ajax:error":l},e.likeActionSelector)},r=function(e,t){var n=e.match(/ref=(.*_u?lk)/);n&&(n=n[1],n.match(/_lk/)?n=n.replace(/_lk/,"_ulk"):n.match(/_ulk/)&&(n=n.replace(/_ulk/,"_lk")),t.attr("href",t.attr("href")+"&ref="+n))},s=function(n){var i,o=$j(n.target),r=o.data("like-container-id");"undefined"==typeof r&&(i=o.text(),""!==i&&(t.bodyText=i),o.html(e.loadingHtml))},a=function(e,t,n){if($j.isPlainObject(t)){var i,o,s,a=$j(e.target),l=a.attr("class"),c=a.data("like-container-id");"undefined"!=typeof c?(o=$j(t.container_html),i=$j("#"+c),i.replaceWith(o),s=o.find("a.jsLike")):(o=$j(t.html),a.replaceWith(o),o.addClass(l),s=o),r(a.attr("href"),s)}},l=function(e,n,i){var o=$j(e.target),r=o.data("like-container-id");"undefined"==typeof r&&(InlineFlash.showError("We had a problem while liking the resource."),o.text(t.bodyText))};return{init:n,teardown:o}}();$j(function(){window.top!==window.self&&window.location.href.match(/show_mini/)&&($j("a").attr("target","_top"),$j("a").attr("href",function(e,t){var n=$j(parent.document.getElementsByTagName("iframe")[0]).data("url1");return"undefined"!=typeof n?n+t:t}))}),$j(document).on("ajax:beforeSend",".loadingLinkSpan",function(){var e=$j(this),t=e.find(".loadingLink");if(t.data("recycleElementId")){var n=$j("#"+t.data("recycleElementId"));n&&n.size()>0&&($j("body").append(n[0].outerHTML),n.hide())}e.find(".loadingLink, .loadingError").hide(),e.find(".loadingAnimation").show()}).on("ajax:success",".loadingLinkSpan",function(){var e=$j(this),t=e.find(".loadingLink");t&&(t.data("keepOnSuccess")&&(t.show(),t.data("resetOnSuccess")&&t.html("&nbsp;")),t.data("removeClassOnSuccess")&&t.removeClass(t.data("removeClassOnSuccess")),t.data("removeOnSuccess")&&$j(document).find("#"+t.data("removeOnSuccess")).remove()),e.find(".loadingAnimation, .loadingError").hide()}).on("ajax:error",".loadingLinkSpan",function(){var e=$j(this);e.find(".loadingError").html('<span class="error">ERROR</span> try again'),e.find(".loadingLink, .loadingError").show(),e.find(".loadingAnimation").hide()}).on("ajax:complete",".loadingLinkSpan",function(){var e=$j(this),t=e.find(".loadingLink");if(t.data("recyclePlacementId")){var n=$j("#"+t.data("recycleElementId"));n&&n.size()>0&&$j("#"+t.data("recyclePlacementId")).prepend(n)}}),$j(document).ready(function(){$j(".sendMessageToFriend").on("click",function(e){var t=$j(this).data("parentUserId"),n={channel:$j(this).data("channel"),variation:$j(this).data("variation"),parent_user_id:t};$grfb.sendDialog({link:"https://www.goodreads.com/user/sign_up?from_fb_send_dialog=true&i="+t}).done(function(){$j.post("/facebook_users/record_invitation_sent",n)}),e.preventDefault()})}),$j(function(){var e=function(){var e=$j("#sponsoredPoll");if(e.find("iframe").length>0){var t=$j("#sponsoredPoll [id*='div-gpt-ad'] iframe"),i=t.contents(),r=i.find("iframe");if(0===r.length)return o();var s=r.contents(),a=s.children().height();n(s.find("a")),e.height(a);var l=e.children("[id*='div-gpt-ad']");l.height(a);var c=l.children("[id*='google_ads']");c.height(a),t.height(a),r.height(a)}},t=function(){return $j(window.top.document).find("#sponsoredPoll").find("iframe").contents().find("iframe").data("url1")},n=function(e){trackingPrefix=t(),"undefined"==typeof trackingPrefix&&(trackingPrefix=""),e.attr("target","_top"),e.attr("href",function(e,t){return trackingPrefix+t})},i=function(e){var t={},i=$j(e);t.id=i.parents("#hpPoll").attr("data_poll_id"),t.answer=i.val(),t.featured=1,$j.post("/poll/vote",t).done(function(e){var t,i,o;o=window.top===window.self?window:window.top,o.Lightbox.showBoxString(e,700),o.$j("#homepagePoll").hide(),o.$j("#hpPollResults").show(),n(o.$j(".hpPollContainer a")),t=$j(e),t.find(".hpPollAd").remove(),i=o.$j("#hpPollResults"),i.html(""),i.append(t),o.$j("#hpPollResults .mediumLargeText").css("fontSize","14px"),o.FB.XFBML.parse()})},o=function(){var e={};e.poll=$j(this).attr("data_poll_id"),s(),$j.post("/poll/next_poll_ajax",e).done(function(e){var t=$j(e).attr("data_poll_id");$j("#homepagePoll").html(e),$j("#homepagePoll").show(),$j("#hpPollNextLink").attr("data_poll_id",t),$j("#hpPollResults").hide(),"true"!==$j("#hpPollContainer").attr("data_show_next")&&$j("#hpPollNextLink").hide()}),a()},r=function(){var e=$j("#featured_polls h2");$j("#homepagePoll .pollAnswers").length>0?e.text("Featured Poll"):$j("#homepagePoll #sponsoredPoll").length>0&&e.text("Sponsored Poll")},s=function(){var e=$j("#featured_polls h2");"Sponsored Poll"===e.text()&&e.text("Featured Poll")},a=function(){$j("#homepagePoll iframe").length>0||0===$j("#featured_polls").length&&$j("#hpPollContainer").length>0?$j("#hpPollContainer").on("click","input",function(){i(this)}):$j("#homepagePoll").on("click","input",function(){i(this)})};a(),$j("#hpPollNextLink").on("click",o),$j("#hpPollNextLink").on("click",s),$j("#hpPollNextLink").on("click",function(){$j("#homepagePoll").on("click","input",function(){i(this)})}),r(),$j(window).on("load",function(){if($j("#homepagePoll").length>0){var t=$j("#homepagePoll iframe"),n=$j("#homepagePoll .pollAnswers");t.length+n.length===0?o():e()}})}),"undefined"!=typeof Prototype&&Ajax.Responders.register({onCreate:function(e){var t=$$("meta[name=csrf-token]")[0];if(t){var n="X-CSRF-Token",i=t.readAttribute("content");e.options.requestHeaders||(e.options.requestHeaders={}),e.options.requestHeaders[n]=i}}}),$j(document).ready(function(){$j(".quizFriendInvite").on("ajax:success",function(){quizFriendInviteSuccess($j(this))})}),document.observe("dom:loaded",function(){activateRateBooksMoreGenreLnk()});var updateAmazonPurchaseImportUI=function(){$j(".js-amazonRateBooksHeader").fadeOut(),$j(".navRow a.actionLinkLite.selected").removeClass("selected"),$j(".js-amazonRateBooksStart").addClass("selected"),setGenre("amazon_purchase_import"),WantToRead.resetShelfMenuStored()};$j(function(){$j(".jsShowAdditionalGenres").on("click",function(e){var t=$j(this),n=$j(t.attr("href")),i=t.data("hide-text"),o=t.data("show-text");e.preventDefault(),n.hasClass("show")?(n.removeClass("show"),t.text(o)):(n.addClass("show"),t.text(i))}),$j(".jsBackToTop").on("click",function(e){e.preventDefault(),window.scroll(0,0)}),$j(".js-amazonRateBooksStart").on("click",function(){$j("#rateBooksList").html("<div class='loadingPageImage'></div>"),updateAmazonPurchaseImportUI()})});var updateAllStarsForBookID=function(e,t){var n=$j(".stars[data-resource-id='"+e+"']");n.each(function(e,n){$j(n).children().each(function(e,n){$j(n).removeClass("on"),$j(n).removeClass("off"),$j(n).addClass(e>=t?"off":"on")})})},colorStars=function(e,t){var n=e.find(".star");if(!e.hasClass("ignored"))for(var i=0;i<n.length;i++)t>=i?n[i].setAttribute("class","star on"):n[i].setAttribute("class","star off")},showRatingErrorMessage=function(e){e.parents(".wtrButtonContainer").find(".starsErrorTooltip").removeClass("hidden"),e.children("#starsSaving").remove(),e.children(".star").show()},showRelatedBooks=function(e){"undefined"!=typeof e.related_work_row&&$j("#"+e.row_id).after(e.related_work_row)},updateRateBooksHeaderAndFooter=function(e){var t=$j("#rateBooksHeader");t.find(".progress").length&&t.html(e.rate_books_header),$j("#rateBooksFooter").html(e.rate_books_footer)},updateWTRButton=function(e,t){var n=t.parents(".wtrButtonContainer");n.find(".wtrLeft").replaceWith(e.wtr_button_left);var i=n.find(".wtrRight");i.data("exclusive-shelf",e.review_read_status),WantToRead.setupShelfVisibilityInMenu(i),WantToRead.disablePrompts()},updateRatingStars=function(e,t){t.parents(".ratingStars").replaceWith(e.rating_stars)},submitStars=function(e,t,n){var i=$j("#reviewMessage"+e.data("resourceId")+"_"+n),o=$j("#successMessage"+e.data("resourceId")+"_"+n);if(!e||!e.hasClass("ignored")){var r="script",s={},a=$j(".regpathRateBooks").length>0,l=e.parents("#amazonPurchaseImport").length>0,c=e.parents(".secondaryWtrButton").length>0,u=a||l;u&&(s={format:"json",use_secondary_wtr:c},r="json");var h=e.find(".star").attr("ref"),d=e.parents(".wtrButtonContainer");$j.ajax({url:t,type:"POST",dataType:r,data:s,context:e,success:function(t){u&&$j.isPlainObject(t)&&(updateWTRButton(t,e),updateRatingStars(t,e),a&&(showRelatedBooks(t),updateRateBooksHeaderAndFooter(t))),$j(this).children("#starsSaving").remove(),d.find(".star").attr("ref",h),$j(this).children(".star").show(),i.hide(),o.show()},error:function(t){if(t&&403===t.status){var n=JSON.parse(t.responseText);n.redirect&&(location.href=n.redirect)}else c?showRatingErrorMessage(e):($j(this).addClass("error"),$j(this).html("So sorry, but there was a problem completing your request. Please reload the page and try again."))},beforeSend:function(){$j(this).append("<span id='starsSaving'>saving...</span>"),$j(this).children(".star").hide()}})}},enrichUrl=function(e,t,n){var i=e.match(/\?/)?e+"&":e+"?";return i=i+t+"="+n},clearRating=function(e){submitStars(e,enrichUrl(e.data("submitUrl"),"rating",0),e.data("userId")),e.data("rating",0),colorStars(e,0)};$j(document).on("click",".clearRating",function(){clearRating($j(this).siblings("div.stars"))}),$j(document).on("mouseenter",".wtrButtonContainer div.ratingStars",function(){$j(this).hasClass("hasRating")&&($j(this).find(".myRating").hide(),$j(this).find(".clearRating").show())}).on("mouseleave",".wtrButtonContainer div.ratingStars",function(){$j(this).find(".clearRating").hide(),$j(this).find(".myRating").show()}),$j(document).on("mouseover",".star",function(){var e=$j(this),t=e.parent();colorStars(t,t.children().index(e))}).on("click",".star",function(){var e=$j(this),t=e.parent(),n=t.children().index(e);return t.data("rating",n+1),url=enrichUrl(t.data("submitUrl"),"rating",n+1),submitStars(t,enrichUrl(url,"ref",e.attr("ref")),t.data("userId")),!1}).on("mouseleave","div.stars",function(){var e=$j(this);colorStars(e,e.data("rating")-1)}),$j(document).on("click",".recommendBook",function(e){recommendBookPopup($j(this).data()),e.preventDefault()});var recommendBookPopup=function(e,t){var n,i,o="/recommendations/book_popup/",r="/book/recommend_send/",s="/user/update_preferences",a="/friend/invite",l=6,c=!1,u="",h="",d=null,f=0,p='<div id="recommendBookPopup" style="display: none;">     <div class="mediumText"><div class="bigText"><div class="cover"><img width="50"></div></div><p><input id="friend_filter" name="friend_filter" placeholder="Search by name" results="" type="search"></p></div>     <div class="peopleContainer"><div class="people clearFix"></div></div>     <div class="paging clearFix"><a href="#" class="prev disabled">&larr; Previous</a>&nbsp;&nbsp;&nbsp;<a href="#" class="next disabled">Next &rarr;</a></div>     </div>',m='<div class="friend vcenteredLineOfBlocks">     <div class="pic"></div>     <div class="text">     <textarea class="message"></textarea>     <div class="name"></div>     <div class="reason"></div>     <a class="gr-button gr-button--small js-recommendButton">Recommend</a>     <span class="toggleMessage">add message</span>     <div class="banner"></div>     </div></div>',g='<div class="togglePref sansSerif">     <span class="explanation">We\'re asking you to recommend this book because you rated it 4 or 5 stars.</span>     <label id="togglePrefLabel">     <input id="recommendBookPopupPref" name="recommendBookPopupPref" type="checkbox">     <span>Don&rsquo;t show this again</span>     </label>     <span class="saved" style="display:none;">Preference saved!</span>     </div>',v='Visit your <a href="/user/edit?tab=settings" target="_blank">settings</a> to re-enable this later; just check<br> &ldquo;prompt me to recommend books to friends.&rdquo;',b='No friends! <a href="'+a+'">Invite a few</a> to Goodreads.',y='Oops, something went wrong!<br>Please wait a moment and <a href="#">try again</a>.',w=$j(p),S=w.find(".people"),x=w.find("#friend_filter"),C=w.find(".prev"),k=w.find(".next");"object"==typeof t&&t.hasOwnProperty("afterReview")&&(c=t.afterReview);var j=function(){S.addClass("people loading"),$j.get(o+e.id,{after_review:c}).always(function(){S.removeClass("errorNotice loading")}).done(function(e){e.hasOwnProperty("friends")&&e.friends.length>0?(n=$j(e.friends).map(function(){return this.lowercaseName=this.name.toLocaleLowerCase(),this.containsUnicode=!/^[\000-\177]*$/.test(this.name),this.disabled=null!==this.readStatus||null!==this.recStatus,this}),x.on("keyup search",T),w.children(".paging").on("click",".prev, .next",O),S.on("click",".js-recommendButton",L),S.on("click","span.toggleMessage",B),""===x.val()||x.val()===x.attr("placeholder")?(D(),P()):x.keyup()):(S.removeClass("people").addClass("errorNotice"),S.html(b),c&&Lightbox.hideBox())}).fail(function(){S.removeClass("people").addClass("errorNotice"),S.html(y),S.children(".friend").click(function(e){S.empty(),j(),e.preventDefault()})})};j(),$j("body").append(w);var E;c?(E="Would any of your friends enjoy <em>"+e.title+"</em>?",w.append($j(g)),new Tip($("togglePrefLabel"),v,{style:"goodreads",stem:"topMiddle",hook:{tip:"topMiddle",target:"topMiddle"},offset:{x:5,y:15},hideOn:!1,hideAfter:.05}),$("togglePrefLabel").observe("prototip:shown",function(){$j(".prototip").css("z-index",100089)}),w.find("#recommendBookPopupPref").change(function(e){
$j.post(s,{"user[prompt_to_recommend_books]":$j(e.target).prop("checked")?"0":"1"},function(){$j("#recommendBookPopup .saved").show().delay(1e3).fadeOut()})})):E="Recommend <em>"+e.title+"</em> to your friends",w.find(".bigText").append(E),w.find(".cover img").attr({src:e.image,alt:e.title}),$j(function(){Lightbox.showBoxByID("recommendBookPopup",715,300),Lightbox.center("box"),$j("#lightBoxRightClose").remove(),document.observe("Lightbox:hideBox",function(){document.stopObserving("Lightbox:hideBox"),$j("#recommendBookPopup").remove()})});var T=_.debounce(function(e){u=e.target.value,u===x.attr("placeholder")&&(u=""),u!==h&&(D(),P()),h=u},300),A=function(e,t){return t.score!==e.score?t.score-e.score:e.containsUnicode||t.containsUnicode?e.lowercaseName.localeCompare(t.lowercaseName):e.lowercaseName<t.lowercaseName?-1:e.lowercaseName>t.lowercaseName?1:0},D=function(){i=$j(jQuery.extend({},n)),u.length>0?(null===d&&(d=f),f=0,i.each(function(){this.score=this.name.score(u)}),i.sort(A)):(f=d||0,d=null),M()},M=function(){u.length>0&&(i=i.filter(function(){return this.score>0}))},N=function(e){if(!e.hasOwnProperty("html")){var t=$j(m);t.data("friend",e),t.toggleClass("disabled",e.hasOwnProperty("disabled")&&e.disabled),t.find(".name").html(e.name),t.find(".reason").html(e.reason),t.find(".banner").html(I(e.readStatus)),t.find(".message").attr("placeholder",e.name+" would like this book because..."),null!==e.imageUrl&&t.children(".pic").css("background-image",'url("'+e.imageUrl+'")'),e.html=t}return e.html},I=function(e){switch(e){case"read":return"Marked as Read";case"to-read":return"Marked as Want to Read";case"currently-reading":return"Marked as Currently Reading";default:return"Recommended"}},P=function(){S.children().detach();var e=l*f;i.length>0?(S.empty().addClass("people").removeClass("errorNotice"),i.slice(e,e+l).each(function(){S.append(N(this))})):(S.addClass("errorNotice").removeClass("people"),S.html("No matches found.")),F(i.length)},F=function(){var e=i.length>l,t=i.length/l-1<=f;C.toggleClass("disabled",!e||0===f),k.toggleClass("disabled",!e||t)},O=function(e){var t=$j(e.target),n=t.hasClass("prev")?-1:1;t.hasClass("disabled")||(f+=n,P()),e.preventDefault()},L=function(t){var o=$j(t.target).parents(".friend"),s=o.data("friend"),a=o.find(".message"),h=a.is(":visible");s.disabled=!0,o.addClass("disabled"),o.removeClass("messageVisible");var d={send:{}};if(d.send[s.id]=!0,d.source="recommend_book_popup",h&&(d.message=a.val()),c?d.context="after_review":d.context="not_after_review",$j.post(r+e.id,d,null,"script"),0===u.length){var f,p,m,g=$j.inArray(s,n),v=0;for(f=g+1;f<n.length;f++)if(!n[f].disabled&&(v++,v>=l)){p=n[f],m=f;break}n=p?n.slice(0,g).add(p).add(n.slice(g+1,m)).add(n.slice(m+1)).add(n[g]):n.slice(0,g).add(n.slice(g+1)).add(n[g]),i=$j(jQuery.extend({},n)),o.delay(2500).fadeOut(700,function(){P(),this.show()})}},B=function(e){var t=$j(e.target),n=t.parents(".friend"),i="clear message"!==t.html();n.toggleClass("messageVisible",i),t.html(i?"clear message":"add message"),i&&n.find(".message").focus()}},adjustRecommendationSponsoredBookHeight=function(){try{var e=$j("#sponsoredBookContainer").find("div"),t=e.children().find("iframe"),n=t.contents().find("iframe"),i=(n.contents().find(".bookDescription").find("a"),n.contents().find("body").height());t.attr("height",i),n.attr("height",i),e.height(i)}catch(o){if("SecurityError"!=o.name)throw o}};$j(setTimeout(function(){try{var e=$j("#sponsoredBookContainer").find("div"),t=e.children().find("iframe"),n=t.contents().find("iframe"),i=n.contents().find(".bookDescription").find("a");i.on("click",adjustRecommendationSponsoredBookHeight)}catch(o){if("SecurityError"!=o.name)throw o}},4e3)),/*!
	reflection.js for jQuery v1.11
	(c) 2006-2013 Christophe Beyls <http://www.digitalia.be>
	MIT-style license.
*/
function(e){e.fn.extend({reflect:function(t){return t=e.extend({height:1/3,opacity:.5},t),this.unreflect().each(function(){function n(){var n,o,r,s,a,l=i.width,c=i.height;if(o=Math.floor(t.height>1?Math.min(c,t.height):c*t.height),n=e("<canvas />")[0],n.getContext){s=n.getContext("2d");try{e(n).attr({width:l,height:o}),s.save(),s.translate(0,c-1),s.scale(1,-1),s.drawImage(i,0,0,l,c),s.restore(),s.globalCompositeOperation="destination-out",a=s.createLinearGradient(0,0,0,o),a.addColorStop(0,"rgba(255, 255, 255, "+(1-t.opacity)+")"),a.addColorStop(1,"rgba(255, 255, 255, 1.0)"),s.fillStyle=a,s.rect(0,0,l,o),s.fill()}catch(u){return}}else{if(!window.ActiveXObject)return;n=e("<img />").attr("src",i.src).css({width:l,height:c,marginBottom:o-c,filter:"FlipV progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*t.opacity+", FinishOpacity=0, Style=1, StartX=0, StartY=0, FinishX=0, FinishY="+o/c*100+")"})[0]}e(n).css({display:"block",border:0}),r=e(/^a$/i.test(i.parentNode.tagName)?"<span />":"<div />").insertAfter(i).append([i,n])[0],r.className=i.className,e.data(i,"reflected",r.style.cssText=i.style.cssText),e(r).css({width:l,height:c+o,overflow:"hidden"}),i.style.cssText="display: block; border: 0px",i.className="reflected"}var i=this;/^img$/i.test(i.tagName)&&(i.complete?n():e(i).load(n))})},unreflect:function(){return this.unbind("load").each(function(){var t,n=this,i=e.data(this,"reflected");void 0!==i&&(t=n.parentNode,n.className=t.className,n.style.cssText=i,e.removeData(n,"reflected"),t.parentNode.replaceChild(n,t))})}})}(jQuery),jQuery(function(e){e("img.reflect").reflect({})});/*
 * Tabs class
 * 
 * Copyright 2008 Goodreads, Inc.
 */
var Tabs=Class.create({selectedClassSuffix:"-selected",initialize:function(e){this.container=$(e),this.tabElts=this.container.select("ul.leftTabs li a"),this._setCurrentSelectedClass(),this.tabSelectedDelegate=this._tabSelected.bindAsEventListener(this),this.tabElts.each(function(e){Event.observe(e,"click",this.tabSelectedDelegate)}.bind(this))},destroy:function(){this.tabElts&&this.tabSelectedDelegate&&this.tabElts.each(function(e){Event.stopObserving(e,"click",this.tabSelectedDelegate)}.bind(this))},setSelected:function(e){var t=e+this.selectedClassSuffix;this.container&&this.currentClass&&t!=this.currentClass&&(this.container.removeClassName(this.currentClass),this.currentClass=t,this.container.addClassName(this.currentClass))},_tabSelected:function(e){var t=e.element();if(t){var n=t.readAttribute("title");n&&this.setSelected(n)}},_setCurrentSelectedClass:function(){if(this.container){var e=new RegExp("[a-zA-Z]+"+this.selectedClassSuffix);this.currentClass=this.container.classNames().find(function(t){return t.match(e)})}}});window.twttr=function(e,t,n){var i,o,r=e.getElementsByTagName(t)[0];if(!e.getElementById(n))return o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",r.parentNode.insertBefore(o,r),window.twttr||(i={_e:[],ready:function(e){i._e.push(e)}})}(document,"script","twitter-wjs"),$gr.user.user_name_edit=function(){var e={},t=function(){var t=$j("#user_full_name_source");e.first_name=$j("#user_first_name").val(),e.middle_name=$j("#user_middle_name").val(),e.last_name=$j("#user_last_name").val();var n={};n.FL=e.first_name+" "+e.last_name,n.FML=e.first_name+" "+e.middle_name+" "+e.last_name,n.LF=e.last_name+" "+e.first_name,t.find("option").each(function(e,t){t.text=n[$j(t).val()]})};return{sync_dropdown:t}}(),$j(document).on("keyup","#user_first_name, #user_middle_name, #user_last_name",function(e){$gr.user.user_name_edit.sync_dropdown()}),$gr.user.custom_gender_suggestions=["agender","androgyne","androgynous","bigender","cis","cisgender","cis female","cis male","cis man","cis woman","cisgender female","cisgender male","cisgender man","cisgender woman","female to male","FTM","gender fluid","gender nonconforming","gender questioning","gender variant","genderqueer","intersex","male to female","MTF","neither","neutrois","non-binary","other","pangender","trans","trans*","trans female","trans* female","trans male","trans* male","trans man","trans* man","trans person","trans* person","trans woman","trans* woman","transfeminine","transgender","transgender female","transgender male","transgender man","transgender person","transgender woman","transmasculine","transsexual","transsexual female","transsexual male","transsexual man","transsexual person","transsexual woman","two-spirit"],$gr.user.show_custom_gender_options_if_needed=function(){"C"==$j("#user_gender").val()?$j("#custom_gender_fields").show():$j("#custom_gender_fields").hide()},$gr.user.autocomplete_gender_suggestions=function(){var e=$j("#user_gender_custom").val(),t="",n="";return e.length>=2&&$gr.user.custom_gender_suggestions.each(function(t){t.toUpperCase().startsWith(e.toUpperCase())&&(n+='<li class="resultsListItem"><a class="resultsListItemLink" href="#">'+t+"</a></li>")}),""!==n&&(t='<ul class="resultsList">'+n+"</ul>"),t},$j(document).ready(function(){$j("#user_full_name_source").append($j("<option value='FL'></option>")),""!==$j("#user_middle_name").val()&&$j("#user_full_name_source").append($j("<option value='FML'></option>")),""!==$j("#user_last_name").val()&&$j("#user_full_name_source").append($j("<option value='LF'></option>")),$gr.user.user_name_edit.sync_dropdown(),$j("#user_gender").change($gr.user.show_custom_gender_options_if_needed),$gr.user.show_custom_gender_options_if_needed(),Autocomplete.attachTo("#user_gender_custom",{menuListParentSelector:"#custom_gender_autocomplete",queryCallback:$gr.user.autocomplete_gender_suggestions,queryDebounceDuration:200,selectToFillIn:!0});var e=function(){var e=$j("#dPreferences .retailers");$j("#dPreferences [type='checkbox'][name='d_type_preferences[]']:checked").length>0?e.show():e.hide()};$j("#dPreferences .types").change(e),$j('#dPreferences .types [type="checkbox"][value="genre"]').change(function(){var e=$j(this).parent().find('.subType [type="checkbox"]');1==this.checked?(e.attr("disabled",!1),e.is("checked")||e.attr("checked",!0)):e.attr("disabled",!0)}),$j("#dPreferences .dPreferencesActionButton").click(function(e){var t=$j("#d_type_preferences_genre"),n=$j(t).parent().find('.subType [type="checkbox"]:checked');return t.prop("checked")&&0==n.length?(e.preventDefault(),$j("#dPreferences .submitErrorMessage").html("Please select at least one genre."),!1):$j("#dPreferences [type='checkbox'][name='d_type_preferences[]']:checked").length>0&&0==$j("#dPreferences [type='checkbox'][name='d_retailer_preferences[]']:checked").length?(e.preventDefault(),$j("#dPreferences .submitErrorMessage").html("Please select at least one retailer."),!1):void 0})}),$gr.user.user_feed_preferences=function(){var e=function(e){var t=$j("#grok_"+e+"_en"),n=$j("#grok_"+e+"_dis"),i=$j("#gr_"+e+"_en"),o=$j("#gr_"+e+"_dis"),r=$j(".checkboxCorrespondingTo-"+e),s=r.length,a=r.filter(":checked").length;s==a?(t.css("display","block"),n.css("display","none")):(t.css("display","none"),n.css("display","block")),a>0?(i.css("display","block"),o.css("display","none")):(i.css("display","none"),o.css("display","block"))};$j(".checkboxCorrespondingTo-publish_book_activities").on("click",function(t){e("publish_book_activities")}),$j(".checkboxCorrespondingTo-publish_review_activities").on("click",function(t){e("publish_review_activities")}),$j(".checkboxCorrespondingTo-publish_additional_activities").on("click",function(t){e("publish_additional_activities")})},$j(document).ready(function(){$gr.user.user_feed_preferences()}),Element.activateHideNewShelfForm=function(e){e.observe("click",function(t){var n=e.up("#createShelfTip");void 0!=n&&(n.previous().addClassName("lastRow"),n.hide()),new Ajax.Request(e.href),t.stop()})},Element.addMethods({activateHideNewShelfForm:Element.activateHideNewShelfForm}),document.observe("dom:loaded",function(){var e=$("hideNewShelfForm");e&&e.activateHideNewShelfForm(),$j("#shelfTable .userShelfName .renameUserShelfLnk").click(function(){return showRenameForm($j(this)),!1}),$j("#shelfTable .userShelfName .cancelRenameUserShelf").click(function(){return hideRenameForm($j(this)),!1}),$j("#shelfTable .userShelfName .submitRenameUserShelf").click(function(){return submitRenameShelf($j(this).closest("form")),!1})}),document.observe("dom:loaded",function(){activateExpandDetailsLinks()});var after_update=function(e){return function(t,n){$j("#"+e+"_name").val().replace(/ *\(.*\) *$/,"");var i=n.readAttribute("id").replace(/auto_complete_/,""),o=i.split("_"),r=o[o.length-1];$j("#"+e+"_id").val(r)}};$j(document).ready(function(){$j("div.metaMerge > div.floatRightContainer").children("a").hide(),$j("div.metaMerge > div.meta_to_delete").children("input:checkbox").prop("checked",!1)}),$j(document).on("change","div.meta_to_delete > input:checkbox",function(){var e=this.parent();if(this.checked)$j("div.meta_to_delete").not(e).children("input:checkbox").hide(),$j("div.meta_to_delete").children("label").hide(),$j(e).children("input:checkbox,a").show(),$j("div.meta_to_keep").children("input:checkbox,a").show(),$j("div.meta_to_keep").children("a.meta_to_keep").attr("href",$j(e).children("a.meta_to_delete").attr("href"));else{var t=$j("div.metaMerge > div.floatRightContainer");t.find("a").hide(),t.find("input:checkbox").show()}}),
// Copyright 2009-2012 by contributors, MIT License
function(e){"function"==typeof define?define(e):"function"==typeof YUI?YUI.add("es5",e):e()}(function(){function e(){}function t(e){return e=+e,e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function n(e){var t=typeof e;return null===e||"undefined"===t||"boolean"===t||"number"===t||"string"===t}function i(e){var t,i,o;if(n(e))return e;if(i=e.valueOf,"function"==typeof i&&(t=i.call(e),n(t)))return t;if(o=e.toString,"function"==typeof o&&(t=o.call(e),n(t)))return t;throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if("function"!=typeof n)throw new TypeError("Function.prototype.bind called on incompatible "+n);var i=d.call(arguments,1),o=function(){if(this instanceof o){var e=n.apply(this,i.concat(d.call(arguments)));return Object(e)===e?e:this}return n.apply(t,i.concat(d.call(arguments)))};return n.prototype&&(e.prototype=n.prototype,o.prototype=new e,e.prototype=null),o});var o,r,s,a,l,c=Function.prototype.call,u=Array.prototype,h=Object.prototype,d=u.slice,f=c.bind(h.toString),p=c.bind(h.hasOwnProperty);if((l=p(h,"__defineGetter__"))&&(o=c.bind(h.__defineGetter__),r=c.bind(h.__defineSetter__),s=c.bind(h.__lookupGetter__),a=c.bind(h.__lookupSetter__)),2!=[1,2].splice(0).length){var m=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?m.apply(this,[void 0===e?0:e,void 0===t?this.length-e:t].concat(d.call(arguments,2))):[]}}if(1!=[].unshift(0)){var g=Array.prototype.unshift;Array.prototype.unshift=function(){return g.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(e){return"[object Array]"==f(e)});var v=Object("a"),b="a"!=v[0]||!(0 in v);if(Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=arguments[1],o=-1,r=n.length>>>0;if("[object Function]"!=f(e))throw new TypeError;for(;++o<r;)o in n&&e.call(i,n[o],o,t)}),Array.prototype.map||(Array.prototype.map=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=n.length>>>0,o=Array(i),r=arguments[1];if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");for(var s=0;i>s;s++)s in n&&(o[s]=e.call(r,n[s],s,t));return o}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,n=M(this),i=b&&"[object String]"==f(this)?this.split(""):n,o=i.length>>>0,r=[],s=arguments[1];if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");for(var a=0;o>a;a++)a in i&&(t=i[a],e.call(s,t,a,n)&&r.push(t));return r}),Array.prototype.every||(Array.prototype.every=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=n.length>>>0,o=arguments[1];if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");for(var r=0;i>r;r++)if(r in n&&!e.call(o,n[r],r,t))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=n.length>>>0,o=arguments[1];if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");for(var r=0;i>r;r++)if(r in n&&e.call(o,n[r],r,t))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var o,r=0;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in n){o=n[r++];break}if(++r>=i)throw new TypeError("reduce of empty array with no initial value")}for(;i>r;r++)r in n&&(o=e.call(void 0,o,n[r],r,t));return o}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(e){var t=M(this),n=b&&"[object String]"==f(this)?this.split(""):t,i=n.length>>>0;if("[object Function]"!=f(e))throw new TypeError(e+" is not a function");if(!i&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var o,r=i-1;if(arguments.length>=2)o=arguments[1];else for(;;){if(r in n){o=n[r--];break}if(--r<0)throw new TypeError("reduceRight of empty array with no initial value")}do r in this&&(o=e.call(void 0,o,n[r],r,t));while(r--);return o}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(e){var n=b&&"[object String]"==f(this)?this.split(""):M(this),i=n.length>>>0;if(!i)return-1;var o=0;for(arguments.length>1&&(o=t(arguments[1])),o=o>=0?o:Math.max(0,i+o);i>o;o++)if(o in n&&n[o]===e)return o;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(e){var n=b&&"[object String]"==f(this)?this.split(""):M(this),i=n.length>>>0;if(!i)return-1;var o=i-1;for(arguments.length>1&&(o=Math.min(o,t(arguments[1]))),o=o>=0?o:i-Math.abs(o);o>=0;o--)if(o in n&&e===n[o])return o;return-1}),!Object.keys){var y=!0,w=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],S=w.length;for(var x in{toString:null})y=!1;Object.keys=function N(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");var N=[];for(var t in e)p(e,t)&&N.push(t);if(y)for(var n=0,i=S;i>n;n++){var o=w[n];p(e,o)&&N.push(o)}return N}}var C=-621987552e5,_="-000001";Date.prototype.toISOString&&-1!==new Date(C).toISOString().indexOf(_)||(Date.prototype.toISOString=function(){var e,t,n,i,o;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");for(i=this.getUTCFullYear(),o=this.getUTCMonth(),i+=Math.floor(o/12),o=(o%12+12)%12,e=[o+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(0>i?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(i>=0&&9999>=i?-4:-6),t=e.length;t--;)n=e[t],10>n&&(e[t]="0"+n);return i+"-"+e.slice(0,2).join("-")+"T"+e.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"});var k=!1;try{k=Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(C).toJSON().indexOf(_)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(j){}if(k||(Date.prototype.toJSON=function(e){var t,n=Object(this),o=i(n);if("number"==typeof o&&!isFinite(o))return null;if(t=n.toISOString,"function"!=typeof t)throw new TypeError("toISOString property is not callable");return t.call(n)}),!Date.parse,Date=function(e){function t(n,i,o,r,s,a,l){var c=arguments.length;if(this instanceof e){var u=1==c&&String(n)===n?new e(t.parse(n)):c>=7?new e(n,i,o,r,s,a,l):c>=6?new e(n,i,o,r,s,a):c>=5?new e(n,i,o,r,s):c>=4?new e(n,i,o,r):c>=3?new e(n,i,o):c>=2?new e(n,i):c>=1?new e(n):new e;return u.constructor=t,u}return e.apply(this,arguments)}function n(e,t){var n=t>1?1:0;return o[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)}var i=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),o=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var r in e)t[r]=e[r];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function(t){var o=i.exec(t);if(o){var r,s=Number(o[1]),a=Number(o[2]||1)-1,l=Number(o[3]||1)-1,c=Number(o[4]||0),u=Number(o[5]||0),h=Number(o[6]||0),d=Number(o[7]||0),f=!o[4]||o[8]?0:Number(new e(1970,0)),p="-"===o[9]?1:-1,m=Number(o[10]||0),g=Number(o[11]||0);return(u>0||h>0||d>0?24:25)>c&&60>u&&60>h&&1e3>d&&a>-1&&12>a&&24>m&&60>g&&l>-1&&l<n(s,a+1)-n(s,a)&&(r=60*(24*(n(s,a)+l)+c+m*p),r=1e3*(60*(r+u+g*p)+h)+d+f,r>=-864e13&&864e13>=r)?r:NaN}return e.parse.apply(this,arguments)},t}(Date),Date.now||(Date.now=function(){return(new Date).getTime()}),"0".split(void 0,0).length){var $=String.prototype.split;String.prototype.split=function(e,t){return void 0===e&&0===t?[]:$.apply(this,arguments)}}if("".substr&&"b"!=="0b".substr(-1)){var E=String.prototype.substr;String.prototype.substr=function(e,t){return E.call(this,0>e&&(e=this.length+e)<0?0:e,t)}}var T="	\n\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff";if(!String.prototype.trim||T.trim()){T="["+T+"]";var A=new RegExp("^"+T+T+"*"),D=new RegExp(T+T+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(A,"").replace(D,"")}}var M=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)}}),
// Copyright 2009-2012 by contributors, MIT License
function(e){"function"==typeof define?define(e):"function"==typeof YUI?YUI.add("es5-sham",e):e()}(function(){function e(e){try{return Object.defineProperty(e,"sentinel",{}),"sentinel"in e}catch(t){}}var t,n,i,o,r,s=Function.prototype.call,a=Object.prototype,l=s.bind(a.hasOwnProperty);if((r=l(a,"__defineGetter__"))&&(t=s.bind(a.__defineGetter__),n=s.bind(a.__defineSetter__),i=s.bind(a.__lookupGetter__),o=s.bind(a.__lookupSetter__)),Object.getPrototypeOf||(Object.getPrototypeOf=function(e){return e.__proto__||(e.constructor?e.constructor.prototype:a)}),!Object.getOwnPropertyDescriptor){var c="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(e,t){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(c+e);if(l(e,t)){var n={enumerable:!0,configurable:!0};if(r){var s=e.__proto__;e.__proto__=a;var u=i(e,t),h=o(e,t);if(e.__proto__=s,u||h)return u&&(n.get=u),h&&(n.set=h),n}return n.value=e[t],n}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){return Object.keys(e)}),!Object.create){var u,h=null===Object.prototype.__proto__;u=h||"undefined"==typeof document?function(){return{__proto__:null}}:function(){function e(){}var t=document.createElement("iframe"),n=document.body||document.documentElement;t.style.display="none",n.appendChild(t),t.src="javascript:";var i=t.contentWindow.Object.prototype;return n.removeChild(t),t=null,delete i.constructor,delete i.hasOwnProperty,delete i.propertyIsEnumerable,delete i.isPrototypeOf,delete i.toLocaleString,delete i.toString,delete i.valueOf,i.__proto__=null,e.prototype=i,function(){return new e}}(),Object.create=function(e,t){function n(){}var i;if(null===e)i=u();else{if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Object prototype may only be an Object or null");n.prototype=e,i=new n,i.__proto__=e}return void 0!==t&&Object.defineProperties(i,t),i}}if(Object.defineProperty){var d=e({}),f="undefined"==typeof document||e(document.createElement("div"));if(!d||!f)var p=Object.defineProperty,m=Object.defineProperties}if(!Object.defineProperty||p){var g="Property description must be an object: ",v="Object.defineProperty called on non-object: ",b="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(e,s,c){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError(v+e);if("object"!=typeof c&&"function"!=typeof c||null===c)throw new TypeError(g+c);if(p)try{return p.call(Object,e,s,c)}catch(u){}if(l(c,"value"))if(r&&(i(e,s)||o(e,s))){var h=e.__proto__;e.__proto__=a,delete e[s],e[s]=c.value,e.__proto__=h}else e[s]=c.value;else{if(!r)throw new TypeError(b);l(c,"get")&&t(e,s,c.get),l(c,"set")&&n(e,s,c.set)}return e}}(!Object.defineProperties||m)&&(Object.defineProperties=function(e,t){if(m)try{return m.call(Object,e,t)}catch(n){}for(var i in t)l(t,i)&&"__proto__"!=i&&Object.defineProperty(e,i,t[i]);return e}),Object.seal||(Object.seal=function(e){return e}),Object.freeze||(Object.freeze=function(e){return e});try{Object.freeze(function(){})}catch(y){Object.freeze=function(e){return function(t){return"function"==typeof t?t:e(t)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(e){return e}),Object.isSealed||(Object.isSealed=function(e){return!1}),Object.isFrozen||(Object.isFrozen=function(e){return!1}),Object.isExtensible||(Object.isExtensible=function(e){if(Object(e)!==e)throw new TypeError;for(var t="";l(e,t);)t+="?";e[t]=!0;var n=l(e,t);return delete e[t],n})}),/*! Flight v1.1.0 | (c) Twitter, Inc. | MIT License */
function(e){function t(){var e,t,n=Array.prototype.slice.call(arguments),o=[];"string"==typeof n[0]&&(e=n.shift()),r(n[0])&&(o=n.shift()),t=n.shift(),i[e]=[o,t]}function n(e){function t(t){var n=e.split("/"),i=t.split("/"),o=!1;for(n.pop();".."==i[0]&&n.length;)n.pop(),i.shift(),o=!0;return"."==i[0]&&(i.shift(),o=!0),o&&(i=n.concat(i)),i.join("/")}var r,a,l;return"undefined"==typeof o[e]&&(r=i[e],r&&(l=r[0],a=r[1],o[e]=a.apply(void 0,s(l,function(e){return n(t(e))})))),o[e]}var i={},o={},r=Array.isArray||function(e){return e.constructor==Array},s=Array.map||function(e,t,n){for(var i=0,o=e.length,r=[];o>i;i++)r.push(t.call(n,e[i]));return r};
// Copyright 2013 Twitter, Inc
t("lib/utils",[],function(){var e=jQuery,t=[],n=100,i={isDomObj:function(e){return!(!e.nodeType&&e!==window)},toArray:function(e,n){return t.slice.call(e,n)},merge:function(){for(var t=arguments.length,n=0,i=new Array(t+1);t>n;n++)i[n+1]=arguments[n];return 0===t?{}:(i[0]={},i[i.length-1]===!0&&(i.pop(),i.unshift(!0)),e.extend.apply(void 0,i))},push:function(e,t,n){return e&&Object.keys(t||{}).forEach(function(i){if(e[i]&&n)throw Error("utils.push attempted to overwrite '"+i+"' while running in protected mode");"object"==typeof e[i]&&"object"==typeof t[i]?this.push(e[i],t[i]):e[i]=t[i]},this),e},isEnumerable:function(e,t){return Object.keys(e).indexOf(t)>-1},compose:function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},uniqueArray:function(e){for(var t={},n=[],i=0,o=e.length;o>i;++i)t.hasOwnProperty(e[i])||(n.push(e[i]),t[e[i]]=1);return n},debounce:function(e,t,i){"number"!=typeof t&&(t=n);var o,r;return function(){var n=this,s=arguments,a=function(){o=null,i||(r=e.apply(n,s))},l=i&&!o;return clearTimeout(o),o=setTimeout(a,t),l&&(r=e.apply(n,s)),r}},throttle:function(e,t){"number"!=typeof t&&(t=n);var i,o,r,s,a,l,c=this.debounce(function(){a=s=!1},t);return function(){i=this,o=arguments;var n=function(){r=null,a&&(l=e.apply(i,o)),c()};return r||(r=setTimeout(n,t)),s?a=!0:(s=!0,l=e.apply(i,o)),c(),l}},countThen:function(e,t){return function(){return--e?void 0:t.apply(this,arguments)}},delegate:function(t){return function(n,i){var o,r=e(n.target);Object.keys(t).forEach(function(e){return(o=r.closest(e)).length?(i=i||{},i.el=o[0],t[e].apply(this,[n,i])):void 0},this)}}};return i}),t("lib/debug",[],function(){function e(t,n,i){var i=i||{},o=i.obj||window,r=i.path||(o==window?"window":""),s=Object.keys(o);s.forEach(function(i){"[object Object]"==Object.prototype.toString.call(o[i])&&o[i]!=o&&-1==r.split(".").indexOf(i)&&e(t,n,{obj:o[i],path:[r,i].join(".")})})}function t(t,n,i,o){n&&typeof i!=n||e(t,i,o)}function n(e,n){t("name","string",e,n)}function i(e,n){t("nameContains","string",e,n)}function o(e,n){t("type","function",e,n)}function r(e,n){t("value",null,e,n)}function s(e,n){t("valueCoerced",null,e,n)}function a(t,n){e(t,null,n)}function l(){var e=[].slice.call(arguments);p.eventNames.length||(p.eventNames=m),p.actions=e.length?e:m,d()}function c(){var e=[].slice.call(arguments);p.actions.length||(p.actions=m),p.eventNames=e.length?e:m,d()}function u(){p.actions=[],p.eventNames=[],d()}function h(){p.actions=m,p.eventNames=m,d()}function d(){window.localStorage&&(localStorage.setItem("logFilter_eventNames",p.eventNames),localStorage.setItem("logFilter_actions",p.actions))}function f(){var e={eventNames:window.localStorage&&localStorage.getItem("logFilter_eventNames")||g,actions:window.localStorage&&localStorage.getItem("logFilter_actions")||v};return Object.keys(e).forEach(function(t){var n=e[t];"string"==typeof n&&n!==m&&(e[t]=n.split(","))}),e}var p,m=(jQuery,"all"),g=[],v=[],p=f();return{enable:function(e){this.enabled=!!e,e&&window.console,window.DEBUG=this},find:{byName:n,byNameContains:i,byType:o,byValue:r,byValueCoerced:s,custom:a},events:{logFilter:p,logByAction:l,logByName:c,logAll:h,logNone:u}}}),
// Copyright 2013 Twitter, Inc
t("lib/compose",["./utils","./debug"],function(e,t){function n(e,t){if(r){var n=Object.create(null);Object.keys(e).forEach(function(i){if(s.indexOf(i)<0){var o=Object.getOwnPropertyDescriptor(e,i);o.writable=t,n[i]=o}}),Object.defineProperties(e,n)}}function i(e,t,n){var i;return r&&e.hasOwnProperty(t)?(i=Object.getOwnPropertyDescriptor(e,t).writable,Object.defineProperty(e,t,{writable:!0}),n.call(e),void Object.defineProperty(e,t,{writable:i})):void n.call(e)}function o(e,t){e.mixedIn=e.hasOwnProperty("mixedIn")?e.mixedIn:[],t.forEach(function(t){-1==e.mixedIn.indexOf(t)&&(n(e,!1),t.call(e),e.mixedIn.push(t))}),n(e,!0)}var r=t.enabled&&!e.isEnumerable(Object,"getOwnPropertyDescriptor"),s=["mixedIn"];if(r)try{Object.getOwnPropertyDescriptor(Object,"keys")}catch(a){r=!1}return{mixin:o,unlockProperty:i}}),
// Copyright 2013 Twitter, Inc
t("lib/advice",["./utils","./compose"],function(e,t){var n={around:function(e,t){return function(){var n=0,i=arguments.length,o=new Array(i+1);for(o[0]=e.bind(this);i>n;n++)o[n+1]=arguments[n];return t.apply(this,o)}},before:function(e,t){var n="function"==typeof t?t:t.obj[t.fnName];return function(){return n.apply(this,arguments),e.apply(this,arguments)}},after:function(e,t){var n="function"==typeof t?t:t.obj[t.fnName];return function(){var t=(e.unbound||e).apply(this,arguments);return n.apply(this,arguments),t}},withAdvice:function(){["before","after","around"].forEach(function(e){this[e]=function(i,o){t.unlockProperty(this,i,function(){return"function"==typeof this[i]?this[i]=n[e](this[i],o):this[i]=o})}},this)}};return n}),
// Copyright 2013 Twitter, Inc
t("lib/registry",["./utils"],function(e){function t(e,t){var n,i,o,r=t.length;return"function"==typeof t[r-1]&&(r-=1,o=t[r]),"object"==typeof t[r-1]&&(r-=1),2==r?(n=t[0],i=t[1]):(n=e.node,i=t[0]),{element:n,type:i,callback:o}}function n(e,t){return e.element==t.element&&e.type==t.type&&(null==t.callback||e.callback==t.callback)}function i(){function e(e){this.component=e,this.attachedTo=[],this.instances={},this.addInstance=function(e){var t=new i(e);return this.instances[e.identity]=t,this.attachedTo.push(e.node),t},this.removeInstance=function(e){delete this.instances[e.identity];var t=this.attachedTo.indexOf(e.node);t>-1&&this.attachedTo.splice(t,1),Object.keys(this.instances).length||o.removeComponentInfo(this)},this.isAttachedTo=function(e){return this.attachedTo.indexOf(e)>-1}}function i(e){this.instance=e,this.events=[],this.addBind=function(e){this.events.push(e),o.events.push(e)},this.removeBind=function(e){for(var t,i=0;t=this.events[i];i++)n(t,e)&&this.events.splice(i,1)}}var o=this;(this.reset=function(){this.components=[],this.allInstances={},this.events=[]}).call(this),this.addInstance=function(t){var n=this.findComponentInfo(t);n||(n=new e(t.constructor),this.components.push(n));var i=n.addInstance(t);return this.allInstances[t.identity]=i,n},this.removeInstance=function(e){var t=(this.findInstanceInfo(e),this.findComponentInfo(e));t&&t.removeInstance(e),delete this.allInstances[e.identity]},this.removeComponentInfo=function(e){var t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)},this.findComponentInfo=function(e){for(var t,n=e.attachTo?e:e.constructor,i=0;t=this.components[i];i++)if(t.component===n)return t;return null},this.findInstanceInfo=function(e){return this.allInstances[e.identity]||null},this.findInstanceInfoByNode=function(e){var t=[];return Object.keys(this.allInstances).forEach(function(n){var i=this.allInstances[n];i.instance.node===e&&t.push(i)},this),t},this.on=function(e){for(var n,i=o.findInstanceInfo(this),r=arguments.length,s=1,a=new Array(r-1);r>s;s++)a[s-1]=arguments[s];if(i){n=e.apply(null,a),n&&(a[a.length-1]=n);var l=t(this,a);i.addBind(l)}},this.off=function(e,i,r){var s=t(this,arguments),a=o.findInstanceInfo(this);a&&a.removeBind(s);for(var l,c=0;l=o.events[c];c++)n(l,s)&&o.events.splice(c,1)},o.trigger=new Function,this.teardown=function(){o.removeInstance(this)},this.withRegistration=function(){this.after("initialize",function(){o.addInstance(this)}),this.around("on",o.on),this.after("off",o.off),window.DEBUG&&DEBUG.enabled&&this.after("trigger",o.trigger),this.after("teardown",{obj:o,fnName:"teardown"})}}return new i}),t("lib/base",["./utils","./registry","./debug"],function(e,t,n){function i(e){e.events.slice().forEach(function(e){var t=[e.type];e.element&&t.unshift(e.element),"function"==typeof e.callback&&t.push(e.callback),this.off.apply(this,t)},e.instance)}function o(e,t){try{window.postMessage(t,"*")}catch(n){throw new Error(["The event",e,"on component",this.toString(),"was triggered with non-serializable data"].join(" "))}}function r(){this.trigger=function(){var e,t,i,r,a,l=arguments.length-1,c=arguments[l];return"string"==typeof c||c&&c.defaultBehavior||(l--,i=c),1==l?(e=s(arguments[0]),r=arguments[1]):(e=this.$node,r=arguments[0]),r.defaultBehavior&&(a=r.defaultBehavior,r=s.Event(r.type)),t=r.type||r,n.enabled&&window.postMessage&&o.call(this,t,i),"object"==typeof this.attr.eventData&&(i=s.extend(!0,{},this.attr.eventData,i)),e.trigger(r||t,i),a&&!r.isDefaultPrevented()&&(this[a]||a).call(this),e},this.on=function(){var t,n,i,o,r=arguments.length-1,a=arguments[r];if(o="object"==typeof a?e.delegate(this.resolveDelegateRules(a)):a,2==r?(t=s(arguments[0]),n=arguments[1]):(t=this.$node,n=arguments[0]),"function"!=typeof o&&"object"!=typeof o)throw new Error("Unable to bind to '"+n+"' because the given callback is not a function or an object");return i=o.bind(this),i.target=o,o.guid&&(i.guid=o.guid),t.on(n,i),o.guid=i.guid,i},this.off=function(){var e,t,n,i=arguments.length-1;return"function"==typeof arguments[i]&&(n=arguments[i],i-=1),1==i?(e=s(arguments[0]),t=arguments[1]):(e=this.$node,t=arguments[0]),e.off(t,n)},this.resolveDelegateRules=function(e){var t={};return Object.keys(e).forEach(function(n){if(!(n in this.attr))throw new Error('Component "'+this.toString()+'" wants to listen on "'+n+'" but no such attribute was defined.');t[this.attr[n]]=e[n]},this),t},this.defaultAttrs=function(t){e.push(this.defaults,t,!0)||(this.defaults=t)},this.select=function(e){return this.$node.find(this.attr[e])},this.initialize=function(e,t){if(t=t||{},this.identity=a++,!e)throw new Error("Component needs a node");e.jquery?(this.node=e[0],this.$node=e):(this.node=e,this.$node=s(e));var n=Object.create(t);for(var i in this.defaults)t.hasOwnProperty(i)||(n[i]=this.defaults[i]);return this.attr=n,Object.keys(this.defaults||{}).forEach(function(e){if(null===this.defaults[e]&&null===this.attr[e])throw new Error('Required attribute "'+e+'" not specified in attachTo for component "'+this.toString()+'".')},this),this},this.teardown=function(){i(t.findInstanceInfo(this))}}var s=jQuery,a=0;return r}),
// Copyright 2013 Twitter, Inc
t("lib/logger",["./compose","./utils"],function(e,t){function n(e){var t=e.tagName?e.tagName.toLowerCase():e.toString(),n=e.className?"."+e.className:"",i=t+n;return e.tagName?["'","'"].join(i):i}function i(e,t,i){var o,s,a,l,c,u,h;"function"==typeof i[i.length-1]&&(a=i.pop(),a=a.unbound||a),"object"==typeof i[i.length-1]&&i.pop(),2==i.length?(s=i[0],o=i[1]):(s=t.$node[0],o=i[0]),window.DEBUG&&window.DEBUG.enabled&&(l=DEBUG.events.logFilter,u="all"==l.actions||l.actions.indexOf(e)>-1,c=function(e){return e.test?e:new RegExp("^"+e.replace(/\*/g,".*")+"$")},h="all"==l.eventNames||l.eventNames.some(function(e){return c(e).test(o)}),u&&h&&console.info(r[e],e,"["+o+"]",n(s),t.constructor.describe.split(" ").slice(0,3).join(" ")))}function o(){this.before("trigger",function(){i("trigger",this,t.toArray(arguments))}),this.before("on",function(){i("on",this,t.toArray(arguments))}),this.before("off",function(e){i("off",this,t.toArray(arguments))})}var r={on:"<-",trigger:"->",off:"x "};return o}),
// Copyright 2013 Twitter, Inc
t("lib/component",["./advice","./utils","./compose","./base","./registry","./logger","./debug"],function(e,t,n,i,o,r,s){function a(){var e=o.findComponentInfo(this);e&&Object.keys(e.instances).forEach(function(t){var n=e.instances[t];n.instance.teardown()})}function l(e){for(var n=arguments.length,i=new Array(n-1),r=1;n>r;r++)i[r-1]=arguments[r];if(!e)throw new Error("Component needs to be attachTo'd a jQuery object, native node or selector string");var s=t.merge.apply(t,i);u(e).each(function(e,t){var n=t.jQuery?t[0]:t,i=o.findComponentInfo(this);i&&i.isAttachedTo(n)||(new this).initialize(t,s)}.bind(this))}function c(){for(var t=arguments.length,c=new Array(t+3),u=0;t>u;u++)c[u]=arguments[u];var d=function(){};return d.toString=d.prototype.toString=function(){var e=c.map(function(e){if(null==e.name){var t=e.toString().match(h);return t&&t[1]?t[1]:""}return"withBase"!=e.name?e.name:""}).filter(Boolean).join(", ");return e},s.enabled&&(d.describe=d.prototype.describe=d.toString()),d.attachTo=l,d.teardownAll=a,s.enabled&&c.unshift(r),c.unshift(i,e.withAdvice,o.withRegistration),n.mixin(d.prototype,c),d}var u=jQuery,h=/function (.*?)\s?\(/;return c.teardownAll=function(){o.components.slice().forEach(function(e){e.component.teardownAll()}),o.reset()},c}),
// Copyright 2013 Twitter, Inc
t("lib/index",["./advice","./component","./compose","./logger","./registry","./utils"],function(e,t,n,i,o,r){return{advice:e,component:t,compose:n,logger:i,registry:o,utils:r}}),e.flight=n("lib/index")}(this);var MixinAuthRedirect=function(){this.authRedirect=function(e,t){if(e&&403===e.status){var n=JSON.parse(e.responseText);n.redirect&&(location.href=n.redirect)}else"function"==typeof t?t(e):alert("So sorry, but there was a problem completing your request. Please reload the page and try again.")}},MixinBackgoundMask=function(){var e="bgmask-";this.initializeBackgroundMask=function(e){this.backgroundMaskId||("string"!=typeof e&&(e=""),e+=" backgroundMask","string"==typeof this.attr.componentName&&(e+=" "+this.attr.componentName+"Mask"),this.backgroundMaskId=this.generateBackgroundMaskId(e),$j("#"+this.backgroundMaskId).length||this.trigger(document,"create.viewportOverlay",{overlayId:this.backgroundMaskId,attr:{className:e,disableDirectHide:!0}}))},this.hideBackgroundMask=function(){this.trigger(document,"hide.viewportOverlay",{overlayId:this.backgroundMaskId})},this.showBackgroundMask=function(){this.trigger(document,"show.viewportOverlay",{overlayId:this.backgroundMaskId})},this.generateBackgroundMaskId=function(t){var n=t.split("").reduce(function(e,t){return e=(e<<5)-e+t.charCodeAt(0),e&e},0);return 0>n&&(n="0"+Math.abs(n).toString()),e+n}},dropdownMenu=function(){this.defaultAttrs({menuToggleSelector:".js-toggleDropdownMenu"}),this.after("initialize",function(){var e=this,t=this.getMenuToggleElement();e.$node.attr("tabindex",-1),e.$node.bind("focusout",function(n){setTimeout(function(){var i=document.activeElement;i&&!t.is(i)&&($j.contains(n.currentTarget,i)||(e.$node.toggle(!1),$j(".js-newsfeedOverlay").last().hide()))},1)}),t.click(function(t){t.preventDefault(),e.toggleDropdownMenu(),e.$node.is(":visible")?(e.$node.focus(),$j(".js-newsfeedOverlay").last().show()):$j(".js-newsfeedOverlay").last().hide()})}),this.toggleDropdownMenu=function(){this.$node.toggle()},this.getMenuToggleElement=function(){var e,t;return e=this.$node,t=e.prevAll(this.attr.menuToggleSelector).first()}},withExpandableTextField=function(){flight.compose.mixin(this,[MixinEventUtils]),this.defaultAttrs({expandedClass:"expanded",loadingClass:"loading",showClass:"show",cancelActionSelector:".cancelAction",hiddenContentSelector:".hiddenContent",inputFieldSelector:".textInput",submitActionSelector:".submitAction"}),this.after("initialize",function(){this.$inputField=this.select("inputFieldSelector"),this.select("inputFieldSelector").on("focus",$j.proxy(this.uiExpandTextField,this)),this.select("cancelActionSelector").on("click",$j.proxy(this.uiResetForm,this))}),this.uiResetForm=function(){this.$inputField.val(""),this.uiHideLoading(),this.uiCollapseTextField()},this.uiExpandTextField=function(){this.$inputField.addClass(this.attr.expandedClass),this.uiShowHiddenContent()},this.uiCollapseTextField=function(){this.$inputField.removeClass(this.attr.expandedClass),this.$inputField.css({width:"",height:""}),this.uiHideContent()},this.uiShowHiddenContent=function(){this.select("hiddenContentSelector").addClass(this.attr.showClass)},this.uiHideContent=function(){this.select("hiddenContentSelector").removeClass(this.attr.showClass)},this.uiShowLoading=function(){this.select("submitActionSelector").addClass(this.attr.loadingClass)},this.uiHideLoading=function(){this.select("submitActionSelector").removeClass(this.attr.loadingClass)}},withFormSubmission=function(){this.after("initialize",function(){this.on("submit",this.submitForm)}),this.submitForm=function(e){var t=this.$node.serialize(),n=this.$node.attr("method"),i=this.$node.attr("action");this.$node.data("remote")&&($j.ajax({url:i,type:n,data:t,dataType:"json",context:this}).done(this.onFormSuccess).fail(this.onFormError),e.preventDefault(),e.stopPropagation())},this.onFormSuccess=function(e,t,n){this.broadcast("data-form-success",e)},this.onFormError=function(e,t,n){this.trigger("data-form-error",{status:t,error:n})}},withSlideUpMenu=function(){var e="transitionend webkitTransitionEnd oTransitionEnd otransitionend";flight.compose.mixin(this,[MixinEventUtils,MixinBackgoundMask]),this.defaultAttrs({slideUpMixinEventNamespace:"slideUpMenu",slideUpAnimPrepClass:"readyToShow",slideUpShowClass:"show",slideUpItemSelectedClass:"selected",slideUpCancelSelector:".cancel",slideUpItemSelector:".slideUpMenuItem:not(.cancel)",slideUpListSelector:".slideUpMenuList"}),this.after("initialize",function(){"undefined"==typeof this.attr.menuSelector&&this.broadcastError("'menuSelector' attribute is required",!0),this.$slideUpMenu=$j(this.attr.menuSelector).first(),this.$slideUpMenu.find(this.attr.slideUpCancelSelector).on("click",$j.proxy(this.hideSlideUpMenu,this));var e=this.getListItems();e.length&&e.on("click",$j.proxy(function(e){this.attr.slideUpListItemAllowDefaultAction||e.preventDefault(),this.triggerSlideUpEvent("listItemSelected",e.target)},this)),this.initializeBackgroundMask(),this.updateMenuHeight(),this.on(document,"beforeHide.viewportOverlay",$j.proxy(function(e,t){t&&t.overlayId===this.overlayId&&this.defer(function(){this.isSlideUpMenuVisible()&&this.hideSlideUpMenu()})},this))}),this.hideSlideUpMenu=function(t){"undefined"!=typeof t&&t.preventDefault(),this.triggerSlideUpEvent("beforeHide"),this.$slideUpMenu.removeClass(this.attr.slideUpShowClass),this.hideBackgroundMask();var n=$j.proxy(function(t){this.$slideUpMenu.off(e,n),this.onHideSlideUpAnimationDone(t)},this);this.$slideUpMenu.one(e,n)},this.onHideSlideUpAnimationDone=function(e){this.$slideUpMenu.removeClass(this.attr.slideUpAnimPrepClass).select("slideUpListSelector").css("bottom",""),this.triggerSlideUpEvent("afterHide")},this.isSlideUpMenuVisible=function(){return this.$slideUpMenu.hasClass(this.attr.slideUpShowClass)},this.showSlideUpMenu=function(){/\biP(hone|ad|od)\b/i.test(navigator.userAgent)&&$j(document).trigger("hideBrowserAddressBar"),this.triggerSlideUpEvent("beforeShow"),this.$slideUpMenu.addClass(this.attr.slideUpAnimPrepClass),this.showBackgroundMask(),this.$slideUpMenu.addClass(this.attr.slideUpShowClass),this.triggerSlideUpEvent("afterShow")},this.toggleSlideUpMenuVisibility=function(e){e&&e.preventDefault(),this.isSlideUpMenuVisible()?this.hideSlideUpMenu():this.showSlideUpMenu()},this.updateMenuHeight=function(){var e=this.$slideUpMenu.find(this.attr.slideUpListSelector);if(e.length){if(this.menuHeight=e.outerHeight(),!(this.menuHeight>0))return this.broadcastError("cannot display menu list because it has no dimensions");e.css("bottom",0-this.menuHeight+"px")}},this.getSafeEventNameForSlideUpEvent=function(e){return this.getSafeEventName([e,this.attr.slideUpMixinEventNamespace].join("."))},this.onSlideUpEvent=function(e,t){this.on(this.getSafeEventNameForSlideUpEvent(e),$j.proxy(t,this))},this.triggerSlideUpEvent=function(e,t){this.trigger(this.getSafeEventNameForSlideUpEvent(e),t)},this.getListItems=function(){return this.$slideUpMenu.find(this.attr.slideUpItemSelector)}},MixinEventUtils=function(){this.broadcast=function(e,t){"undefined"==typeof t||$j.isPlainObject(t)||(t={data:t}),this.trigger(document,this.getSafeEventName(e),t)},this.broadcastError=function(e,t){if(!e||/^\s*$/.test(e))var e="unknown error";var n="unknown component",i={};if($j.each(["identifier","channel","componentName"],$j.proxy(function(e,t){var o=this.attr[t];o&&(i[t]=n=o)},this)),e=n+" : "+e,t===!0)throw new Error(e);this.trigger(document,"componentError",$j.extend({message:e},i))},this.defer=function(e,t){setTimeout($j.proxy(e,this),$j.isNumeric(t)?t:0)},this.forceBrowserReflow=function(){this.$node.offset()},this.getSafeEventName=function(e){if("string"==typeof e){var t=".";this.attr.channel&&(e+=t+this.attr.channel),this.attr.identifier&&(e+=t+this.attr.identifier)}return e},this.listen=function(e,t){this.on(document,this.getSafeEventName(e),t)}},withFormAjax=function(){this.defaultAttrs({}),this.after("initialize",function(){this.on("ajax:before",this.onBefore),this.on("ajax:error",this.onError)}),this.onBefore=function(){this.uiDismissNotification(),this.uiShowLoading()},this.onError=function(e,t,n,i){var o;try{o=$j.parseJSON(t.responseText)}catch(r){o={type:"error",message:"There was an unknown error. Please retry."}}this.uiShowNotification(o),this.uiHideLoading()}},withNotification=function(){flight.compose.mixin(this,[MixinEventUtils]);var e="info",t=["info","error","success"];this.defaultAttrs({notificationType:e,showNotificationClass:"notificationShow",dismissActionSelector:".js-notificationDismissAction",messageSelector:".js-notificationMessage"}),this.after("initialize",function(){this.$notificationNode=this.$node.find(".js-notification");var e=this.$notificationNode.find(this.attr.dismissActionSelector);e.on("click",$j.proxy(function(e){this.onDismiss(e)},this))}),this.onDismiss=function(e){this.uiDismissNotification(e),this.recordNotificationDismissal()},this.uiDismissNotification=function(){this.$notificationNode.removeClass(this.attr.showNotificationClass)},this.uiShowNotification=function(t){if($j.isPlainObject(t)){this.uiResetNotification(),t.type&&this.isValidNotificationType(t.type)?this.attr.notificationType=t.type:this.attr.notificationType=e,this.$notificationNode.addClass(this.notificationTypeToClassName(this.attr.notificationType));var n=this.$notificationNode.find(this.attr.messageSelector).first(),i=t.message;if("error"===t.type&&$j.isArray(i)&&i.length>1){var o=$j("<ul>");$j.each(i,function(e,t){o.append($j("<li>").html(t))}),n.html(o)}else n.html(i);this.$notificationNode.addClass(this.attr.showNotificationClass)}},this.uiResetNotification=function(){this.$notificationNode.removeClass(this.notificationTypeToClassName(this.attr.notificationType))},this.recordNotificationDismissal=function(){var e=this.$notificationNode.find(this.attr.dismissActionSelector).data("user-preference");if(e){var t={};t[e]=0,$j.post("/user/update_preferences",{user:t})}},this.isValidNotificationType=function(e){return $j.inArray(e,t)>-1},this.notificationTypeToClassName=function(e){return"notification"+e.charAt(0).toUpperCase()+e.slice(1)}},withTooltips=function(){this.defaultAttrs({tooltipTriggerSelector:".js-withTooltips-tooltipTrigger",tooltipSelector:".js-withTooltips-tooltip"}),this.after("initialize",function(){this.attr.titleText=this.select("tooltipTriggerSelector").attr("title"),this.on("mouseenter",{tooltipTriggerSelector:this.intendToShow,tooltipSelector:this.intendToShow}),this.on("mouseleave",{tooltipTriggerSelector:this.intendToHide,tooltipSelector:this.intendToHide})}),this.hideTooltip=function(){grPopup.hide(this.select("tooltipSelector"),function(){this.hide()})},this.intendToShow=function(){HoverIntent.onEnterIntent(this,this.showTooltip)},this.intendToHide=function(){HoverIntent.onLeaveIntent(this,this.hideTooltip)},this.showTooltip=function(){var e=this.select("tooltipSelector"),t=this.select("tooltipTriggerSelector"),n=t.attr("title");void 0!==n&&""!==n&&(t.attr("title",""),""===e.html()&&e.text(this.attr.titleText)),grPopup.show(e,function(){this.show()})}},Accordion=flight.component(function(){var e=$j(document),t="accordionComponent";this.defaultAttrs({channel:t,componentName:t,catalystSelector:".accordionHeading",contentSelector:".accordionContent",openClass:"sectionOpen",outsideCatalystSelectors:"",outsideCatalystsCloseSection:!1}),this.after("initialize",function(){var e=this.select("catalystSelector"),t="";e.on("click",$j.proxy(this.toggleState,this)),""!==this.attr.outsideCatalystSelectors&&(t=this.attr.outsideCatalystsCloseSection===!1?"openState":"toggleState",$j(this.attr.outsideCatalystSelectors).on("click",$j.proxy(this[t],this)))}),this.toggleState=function(e){this.isVisible()?this.closedState(e):this.openState(e)},this.isVisible=function(){return this.$node.hasClass(this.attr.openClass)},this.openState=function(t){this.$node.addClass(this.attr.openClass),"true"===$j(t.target).data("scroll-to-section")&&e.scrollTop(this.$node.offset().top)},this.closedState=function(e){this.$node.removeClass(this.attr.openClass)}});$gr.shared.amazonPurchasesBanner=flight.component(function(){var e="amazonPurchasesBannerComponent";this.defaultAttrs({channel:e,componentName:e,dismissButtonSelector:".dismissButton",rateBooksContainerSelector:".rateBooks"}),this.after("initialize",function(){this.on("click",{dismissButtonSelector:this.hideBanner}),this.$node.parents(this.attr.rateBooksContainerSelector).length&&this.hideDismissButton()}),this.hideBanner=function(e){this.$node.fadeOut(),this.updateHideBannerPreference(),e.preventDefault(),this.teardown()},this.hideDismissButton=function(){this.select("dismissButtonSelector").hide()},this.updateHideBannerPreference=function(){$j.post("/user/update_preferences",{user:{show_amazon_import_prompt:0}})}}),$gr.shared.asyncGlideButton=flight.component(function(){this.after("initialize",function(){var e=this.$node.data("book-id");this.getGlideData(e)}),this.getGlideData=function(e){$j.ajax({url:"/buttons/glide/"+e,type:"GET",context:this,success:function(e){this.readJson(e)}})},this.readJson=function(e){var t=e.glide_eligible,n=e.glide_enabled,i=e.ku_eligible,o=e.ebook_price,r=e.asin;n?(this.$node.find(".glideButton").attr("data-asin",r),i?(this.$node.find(".glideButton").attr("data-ku-eligible",!0),this.$node.find(".asyncGlideButton").attr("data-ref-tag","x_gr_w_glide_sout_ku"),this.$node.find(".asyncKindleUnlimitedBuyText").attr("data-ref-tag","x_gr_w_glide_sout_ku_buy"),this.$node.find(".asyncGlideButton").html('Kindle Unlimited <span class="kindleUnlimitedPrice">$0.00</span>'),this.$node.find(".asyncKindleUnlimitedBuyText").text("Or buy for "+o),this.$node.find(".asyncKindleUnlimitedBuyText").show()):(this.$node.find(".glideButton").attr("data-ku-eligible",!1),this.$node.find(".asyncGlideButton").attr("data-ref-tag","x_gr_w_glide_sout"),this.$node.find(".asyncGlideButton").text("Kindle eBook $"+o)),this.updateBuyButtonRefTag("x_gr_w_glide_bb_sout"),this.$node.find("#buyDropButtonStores .buttonBar").html("Stores&nbsp;&#9662;"),this.$node.find(".secondBuyButton").removeClass("secondBuyButton"),this.$node.find(".asyncGlideButton").css("display","inline-block")):t&&this.updateBuyButtonRefTag("x_gr_w_bb_sout")},this.updateBuyButtonRefTag=function(e){var t=/ref=(\S)+?(?=&|$)/,n=/tag=(\S)+?(?=&|$)/,i=this.$node.find("#buyButton");if(1==i.length){var o=i.attr("href");o=o.replace(t,"ref="+e),o=o.replace(n,"tag="+e+"-20"),i.attr("href",o)}}},MixinEventUtils),$gr.shared.asyncPreviewButton=flight.component(function(){this.after("initialize",function(){var e=this.$node.data("book-id");this.getPreviewLink(e)}),this.getPreviewLink=function(e){$j.ajax({url:"/buttons/preview/"+e,type:"GET",data:{},context:this,success:function(e){this.readJson(e)}})},this.readJson=function(e){var t=e.preview_link;t&&(this.$node.find(".asyncPreviewButton").attr("href",t),this.$node.show())}},MixinEventUtils),$gr.shared.audibleSampleButton=flight.component(function(){this.audibleIframeLocation="https://www.audible.com",this.defaultAttrs({audibleSampleContainer:"#audibleSample",audibleFlyoutFrame:"#audibleSampleFlyoutFrame",modalAMediumHeight:175,modalALargeHeight:245}),this.after("initialize",function(){this.on("message onmessage",this.receiveMessage)}),this.receiveMessage=function(e){if(e=e.originalEvent,e.origin===this.audibleIframeLocation){var t=e.data;if("function"==typeof this[t.func]){if(!isShowingBuyableFeatures())return;$j.proxy(this[t.func],this).call()}}},this.showAudibleModalA=function(){$j(this.attr.audibleFlyoutFrame).removeClass("audibleSampleFlyoutFrameNoTreatment"),$j(this.attr.audibleFlyoutFrame).addClass("audibleSampleFlyoutFrameTreatmentA")},this.showAudibleModalB=function(){$j(this.attr.audibleFlyoutFrame).removeClass("audibleSampleFlyoutFrameNoTreatment"),$j(this.attr.audibleFlyoutFrame).addClass("audibleSampleFlyoutFrameTreatmentB")},this.showAudibleButton=function(){$j(this.attr.audibleSampleContainer).css("display","inline-block"),$j(this.attr.audibleFlyoutFrame).addClass("audibleSampleFlyoutFrameNoTreatment")},this.showAudibleSampleFlyout=function(){$j(this.attr.audibleFlyoutFrame).show()},this.hideAudibleSampleFlyout=function(){$j(this.attr.audibleFlyoutFrame).hide()},this.showAudibleSampleFlyoutLarge=function(){$j(this.attr.audibleFlyoutFrame).height(this.attr.modalALargeHeight)},this.showAudibleSampleFlyoutMedium=function(){$j(this.attr.audibleFlyoutFrame).height(this.attr.modalAMediumHeight)}}),$gr.shared.authorAnswersSort=flight.component(function(){this.defaultAttrs({sortMenuSelector:".answersSort__menu",loadingSelector:".answersSort__spinner"}),this.after("initialize",function(){this.$answersContainer=$j(".authorAnsweredQuestions__questionsList"),this.$loadingIcon=$j(".authorAnsweredQuestions__loading"),this.$errorContainer=$j(".authorAnsweredQuestions__errorMessage"),this.on("change",{sortMenuSelector:this.getSortedAnswers})}),this.updateAnswerList=function(e,t,n){this.$loadingIcon.hide(),this.$answersContainer.html(e.content_html).fadeIn(),LoadMore.attachTo(".jsLoadMoreAnswered",{loadMoreContainerSelector:"#loadMoreContainerAnsweredQuestions",loadMoreActionSelector:".loadMoreActionAnsweredQuestions",loadMoreSelector:".jsLoadMoreAnswered"})},this.showLoadingIcon=function(){this.$answersContainer.hide(),this.$loadingIcon.show()},this.showError=function(){this.$loadingIcon.hide(),this.$errorContainer.show()},this.getSortedAnswers=function(){this.showLoadingIcon();var e=this.select("sortMenuSelector").data("url");$j.ajax({url:e,type:"get",data:{format:"json",sort:this.select("sortMenuSelector").val(),resort:!0},context:this,success:this.updateAnswerList,error:this.showError})}},MixinEventUtils),$gr.shared.authorDashboardQA=flight.component(function(){var e="authorDashboardQA";this.defaultAttrs({channel:e,componentName:e,digestSettingsSelector:".js-authorDigestSettings",errorMessageSelector:".errorMessage",loadingQuestionsSelector:".js-questions-loading",optedInActionSelector:".js-optIntoAuthorQA",optedInFormMessageSelector:".js-optedInMessage",optedInNotificationSelector:".js-optedInNotification",optedInSettingsSelector:".js-optedInSettings",optedOutActionSelector:".js-optOutofAuthorQA",optedOutFormMessageSelector:".js-optedOutMessage",pendingQuestionsCountSelector:".js-pending-questions-count",skipQuestionSelector:".js-skipQuestionAction",starterQuestionSelector:".starterQuestion",unansweredQuestionsContainerSelector:".unansweredQuestionsContainer",unansweredQuestionSelector:".unansweredQuestion"}),this.after("initialize",function(){this.optInUrl=this.select("optedInActionSelector").data("url"),this.optOutUrl=this.select("optedOutActionSelector").data("url"),this.currentQuestionsCount=parseInt(this.select("pendingQuestionsCountSelector").data("count")),this.attr.optIntoQaActionSelectors=[this.attr.optedInActionSelector,this.attr.optedOutActionSelector].join(","),this.on("change",{optIntoQaActionSelectors:this.updateOptInState,digestSettingsSelector:this.updateDigestSettings}),this.on("ajax:success",{skipQuestionSelector:this.uiHideSkippedQuestion}),this.listen("answerFormSubmitted",this.uiDecrementQuestionsCount)}),this.uiShowOptedOutState=function(){this.select("optedInNotificationSelector").hide(),this.select("starterQuestionSelector").show(),this.select("optedInFormMessageSelector").hide(),this.select("optedOutFormMessageSelector").show(),this.select("optedInSettingsSelector").hide()},this.uiShowOptedInState=function(e,t,n){this.select("optedInNotificationSelector").show(),this.select("starterQuestionSelector").hide(),this.select("optedInFormMessageSelector").show(),this.select("optedOutFormMessageSelector").hide(),this.select("optedInSettingsSelector").show(),$j.isPlainObject(e)&&e.content_html&&(this.select("unansweredQuestionsContainerSelector").html(e.content_html),this.select("pendingQuestionsCountSelector").text(e.questions_count),this.currentQuestionsCount=e.questions_count),this.select("loadingQuestionsSelector").hide()},this.uiShowError=function(){this.select("errorMessageSelector").show()},this.uiHideSkippedQuestion=function(e,t,n){$j(e.target).parents(this.attr.unansweredQuestionSelector).fadeOut(),this.uiDecrementQuestionsCount()},this.uiDecrementQuestionsCount=function(){this.currentQuestionsCount-=1,this.currentQuestionsCount=Math.max(0,this.currentQuestionsCount),this.select("pendingQuestionsCountSelector").text(this.currentQuestionsCount)},this.updateOptInState=function(){var e=this.select("optedInActionSelector").is(":checked");e&&this.select("optedInActionSelector").data("neverOpted")&&this.select("loadingQuestionsSelector").show(),$j.ajax({url:e?this.optInUrl:this.optOutUrl,type:"post",data:{format:"json"},context:this,success:e?this.uiShowOptedInState:this.uiShowOptedOutState,error:this.uiShowError})},this.updateDigestSettings=function(){var e=this.select("digestSettingsSelector").data("url"),t=this.select("digestSettingsSelector").find("input:checked").val();$j.ajax({url:e,type:"post",data:{format:"json",digest_frequency:t},context:this,error:this.uiShowError})}},MixinEventUtils),$gr.shared.authorFollow=flight.component(function(){var e="AuthorFollow";this.defaultAttrs({channel:e,componentName:e,activeClass:"gr-button--togglable--enabled",inactiveClass:"gr-button--togglable--disabled",hoverClass:"btnHover",activeStateMethod:"delete",inactiveStateMethod:"post"}),this.after("initialize",function(){this.$node.data("activeButtonText")&&(this.activeStateText=this.$node.data("activeButtonText")),this.$node.data("inactiveButtonText")&&(this.inactiveStateText=this.$node.data("inactiveButtonText")),this.$node.data("hoverButtonText")&&(this.hoverStateText=this.$node.data("hoverButtonText"),this.on("mouseenter",this.activateHover),this.on("mouseleave",this.deactivateHover)),this.on("click",this.updateAuthorFollowing)}),this.updateAuthorFollowing=function(){this.methodType=this.$node.attr("method"),this.url=this.$node.data("requestUrl"),this.disabledState();var e=$j.ajax({url:this.url,type:this.methodType,data:{format:"json"},context:this});e.done(this.onButtonSuccess),e.fail(this.onButtonError),e.always(this.onButtonComplete)},this.onButtonSuccess=function(e,t){$j.isPlainObject(e)&&this.$node.data("requestUrl",e.url),$j("#flashMessages").trigger("clearFlashError"),this.toggleState();var n=0;n=this.$node.hasClass(this.attr.activeClass)?1:-1,this.trigger("authorFollowersCountChanged",{countDelta:n})},this.onButtonComplete=function(e){this.enabledState()},this.onButtonError=function(e){if(403===e.status)this.defer(function(){this.authRedirect(e,$j.proxy(function(){var t="Unknown XHR failure when trying to follow author.";e.status&&(t+=" , status code "+e.status),this.broadcastError(t)},this))},500);else{var t="There was an error when trying to follow/unfollow an author.";$j("#flashMessages").trigger("addFlashMessage",[t,"error"]),this.$node.data("hoverButtonText")&&$j("#notificationBanner").trigger("showNotification",{type:"error",message:t})}},this.toggleState=function(){this.$node.hasClass(this.attr.inactiveClass)?this.activeState():this.inactiveState()},this.activateHover=function(){this.hoverStateText&&this.$node.hasClass(this.attr.activeClass)&&this.hoverState()},this.deactivateHover=function(){this.hoverStateText&&this.$node.hasClass(this.attr.hoverClass)&&this.activeState()},this.activeState=function(){this.$node.addClass(this.attr.activeClass),this.$node.removeClass(this.attr.inactiveClass),this.$node.removeClass(this.attr.hoverClass),this.$node.attr("method",this.attr.activeStateMethod),this.$node.text(this.activeStateText)},this.inactiveState=function(){this.$node.addClass(this.attr.inactiveClass),this.$node.removeClass(this.attr.activeClass),this.$node.removeClass(this.attr.hoverClass),this.$node.attr("method",this.attr.inactiveStateMethod),this.$node.text(this.inactiveStateText)},this.hoverState=function(){this.$node.addClass(this.attr.hoverClass),this.$node.removeClass(this.attr.activeClass),this.$node.removeClass(this.attr.inactiveClass),this.$node.text(this.hoverStateText)},this.disabledState=function(){this.$node.attr("disabled","disabled")},this.enabledState=function(){this.$node.removeAttr("disabled")}},MixinEventUtils,MixinAuthRedirect),$gr.shared.authorFollowersCount=flight.component(function(){var e="AuthorFollowersCount",t="count";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.on(document,"authorFollowersCountChanged",this.updateAuthorFollowersCount)}),this.updateAuthorFollowersCount=function(e,n){var i,o=this.$node.data(t);parseInt(o)===o&&(o+=n.countDelta)>=0&&(i=o+" ",i+=1===o?"follower":"followers",this.$node.text(i).data(t,o))}}),$gr.shared.notificationBanner=flight.component(function(){this.after("initialize",function(){this.on("showNotification",function(e,t){this.uiShowNotification(t)}),this.on("resetNotification",this.uiResetNotification),this.on("dismissNotification",this.uiDismissNotification)})},withNotification);var Autocomplete=flight.component(function(){var e="autocomplete";this.defaultAttrs({channel:e,componentName:e,menuListParentSelector:"body",menuListSelector:".resultsList",menuListItemSelector:".resultsListItem",menuListItemLinkSelector:".resultsListItemLink",menuBaseClass:e,menuShowClass:"show",$queryAjaxSettings:{},queryParamName:"q",queryLengthMin:3,queryLengthMax:50,queryDebounceDuration:500,queryCallback:!1,selectToFillIn:!1}),this.after("initialize",function(){this.initializeMenu(),this.on("keyup",flight.utils.debounce($j.proxy(this.onKeystroke,this),this.attr.queryDebounceDuration)),this.on(this.getSafeEventName("reset"),this.onReset),this.on(this.getSafeEventName("clearMenu"),this.onClearMenu)}),this.initializeMenu=function(){if(!this.$menuRoot){this.$menuRoot=$j("<div/>").addClass(this.attr.menuBaseClass).appendTo(this.attr.menuListParentSelector),this.attr.identifier&&this.$menuRoot.data(this.attr.componentName+"-id",this.attr.identifier);var e=this;$j("html").click(function(){e.hideMenu()}),this.$menuRoot.on("click",this.attr.menuListItemSelector,$j.proxy(this.onSelectMenuItem,this))}},this.clearMenu=function(){this.$menuRoot.empty()},this.hideMenu=function(){this.isMenuVisible()&&(this.$menuRoot.removeClass(this.attr.menuShowClass),this.trigger(this.getSafeEventName("hideMenu")))},this.isMenuVisible=function(){return this.$menuRoot.hasClass(this.attr.menuShowClass)},this.reset=function(){this.hideMenu(),this.clearMenu(),this.$node.val("")},this.showMenu=function(){this.isMenuVisible()||(this.$menuRoot.addClass(this.attr.menuShowClass),this.trigger(this.getSafeEventName("showMenu")))},this.updateMenu=function(e){this.$menuRoot.html(e),this.trigger(this.getSafeEventName("updateMenu"))},this.submitQuery=function(e){if(this.attr.queryCallback)return results=this.attr.queryCallback(e),void this.onSubmitQuerySuccess(results);if("string"!=typeof e&&(e=this.$node.val()),e.length>=this.attr.queryLengthMin&&e.length<=this.attr.queryLengthMax){this.cachedAjaxSettings||(this.cachedAjaxSettings=$j.extend({},this.attr.$queryAjaxSettings,{context:this,success:this.onSubmitQuerySuccess,error:function(){this.onSubmitQueryError(e)},complete:function(){this.trigger(this.getSafeEventName("submitQueryEnd")),this.$activeAjaxRequest=null},beforeSend:function(){this.trigger(this.getSafeEventName("submitQueryStart"))}}));var t=$j.extend({},this.cachedAjaxSettings);$j.isPlainObject(t.data)?t.data[this.attr.queryParamName]=e:t.url+=(t.url.indexOf("?")>=0?"&":"?")+this.attr.queryParamName+"="+encodeURIComponent(e),this.$activeAjaxRequest&&this.$activeAjaxRequest.abort(),this.$activeAjaxRequest=$j.ajax(t)}else this.clearMenu()},this.onClearMenu=function(e){this.clearMenu()},this.onKeystroke=function(e){13===e.charCode&&e.preventDefault(),this.submitQuery()},this.onReset=function(e){this.reset()},this.onSelectMenuItem=function(e){e.preventDefault();var t=$j(e.target).closest(this.attr.menuListItemSelector),n=t.find(this.attr.menuListItemLinkSelector);if(n.length)if(this.attr.selectToFillIn===!0){var i=n.text(),o=t.data("bookId");i&&(this.$node.val(i),this.$node.data("bookId",o),this.hideMenu())}else{var r=n.attr("href");r&&(this.reset(),location.href=r)}},this.onSubmitQuerySuccess=function(e){var t=e;$j.isPlainObject(e)&&e.html&&(e=e.html),this.updateMenu(e),this.showMenu(),t.attachLoadMore&&LoadMore.attachTo(".jsLoadMore")},this.onSubmitQueryError=function(e){var t="bad response from query";"string"==typeof e&&(t+=' : "'+e+'"'),this.trigger(this.getSafeEventName("submitQueryError")),this.broadcastError(t),this.hideMenu()}},MixinEventUtils),BackToTopButton=flight.component(function(){var e="backToTopButton";this.defaultAttrs({hideOnFocusSelectors:"input[type='text'], input[type='password'],                                  select, textarea",showClass:"show",buttonVisibilityThresholdBottom:150,buttonVisibilityThresholdTop:150,scrollDebounceDuration:15,channel:e,componentName:e}),this.after("initialize",function(){this.isFieldFocused=!1,this.on("click",this.onScrollToTop),this.on(window,"scroll",flight.utils.debounce(this.onUpdateDisplay,this.attr.scrollDebounceDuration));var e=[this.getSafeEventName("focus"),this.getSafeEventName("blur")].join(" ");$j(document.body).on(e,this.attr.hideOnFocusSelectors,$j.proxy(function(e){$j(e.target).is(":visible")&&(e.type.indexOf("focusin")>=0?this.onFieldFocus():this.onFieldBlur())},this))}),this.hide=function(){this.isVisible()&&this.$node.removeClass(this.attr.showClass)},this.isVisible=function(){return this.$node.hasClass(this.attr.showClass)},this.scrollToTop=function(){$j(document).scrollTop(0)},this.show=function(){this.isVisible()||this.$node.addClass(this.attr.showClass)},this.updateDisplay=function(){var e=window.scrollY,t=$j(document).height()-$j(window).height()-this.attr.buttonVisibilityThresholdBottom;this.isFieldFocused||e<this.attr.buttonVisibilityThresholdTop||e>t?this.hide():this.show()},this.onFieldBlur=function(e){this.isFieldFocused=!1,this.updateDisplay()},this.onFieldFocus=function(e){this.isFieldFocused=!0,this.hide()},this.onScrollToTop=function(e){e.preventDefault(),this.scrollToTop()},this.onUpdateDisplay=function(e){this.updateDisplay()}},MixinEventUtils);$gr.shared.bookCarousel=flight.component(function(){var e=($j(document),"bookCarouselComponent");this.maxLeft=0,this.minLeft=0,this.defaultAttrs({channel:e,componentName:e,bookCover:".cover",carouselRow:".carouselRow",carouselNav:".navButton",navBackgroundClass:"highlightedNavButton",nextButtonClass:"navButtonNext",prevButtonClass:"navButtonPrev",rightArrowPadding:30,slideDelay:500}),this.after("initialize",function(){this.containerWidth=this.$node.width(),this.setBoundsOfCarousel(),this.setNavVisibility(),this.toggleBackground(!1),this.on("click",{carouselNav:this.moveCarousel}),this.on("mouseenter",this.highlightNavigation),this.on("mouseleave",this.removeHighlightInNavigation)}),this.setBoundsOfCarousel=function(){var e=0;this.select("carouselRow").find(this.attr.bookCover).each(function(){e+=$j(this).outerWidth()}),this.minLeft=Math.min(this.containerWidth-e-this.attr.rightArrowPadding,this.maxLeft)},this.moveCarousel=function(e){var t,n=$j(e.target).parent();n.hasClass(this.attr.nextButtonClass)?t="next":n.hasClass(this.attr.prevButtonClass)&&(t="prev"),this.singleSlide(t)},this.highlightNavigation=function(){this.toggleBackground(!0),this.setNavVisibility()},this.removeHighlightInNavigation=function(){this.toggleBackground(!1),this.setNavVisibility()},this.singleSlide=function(e){var t;this.select("carouselRow").stop(),"prev"===e?t=this.select("carouselRow").position().left+4*this.containerWidth/5:"next"===e&&(t=this.select("carouselRow").position().left-4*this.containerWidth/5),t=Math.min(t,this.maxLeft),t=Math.max(t,this.minLeft),this.setNavVisibility(t),this.select("carouselRow").animate({left:t},this.attr.slideDelay)},this.setNavVisibility=function(e){"undefined"==typeof e&&this.select("carouselRow").length&&(e=this.select("carouselRow").position().left),e>this.minLeft?this.$node.find("."+this.attr.nextButtonClass).show():this.$node.find("."+this.attr.nextButtonClass).hide(),e<this.maxLeft?this.$node.find("."+this.attr.prevButtonClass).show():this.$node.find("."+this.attr.prevButtonClass).hide()},this.toggleBackground=function(e){this.select("carouselNav").toggleClass(this.attr.navBackgroundClass,e)}});var BookProgressUpdate=flight.component(function(){var e="bookProgressUpdate";this.defaultAttrs({bookSelectorPrefix:"#book_list_item_",cancelSelector:".actionFormControls .cancel",catalystButtonSelector:".startUpdate",distractionSelector:".reviewList",fieldSelector:".field",fieldToggleSelector:".swap",finishedSelector:".finished",formSelector:".actionForm",progressSelector:".bookProgress",fieldToggleClass:"showPages",meterClass:"meter",showFormClass:"active",channel:e,componentName:e,enableCollapseDistractions:!0
}),this.after("initialize",function(){this.on("click",{cancelSelector:this.onHideForm,fieldToggleSelector:this.onFieldsToggle});var e=this.$node.data("bookid");this.$bookNode=$j(this.attr.bookSelectorPrefix+e).first(),this.on(this.$bookNode.find(this.attr.catalystButtonSelector),"click",this.showForm),this.after("hideForm",function(){this.select("formSelector").get(0).reset()});var t=this.select("fieldSelector");t.on("focus",function(){$j(this).val("")}),t.each(function(){var e=$j(this),t=e.val(),n=new RegExp(e.attr("pattern"));n&&n.test(t)&&!/^\s*$/.test(t)&&e.data("default-value",t)}),this.on("submit",{formSelector:function(e){this.validateFields()||(e.preventDefault(),e.stopPropagation(),this.showMessage("Your progress was not updated. Please enter a valid number.",!0))}}),this.on("ajax:success",{formSelector:this.onFormSubmitSuccess}),this.on("ajax:error",{formSelector:this.onFormSubmitError})}),this.hideForm=function(){this.$node.removeClass(this.attr.showFormClass),this.toggleDistractionlessMode(!1)},this.showForm=function(){this.$node.addClass(this.attr.showFormClass),this.toggleDistractionlessMode(!0)},this.showMessage=function(e,t){if("string"==typeof e&&!/^\s*$/.test(e)){var n=$j("#flashMessages");t?alert(e):n.trigger("addFlashMessage",[e])}},this.toggleFields=function(){this.select("formSelector").toggleClass(this.attr.fieldToggleClass),this.select("fieldSelector").each(function(){this.disabled=!this.disabled})},this.toggleDistractionlessMode=function(e){var t=$j(this.attr.distractionSelector);this.attr.enableCollapseDistractions===!0?t[e?"hide":"show"]():t.css("visibility",e?"hidden":"")},this.onFieldsToggle=function(e){e.preventDefault(),this.toggleFields();var t=$j(e.target),n=t.text(),i=t.data("swap-text");t.text(i).data("swap-text",n)},this.onHideForm=function(e){e.preventDefault(),this.hideForm()},this.onFormSubmitError=function(e,t){this.defer(function(){this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure when trying to update book progress.";t.status&&(e+=" , status code "+t.status),this.broadcastError(e)},this))},500)},this.onFormSubmitSuccess=function(e,t){if($j.isPlainObject(t)){if(t.html_meter&&!/^\s*$/.test(t.html_meter)){var n=this.$bookNode.find("."+this.attr.meterClass);if(n.length)n.html(t.html_meter);else{var i=this.$bookNode.find(this.attr.progressSelector);$j(t.html_meter).wrap("<div/>").addClass(this.attr.meterClass).prependTo(i)}}this.isBookFinished()&&this.$bookNode.hide(),t.message&&this.showMessage(t.message),this.hideForm()}else this.broadcastError("Malformed JSON response when trying to update book progress.")},this.isBookFinished=function(){return this.select("finishedSelector").prop("checked")},this.getVisibleField=function(){return this.select("fieldSelector").filter(":visible").first()},this.validateFields=function(){if(this.isBookFinished())return!0;var e=this.getVisibleField();if(e.length){var t=/^\d+$/,n=e.data("default-value"),i=e.val();return t.test(n)?t.test(i)&&i!==n:t.test(i)}return!1}},MixinEventUtils,MixinAuthRedirect),BrowseButton=flight.component(function(){this.after("initialize",function(){this.on(document,"topBrowseMenuOpened",this.openMenu),this.on(document,"topBrowseMenuClosed",this.closeMenu),this.on($gr.touch,function(e){e.preventDefault(),"block"===$j("#browseMenu").css("display")?this.trigger(document,"topBrowseMenuClosed"):this.trigger(document,"topBrowseMenuOpened")})}),this.openMenu=function(){this.$node.addClass("selectedLinkBarItem")},this.closeMenu=function(){this.$node.removeClass("selectedLinkBarItem")}}),BrowseMenu=flight.component(function(){this.after("initialize",function(){this.on(document,"topBrowseMenuOpened",this.openMenu),this.on(document,"topBrowseMenuClosed",this.closeMenu)}),this.openMenu=function(){this.$node.css("display","block")},this.closeMenu=function(){this.$node.css("display","none")}}),ReCaptcha=flight.component(function(){this.defaultAttrs({site_key:null,theme:"light"});var e=function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e;var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)};this.after("initialize",function(){if(this.on("reset",function(){this.reset()}),"undefined"==typeof grecaptcha){if("undefined"==typeof _recaptchaLoadedCallback){var t=this;window._recaptchaLoadedCallback=function(){t.render()}}return e("https://www.google.com/recaptcha/api.js?render=explicit&onload=_recaptchaLoadedCallback"),!0}this.render()}),this.render=function(){"undefined"!=typeof grecaptcha&&(this.widget_id=grecaptcha.render(this.node,{sitekey:this.attr.site_key,theme:this.attr.theme}))},this.reset=function(){"undefined"!=typeof grecaptcha&&grecaptcha.reset(this.widget_id);try{div=jQuery("tr.gc-reset").closest("table.pls-container").parent("div"),ins=div.next("ins"),div.remove(),ins.remove()}catch(e){}this.$node.empty()}}),Carousel=flight.component(function(){var e,t,n;this.defaultAttrs({itemSelector:".carouselItem"}),this.after("initialize",function(){var e=Hammer(this.$node,{drag_block_horizontal:!0});e.on("dragstart",$j.proxy(this.initializeCarousel,this)),e.on("drag",$j.proxy(this.moveCarousel,this)),this.listen("saveRatingSuccess.ratingStars",this.addBooks)}),this.initializeCarousel=function(){var i=this.$node.parent(),o=i.innerWidth(),r=i.parent().innerWidth(),s=this.select("itemSelector");t=0,$j.each(s,function(e,n){t+=$j(n).outerWidth(!0)+4}),r>o&&(o-=r-o),o>t&&this.off("drag"),e=parseInt(this.$node.css("left"),10),n=-Math.abs(t-o)},this.moveCarousel=function(t){var i=e+t.gesture.deltaX;0>i?n>i?this.$node.css("left",n):this.$node.css("left",i):this.$node.css("left","0")},this.addBooks=function(e,t){void 0!==t.related_work_row&&void 0!==t.book_id&&($j(".carouselItem[rel='"+t.book_id+"']").after(t.related_work_row),$j(document).trigger("rateBooksCarouselUpdated"))}},MixinEventUtils);$gr.shared.challenge=flight.component(function(){var e="challengeComponent";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){_.each($j("li.step"),function(e){e.on("click",t)})});var t=function(){this.className+=" doneStep"}}),$gr.challengeBooksComponent=flight.component(function(){var e,t,n,i="View More \u25be",o="View Less \u25b4",r=!1;this.defaultAttrs({sortClass:".sortBy",expandToggleClass:"#showMoreReviews",collapsibleBooksClass:".moreChallengeCovers"}),this.after("initialize",function(){e=$j(this.attr.sortClass),t=$j(this.attr.expandToggleClass),n=$j(this.attr.collapsibleBooksClass),e.change(this.toggleSort),t.click(this.toggleReviewDisplay),t.text()===o&&(r=!0)}),this.toggleSort=function(){var t=e.val(),n="?sort_by="+t;r&&(n+="&expand=true"),window.location.href=window.location.href.replace(/[\?#].*|$/,n)},this.toggleReviewDisplay=function(){var e=t.text().trim();e===i?(n.show(),t.text(o),r=!0):(n.hide(),t.text(i),r=!1)}},MixinEventUtils),$gr.shared.checkBoxForm=flight.component(function(){this.defaultAttrs({continueMessageSelector:".js-continueMessage",checkedClass:"",checkBoxContainerSelector:"",saveActionSelector:".js-saveAction",mobile:!1}),this.after("initialize",function(){this.uiSetupForm(),this.on("click",{checkBoxContainerSelector:this.uiUpdateCheckbox}),this.on("click",{saveActionSelector:this.submitFormAndHide})}),this.submitFormAndHide=function(e){e.preventDefault(),e.stopPropagation(),this.$node.submit(),this.trigger("hideModal")},this.uiSetupForm=function(){var e=this.$node.find(":checkbox"),t=this;e.each(function(e){var n=$j(this),i=n.closest(t.attr.checkBoxContainerSelector);n.prop("checked")?i.addClass(t.attr.checkedClass):i.removeClass(t.attr.checkedClass)}),this.uiUpdateFormSaveButton()},this.uiUpdateCheckbox=function(e){var t=$j(e.target).closest(this.attr.checkBoxContainerSelector),n=t.find(":checkbox");return $j(e.target)!==n&&(n.prop("checked")?t.addClass(this.attr.checkedClass):t.removeClass(this.attr.checkedClass)),this.uiUpdateFormSaveButton(),!1},this.uiUpdateFormSaveButton=function(){if(this.$node.data("forceSelection")){var e=this.$node.find("input:checked").length>0;this.attr.mobile?e?(this.select("saveActionSelector").addClass("enabled"),this.select("saveActionSelector").removeAttr("disabled")):(this.select("saveActionSelector").removeClass("enabled"),this.select("saveActionSelector").attr("disabled","disabled")):(this.select("continueMessageSelector").toggle(!e),this.select("saveActionSelector").toggle(e))}else this.select("continueMessageSelector").hide(),this.select("saveActionSelector").show()}},MixinEventUtils,withFormSubmission);var CommentComposer=flight.component(function(){var e="commentComposer";this.defaultAttrs({channel:e,componentName:e,commentCountContainerSelector:".commentsCount",formSelector:"form",submitButtonSelector:".jsCommentComposerSubmitButton",textAreaContainerSelector:".expandingArea",textAreaMirrorSelector:".expandingArea span",textAreaSelector:".jsCommentComposerTextArea",commentCountHideClass:"hide"}),this.after("initialize",function(){return this.$commentList=$j(this.$node.data("comment-list")).first(),this.$commentList.length<1?this.broadcastError("No comment list selector found."):(this.commentCountSelector=this.$node.data("comment-counter"),this.select("textAreaContainerSelector").addClass("active"),this.toggleSubmitButton(),this.select("textAreaMirrorSelector").text(this.select("textAreaSelector").val()),this.on("input",this.resizeTextArea),this.on("input",this.toggleSubmitButton),this.$form=this.select("formSelector").first(),this.$form.on("ajax:success",$j.proxy(this.onFormSubmitSuccess,this)),void this.$form.on("ajax:error",$j.proxy(this.onFormSubmitError,this)))}),this.resizeTextArea=function(e){this.select("textAreaMirrorSelector").text(this.select("textAreaSelector").val())},this.toggleSubmitButton=function(e){this.select("textAreaSelector").val().length>0?(this.select("submitButtonSelector").show(),this.select("textAreaContainerSelector").addClass("jsCommentComposerTextAreaFilled")):(this.select("submitButtonSelector").hide(),this.select("textAreaContainerSelector").removeClass("jsCommentComposerTextAreaFilled"))},this.onFormSubmitError=function(e,t){this.defer(function(){this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure when trying to add new comment";t.status&&(e+=" , status code "+t.status),this.broadcastError(e)},this))},500)},this.onFormSubmitSuccess=function(e,t){this.insertComment(t.html),this.updateCommentCount(t.count),this.clearCommentField()},this.clearCommentField=function(){this.select("textAreaSelector").val("")},this.insertComment=function(e){this.$commentList.is(":visible")||this.$commentList.show().removeClass("empty"),this.$commentList.append(e)},this.updateCommentCount=function(e){$j(this.commentCountSelector).html(e);var t=$j(this.commentCountSelector).closest(this.attr.commentCountContainerSelector);e>0&&t.hasClass(this.attr.commentCountHideClass)&&t.removeClass(this.attr.commentCountHideClass)}},MixinEventUtils,MixinAuthRedirect);$gr.shared.confirmModal=flight.component(function(){var e="confirmModal";this.defaultAttrs({channel:e,componentName:e,cancelActionSelector:".js-cancelAction",closeModalSelector:".js-closeModalIcon",confirmActionSelector:".js-confirmAction",confirmHeadingSeletor:".js-confirmationHeading",confirmMessageSelector:".js-confirmationMessage",confirmActionText:"Yes",confirmModalId:"confirmationModal",modalHeading:"Are you sure?",modalMessage:"",modalHeight:150,modalWidth:500}),this.after("initialize",function(){this.$modal=this.uiBuildModal(),this.on("click, ajax:before",this.onClick),this.on(document,"ui.modal.hideComplete",this.teardownModal),this.listen("hideConfirmModal",this.uiHideModal)}),this.onConfirmSuccess=function(){this.uiHideModal(),"undefined"!=typeof this.redirectPath?window.location.href=this.redirectPath:window.location.reload(!0)},this.onConfirmError=function(){this.uiHideModal()},this.onClick=function(){return this.uiShowModal(),!1},this.uiSetupModal=function(){var e=this.$modal.find(this.attr.confirmActionSelector),t=this.$modal.find(this.attr.cancelActionSelector),n=this.$node.attr("href"),i=this.$node.data(),o=i.confirmationHeading,r=i.confirmationMessage,s=i.method,a=i.remote;this.redirectPath=i.redirectPath,"undefined"==typeof r&&(r=this.attr.modalMessage),"undefined"==typeof o&&(o=this.attr.modalHeading),this.$modal.find(this.attr.confirmMessageSelector).html(r),this.$modal.find(this.attr.confirmHeadingSeletor).text(o),e.attr("data-method",s),e.attr("data-remote",a),e.attr("href",n),e.on("ajax:success",$j.proxy(function(e,t,n,i){this.onConfirmSuccess()},this)),e.on("ajax:error",$j.proxy(function(e,t,n,i){this.onConfirmError()},this)),t.click(this.uiHideModal)},this.uiShowModal=function(){this.uiSetupModal(),this.uiAttachModal(),Lightbox.showBoxByID(this.attr.confirmModalId,this.attr.modalWidth,this.attr.modalHeight)},this.uiHideModal=function(){Lightbox.hideBox()},this.uiAttachModal=function(){var e=$j("#"+this.attr.confirmModalId);e.length?e.replaceWith(this.$modal):this.$modal.appendTo("body")},this.uiBuildModal=function(){var e,t,n;return t={confirmModalId:this.attr.confirmModalId,confirmActionText:this.attr.confirmActionText},e='<div id="{{confirmModalId}}" style="display: none">',e+='<h2 class="confirmationHeading js-confirmationHeading"></h2>',e+='<div class="confirmationMessage js-confirmationMessage"></div>',e+='<div class="confirmationActions js-confirmationActions">',e+='<a class="button confirmAction js-confirmAction">{{confirmActionText}}</a>',e+='<div class="cancelWrapper"><a class="cancelAction js-cancelAction" href="#">Cancel</a></div>',e+="</div>",e+="</div>",n=_.template(e),$j(n(t))},this.teardownModal=function(){$j("#"+this.attr.confirmModalId).remove()}},MixinEventUtils),$gr.shared.confirmNilReadAt=flight.component(MixinEventUtils,function(){this.works_queue=[],this.html_queue=[],this.current_work_id=null,this.$work_display=null,this.$module_display=null,this.$messages_display=null,this.disable_nil_read_at_buttons=!1,this.reload_cache_val=2,this.broadcast_type="readingChallengeReadInYear";var e="confirmNilReadAt";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.$work_display=$j("#"+this.$node.data("workdisplayid")),this.$module_display=$j("#"+this.$node.data("moduledisplayid")),this.$messages_display=$j("#"+this.$node.data("messagecontainerid")),this.updateNilReadAtWorks(),$j("#"+this.$node.data("readinyearbuttonid")).on("click",{env:this},this.readInYearAction),$j("#"+this.$node.data("confirmnilreadatbuttonid")).on("click",{env:this},this.confirmNilReadAtAction),$j("#"+this.$node.data("closereadinyearmoduleid")).on("click",{env:this},function(e){e.data.env.$module_display.css("display","none"),e.preventDefault()})}),this.readInYearAction=function(e){var t=e.data.env;t.disable_nil_read_at_buttons||(t.$module_display.css("visibility","hidden"),t.disable_nil_read_at_buttons=!0,$j.ajax({url:"/challenges/mark_as_read_this_year",data:{work_id:t.current_work_id},method:"post"}).success(function(e){$j.data(document,"newProgressText",{text:e.new_progress_text}),t.broadcast(t.broadcast_type,""),t.afterDecision()}).fail(function(e){t.onFailure()}))},this.confirmNilReadAtAction=function(e){var t=e.data.env;t.disable_nil_read_at_buttons||(t.$module_display.css("visibility","hidden"),t.disable_nil_read_at_buttons=!0,$j.ajax({url:"/challenges/confirm_nil_read_at",data:{work_id:t.current_work_id},method:"post"}).success(function(){t.afterDecision()}).fail(function(){t.onFailure()}))},this.updateNilReadAtWorks=function(){var e=this;$j.ajax({url:"/challenges/get_new_nil_read_at_books",dataType:"json"}).success(function(t){if(t.work_ids.length>0)for(var n=0;n<t.work_ids.length;n++)e.works_queue.include(t.work_ids[n])||(e.works_queue.push(t.work_ids[n]),e.html_queue.push(t.htmls[n]));0==e.works_queue.length?e.$module_display.css("display","none"):e.refreshDisplay()}).fail(function(){e.onFailure()})},this.refreshDisplay=function(){this.current_work_id=this.works_queue.shift(),this.$work_display.html(this.html_queue.shift()),this.$module_display.css("display","inline-block"),this.$module_display.css("visibility","visible"),this.disable_nil_read_at_buttons=!1},this.afterDecision=function(){this.works_queue.length<=this.reload_cache_val?this.updateNilReadAtWorks():this.refreshDisplay()},this.onFailure=function(){this.$module_display.css("visibility","visible"),this.$module_display.css("display","none"),this.$messages_display.html("We're sorry, there was a problem processing your request. Please reload the page and try again."),this.$messages_display.css("display","inline-block")}}),$gr.shared.dataStoreUserPreferences=flight.component(function(){this.after("initialize",function(){this.on("ui-user-preference-changed",this.updateUserPreferences)}),this.updateUserPreferences=function(e,t){$j.post("/user/update_preferences",{user:t.prefData})}}),$gr.shared.dataTooltip=flight.component(function(){var e="dataTooltip",t=50,n=100;this.defaultAttrs({channel:e,componentName:e,tooltipTriggerSelector:".js-tooltipTrigger",broadcastEventName:"tooltipHtmlRetrieved"}),this.after("initialize",function(){this.getTooltipContent(this.$node),this.listen("success.loadMore",this.handleLoadMore)}),this.handleLoadMore=function(e,t){"undefined"!=typeof t.content_html&&this.getTooltipContent($j(t.content_html))},this.getTooltipContent=function(e){var i={},o=this,r=o.$node.data("batchSize");r>0&&n>r||(r=t),e.find(this.attr.tooltipTriggerSelector).each(function(e,t){var n={},s=$j(t).data("resource-type"),a=$j(t).data("resource-id"),l=s+"."+a;n.type=s,n.id=a,n.extra=$j(t).data("extra"),i[l]=n,Object.keys(i).length>=r&&(o.getBatchOfTooltipContent(i),i={})}),o.getBatchOfTooltipContent(i)},this.getBatchOfTooltipContent=function(e){var t=this.$node.data("ref-tag");$j.ajax({url:"/tooltips",type:"GET",data:{resources:e,ref_tag:t,use_wtr_tooltip:this.$node.data("use-wtr-tooltip"),current_user_id:this.$node.data("current-user-id")},context:this,success:function(e){this.broadcast(this.attr.broadcastEventName,e)}})}},MixinEventUtils),$gr.shared.dfpAd=flight.component(function(){var e,t;this.impressionCode={success:"0",dfpError:"1",monolithError:"2",empty:"3"},this.defaultAttrs({isNativeAd:!1,creativeSelector:null,attachClickTracking:function(e){},nativeAdAttrs:{iframeWrapperSelector:null,iframeWrapperParams:[],adRootSelector:null,nativeAdUrl:null,success:function(e){}},dfpEvent:null,pmetImpressionTrackUrl:null,pmetClickTrackUrl:null,adDeviceType:null}),this.after("initialize",function(){if(this.attr.dfpEvent.isEmpty)return void this.trackImpression(this.impressionCode.empty);var n=this.$node.find('iframe[id^="google_ads_iframe_"]'),i=n.contents().find(this.attr.creativeSelector);if(this.attr.isNativeAd){var o=i.data("id"),r=i.data("url"),s=this.attr.dfpEvent.lineItemId,a={id:o,line_item_id:s,ad_unit:this.adUnit(),ad_device_type:this.attr.adDeviceType};if(o&&r){var l=n.closest(this.attr.nativeAdAttrs.iframeWrapperSelector);$j.each(this.attr.nativeAdAttrs.iframeWrapperParams,function(e,t){a[t]=l.attr(t)});var c=n.closest(this.attr.nativeAdAttrs.adRootSelector);this.populateNativeAd(a,c,r)}else this.trackImpression(this.impressionCode.dfpError)}else this.trackImpression(this.impressionCode.success),e=i,t=$j.proxy(function(e){this._ajaxTrackingCall(this.attr.pmetClickTrackUrl,{click_type:e})},this),this.attr.attachClickTracking(this)}),this.populateNativeAd=function(n,i,o){$j.ajax({url:this.attr.nativeAdAttrs.nativeAdUrl,type:"GET",data:n,context:this,success:function(n){n.ok?(e=i.replaceWithNew(n.content_html),this.trackImpression(this.impressionCode.success),this.attr.nativeAdAttrs.success(this),t=$j.proxy(function(e){var t=$j.extend(this.dfpTrackingInfo(),{click_type:e});$j("<iframe/>",{src:o+this.attr.pmetClickTrackUrl+encodeURIComponent("?"+$j.param(t)),style:"display:none",height:0,width:0,load:function(){$(this).show()}}).appendTo("body")},this),this.attr.attachClickTracking(this)):this.trackImpression(this.impressionCode.monolithError)},error:function(){this.trackImpression(this.impressionCode.monolithError)}})},this.adUnit=function(){return this.attr.dfpEvent.slot.getName().split("/",3)[2]},this.dfpTrackingInfo=function(){return{ad_unit:this.adUnit(),line_item_id:this.attr.dfpEvent.lineItemId,ad_device_type:this.attr.adDeviceType}},this.adRoot=function(){return e},this.trackImpression=function(e){this._ajaxTrackingCall(this.attr.pmetImpressionTrackUrl,{impression_output:e})},this.trackClick=function(e){t(e)},this.trackNotInterestedClick=function(){this._ajaxTrackingCall(this.attr.pmetClickTrackUrl,{not_interested:!0})},this.trackNonDFPClick=function(e){this._ajaxTrackingCall(this.attr.pmetClickTrackUrl,{click_type:e})},this._ajaxTrackingCall=function(e,t){$j.ajax({url:e,type:"GET",data:$j.extend(this.dfpTrackingInfo(),t)})}}),$j.fn.replaceWithNew=function(e){var t=$j(e);return this.replaceWith(t),t},$gr.shared.dfpAd.imageAdAttrs=function(){return{isNativeAd:!1,creativeSelector:"div#google_image_div",attachClickTracking:function(e){e.adRoot().on("click","a",function(){e.trackClick("click")})}}},$gr.shared.dfpAd.newsfeedAdAttrs=function(){return{isNativeAd:!0,creativeSelector:"div.dfp_native_update",attachClickTracking:function(e){var t=function(t,n,i){e.adRoot().on(t,n,function(){e.trackClick(i)})};t("click",".star","rating"),t("click",".wtrShelfMenu button","wtr_button"),t("submit",".wtrButtonContainer form","wtr_button"),t("change",".wtrNonExclusiveShelves,input.wtrNonExclusiveShelf","wtr_button"),t("click",".newsfeedAdDescription a.trackClick","body_click"),t("click",".updateImage a, .updateImage js-tooltipTrigger tooltipTrigger a","book_image"),t("click",".newsfeedAdTitle a","book_title"),t("click",".authorName a","author_name"),t("click",".newsfeedAdCustomCopy a","social"),e.adRoot().on("submit","div.js-newsfeedNotInterested > form",function(){e.trackNotInterestedClick()}),e.adRoot().on("click","div.whyAmISeeingThis a",function(){e.trackNonDFPClick("why")}),e.adRoot().on("click","a.menuCaret",function(){e.trackNonDFPClick("caret")}),e.adRoot().on("click",".newsfeedAdDescription a.showAction",function(){e.trackNonDFPClick("more")})},nativeAdAttrs:{iframeWrapperSelector:"td",iframeWrapperParams:["offset","index"],adRootSelector:"tr",nativeAdUrl:"/home/index_ajax_newsfeed_ad/",success:function(e){var t=e.adRoot(),n=t.attr("id");if(!n||0==n.length){var i="native_ad_"+Math.floor(1e6*Math.random());t.attr("id",i)}var o="#"+t.attr("id")+" ";$gr.shared.attachNewsfeedComponents(o)}}}},$gr.shared.dfpAd.mobileNewsfeedAdAttrs=function(){return{isNativeAd:!0,creativeSelector:"div.dfp_native_update",attachClickTracking:function(e){var t=function(t,n,i){e.adRoot().on(t,n,function(){e.trackClick(i)})};t("click","a.feedItemImage","book_image"),t("click",".feedItemBookTitle a","book_title"),t("click",".feedItemBookAuthor a","author_name"),t("click",".feedItemContent .reviewText a.trackClick, .feedItemContent .reviewText .newsfeedAdMobileCustomText a.trackClick","body_click"),t("click",".feedItemContent .newsfeedAdMobileCustomText a","social"),e.on(document,"shelving.wtrButtonMenu",function(t,n){$j.contains(e.adRoot()[0],document.getElementById(n.buttonId))&&e.trackClick("wtr_button")}),e.adRoot().on("submit","div.js-newsfeedNotInterested > form",function(){e.trackNotInterestedClick()}),e.adRoot().on("submit","div.whyAmISeeingThis > form",function(){e.trackNonDFPClick("why")}),e.adRoot().on("click","a.menuCaret",function(){e.trackNonDFPClick("caret")}),e.adRoot().on("click",".feedItemContent .reviewText a.showAction, .feedItemContent .reviewText .newsfeedAdMobileCustomText a.showAction",function(){e.trackNonDFPClick("more")})},nativeAdAttrs:{iframeWrapperSelector:"article",iframeWrapperParams:[],adRootSelector:"article",nativeAdUrl:"/home/index_ajax_newsfeed_ad/",success:function(e){ExpandableContent.attachTo(".jsShow, .jsHide"),$gr.shared.newsfeedMenu.attachTo(".js-newsfeedStoryDropdown")}}}},$gr.shared.dismissModuleUI=flight.component(function(){this.defaultAttrs({newPrefValue:"1"}),this.after("initialize",function(){this.on("click",{dismissButtonSelector:this.hideModule})}),this.hideModule=function(e){this.$node.fadeOut(),this.attr.userPrefName&&this.triggerUserPrefChanged(),e.preventDefault()},this.triggerUserPrefChanged=function(){var e={};e[this.attr.userPrefName]=this.attr.newPrefValue,this.trigger("ui-user-preference-changed",{prefData:e})}}),$gr.shared.doneRatingDialog=flight.component(function(){var e="doneRatingDialog";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){var e=this.$node,t=$j(".js-saveAction");this.listen("rateBooksDoneRating",function(){this.$node.show()}),$j(".js-closeDoneRatingDialog").on("click",function(){e.hide(),t.text("Done")})})},MixinEventUtils),$gr.shared.editInPlace=flight.component(function(){var e="editInPlace";this.defaultAttrs({channel:e,componentName:e,cancelActionSelector:".cancelAction",controllerComponentSelector:".js-editInPlace",editableElementSelector:".editInPlaceContent",inputFieldSelector:".editInPlaceInputField",formContainerSelector:".editInPlaceContainer",submitActionSelector:".submitAction",inputFieldClass:"editInPlaceInputField",loadingClass:"loading",originalText:null,submitButton:!0}),this.after("initialize",function(){this.formHtml=this.uiBuildForm(),this.$editInPlaceController=this.$node.closest(this.attr.controllerComponentSelector),this.$node.append(this.formHtml),this.on("click",{cancelActionSelector:this.onCancel,submitActionSelector:this.onSubmit}),this.on("saveSuccess",this.onSaveSuccess),this.on("saveError",this.uiHideLoading)}),this.onCancel=function(){this.uiRemoveForm(),this.teardown(),this.trigger(this.$editInPlaceController,"ui.editInPlace.cancel")},this.onSaveSuccess=function(){this.uiHideLoading(),this.uiRemoveForm(),this.teardown()},this.onSubmit=function(){var e=this.select("inputFieldSelector").val();this.uiShowLoading(),this.trigger(this.$editInPlaceController,"ui.editInPlace.submit",{text:e})},this.uiBuildForm=function(){var e,t,n,i=this.$node.data("field-name");return e={inputFieldClass:this.attr.inputFieldClass,inputFieldName:i,originalText:this.attr.originalText},t='<div class="editInPlaceContainer">',t+='<textarea class="{{inputFieldClass}}" name="{{inputFieldName}}">',t+="{{originalText}}",t+="</textarea>",t+='<div class="formAction">',t+=1==this.attr.submitButton?'<button class="submitAction primaryAction button" type="submit">Submit</button>':'<a class="submitAction primaryAction">Submit</a>',t+='<span class="cancelAction secondaryAction">Cancel</span>',t+="</div>",t+='<div class="editInPlaceError"></div>',t+="</div>",(n=_.template(t))(e)},this.uiHideLoading=function(){this.select("submitActionSelector").removeClass(this.attr.loadingClass)},this.uiRemoveForm=function(){this.select("formContainerSelector").hide().remove()},this.uiShowLoading=function(){this.select("submitActionSelector").addClass(this.attr.loadingClass)}}),$gr.shared.editInPlaceController=flight.component(function(){var e="editInPlaceController";this.defaultAttrs({channel:e,componentName:e,containerSelector:".js-editInPlaceForm",editableElementSelector:".textBody",enableLinkSelector:".js-editInPlaceEnableAction",errorSelector:".editInPlaceError",highlightElementSelector:".js-editInPlaceHighlight",highlightClass:"highlight",enableLinkClass:"js-editInPlaceEnableAction",elementsToHideSelectors:""}),this.after("initialize",function(){this.attr.rawText=this.$node.data("raw-text-for-editing"),this.attr.editableBecauseAdmin=!!this.$node.data("editable-because-admin"),this.isNotAdminEditor()&&this.enableHighlight(),this.on("mouseup",{highlightElementSelector:this.onMouseUp}),this.on("click",{enableLinkSelector:this.onActivate}),this.on("ui.editInPlace.cancel",this.uiReset),this.on("ui.editInPlace.submit",this.onSubmit)}),this.onMouseUp=function(e){this.isNotAdminEditor()&&this.onActivate(e)},this.disableHighlight=function(){this.off("mouseover mouseout"),this.uiRemoveHighlight()},this.enableHighlight=function(){this.on("mouseover",{highlightElementSelector:this.uiAddHighlight}),this.on("mouseout",{highlightElementSelector:this.uiRemoveHighlight})},this.onActivate=function(e){var t=$j(e.target);e.preventDefault(),(!this.isTextSelected()||t.hasClass(this.attr.enableLinkClass))&&(this.disableHighlight(),this.uiHideElements(),$gr.shared.editInPlace.attachTo(this.select("containerSelector"),{originalText:this.$node.data("raw-text-for-editing"),submitButton:this.$node.data("submit-button")}))},this.onSaveError=function(e,t,n){var i=$j.parseJSON(e.responseText);$j.isPlainObject(i)&&this.select("errorSelector").html(i.errors.join("<br>")),this.trigger(this.attr.containerSelector,"saveError")},this.onSaveSuccess=function(e,t,n){$j.isPlainObject(e)&&this.uiUpdateText(e.answer_text_filtered),this.uiReset(),this.trigger(this.attr.containerSelector,"saveSuccess")},this.onSubmit=function(e,t){this.uiClearErrors(),this.attr.rawText=t.text,$j.isPlainObject(t)&&this.save(t)},this.save=function(e){var t=this.$node.data("update-url"),n=this.$node.data("field-name"),i={};i[n]=e.text,$j.ajax({url:t,type:"put",data:i,dataType:"json",context:this,timeout:3e3}).done(this.onSaveSuccess).fail(this.onSaveError)},this.uiAddHighlight=function(){this.select("highlightElementSelector").addClass(this.attr.highlightClass)},this.uiClearErrors=function(){this.select("errorSelector").text("")},this.uiHideElements=function(){this.select("editableElementSelector").hide(),this.select("elementsToHideSelectors").hide()},this.uiRemoveHighlight=function(){this.select("highlightElementSelector").removeClass(this.attr.highlightClass)},this.uiReset=function(){this.uiClearErrors(),this.uiShowElements(),this.isNotAdminEditor()&&this.enableHighlight()},this.uiShowElements=function(){this.select("editableElementSelector").show(),this.select("elementsToHideSelectors").show()},this.uiUpdateText=function(e){this.select("editableElementSelector").html(e)},this.isTextSelected=function(){var e="";return window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(e=document.selection.createRange().text),""!==e},this.isNotAdminEditor=function(){return!this.attr.editableBecauseAdmin}}),$gr.communityQA.editQAMessageForm=flight.component(function(){var e="editQAMessageForm";this.defaultAttrs({channel:e}),this.after("initialize",function(){this.on("ajax:success",this.uiUpdateFormField)}),this.uiUpdateFormField=function(e,t){t.message&&(this.uiResetForm(),this.select("inputFieldSelector").attr("placeholder",t.message))}},MixinEventUtils,withExpandableTextField,withNotification,withFormAjax),$gr.shared.editorialStoryForm=flight.component(function(){this.defaultAttrs({storyTypeMenuSelector:".js-storyTypeMenu",featuredInputSelector:".js-featuredBookInput",resourceInputSelector:".js-resourceIdInput"}),this.after("initialize",function(){this.uiUpdateFormFields(),this.on("change",{storyTypeMenuSelector:this.uiUpdateFormFields})}),this.uiUpdateFormFields=function(){var e=this.select("storyTypeMenuSelector").val();if("best_books_of_the_month"===e?this.select("featuredInputSelector").show():this.select("featuredInputSelector").hide(),""===e)this.select("resourceInputSelector").hide();else{this.select("resourceInputSelector").show();var t=this.getResourceType(e)+" ID: ";this.select("resourceInputSelector").find("label").text(t)}},this.getResourceType=function(e){switch(e){case"author_interview":return"Interview";case"good_minds_suggest":return"Interview";case"goodreads_blog":return"Blog";case"best_books_of_the_month":return"FeaturedList";default:return""}}});var ExpandableContent=flight.component(function(){this.defaultAttrs({showSelector:".jsShow",hideSelector:".jsHide",containerSelector:".expandableContainer"}),this.after("initialize",function(){this.on($gr.touch,{showSelector:this.uiShowHideToggle,hideSelector:this.uiShowHideToggle})}),this.uiShowHideToggle=function(e){var t=$j(e.target),n=t.parent(),i=t.closest(this.attr.containerSelector);e.preventDefault(),n.hide(),n.hasClass("fullContent")?i.find(".truncatedContent").show():i.find(".fullContent").show()}});$gr.shared.experimentConversion=flight.component(function(){var e="experimentConversion";this.defaultAttrs({channel:e,componentName:e,clickSelector:".js-trackConversionClick",experimentName:null}),this.after("initialize",function(){var e=this.attr.experimentName;t(this.$node.data("stepName"),e),$j(this.attr.clickSelector).on("click",function(){t($j(event.target).data("stepName"),e)})});var t=function(e,t){null!=t&&void 0!==e&&$j.post("/track_conversion_action",{event:e,no_interval:!0,options:{experiments:t}})}}),$gr.communityQA.facebookTimelinePoster=flight.component(function(){var e="facebookTimelinePosterComponent";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.on("click",this.shareToFacebook);
}),this.shareToFacebook=function(){var e=this.$node.data("fb-options");$grfb.feedDialog(e)}}),$gr.shared.favoriteAuthor=flight.component(function(){var e="favoriteAuthorComponent",t="post",n="delete",i="Add to my favorite authors",o=" is now on your <b>Favorite Authors</b> list",r="Remove from my favorite authors",s=" has been removed from your <b>Favorite Authors</b> list",a="#notificationBanner",l="Sorry, there was an unknown error adding author to favorites. Please reload the page and try again.",c=".js-addToFavoriteAuthors",u="h1.authorName > span",h="author-id",d="favorite-author-id",f="favorite_author",p="/favorite_authors",m="/favorite_authors/",g="success",v="error";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.authorName=$j(u).text(),this.addRemoveLink=this.$node.find(c),this.notification=$j(a),this.authorId=this.addRemoveLink.data(h),this.favoriteAuthorId=this.addRemoveLink.data(d),null===this.favoriteAuthorId||""===this.favoriteAuthorId?this.addRemoveLink.text(i):this.addRemoveLink.text(r),this.addRemoveLink.click($j.proxy(this.updateFavoriteAuthor,this))}),this.updateFavoriteAuthor=function(){this.disableState(),this.updateUrl();var e={format:"json"};this.methodType===t&&(e[f]={author_id:this.authorId}),$j.ajax({url:this.url,type:this.methodType,data:e,context:this,success:this.onSuccess,error:this.onError,complete:this.onComplete})},this.onSuccess=function(e,t,i){var r=e[f];if(t===g){var a=this.authorName;a+=this.methodType===n?s:o,this.toggleState(r),this.notification.trigger("showNotification",{type:"info",message:a})}else t===v&&this.showErrorMessage(l)},this.onError=function(e,t,n){this.defer(function(){this.authRedirect(e,$j.proxy(function(){var e="Unknown XHR failure when trying to add author to favorites.";t&&(e+=" (status code "+t+")"),this.broadcastError(e),this.showErrorMessage(l)},this))},500)},this.onComplete=function(e,t){this.enableState()},this.toggleState=function(e){this.methodType===n?(this.addRemoveLink.data(d,""),this.addRemoveLink.text(i)):this.methodType===t?(this.addRemoveLink.data(d,e),this.addRemoveLink.text(r)):this.showErrorMessage("Unsupported HTTP method: "+this.methodType)},this.showErrorMessage=function(e){this.notification.trigger("showNotification",{type:"error",message:e}),this.broadcastError(e)},this.disableState=function(){this.addRemoveLink.attr("disabled","disabled")},this.enableState=function(){this.addRemoveLink.removeAttr("disabled")},this.updateUrl=function(){this.favoriteAuthorId=this.addRemoveLink.data(d),null===this.favoriteAuthorId||""===this.favoriteAuthorId?(this.methodType=t,this.url=p):(this.methodType=n,this.url=m,this.url+=this.favoriteAuthorId)}},MixinEventUtils,MixinAuthRedirect,dropdownMenu),$gr.shared.favoriteGenre=flight.component(function(){var e="FavoriteGenre";this.defaultAttrs({componentName:e,activeClass:"gr-button--togglable--enabled",inactiveClass:"gr-button--togglable--disabled",activeStateMethod:"post",inactiveStateMethod:"delete",dataAttrUrlActivate:"async-url-activate-url",dataAttrUrlInactivate:"async-url-inactivate-url"}),this.after("initialize",function(){var e=this.$node.data("active-button-text"),t=this.$node.data("active-button-hover-text"),n=this.$node.data("inactive-button-text");e&&(this.attr.activeStateText=e),t&&(this.attr.activeButtonHoverText=t),n&&(this.attr.inactiveStateText=n),this.on("ajax:success",this.onFavoriteSuccess),this.on("ajax:error",this.onFavoriteError),this.on("mouseover",this.handleHover),this.on("mouseleave",this.handleMouseLeave)}),this.onFavoriteSuccess=function(e,t,n){$j.isPlainObject(t)&&("success"===t.status?this.toggleState():"error"===t.status&&this.showErrorMessage(t.message))},this.onFavoriteError=function(e,t,n){var i="Sorry, there was an unknown error favoriting this genre. Please reload the page and try again.";this.showErrorMessage(i)},this.toggleState=function(){this.$node.hasClass(this.attr.activeClass)?this.inactiveState():this.activeState()},this.activeState=function(){this.$node.addClass(this.attr.activeClass),this.$node.removeClass(this.attr.inactiveClass),this.$node.data("method",this.attr.inactiveStateMethod),this.$node.text(this.attr.activeStateText),this.updateURL()},this.inactiveState=function(){this.$node.addClass(this.attr.inactiveClass),this.$node.removeClass(this.attr.activeClass),this.$node.data("method",this.attr.activeStateMethod),this.$node.text(this.attr.inactiveStateText),this.updateURL()},this.showErrorMessage=function(e){$j("#flashMessages").trigger("addFlashMessage",[e,"error"]),this.broadcastError(e)},this.handleHover=function(e){this.attr.activeButtonHoverText&&this.$node.hasClass(this.attr.activeClass)&&this.$node.text(this.attr.activeButtonHoverText)},this.handleMouseLeave=function(e){this.$node.hasClass(this.attr.activeClass)?this.activeState():this.inactiveState()},this.updateURL=function(){var e="",t=this.$node.data("method");t===this.attr.activeStateMethod?e=this.$node.data(this.attr.dataAttrUrlActivate):t===this.attr.inactiveStateMethod&&(e=this.$node.data(this.attr.dataAttrUrlInactivate)),this.$node.attr("href",e)}},MixinEventUtils);var FlashMessages=flight.component(function(){var e="flashMessages";this.defaultAttrs({channel:e,componentName:e,hideClass:"hide",errorClass:"error",noticeClass:"notice",containerIdSelector:"#flashMessages",flashMessageSelector:".flashMessage",siteHeaderSelector:"#siteHeader",hideDelay:5e3,scrollDebounceDuration:150}),this.after("initialize",function(){var e=this.select("flashMessageSelector"),t=$j(this.attr.siteHeaderSelector);this.isSiteHeader=!1,this.siteHeaderHeight=0,this.updateMessageCount(),t.length&&(this.isSiteHeader=!0,this.siteHeaderHeight=t.outerHeight()),e.length&&this.isSiteHeader&&e.css("top",this.siteHeaderHeight),this.on(document,"scrollstart",this.prepareForUpdate),this.on(document,"scroll",flight.utils.debounce(this.updatePosition,this.attr.scrollDebounceDuration)),this.on("addFlashMessage",this.add),this.on("addFlashError",function(e,t){this.add(e,t,this.attr.errorClass)}),this.on("clearFlashError",this.onClearFlashError),this.messageCount>0&&this.next()}),this.add=function(e,t,n){var i=$j("<div/>").addClass("flashMessage");i.addClass("string"==typeof n?n:this.attr.noticeClass).text(t).appendTo(this.attr.containerIdSelector),i.css({opacity:0,top:-100}),window.getComputedStyle(i[0]).opacity,i.css({opacity:"",top:""}),this.updateMessageCount(),this.next(),this.updatePosition(!0)},this.hide=function(){var e=this.first();e.addClass(this.attr.hideClass),e.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",$j.proxy(this.remove,this))},this.prepareForUpdate=function(){var e=this.select("flashMessageSelector");e.length&&(e.addClass("notransition hide"),this.forceBrowserReflow())},this.remove=function(){return 0===this.messageCount?!1:(this.broadcast("beforeRemove"),this.first().remove(),this.updateMessageCount(),this.broadcast("afterRemove"),void this.next())},this.onClearFlashError=function(e){this.first().hasClass(this.attr.errorClass)&&this.hide()},this.updatePosition=function(e){var t=this.select("flashMessageSelector"),n=0,i=$j(document).scrollTop();0!==t.length&&(e="undefined"!=typeof e?e:!1,n=this.isSiteHeader&&i<=this.siteHeaderHeight?this.siteHeaderHeight:i,(this.currentTop!==n||e===!0)&&t.css("top",n),this.forceBrowserReflow(),t.removeClass("notransition hide"),this.currentTop=n)},this.first=function(){return this.select("flashMessageSelector").first()},this.next=function(){var e=this.first();this.messageCount>0&&!e.hasClass(this.attr.errorClass)&&this.defer(this.hide,this.attr.hideDelay)},this.updateMessageCount=function(){this.messageCount=this.select("flashMessageSelector").length}},MixinEventUtils),Follow=flight.component(function(){var e="follow";this.defaultAttrs({channel:e,componentName:e,activeClass:"btnActivated",inactiveClass:"btnSecondary",loadingClass:"btnLoading",activeStateMethod:"post",inactiveStateMethod:"delete",dataAttrUrlAdd:"async-url-add",dataAttrUrlDelete:"async-url-delete",defautlActiveStateText:"Unfollow",defautlInactiveStateText:"Follow"}),this.after("initialize",function(){var e=this.$node.data("active-button-text"),t=this.$node.data("inactive-button-text");this.userId=this.$node.data("user-id"),this.validateUserId(),e&&(this.attr.activeStateText=e),t&&(this.attr.inactiveStateText=t),this.on("ajax:success",this.onFollowSuccess),this.on("ajax:error",this.onFollowError)}),this.onFollowSuccess=function(e,t,n){$j.isPlainObject(t)&&("success"===t.status?(this.toggleState(),this.broadcast("success",t)):"error"===t.status&&this.showErrorMessage(t.message))},this.onFollowError=function(e,t,n){this.defer(function(){this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure when trying to follow the user.",n="Sorry, there was an unknown error following this user. Please reload the page and try again.";t.status&&(e+=" (status code "+t.status+")"),this.broadcastError(e),this.showErrorMessage(n)},this))},500)},this.toggleState=function(){this.$node.hasClass(this.attr.activeClass)?this.inactiveState():this.activeState()},this.activeState=function(){this.$node.addClass(this.attr.activeClass),this.$node.removeClass(this.attr.inactiveClass),this.$node.data("method",this.attr.inactiveStateMethod),this.$node.text(this.attr.activeStateText),this.updateURL()},this.inactiveState=function(){this.$node.addClass(this.attr.inactiveClass),this.$node.removeClass(this.attr.activeClass),this.$node.data("method",this.attr.activeStateMethod),this.$node.text(this.attr.inactiveStateText),this.updateURL()},this.updateURL=function(){var e="",t=this.$node.data("method");if(t===this.attr.activeStateMethod)e=this.$node.data(this.attr.dataAttrUrlAdd);else if(t===this.attr.inactiveStateMethod)e=this.$node.data(this.attr.dataAttrUrlDelete);else{var n="Sorry, there was an invalid method type for the Follow button.";this.showErrorMessage(n)}e?this.$node.attr("href",e):this.$node.on("click",function(){return!1})},this.showErrorMessage=function(e){$j("#flashMessages").trigger("addFlashMessage",[e,"error"]),this.broadcastError(e)},this.validateUserId=function(){var e=/[0-9]+/;e.test(this.userId)||(this.showErrorMessage("Invalid user ID for follow component."),this.teardown())}},MixinEventUtils,MixinAuthRedirect);$gr.shared.followSuggestedAuthor=flight.component(function(){this.defaultAttrs({defaultActiveStateText:"Unfollow",defaultInactiveStateText:"Follow",followButtonSelector:".followAuthorButton",unfollowButtonSelector:".unfollowAuthorButton"}),this.after("initialize",function(){this.on("click",{followButtonSelector:this.onFollow}),this.on("click",{unfollowButtonSelector:this.onUnfollow}),this.listen("success.follow",function(e,t){this.appendNewUpdates(t)})}),this.onFollow=function(e,t){e.preventDefault();var n=this.$node.data("follow-path"),i=this.$node.data("ref-tag");$j.ajax({url:n,type:"post",data:{format:"json",follow_author_from_newsfeed:!0,ref:i},context:this,success:this.onFollowSuccess,error:this.onError})},this.onUnfollow=function(e,t){e.preventDefault();var n=this.$node.data("unfollow-path");$j.ajax({url:n,type:"delete",data:{format:"json",follow_author_from_newsfeed:!0},context:this,success:this.onUnfollowSuccess,error:this.onError})},this.onFollowSuccess=function(e,t,n){var i=e;"success"==i.status?(this.appendNewUpdates(i),this.$node.find(".followedMessage").show(),this.$node.find(".notFollowedMessage").hide(),this.$node.find(this.attr.followButtonSelector).hide(),this.$node.find(".authorFollowingSuggestionMessaging").hide()):this.onError(n,t)},this.onUnfollowSuccess=function(e,t,n){var i=e;"success"==i.status?(this.$node.find(".followedMessage").hide(),this.$node.find(".notFollowedMessage").show(),this.$node.find(this.attr.followButtonSelector).show(),this.$node.find(".authorFollowingSuggestionMessaging").show(),this.removeAssociatedUpdates()):this.onError(n,t)},this.appendNewUpdates=function(e){$j(".authorFollowingSuggestion.update, .authorFollowingSuggestion.feedItem").after(e.last_activity_html)},this.removeAssociatedUpdates=function(){var e="."+this.$node.data("associated-resource");$j(e).remove()},this.onError=function(e,t,n){var i;try{i=$j.parseJSON(e.responseText)}catch(o){i={type:"error",message:"There was an unknown error. Please retry.  (errorThrown: "+n+")"}}this.$node.find(".notFollowedMessage").html(i.message),this.$node.find(".notFollowedMessage").show(),this.$node.find(".followedMessage").hide(),this.$node.find(".authorFollowingSuggestionMessaging").hide()}},MixinEventUtils),$gr.shared.formBoxChecker=flight.component(function(){this.defaultAttrs({checkBoxesSelector:".js-formBoxChecker-checkBox",massCheckAll:!1,massCheckControlSelector:"#js-formBoxChecker-checkAllControl"}),this.after("initialize",function(){this.on("allBoxesCleared",this.changeToCheckAll),this.on("allBoxesChecked",this.changeToUncheckAll),this.on("click",{massCheckControlSelector:this.handleMassCheckClick}),this.on("change",{checkBoxesSelector:this.handleCheckboxChange})}),this.changeToCheckAll=function(){this.attr.massCheckAll=!0,this.select("massCheckControlSelector").text("Check all")},this.changeToUncheckAll=function(){this.attr.massCheckAll=!1,this.select("massCheckControlSelector").text("Uncheck all")},this.checkAll=function(){this.select("checkBoxesSelector").prop("checked",!0),this.trigger("allBoxesChecked")},this.handleCheckboxChange=function(){$checkBoxes=this.select("checkBoxesSelector"),0===$checkBoxes.filter(":checked").length?this.trigger("allBoxesCleared"):0===$checkBoxes.not(":checked").length&&this.trigger("allBoxesChecked")},this.handleMassCheckClick=function(e){e.preventDefault(),this.attr.massCheckAll===!0?this.checkAll():this.uncheckAll()},this.uncheckAll=function(){this.select("checkBoxesSelector").prop("checked",!1),this.trigger("allBoxesCleared")}});var FriendRequest=flight.component(function(){var e="FriendRequest";this.defaultAttrs({channel:e,componentName:e,showClass:"show",approveButtonSelector:".btnApprove",ignoreButtonSelector:".btnIgnore",buttonContainerSelector:".friendRequestActions",statusMessageSelector:".friendRequestStatusMessage",confirmResponseType:"confirm",ignoreResponseType:"ignore",confirmRequestMessage:"You are now friends",ignoreRequestMessage:"You\u2019ve ignored this invitation"}),this.after("initialize",function(){var e=this.$node.data("confirm-request-message"),t=this.$node.data("ignore-request-message");e&&!/^\s*$/.test(e)&&(this.attr.confirmRequestMessage=e),t&&!/^\s*$/.test(t)&&(this.attr.ignoreRequestMessage=t),this.on("ajax:success",this.onFriendRequestSuccess),this.on("ajax:error",this.onFriendRequestError)}),this.onApprove=function(){this.hide("buttonContainerSelector"),this.updateMessage(this.attr.confirmRequestMessage),this.show("statusMessageSelector")},this.onIgnore=function(){this.hide("buttonContainerSelector"),this.updateMessage(this.attr.ignoreRequestMessage),this.show("statusMessageSelector")},this.onFriendRequestSuccess=function(e,t){var n=[this.attr.confirmResponseType,this.attr.ignoreResponseType];$j.isPlainObject(t)?t.response_type&&$j.inArray(t.response_type,n)>=0?t.response_type===this.attr.confirmResponseType?this.onApprove():t.response_type===this.attr.ignoreResponseType&&this.onIgnore():this.broadcastError("Undefined or invalid response type in friend request response.",!0):this.broadcastError("Malformed JSON response when trying to confirm/ignore friend request.",!0)},this.onFriendRequestError=function(e,t){this.defer(function(){404===t.status&&(t.status=403,t.responseText='{"redirect":"/user/sign_in"}'),this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure while trying to confirm/ignore a friend request";t.status&&(e+=", status code: "+t.status),this.broadcastError(e,!0)},this))},500)},this.hide=function(e){var t=this.select(e);t.removeClass(this.attr.showClass)},this.show=function(e){var t=this.select(e);t.addClass(this.attr.showClass)},this.updateMessage=function(e){if("string"==typeof e&&!/^\s*$/.test(e)){var t=this.select("statusMessageSelector");t.text(e)}}},MixinEventUtils,MixinAuthRedirect);$gr.shared.genrePicker=flight.component(function(){var e="genrePicker",t=null,n=null,i=null,o=null,r=null,s=null;this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){switch(t=this.$node,o=$j(".js-saveAction"),r=o.text(),n=$j(".rateBooksContainer"),this.$node.data("page")){case"recommendations":s="/recommendations/genre";break;case"rate_books":s="/user/rate_books";break;default:s="/user/rate_books"}$j(".js-genrePickerButton").on("click",a),$j(".js-genrePickerListItem").on("click",l),this.on("genrePicked",c)});var a=function(){var e=this.getAttribute("data-genre");i=t.find("[data-genre='"+e+"']"),i.addClass("genrePickerListItemSelected"),$j(".js-saveAction").removeClass("includeArrow"),t.show(),n.hide(),o.length&&(o.text("Done"),o.on("click",u)),$j(document).trigger("genrePickerOpened")},l=function(){$j(this).trigger("genrePicked",{genre:this.getAttribute("data-genre")}),u()},c=function(e,t){$j(".js-genrePickerButton").attr("data-genre",t.genre),$j.ajax({url:s,type:"get",data:{format:"json",genre:t.genre,reg_path:$j("#reg_path").val()},context:this,success:h})},u=function(e){return i.removeClass("genrePickerListItemSelected"),n.show(),t.hide(),$j(".js-saveAction").addClass("includeArrow"),o.length&&(o.text(r),o.off("click",u)),$j(document).trigger("genrePickerClosed"),"undefined"!=typeof e&&e.preventDefault(),!1},h=function(e){$j(".carouselList").html(e.html),$j(document).trigger("rateBooksCarouselUpdated")}},MixinEventUtils),$gr.shared.giveawayBookFindWidget=flight.component(function(){var e=13,t=404,n=3e3;this.after("initialize",function(){this.$asinFindInput=this.$node.find("#asinFindInput"),this.$asinFindButton=this.$node.find("#asinFindButton"),this.$asinFindClearLink=this.$node.find("#asinFindClearLink"),this.$bookImage=this.$node.find("#bookImage"),this.$bookTitle=this.$node.find("#bookTitle"),this.$bookAuthor=this.$node.find("#bookAuthor"),this.$bookAsin=this.$node.find("#bookAsin"),this.$bookAsinHiddenInput=this.$node.find("#giveaway_asin"),this.$changeBookButton=this.$node.find("#changeBookButton"),this.$bookFindResultContainer=this.$node.find("#giveawayBookFindResult"),this.on(this.$asinFindClearLink,"click",this.clearFindInput),this.on(this.$changeBookButton,"click",this.resetBookSelection),this.on(this.$asinFindButton,"click",this.findBookByAsin),this.on(this.$asinFindInput,"keyup",this.checkEnterPressedAndFindBook)}),this.findBookByAsin=function(){var e=this.$asinFindInput.val().trim();e&&(this.$asinFindButton.prop("disabled",!0),$j.ajax({url:"/giveaway/find_book_by_asin",data:{asin:e},context:this,timeout:n}).done(this.updateBookView).fail(this.displayErrorMessage).always(this.enableFindButton))},this.checkEnterPressedAndFindBook=function(t){t.keyCode===e&&this.findBookByAsin()},this.clearFindInput=function(){this.$asinFindInput.val("")},this.updateBookView=function(e){this.$bookImage.attr({src:e.image_url,title:e.title}),this.$bookTitle.text(e.title),this.$bookAuthor.attr("href",e.author_url),this.$bookAuthor.text(e.author),this.$bookAsin.text("ASIN: "+e.asin),this.$bookAsinHiddenInput.val(e.asin),this.$bookFindResultContainer.show()},this.resetBookSelection=function(){this.$bookFindResultContainer.hide(),this.$bookAsinHiddenInput.val(""),this.$asinFindInput.val("").focus()},this.displayErrorMessage=function(e){e.status===t?alert("Sorry, there is no book with this ASIN. Pleas try again."):alert("An error occurred when finding book with this ASIN.")},this.enableFindButton=function(){this.$asinFindButton.removeProp("disabled")}}),$gr.shared.inAppNotification=flight.component(function(){this.defaultAttrs({notificationType:"",clickableSelector:"a, img"}),this.after("initialize",function(){if(this.$node.data("notification-type")){this.attr.notificationType=$gr.shared.inAppNotification.parseNotificationType(this.$node),this.on("click",{clickableSelector:this.recordClick});var e=this.$node.parentsUntil("notificationContainer").first(),t=$j(e).find(".inAppNotification").first();if(this.$node[0]==t[0]){var n=$j(this.$node.parent()).children().map(function(){return $gr.shared.inAppNotification.parseNotificationType($j(this))}).get();this.recordImpressions(n)}}}),this.recordClick=function(){this.recordEvent({notification_types:[this.attr.notificationType],type:"click"})},this.recordImpressions=function(e){this.recordEvent({notification_types:e,type:"impression"})},this.recordEvent=function(e){$j.post("/notifications/track",{data:JSON.stringify(e)})}}),$gr.shared.inAppNotification.parseNotificationType=function(e){return e.data("notification-type")};var InterstitialHider=flight.component(function(){this.defaultAttrs({rootSelector:".interstitialAppDownload",closeSelector:".closeIcon",closeLinkSelector:".closeLink",showClass:"interstitialAppDownloadVisible"}),this.after("initialize",function(){this.on(this.select("closeSelector"),"click",this.hide),this.on(this.select("closeLinkSelector"),"click",this.hide)}),this.hide=function(){this.isVisible()&&(this.select("rootSelector").removeClass(this.attr.showClass),$j(document).trigger("hide.viewportOverlay",{overlayId:"interstitialAppDownloadOverlay"}))},this.isVisible=function(){return this.select("rootSelector").hasClass(this.attr.showClass)}});$gr.shared.lazilyLoadedGlidePopup=flight.component(function(){this.after("initialize",function(){$j(document).on("click",".glideButton",this.openGlidePopup)}),this.openGlidePopup=function(e){var t=$j(e.target),n=t.data("refTag"),i=t.data("asin"),o=t.data("url"),r=t.data("kuEligible"),s="";1==r&&(s="KU"),window.open("https://www.amazon.com/gp/product/"+i+"/ref="+n+"?v=mini-glance&caller=Goodreads&callerLink="+o+"&preference="+s+"&tag="+n+"-20","1402010176686","width=950,height=585,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0").focus(),e.preventDefault()}}),$gr.shared.libraryExport=flight.component(function(){var e=2e3,t=900;this.after("initialize",function(){var e=this.$node.data("userid").toString();this.submissionUrl="/review_porter/export/"+e,this.$fileList=$j("#"+this.$node.data("filelistid")),this.$messageBox=$j("#"+this.$node.data("statusid")),this.fileUrl="/review_porter/export/"+e+"/goodreads_export.csv",this.checkExport(),this.on("click",this.generateExport)}),this.generateExport=function(){this.generatingExportState();var e=$j.ajax({url:this.submissionUrl,method:"post",data:{format:"json"},context:this});e.done(this.onSubmissionSuccess),e.fail(this.onSubmissionFailure)},this.checkExport=function(e){var t=$j.ajax({url:this.fileUrl,method:"head",context:this});t.done(this.onExportSuccess),e&&t.fail(e)},this.pollForExport=function(e,t){0>=e?this.errorState("We were unable to export your library. Please try again."):this.checkExport(function(){var n=this;setTimeout(function(){n.pollForExport(e-1,t)},t)})},this.onSubmissionSuccess=function(){this.pollForExport(t,e)},this.onSubmissionFailure=function(){this.errorState("We were unable to export your library. Please try again.")},this.onExportSuccess=function(e,t,n){var i=n.getResponseHeader("x-export-creation-time");this.exportAvailableState(i)},this.generatingExportState=function(){this.$fileList.empty(),this.$node.text("Exporting library..."),this.$node.attr("disabled",!0),this.$messageBox.text("We are currently generating your export. This may take some time if you have a large library.")},this.exportAvailableState=function(e){this.$fileList.empty(),this.$messageBox.text("");var t=$j(document.createElement("a"));if(t.attr("href",this.fileUrl),t.text("Your export"),this.$fileList.append(t),null!=e){var n=$j(document.createElement("span"));n.text(" from "+e),this.$fileList.append(n)}this.$node.text("Export Library"),this.$node.removeAttr("disabled")},this.errorState=function(e){this.$node.text("Export Library"),this.$node.removeAttr("disabled"),this.$messageBox.text(e.toString())}});var LikeResource=flight.component(function(){var e="likeResource";this.defaultAttrs({channel:e,componentName:e,catalystSelector:".jsLike",likesCountContainerSelector:".ratingsCount",likesCountSelector:".likesCount",likesIconSelector:".likesIndicator",likesHideClass:"hide",likesIconActiveClass:"userHasRating"}),this.after("initialize",function(){this.on("ajax:success",{catalystSelector:this.onLikeSuccess}),this.on("ajax:error",{catalystSelector:this.onLikeError})}),this.swapLikeUnlikeLink=function(e,t){var n=e.parent(),i=e.attr("href").match(/.*&ref=(.*_u?lk)/);if(e.replaceWith(t.html),i){var o=n.find("a");t.is_liked_by_current_user?o.attr("href",o.attr("href")+"&ref="+t.ref.replace(/_lk/,"_ulk")):o.attr("href",o.attr("href")+"&ref="+t.ref.replace(/_ulk/,"_lk"))}},this.onLikeError=function(e,t){this.defer(function(){this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure when trying to like resource.";t.status&&(e+=" , status code "+t.status),this.broadcastError(e)},this))},500)},this.onLikeSuccess=function(e,t){if($j.isPlainObject(t)){var n=$j(e.target),i=n.data("like-count-id");if(i){var o=$j("#"+i);if($j.isNumeric(t.count)){var r=t.count>0?t.count:0;o.parent()&&o.parent().hasClass("showLikeWord")&&(t.count>1?r+=" likes":t.count>0?r+=" like":0==t.count&&(r+=" likes")),o.find(this.attr.likesCountSelector).text(r).toggleClass(this.attr.likesIconActiveClass,t.is_liked_by_current_user);var s=o.closest(this.attr.likesCountContainerSelector);t.count>0&&s.hasClass(this.attr.likesHideClass)?s.removeClass(this.attr.likesHideClass):t.count<=0&&!s.hasClass(this.attr.likesHideClass)&&s.addClass(this.attr.likesHideClass)}o.find(this.attr.likesIconSelector).toggleClass(this.attr.likesIconActiveClass,t.is_liked_by_current_user)}this.swapLikeUnlikeLink(n,t)}else this.broadcastError("Malformed JSON response when trying to like resource.")}},MixinEventUtils,MixinAuthRedirect),LoadMore=flight.component(function(){var e="loadMore",t=/page=([0-9]+)/;this.defaultAttrs({channel:e,componentName:e,loadMoreContainerSelector:"#loadMoreContainer",loadMoreActionSelector:".loadMoreAction",loadMoreSelector:".jsLoadMore",loadingClass:"loading"}),this.after("initialize",function(){this.nextPage=this.getPageNumberFromURL(),this.on("click",this.uiShowLoading),this.on("ajax:success",this.onLoadMoreSuccess),this.on("ajax:error",this.onLoadMoreError)}),this.onLoadMoreSuccess=function(e,t){var n=this.$node.data("content-container");t.content_html&&!/^\s*$/.test(t.content_html)?$j(n).append(t.content_html):this.teardownLoadMore(),t.page&&t.total_pages&&t.total_pages<=t.page&&this.teardownLoadMore(),this.nextPage+=1,t.load_more_html?($j(this.attr.loadMoreContainerSelector).replaceWith(t.load_more_html),LoadMore.attachTo(this.attr.loadMoreSelector,{loadMoreContainerSelector:this.attr.loadMoreContainerSelector,loadMoreActionSelector:this.attr.loadMoreActionSelector,loadMoreSelector:this.attr.loadMoreSelector})):this.updateLoadMoreAction(),this.broadcastSuccessfulLoadMore(t),this.uiHideLoading()},this.broadcastSuccessfulLoadMore=function(e){this.broadcast("success",e);var t=this.$node.data("success-event");"undefined"!=typeof t&&this.broadcast(t)},this.onLoadMoreError=function(e,t,n){if("timeout"===n){var i=$j("#flashMessages"),o="The request timed out. Please try again.";i.trigger("addFlashMessage",[o])}this.uiHideLoading(),this.defer(function(){this.authRedirect(t,$j.proxy(function(){var e="Unknown XHR failure while trying to load more content";t.status&&(e+=", status code: "+t.status),this.broadcastError(e)},this))},500)},this.uiShowLoading=function(){$j(this.attr.loadMoreActionSelector).addClass(this.attr.loadingClass)},this.uiHideLoading=function(){$j(this.attr.loadMoreActionSelector).removeClass(this.attr.loadingClass)},this.getPageNumberFromURL=function(){var e=this.$node.attr("href"),n=t.exec(e);return null!==n?parseInt(n[1],10):1},this.updateLoadMoreAction=function(){var e=this.$node.attr("href");t.test(e)?e=e.replace(t,"page="+this.nextPage):this.broadcastError("There is no page query to replace in the load more button",!0),this.$node.attr("href",e)},this.teardownLoadMore=function(){$j(this.attr.loadMoreContainerSelector).remove(),this.teardown()}},MixinEventUtils,MixinAuthRedirect),LoadingFeedback=flight.component(function(){this.defaultAttrs({loadingClass:"btnLoading",submitElementClass:"btnSubmit"}),this.after("initialize",function(){this.on(document,"ajax:beforeSend submit",this.enableLoadingState),this.on(document,"ajax:complete unload",this.disableLoadingState)}),this.enableLoadingState=function(e){var t=$j(e.target),n=this.getSubmitElement(t);n.length&&(n.prop("disabled",!0),n.addClass(this.attr.loadingClass))},this.disableLoadingState=function(e){var t=$j(e.target),n=this.getSubmitElement(t);n.length&&(n.prop("disabled",!1),n.removeClass(this.attr.loadingClass))},this.getSubmitElement=function(e){var t=null;return t=e.hasClass(this.attr.submitElementClass)?e:e.find("."+this.attr.submitElementClass)}});$gr.shared.loadingScreen=flight.component(function(){var e=null,t=null,n=null,i=null,o=null,r=null,s=0,a=3;this.defaultAttrs({loadingEndpoint:null,pollTimeout:5e3}),this.after("initialize",function(){e=this.attr.loadingEndpoint,t=this.attr.pollTimeout,i=this.$node,o=$j(".rateBooksContainer"),r=$j(".siteFooter"),o.hide(),r.hide(),n=$j(".js-genrePickerButton").data("genre"),l()});var l=function(){s+=1,a>=s?$j.ajax({url:e,type:"get",data:{format:"json",tag:n},context:this,success:c}):window.location.href="/?error=from_recs"},c=function(e){""!==e.html?window.location.reload(!0):setTimeout(l,t)}});var MobileConfirmationMenu=flight.component(function(){var e="mobileConfirmationMenu";this.defaultAttrs({channel:e,menuSelector:".js-mobileConfirmationMenu",dataAttrActionType:"action"}),this.after("initialize",function(){this.listen("requestShow",this.showSlideUpMenu),this.onSlideUpEvent("listItemSelected",this.onMenuItemSelected)}),this.onMenuItemSelected=function(e,t){var n=$j(t).first();n.length&&n.data(this.attr.dataAttrActionType)&&(this.broadcast("listItemSelected",{action:n.data(this.attr.dataAttrActionType)}),this.hideSlideUpMenu())}},MixinEventUtils,withSlideUpMenu);$gr.shared.modal=flight.component(function(){this.defaultAttrs({closeIconSelector:".js-closeModalIcon",lightBoxContainerSelector:"#box"}),this.after("initialize",function(){this.modalId=this.$node.attr("id"),this.hideCloseIcon=this.$node.data("hide-close-icon"),this.listen("modalTriggered",this.onModalTrigger),this.listen("hideModal",this.uiHideModal),this.$node.data("auto-show")&&this.uiShowModal()}),this.onModalTrigger=function(e,t){t["modal-id"]===this.modalId&&this.uiShowModal()},this.uiShowModal=function(){Lightbox.showBoxByID(this.$node.attr("id")),this.hideCloseIcon&&$j(this.attr.lightBoxContainerSelector).find(this.attr.closeIconSelector).remove()},this.uiHideModal=function(){Lightbox.hideBox()}},MixinEventUtils),$gr.shared.modalTrigger=flight.component(function(){this.defaultAttrs({}),this.after("initialize",function(){this.on("click",this.broadcastTriggerEvent)}),this.broadcastTriggerEvent=function(){return this.broadcast("modalTriggered",{"modal-id":this.$node.data("modal-id")}),!1}},MixinEventUtils),$gr.shared.newsfeedMenu=flight.component(function(){this.defaultAttrs({notInterestedButtonSelector:".js-newsfeedNotInterestedButton",notInterestedFormSelector:".js-newsfeedNotInterested",notInterestedMessageSelector:".js-wtrNotInterestedMessage",undoNotInterestedButtonSelector:".js-undoNotInterestedButton",dismissNotInterestedMessageButtonSelector:".js-dismissNotInterestedMessage"}),this.after("initialize",function(){var e,t,n,i=this;this.on("click",{notInterestedButtonSelector:this.markNotInterested}),e=this.getNotInterestedMessageContainer(),t=e.find(this.attr.undoNotInterestedButtonSelector),t.click(function(e){i.undoNotInterested(e)}),n=e.find(this.attr.dismissNotInterestedMessageButtonSelector),n.click(function(e){i.dismissNotInterested(e)})}),this.markNotInterested=function(e){e.preventDefault(),e.stopPropagation(),this.select("notInterestedButtonSelector").parent().submit(),$j(this.getNotInterestedNewsfeedStorySelector()).hide(),this.getNotInterestedMessageContainer().show(),$j(".js-newsfeedOverlay").last().hide()},this.undoNotInterested=function(e){var t,n;e.preventDefault(),t=this.buildNotInterestedData(),n=e.target.href,$j.ajax({url:n,type:t.requestType,data:t.requestData,context:this,success:this.showIgnoredNewsfeedStory,error:this.uiShowError})},this.showIgnoredNewsfeedStory=function(){$j(this.getNotInterestedNewsfeedStorySelector()).show(),this.getNotInterestedMessageContainer().hide()},this.dismissNotInterested=function(e){e.preventDefault(),$j(this.attr.notInterestedMessageSelector).hide()},this.getNotInterestedMessageContainer=function(){return $j(this.getNotInterestedMessageSelector())},this.getNotInterestedNewsfeedStorySelector=function(){var e,t,n;return e=this.getNotInterestedObjectType(),
"work"===e?(t=this.getNotInterestedWorkID(),n=".newsfeedWorkUpdate"+t):"suggested_list"===e?(t=this.getNotInterestedSuggestedListID(),n=".newsfeedListUpdate"+t):"author_following_suggestion"===e&&(t=this.getNotInterestedAuthorFollowingSuggestionID(),n=".newsfeedAuthorUpdate"+t),n},this.getNotInterestedMessageSelector=function(){return this.getNotInterestedNewsfeedStorySelector()+"ShowOnNotInterested"},this.getNotInterestedData=function(e){var t=this.select("notInterestedButtonSelector").closest(this.attr.notInterestedFormSelector);return t.data(e)},this.getNotInterestedObjectType=function(){return this.getNotInterestedData("object-type")},this.getNotInterestedWorkID=function(){return this.getNotInterestedData("work-id")},this.getNotInterestedBookID=function(){return this.getNotInterestedData("book-id")},this.getNotInterestedSuggestedListID=function(){return this.getNotInterestedData("suggested-list-id")},this.getNotInterestedAuthorFollowingSuggestionID=function(){return this.getNotInterestedData("author-following-suggestion-id")},this.buildNotInterestedData=function(){var e,t,n,i;return i="put",t=this.getNotInterestedObjectType(),"work"===t?(n=this.getNotInterestedBookID(),i="delete",e={format:"json",user_not_interested_work:{book_id:n}}):"suggested_list"===t?(n=this.getNotInterestedSuggestedListID(),e={format:"json",suggested_list:{id:n}}):"author_following_suggestion"==t&&(n=this.getNotInterestedAuthorFollowingSuggestionID(),e={format:"json",author_following_suggestion:{id:n}}),{method:i,requestData:e}}},dropdownMenu),$gr.shared.newsfeedNav=flight.component(function(){this.defaultAttrs({updateFilterToggleSelector:".js-updateToggle",updateFiltersSelector:".js-updateTypeFilters",loadingSelector:".js-loading"}),this.after("initialize",function(){var e=this;this.on("click",{updateFilterToggleSelector:this.toggleUpdateFilterForm}),this.listen("dataUpdatesLoading",this.showLoading),this.listen("dataUpdatesLoadingFinished",this.hideLoading),this.listen("dataFiltersUpdated",this.hideUpdateFilterForm),this.listen("hideConfirmModal",this.hideUpdateFilterForm),$j(document).keyup(function(t){27===t.which&&e.hideUpdateFilterForm()}),$j(document).click(function(t){$j(e.attr.newsfeedNavSelector).first();$j.contains(e.node,t.target)||e.hideUpdateFilterForm()})}),this.toggleUpdateFilterForm=function(){this.select("updateFiltersSelector").toggle()},this.hideUpdateFilterForm=function(){this.select("updateFiltersSelector").hide()},this.showLoading=function(){this.select("loadingSelector").show()},this.hideLoading=function(){this.select("loadingSelector").hide()}},MixinEventUtils),$gr.shared.newsfeedTracking=flight.component(function(){this.defaultAttrs({trackingContainerSelector:".newsfeed"}),this.after("initialize",function(){$j(document).on("click",this.attr.trackingContainerSelector+" .csct",this.setCookie)}),this.setCookie=function(){var e=new Date;e.setTime(e.getTime()+3e4),document.cookie="csct=true; expires="+e.toGMTString()+"; path=/"}}),$gr.shared.newsfeedUpdateUI=flight.component(function(){this.defaultAttrs({errorMessageSelector:".newsfeedErrorMessage",existingUpdatesSelector:"tr.update[data-timestamp]",loadingSpinnerSelector:".js-loading",loadMoreContainerSelector:"#loadMoreContainerUpdates",updatesContainerSelector:"#updates",updatesFiltersSelector:".js-updateTypeFilters"}),this.after("initialize",function(){this.listen("data-form-success",this.updateNewsfeed),this.listen("newsfeedUpdates.loadMore",this.reattachComponents),this.lazyloadNewsfeed()}),this.reattachComponents=function(){$gr.shared.attachNewsfeedComponents()},this.lazyloadNewsfeed=function(){var e=$j(".newsfeed #loadMoreContainerUpdates .loadMoreAction a");e.click()},this.updateNewsfeed=function(e,t){"undefined"!=typeof t.newsfeed_html?this.reloadNewsfeed(t.newsfeed_html):"undefined"!=typeof t.reload_newsfeed&&$j.ajax({url:"/home/index_ajax",type:"get",data:{format:"json"},context:this,beforeSend:this.showLoadingIcon,success:function(e,t,n){this.reloadNewsfeed(e.newsfeed_html)},error:this.showNewsfeedError})},this.reloadNewsfeed=function(e){this.$node.html(e),this.reattachComponents(),this.broadcast("dataUpdatesLoadingFinished"),this.lazyloadNewsfeed()},this.showLoadingIcon=function(){$j("html, body").animate({scrollTop:0},"slow"),this.select("updatesFiltersSelector").hide(),this.select("updatesContainerSelector").hide(),this.select("loadMoreContainerSelector").hide(),this.select("loadingSpinnerSelector").show()},this.showNewsfeedError=function(){this.select("errorMessageSelector").show()}},MixinEventUtils),$gr.shared.notification=flight.component(function(){},withNotification),$gr.shared.openGlidePopup=flight.component(function(){this.after("initialize",function(){this.on("click",this.buttonClicked)}),this.buttonClicked=function(e){var t=this.$node.data("refTag"),n=this.$node,i=n.data("asin"),o=n.data("url"),r=n.data("kuEligible"),s="";1==r&&(s="KU"),window.open("https://www.amazon.com/gp/product/"+i+"/ref="+t+"?v=mini-glance&caller=Goodreads&callerLink="+o+"&preference="+s+"&tag="+t+"-20","1402010176686","width=950,height=585,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0").focus(),e.preventDefault()}}),$gr.shared.pollClearVoteButton=flight.component(function(){this.defaultAttrs({paneSelector:".votedOnPane",voteButtonSelector:".pollVoteButton",writeInSelector:".writeIn",bookCoverSelector:".bookcover",wtrSelector:".gcaNominee__wtr"}),this.after("initialize",function(){this.on("click",this.clearVote)}),this.clearVote=function(e){var t=$j(e.target),n=t.data("pollVoteId"),i=t.data("answer"),o=t.data("pollId");return $j.ajax({url:"/poll/clear_vote",type:"POST",dataType:"JSON",context:this,data:{id:o,poll_vote_id:n,gca:!0},success:function(){this.hideVotedOnPane(),this.showVoteButtons(i)}}),!1},this.hideVotedOnPane=function(){$j(this.attr.paneSelector).hide()},this.removeOverlayAndCheckMark=function(){$j(this.attr.bookCoverSelector).removeClass("votedCoverOverlay"),$j("div").remove(".votedForCoverCheckSlim")},this.showVoteButtons=function(e){$j(this.attr.voteButtonSelector).removeClass("hidden"),$j(this.attr.wtrSelector).addClass("hidden"),this.removeOverlayAndCheckMark(),$j(this.attr.voteButtonSelector).show(),$j("#pollVoteButton_"+e).html("Vote"),$j(this.attr.writeInSelector).show()}}),$gr.shared.pollVoteButton=flight.component(function(){this.defaultAttrs({bookCoverSelector:".bookcover",voteButtonSelector:".pollVoteButton",autoCompleteSelector:".searchFieldInput",votedOnPaneSelector:".votedOnPane",writeInVoteBtnSelector:".writeInButton",writeInSelector:".writeIn",writeInErrorSelector:".writeInError",wtrSelector:".gcaNominee__wtr"}),this.bookID=-1,this.after("initialize",function(){this.on("click",this.voteForPoll)}),this.voteForPoll=function(e){var t=$j(e.target),n=t.data("answer"),i=t.data("pollId");return this.bookID=t.data("bookId"),t.innerHTML="voting","undefined"==typeof n&&(n=$j(this.attr.autoCompleteSelector)[0].value,this.bookID=$j(this.attr.autoCompleteSelector).data("bookId"),"undefined"==typeof this.bookID)?(this.displayError(),!1):("undefined"!=typeof n&&""!=n?$j.ajax({url:"/poll/vote",type:"POST",dataType:"JSON",context:this,data:{id:i,answer:n,book_id:this.bookID,gca:!0},statusCode:{200:this.displayVotedOnPanel,400:this.displayError,401:this.displayError,403:this.displayError}}):t.innerHTML="Vote",!1)},this.displayVotedOnPanel=function(e){var t=e.body;this.addOverlayAndCheckMark(),$j(this.attr.votedOnPaneSelector).html(t),$j(this.attr.votedOnPaneSelector).hide().fadeIn(),$j(this.attr.voteButtonSelector).hide(),$j(this.attr.wtrSelector).removeClass("hidden"),$j(this.attr.writeInErrorSelector).hide(),$j(this.attr.writeInSelector).hide(),$gr.shared.pollClearVoteButton.attachTo(".clearVoteButton"),window.scrollTo(0,0)},this.addOverlayAndCheckMark=function(){$j(this.attr.bookCoverSelector).addClass("votedCoverOverlay"),$j("#bookcover_"+this.bookID).removeClass("votedCoverOverlay"),$j("#bookcover_"+this.bookID).before("<div class='votedForCoverCheckSlim'></div>")},this.displayError=function(e){var t="<span>That book is ineligible. Please try again!</span>";e&&(t+="<br /><br />"+e.responseJSON.body),$j(this.attr.writeInErrorSelector).html(t),$j(this.attr.writeInErrorSelector).hide().fadeIn(),$j(this.attr.writeInVoteBtnSelector).html("Vote")}}),$gr.shared.previewableNewsfeedStoryForm=flight.component(function(){this.defaultAttrs({inputSelector:":input",imageFieldSelector:".js-imageField",previewContainerSelector:".js-previewContainer",previewErrorSelector:".js-previewError",previewImageSelector:".js-previewImage"}),this.after("initialize",function(){this.on("change",{inputSelector:this.getPreviewHtml})}),this.getPreviewHtml=function(e){$j.ajax(this.$node.data("preview-url"),{data:this.$node.serialize(),context:this,success:this.showPreview,error:this.showPreviewError})},this.showPreview=function(e){this.select("previewErrorSelector").hide(),this.select("previewContainerSelector").html(e.preview_html),this.showPreviewImage()},this.showPreviewError=function(){this.select("previewContainerSelector").hide(),this.select("previewErrorSelector").show()},this.showPreviewImage=function(){var e=this.select("imageFieldSelector");if(0!==e.length&&0!==e[0].files.length){var t=e[0].files[0],n=this.select("previewImageSelector"),i=new FileReader;i.onload=function(e){var t=e.target.result,i=$j("<img>").attr("src",t);n.html(i)},i.readAsDataURL(t)}}}),$gr.shared.pulldownNavigator=flight.component(function(){var e="pulldownNavigator";this.defaultAttrs({channel:e,componentName:e,pullDownSelector:".pulldownNavigator"}),this.after("initialize",function(){this.on("change",t)});var t=function(e){var t=e.target.value;window.location=t}});var RateBooksProgressBar=flight.component(function(){var e="rateBooksProgressBar";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.listen("saveRatingSuccess.ratingStars",this.updateProgressBar),this.rateBooksTotal=this.$node.data("rateBooksTotal")}),this.updateProgressBar=function(e,t){var n=t.user_ratings_count,i=Math.min(100,parseInt(100*(n/this.rateBooksTotal)));$j(".progressBarInner").css("width",i+"%"),$j(".progressRatingsCount").text(n),n==this.rateBooksTotal&&this.trigger("rateBooksDoneRating")}},MixinEventUtils,MixinAuthRedirect);$gr.shared.rateBooksSkipDialog=flight.component(function(){var e="rateBooksSkipDialog",t=null,n=null,i=null,o=null;this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){o=this,t=$j(".js-saveAction"),n=$j(".js-closeDialog"),i=this.$node,this.addOnClickHandler(),n.on("click",this.hideDialog),this.on(document,"rateBooksDoneRating",this.removeOnClickHandler),this.on(document,"genrePickerOpened",this.removeOnClickHandler),this.on(document,"genrePickerClosed",this.addOnClickHandler)}),this.addOnClickHandler=function(){"Skip"===t.text()&&t.on("click",this.showDialog)},this.removeOnClickHandler=function(){this.hideDialog(this.$node),t.off("click",this.showDialog)},this.showDialog=function(){return o.$node.show(),!1},this.hideDialog=function(){i.hide()}},MixinEventUtils);var RatingComponent=flight.component(function(){var e=$j(document),t=$j("html"),n=t.hasClass("touchevents"),i="ratingComponent",o=!1;this.defaultAttrs({channel:i,componentName:i,tapEvent:n?"touchstart":"click",tapStartEvent:n?"touchstart":"mousedown",tapEndEvent:n?"touchend":"mouseup",animPrepClass:"readyToShow",showClass:"show",itemActiveClass:"active",itemInactiveClass:"inactive",cancelSelector:".cancel",itemSelector:".ratingItem:not(.cancel)",listSelector:".ratingList",isDevicePhone:t.hasClass("mobile"),isDeviceTablet:t.hasClass("tablet"),currentRating:-1,minRating:0,maxRating:5}),this.after("initialize",function(){this.elCache={},this.$bookContainer=this.$node.parent().parent();var e=this.$node.data("submit-url");if(!e)return this.broadcastError("could not retrieve 'saveUrl'");if(this.$node.removeAttr("data-submit-url"),this.attr.saveUrl=e,this.attr.currentRating<this.attr.minRating){var t=this.$node.data("user-rating");this.$node.removeAttr("data-user-rating"),"undefined"!=typeof t&&this.validateRating(t)?this.attr.currentRating=parseInt(t,10):this.attr.currentRating=this.attr.minRating}var n=this.$node.data("disable-star-update");if(this.$node.on([this.attr.tapStartEvent,this.attr.tapEndEvent].join(" "),this.attr.itemSelector,$j.proxy(function(e){var t=$(e.target),n=this.attr.itemActiveClass;e.type===this.attr.tapStartEvent?t.prevAll().addClass(n):(t.prevAll().removeClass(n),this.save(t.data("rating")))},this)),this.attr.isDevicePhone)this.initializeForPhone();else{if(!this.attr.isDeviceTablet)return this.broadcastError("initialization failed, user agent is not mobile/tablet.");this.initializeForTablet()}this.$bookContainer.find(this.attr.resetSelector).on(this.attr.tapEvent,$j.proxy(this.resetRating,this)),this.listen("saveSuccess",function(e,t){if($j.isPlainObject(t)&&this.validateRating(t.rating)){if(this.$node.attr("id")!==t.domId)return;t.rating===this.attr.minRating&&this.broadcast("reset"),n||this.defer(function(){this.updateStaticStars(t.rating)})}})}),this.initializeForPhone=function(){return this.elCache.$catalyst&&this.elCache.$catalyst.length||(this.elCache.$catalyst=this.$node.find(".catalyst"),this.elCache.$catalyst.length)?(this.elCache.$catalyst.on(this.attr.tapEvent,$j.proxy(this.toggleVisibility,this)),this.select("cancelSelector").on(this.attr.tapEvent,$j.proxy(this.hide,this)),this.overlayId=[this.attr.componentName,Math.floor(1000000001*Math.random())].join("_"),o||(e.trigger("create.viewportOverlay",{overlayId:this.overlayId}),o=!0),this.listen("beforeShow",function(){var t=this.select("listSelector");if(t.length){var n=t.outerHeight();if(!(n>0))return this.broadcastError("cannot display options list because it has no dimensions");t.css("bottom",0-n+"px")}this.$node.addClass(this.attr.animPrepClass),e.trigger("show.viewportOverlay",{overlayId:this.overlayId})}),this.listen("afterHide",function(){this.defer(function(){e.trigger("hide.viewportOverlay",{overlayId:this.overlayId})}),this.defer(function(){this.$node.removeClass(this.attr.animPrepClass).select("listSelector").css("bottom","")},350)}),e.on("beforeHide.viewportOverlay",$j.proxy(function(e,t){t&&t.overlayId===this.overlayId&&this.defer(function(){this.isVisible()&&this.hide()})},this)),this.listen("saveSuccess",function(e,t){$j.isPlainObject(t)&&this.validateRating(t.rating)&&this.attr.hideCatalystClass&&this.elCache.$catalyst.toggleClass(this.attr.hideCatalystClass,this.attr.currentRating>this.attr.minRating)}),void this.listen("saveComplete",$j.proxy(this.hide,this))):this.broadcastError("could not find catalyst element")},this.initializeForTablet=function(){this.listen("saveSuccess",function(e,t){if($j.isPlainObject(t)&&this.validateRating(t.rating)){var n=t.rating;this.defer(function(){this.$node.find(this.attr.itemSelector).each($j.proxy(function(e,t){var i=$j(t);i.toggleClass(this.attr.itemInactiveClass,n<parseInt(i.data("rating"),10))},this))})}})},this.hide=function(){this.broadcast("beforeHide"),this.$node.removeClass(this.attr.showClass),this.broadcast("afterHide")},this.isVisible=function(){return this.$node.hasClass(this.attr.showClass)},this.show=function(){this.broadcast("beforeShow"),this.$node.addClass(this.attr.showClass),this.broadcast("afterShow")},this.toggleVisibility=function(e){e.preventDefault(),this.isVisible()?this.hide():this.show()},this.updateStaticStars=function(e){var t=this.$bookContainer.find(".bookUserRatingCurrent");if(t.length){var n=e>this.attr.minRating&&e<=this.attr.maxRating,i=/(^|\s+stars_)\d($|\s+)/;t.find(".stars").removeAttr("title").html("").each(function(t,n){n.className=n.className.replace(i,"$1"+e+"$2")}).end().toggleClass("show",n)}},this.resetRating=function(e){e.preventDefault(),this.save(this.attr.minRating)},this.save=function(e){this.validateRating(e)&&$j.ajax({url:this.attr.saveUrl,type:"post",data:{format:"js",rating:e},context:this,success:function(){this.attr.currentRating=e,this.broadcast("saveSuccess",{rating:e,domId:this.$node.attr("id")})},error:function(e){this.broadcast("saveError",e),this.defer(function(){this.authRedirect(e,$j.proxy(function(){var t="Unknown XHR failure when trying to save rating";e.status&&(t+=" , status code "+e.status),this.broadcastError(t)},this))},500)},complete:function(e){this.broadcast("saveComplete",e)}})},this.validateRating=function(e){var t=new RegExp("^["+this.attr.minRating+"-"+this.attr.maxRating+"]$");return t.test(e)}},MixinEventUtils,MixinAuthRedirect);$gr.shared.ratingDistTooltip=flight.component(function(){var e="RatingDistTooltip";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){this.userId=this.$node.data("user-id"),this.graph=$j("#ratingDistribution"+this.userId),this.graphHtml,this.on("click",this.getRatingDistribution)}),this.getRatingDistribution=function(){return void 0===this.graphHtml?$j.ajax({url:"/user/rating_distribution/"+this.userId,type:this.methodType,data:{format:"json"},context:this,success:this.showRatingDistGraph}):this.graph.toggle(),!1},this.showRatingDistGraph=function(e){this.graphHtml=e.body,this.graph.append(this.graphHtml),this.graph.toggle()}},MixinEventUtils);var RatingStars=flight.component(function(){var e="ratingStars";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){var e=this;this.attachStarClickHandler(e),this.on(document,"rateBooksCarouselUpdated",function(){this.attachStarClickHandler(e)})}),this.attachStarClickHandler=function(e){$j(".js-starRating").off(),$j(".js-starRating").on("click",function(){e.toggleStarUI($j(this),e)})},this.toggleStarUI=function(e,t){var n=$.merge(e.siblings(),e),i=e.parent().data("user-rating"),o=e.data("star"),r=e.hasClass("on")&&o==i;$.each(n,function(e,t){var n=$j(t);r||n.data("star")>o?(n.removeClass("on"),n.addClass("off")):(n.removeClass("off"),n.addClass("on"))}),t.saveRating(e,o,i)},this.saveRating=function(e,t,n){t===n&&(t=0);var i=e.parent().parent().attr("rel"),o=e.parent().parent().attr("origin"),r=$j(".bookItem[rel='"+i+"']");t>=3&&3>n&&(r.find(".bookCover").hide(),r.find(".bookCoverLoadingOverlay").show()),$.ajax({url:e.parent().data("submit-url"),type:"post",data:{format:"json",rating:t,delete_review:0===t,book_id:i,reg_path:$j("#reg_path").val(),book_origin:o},context:this,success:function(i){e.parent().data("user-rating",t),t>=3&&3>n&&(r.find(".bookCover").show(),r.find(".bookCoverLoadingOverlay").hide()),(0==t||0==n)&&this.broadcast("saveRatingSuccess",i)}})}},MixinEventUtils,MixinAuthRedirect);$gr.communityQA.readerQAForm=flight.component(function(){var e="readerQAForm";this.defaultAttrs({channel:e,formSuccessEventName:"qaFormSuccess",containerSelector:".js-communityAnswersList",emptyMessageSelector:".communityAnswerEmptyMessage",formContainerSelector:".readerQAFormContainer",formUserImageSelector:".js-ReaderQAForm-formUserImage",notificationSelector:".js-notification",rateLimitMessageSelector:".js-ReaderQAForm-rateLimitMessage",unansweredQuestionsContainer:".js-unansweredQuestionsContainer",unansweredQuestionsList:"#communityQuestionsWithoutAnswers",unansweredQuestionSelector:".unansweredQuestion"}),this.after("initialize",function(){this.on("ajax:success",this.uiAddResponseToPage),this.$formNode=this.$node.find("form")}),this.displayRateLimitMessage=function(){$j(this.attr.rateLimitMessageSelector).show()},this.hideFormUserImage=function(){$j(this.attr.formUserImageSelector).hide()},this.uiAddQuestionToPage=function(e){$j(this.attr.unansweredQuestionsList).prepend(e.html);var t=$j(this.attr.unansweredQuestionsContainer);t.is(":visible")||t.show()},this.uiAddAnswerToPage=function(e){var t=$j(e.html).prependTo(this.attr.containerSelector);this.attachComponentsToNewAnswers(t),$j(this.attr.emptyMessageSelector).hide()},this.uiAddResponseToPage=function(e,t,n,i){this.uiResetForm();var o=!1,r=this.$formNode.data("formType");t.html&&("question"===r?this.uiAddQuestionToPage(t):"answer"===r&&this.uiAddAnswerToPage(t)),t.message&&this.uiShowNotification(t),t.limit_reached&&(o=!0),("answer"===this.$formNode.data("formType")||o)&&(this.uiHideForm(),this.trigger("answerFormSubmitted.authorDashboardQA")),o&&(this.hideFormUserImage(),this.displayRateLimitMessage());var s=this.$formNode.parents(this.attr.unansweredQuestionSelector);s.length&&s.find(".questionHeaderAndActions").fadeOut()},this.attachComponentsToNewAnswers=function(e){$gr.shared.editInPlaceController.attachTo(e,{editableElementSelector:".communityAnswerText",highlightElementSelector:".communityAnswerText",elementsToHideSelectors:".communityAnswererName, .communityAnswerText, .communityAnswerFooter"}),$gr.shared.confirmModal.attachTo(".js-confirmModal")},this.uiHideForm=function(){this.$node.children().not(this.attr.notificationSelector).fadeOut(),this.teardown()}},MixinEventUtils,withExpandableTextField,withNotification,withFormAjax),$gr.shared.readingNote=flight.component(function(){var e="ReadingNote",t=2e4,n=1e3,i="delete",o="post",r="put";this.defaultAttrs({channel:e,componentName:e,highlightContainer:".highlightContainer",noteContainer:".noteHighlightTextContainer__noteContainer",noteText:".noteContainer__noteText",persistanceUI:".noteContainer__noteText__persist",saveButton:".js-readingNote-save",cancelButton:".js-readingNote-cancel",savedNotification:".noteContainer__noteText__savedNotification",deleteNoteLink:".noteContainer__noteText__deleteNote",visibleToggle:".toggle-switch-checkbox",makeVisibleButton:".readingNotesBanner-makeVisible",makeInvisibleLink:".readingNotesBanner-makeInvisible",deleteReadingNoteLink:".js-readingNote-deleteReadingNote",markAsSpoilerCheckbox:".js-readingNote-spoilerCheckbox",markAsSpoilerLabel:".markAsSpoilerContainer__label",commentsContainer:".noteHighlightTextContainer__commentsContainer",showSpoiler:".spoilerContainer__showLink"}),this.after("initialize",function(){this.saveButtonActive=!0,this.totalCount=parseInt($j("#totalCount").text()),this.showBulkUpdateControl();var e=this.select("noteText").text().trim();this.select("noteText").text(e),this.lastSavedText=e,""!==this.lastSavedText&&(this.hasNote=!0),this.readingNoteEndpoint="/book/"+this.$node.data("bookId")+"/reading_note/",this.annotationPairEndpoint="/book/"+this.$node.data("bookId")+"/reading_notes/",this.persistEndpoint=this.$node.data("notePersistEndpoint"),this.annotationPairId=this.$node.data("annotation-pair-id"),this.select("visibleToggle").prop("checked",this.$node.data("visible")),this.on("click",{noteText:this.showPersistanceUI,cancelButton:this.hidePersistanceUIandRestoreText,saveButton:this.saveNote,deleteNoteLink:this.deleteNote,makeVisibleButton:this.makeAllVisible,makeInvisibleLink:this.makeAllInvisible,deleteReadingNoteLink:this.deleteReadingNote,showSpoiler:this.showSpoiler}),this.on("change",{visibleToggle:this.toggleVisible,markAsSpoilerCheckbox:this.changeIsSpoiler})}),this.showPersistanceUI=function(){this.hidePrompts(),this.select("persistanceUI").show(),this.hasNote&&(this.resetSaveButtonState(),this.showDeleteLink())},this.hidePersistanceUI=function(){this.showPrompts(),this.select("persistanceUI").hide()},this.showPrompts=function(){var e=this.select("noteText");e.removeClass("noEdit"),e.removeClass("greyWatermark")},this.hidePrompts=function(){var e=this.select("noteText");e.addClass("noEdit"),e.addClass("greyWatermark")},this.showDeleteLink=function(){this.select("deleteNoteLink").show()},this.hideDeleteLink=function(){this.select("deleteNoteLink").hide()},this.showSavedNotification=function(){this.select("savedNotification").show()},this.hideSavedNotification=function(){this.select("savedNotification").hide()},this.hidePersistanceUIandRestoreText=function(){this.hidePersistanceUI(),this.restoreText()},this.resetSaveButtonState=function(){this.select("saveButton").text("Save"),this.saveButtonActive=!0},this.removeText=function(){this.select("noteText").text("")},this.restoreText=function(){this.select("noteText").text(this.lastSavedText)},this.saveNote=function(){if(this.saveButtonActive){this.saveButtonActive=!1,this.select("saveButton").text("Saving...");var e=this.select("noteText").text().trim();if(e===this.lastSavedText)return void this.onSaveNoteSuccess();var t,n,s={text:e};""===e?(t=i,n=this.onImplicitDeleteSuccess):(this.hasNote?t=r:(t=o,s.highlight_id=this.$node.data("highlightId")),n=this.onSaveNoteSuccess);var a=this.onSaveNoteError;this.makeRequest(t,this.persistEndpoint,s,n,a)}},this.deleteNote=function(){var e=i,t=this.onDeleteNoteSuccess,n=this.onDeleteNoteError;this.makeRequest(e,this.persistEndpoint,null,t,n)},this.makeRequest=function(e,n,i,o,r){var s={url:n,type:e,dataType:"json",success:o,error:r,data:i,timeout:t,context:this};$j.ajax(s)},this.onSaveNoteSuccess=function(e){this.lastSavedText=this.select("noteText").text().trim(),this.resetSaveButtonState(),this.showSavedNotification(),this.hasNote=!0,e&&e.annotation_pair_id&&(this.annotationPairId=e.annotation_pair_id,this.persistEndpoint=this.readingNoteEndpoint+this.annotationPairId);var t=$j.proxy(this.hidePersistanceUI,this),i=$j.proxy(this.hideSavedNotification,this),o=$j.proxy(this.showDeleteLink,this);window.setTimeout(function(){t(),i(),o()},n)},this.onImplicitDeleteSuccess=function(){this.resetSaveButtonState(),this.showSavedNotification();var e=$j.proxy(this.hidePersistanceUI,this),t=$j.proxy(this.hideSavedNotification,this),i=$j.proxy(this.onDeleteNoteSuccess,this);window.setTimeout(function(){e(),t(),i()},n)},this.onDeleteNoteSuccess=function(e){this.$node.data("highlightId")||this.$node.remove(),this.lastSavedText="",this.hasNote=!1,this.annotationPairId=e.annotation_pair_id,this.persistEndpoint=this.readingNoteEndpoint,this.removeText(),this.hidePersistanceUI(),this.hideDeleteLink()},this.onSaveNoteError=function(){this.resetSaveButtonState();var e="An error occurred while saving your note.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e})},this.onDeleteNoteError=function(){this.restoreText();var e="An error occurred while deleting your note.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e})},this.toggleVisible=function(e){var t=e.target.checked;t||this.select("commentsContainer").hide(),this.toggleVisibleRequest(t,this.annotationPairId)},this.toggleVisibleRequest=function(e,t){this.updateCount(e),this.showBulkUpdateControl();var n={visible:e},i=this.annotationPairEndpoint+t,o=this.onToggleVisibleSuccess,s=this.onToggleVisibleError;this.makeRequest(r,i,n,o,s)},this.onToggleVisibleSuccess=function(){},this.onToggleVisibleError=function(){var e="Your reading note could not be made visible/hidden. Please try again later.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e});var t=this.$node.data("visible");this.select("visibleToggle").prop("checked",t),this.updateCount(t),this.showBulkUpdateControl()},this.updateCount=function(e){var t=parseInt($j("#visibleCount").text()),n=e?t+1:t-1;$j("#visibleCount").text(n)},this.makeAllVisible=function(){this.fallbackCount=parseInt($j("#visibleCount").text()),$j("#visibleCount").text(this.totalCount),$j(".toggle-switch-checkbox").prop("checked",!0),this.showBulkUpdateControl(),this.bulkUpdateShareState(!0)},this.makeAllInvisible=function(){this.fallbackCount=parseInt($j("#visibleCount").text()),$j("#visibleCount").text(0),$j(".toggle-switch-checkbox").prop("checked",!1),this.showBulkUpdateControl(),this.bulkUpdateShareState(!1)},this.bulkUpdateShareState=function(e){var t={visible:e},n=this.annotationPairEndpoint,i=this.onBulkUpdateShareStateSuccess,o=this.onBulkUpdateShareStateError;this.makeRequest(r,n,t,i,o)},this.onBulkUpdateShareStateSuccess=function(){},this.onBulkUpdateShareStateError=function(){var e="Your reading notes could not be made visible/hidden. Please try again later.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e}),$j("#visibleCount").text(this.fallbackCount),this.showBulkUpdateControl(),this.reloadMainContainer()},this.showBulkUpdateControl=function(){var e=parseInt($j("#visibleCount").text());e===this.totalCount?(this.select("makeVisibleButton").hide(),this.select("makeInvisibleLink").show()):(this.select("makeInvisibleLink").hide(),this.select("makeVisibleButton").show())},this.reloadMainContainer=function(){jQuery("#allHighlightsAndNotes").load(document.URL+" #allHighlightsAndNotes > *")},this.changeIsSpoiler=function(){var e={is_spoiler:this.isSpoilerValue()};this.updateSpoilerLabelText();var t=this.annotationPairEndpoint+this.annotationPairId,n=this.onChangeSpoilerSuccess,i=this.onChangeSpoilerError;this.makeRequest(r,t,e,n,i)},this.updateSpoilerLabelText=function(){var e;e="true"===this.isSpoilerValue()?"Marked as Spoiler":"Mark as Spoiler",this.select("markAsSpoilerLabel").text(e)},this.onChangeSpoilerSuccess=function(){this.$node.data("isSpoiler",this.isSpoilerValue())},this.onChangeSpoilerError=function(){var e="Your reading note could not be marked/unmarked as a spoiler. Please try again later.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e}),this.$node.find(".js-readingNote-spoilerCheckbox").prop("checked",this.$node.data("isSpoiler")),this.updateSpoilerLabelText()},this.isSpoilerValue=function(){return this.$node.find(".js-readingNote-spoilerCheckbox").prop("checked")?"true":"false"},this.showSpoiler=function(){this.$node.find(".spoilerContainer").hide(),this.$node.find(".readingNoteContentContainer").show()},this.deleteReadingNote=function(){var e=this.annotationPairEndpoint+this.annotationPairId,t={book_id:this.$node.data("bookId")},n=this.onDeleteReadingNoteSuccess,o=this.onDeleteReadingNoteError;this.makeRequest(i,e,t,n,o)},this.onDeleteReadingNoteSuccess=function(){this.$node.remove()},this.onDeleteReadingNoteError=function(){var e="An error occurred while deleting your reading note.";$j("#notificationBanner").trigger("showNotification",{type:"error",message:e})}},MixinEventUtils,MixinAuthRedirect),$gr.shared.readingYear=flight.component(MixinEventUtils,function(){var e="",t=null,n="",i="",o="",r=1.5;this.readingYearId=null,this.$shareToNewsfeedFeedbackId=null,this.after("initialize",function(){e=this.$node.data("alignby"),n=this.$node.data("coverclass"),i=this.$node.data("doubleclass"),this.readingYearId=this.$node.data("readingyearid"),this.$shareToNewsfeedFeedbackId=$j("#"+this.$node.data("sharetonewsfeedfeedbackid")),"px"==e?t=this.$node.data("maxheight"):"relative"==e&&(o=this.$node.data("separatorimageclass")),$j(window).load(this.resizeSeasonalCovers),window.addEventListener("resize",this.resizeSeasonalCovers),$j("#"+this.$node.data("sharetonewsfeedbuttonid")).on("click",{env:this},this.shareToNewsfeedAction),$j(this.$node.data("fbselector")).on("click",{tag:"fb"},this.trackClick),$j(this.$node.data("twitterselector")).on("click",{tag:"twitter"},this.trackClick),$j(this.$node.data("pinterestselector")).on("click",{tag:"pinterest"},this.trackClick)}),this.resizeSeasonalCovers=function(){s(n,1),s(i,2),"relative"==e&&s(o,1)};var s=function(n,i){$j(n).each(function(){var n=$j(this).find("img");if("px"==e){var o=t*i-40*(i-1);n.length&&n.height()>=o&&(n.css("height",o.toString()+"px"),n.css("width","auto")),n.length&&2==i&&$j(this).find(".staticStars").css("transform","translateY(-"+((o-n.height())/2).toString()+"px)")}else if("relative"==e){var s=25*i;if($j(this).css("width",s.toString()+"%"),$j(this).height($j(this).width()*r/i),n.length){n.css("height",""),n.css("width","");var a=$j(this).height()*i,l=n.height();if(l>a)n.css("height",a.toString()+"px"),n.css("width","auto");else{var c=(a-l)/2;n.css("transform","translateY("+c.toString()+"px)"),2==i&&$j(this).find(".staticStars").css("transform","translateY("+c.toString()+"px)")}}}})};this.shareToNewsfeedAction=function(e){var t=e.data.env;1!=e.currentTarget.disabled&&$j.ajax({url:"/reading_year/add_newsfeed_update",data:{id:t.readingYearId},method:"post"}).success(function(){e.currentTarget.textContent="Shared",e.currentTarget.disabled=!0,t.$shareToNewsfeedFeedbackId.show(),setTimeout(function(){t.$shareToNewsfeedFeedbackId.hide()},8e3)})},this.trackClick=function(e){$j.post("/track/track",{tid:"yyib_"+e.data.tag+"_share"},null),$j.post("/track/track_click",{feature:"yyib_share_"+e.data.tag})}}),$gr.shared.relatedWorks=flight.component(function(){this.defaultAttrs({relatedWorksContainerSelector:".js-relatedWorksContainer",wtrButtonSelector:".wtrButtonContainer"}),this.after("initialize",function(){this.on("wtrShelvingCompleted",{wtrButtonSelector:this.uiInsertRelatedWorks})}),this.uiInsertRelatedWorks=function(e,t){this.$node.next(this.attr.relatedWorksContainerSelector).removeClass("initiallyHidden").find("td").html(t.html_content),$gr.shared.dismissModuleUI.attachTo(".js-dismissModuleContainer",{dismissButtonSelector:".js-dismissTrigger"
})}}),$gr.shared.reviewAutoSave=flight.component(function(){this.defaultAttrs({reviewTextArea:".js-reviewUserText",manualSaveButton:"#js-saveReviewDraftButton",autoSavePeriod:3e4}),this.loopInterval,this.previousPayload={},this.lock=!1;var e;this.after("initialize",function(){e=this,$j(e.attr.reviewTextArea).on("change.reviewDraft",t),$j(this.attr.manualSaveButton).click(function(e){e.stopImmediatePropagation(),n()}),window.onunload=n,$j(e.attr.reviewTextArea).on("keypress.reviewDraft",function(){$j("#autoSaveConfirmation").hide()})});var t=function(t){t.stopImmediatePropagation(),$j(e.attr.reviewTextArea).off("change.reviewDraft"),n(),e.loopInterval=setInterval(n,e.attr.autoSavePeriod)},n=function(){var t=o();!e.lock&&i(t)&&(e.lock=!0,$j("#autoSaveError").hide(),$j("#autoSaveLoading").show(),$j.post("/review/draft",t).always(function(){e.lock=!1,$j("#autoSaveLoading").hide()}).done(function(){e.previousPayload=t,$j("#autoSaveConfirmation").show()}).fail(function(){$j("#autoSaveError").html("The review draft could not be saved."),$j("#autoSaveError").show()}))},i=function(t){return t.review!==e.previousPayload.review},o=function(){return{book_id:e.attr.bookID,review:$j(e.attr.reviewTextArea).val()}}}),$gr.shared.reviewDraftDataCollection=flight.component(function(){this.after("initialize",function(){var e=this;this.on("change.reviewDraftDataCollection",function(){$j.post("/track/track",{tid:"track_text_written_in_review_text_box"}).done(function(){e.off("change.reviewDraftDataCollection")})})})}),$gr.shared.reviewStatsChart=flight.component(function(){this.defaultAttrs({}),this.after("initialize",function(){this.bindChartCallback(".js-reviewStatsGraph")}),this.bindChartCallback=function(e){var t=this.toggleGraphCallback(e);$j(e).hover(t,t)},this.toggleGraphCallback=function(e){return function(){$j(".js-reviewStats").toggle(),$j(".js-reviewStatsLabeled").toggle()}},this.getChartClass=function(e){return e+"Chart"},this.getLabeledChartClass=function(e){return this.getChartClass(e)+"Labeled"}}),$gr.shared.reviewStatsSort=flight.component(function(){this.defaultAttrs({sortSelector:".selectMenu"}),this.after("initialize",function(){this.on("change",{sortSelector:this.sortPage})}),this.sortPage=function(){var e=this.$node.data("url");e+="?year="+$j(".selectYear").val(),e+="&group_by="+$j(".selectSortFilter").val(),window.location.href=e}});var SearchInline=flight.component(function(){var e="searchInline";this.defaultAttrs({channel:e,componentName:e,searchResultsSelector:null,searchFieldSelector:".field",searchFieldClearSelector:".clearIcon",distractionSelector:"",searchFieldActiveClass:"active",searchResultsLoadingClass:"loading",searchResultsShowClass:"show",$queryAjaxSettings:null,queryParamName:"q",queryLengthMin:2,enableCollapseDistractions:!1}),this.after("initialize",function(){return this.isActive=!1,this.$node.is("input")?this.$searchField=this.$node:this.$searchField=this.select("searchFieldSelector").first(),this.$searchField.length<1||!this.$searchField.is("input")?this.broadcastError("search field element is required"):(this.on(this.$searchField,"focus",this.activate),this.select("searchFieldClearSelector").on("click",$j.proxy(this.deactivate,this)),this.$searchResultsContainer||(this.$searchResultsContainer=$j(this.attr.searchResultsSelector)),void this.initializeSearchFieldAutocomplete())}),this.initializeSearchFieldAutocomplete=function(){this.on(this.$searchField,"showMenu.autocomplete",this.showSearchResults),this.on(this.$searchField,"submitQueryStart.autocomplete",function(){this.trigger(this.$searchField,"clearMenu.autocomplete"),this.$searchResultsContainer.addClass(this.attr.searchResultsLoadingClass)}),this.on(this.$searchField,"submitQueryEnd.autocomplete",function(){this.$searchResultsContainer.removeClass(this.attr.searchResultsLoadingClass)}),Autocomplete.attachTo(this.$searchField,{menuListParentSelector:this.attr.searchResultsSelector,queryLengthMin:this.attr.queryLengthMin,queryParamName:this.attr.queryParamName,$queryAjaxSettings:this.attr.$queryAjaxSettings})},this.activate=function(){this.isActive||(this.isActive=!0,this.$node.addClass(this.attr.searchFieldActiveClass),this.toggleDistractionlessMode(!0),this.showSearchResults(),this.trigger(document,"hideBrowserAddressBar"))},this.deactivate=function(){this.isActive&&(this.isActive=!1,this.$node.removeClass(this.attr.searchFieldActiveClass),this.hideSearchResults(),this.toggleDistractionlessMode(!1),this.resetSearchResults())},this.hideSearchResults=function(){this.$searchResultsContainer.removeClass(this.attr.searchResultsShowClass)},this.resetSearchResults=function(){this.trigger(this.$searchField,"reset.autocomplete")},this.showSearchResults=function(){this.isActive&&this.$searchResultsContainer.addClass(this.attr.searchResultsShowClass)},this.toggleDistractionlessMode=function(e){var t=$j(this.attr.distractionSelector);this.attr.enableCollapseDistractions===!0?t[e?"hide":"show"]():t.css("visibility",e?"hidden":"")}},MixinEventUtils),ShareBookButton=flight.component(function(){this.after("initialize",function(){this.on($gr.touch,function(){alert("Sharing is caring.")})})});$gr.communityQA.shareToggle=flight.component(function(){var e="shareToggleComponent";this.defaultAttrs({channel:e,componentName:e,selectedClass:"selected"}),this.after("initialize",function(){this.$parent=this.$node.parent(),this.on("click",this.toggleShareOption)}),this.toggleShareOption=function(){var e=this,t=function(){e.uiToggle(),e.dataToggle()};"facebook"===this.$node.data("share-service")?$grfb.ensurePublishPermission().done(t):"twitter"===this.$node.data("share-service")?"connected"===this.$node.data("service-connected")?t():GR_Twitter.askToConnect(function(){e.$node.data("service-connected","connected"),t()}):t()},this.uiToggle=function(){this.$parent.toggleClass(this.attr.selectedClass)},this.dataToggle=function(){var e=this.$node.closest("form"),t=this.$node.data("share-service"),n="share-service-"+t;this.$parent.hasClass(this.attr.selectedClass)?$j("<input>").attr({type:"hidden",name:n,value:!0}).appendTo(e):$j('input[name="'+n+'"]').remove()}},withTooltips);var SiteBanner=flight.component(function(){var e="siteBanner";this.defaultAttrs({rootSelector:"#siteBanner",closeSelector:".closeIcon",showClass:"show",channel:e}),this.after("initialize",function(){this.listen("requestHide",this.onRequestHide),this.listen("requestShow",this.onRequestShow),this.$rootNode=$j(this.attr.rootSelector).first(),this.on(this.$rootNode.find(this.attr.closeSelector),"click",this.hide),this.listen("addClass",function(e,t){this.$rootNode.addClass(t)})}),this.hide=function(){this.isVisible()&&(this.broadcast("beforeHide"),this.$rootNode.removeClass(this.attr.showClass),this.broadcast("afterHide"))},this.isVisible=function(){return this.$rootNode.hasClass(this.attr.showClass)},this.show=function(){this.isVisible()||(this.broadcast("beforeShow"),this.$rootNode.addClass(this.attr.showClass),this.broadcast("afterShow"))},this.onRequestHide=function(e){this.isVisible()?this.hide():this.broadcast("afterHide")},this.onRequestShow=function(e){this.isVisible()?this.broadcast("afterShow"):this.show()}},MixinEventUtils),SiteNavSecondary=flight.component(function(){var e="siteNavSecondary";this.defaultAttrs({navRootSelector:"#siteNavSecondary",catalystSelector:".jsSecondaryNavToggle",activeClass:"showSiteNavSecondary",channel:e,componentName:e}),this.after("initialize",function(){this.on("click",{catalystSelector:this.onToggleNavVisibility}),this.listen("requestHide",this.hideNav),this.listen("requestShow",this.showNav),this.on(window,"orientationchange",this.hideNav)}),this.hideNav=function(){this.isNavVisible()&&($j(document).trigger("disableScrollLock"),$j(document.body).removeClass(this.attr.activeClass),this.broadcast("beforeHide"),this.defer(function(){this.broadcast("requestReset.tabCluster"),this.disableTouchScrollingAssist(),this.broadcast("hide"),this.broadcast("afterHide")},500))},this.isNavVisible=function(){return $j(document.body).hasClass(this.attr.activeClass)},this.showNav=function(){this.isNavVisible()||(this.broadcast("beforeShow"),$j(document.body).addClass(this.attr.activeClass),this.enableTouchScrollingAssist(),$j(document).trigger("hideBrowserAddressBar",!0),$j(document).trigger("enableScrollLock","x"),this.broadcast("show"),this.broadcast("afterShow"))},this.onToggleNavVisibility=function(e){e.preventDefault(),this.isNavVisible()?this.hideNav():this.showNav()},this.disableTouchScrollingAssist=function(){$j(this.attr.navRootSelector).css("height","")},this.enableTouchScrollingAssist=function(){var e=$j(document).height(),t=$j(window).height();$j(this.attr.navRootSelector).height(e>t?e:t)}},MixinEventUtils),SiteSearch=flight.component(function(){var e="siteSearch";this.defaultAttrs({channel:e,componentName:e,searchButtonSelector:"#siteSearchButton",searchFieldClearSelector:".clearIcon",searchFieldSelector:".field",searchFormSelector:".searchForm",searchResultsSelector:".searchResults",buttonSelectedClass:"selected",searchFormActiveClass:"active",clearIconShowClass:"show",searchPanelShowClass:"show",searchResultsShowClass:"show",autocomplete:!0,sticky:!1,queryDebounceDuration:500}),this.after("initialize",function(){this.isActive=!1,this.$searchButton||(this.$searchButton=$j(this.attr.searchButtonSelector)),this.$searchField||(this.$searchField=this.select("searchFieldSelector")),this.$searchForm||(this.$searchForm=this.select("searchFormSelector")),this.$searchResultsContainer||(this.$searchResultsContainer=this.select("searchResultsSelector")),this.$searchFieldClear||(this.$searchFieldClear=this.select("searchFieldClearSelector")),this.on(this.$searchButton,"click",this.toggleSearchPanel),this.attr.autocomplete===!0&&this.initializeSearchFieldAutocomplete(),this.on(this.$searchField,"focus",this.activate),this.on(this.$searchFieldClear,"click",this.deactivate),this.on(document,"beforeShow.siteNavSecondary",function(e){this.toggleSearchPanel(null,!1)}),this.attr.sticky===!1&&(this.on(document,"click",function(){this.isSearchPanelVisible()&&this.hideSearchPanel()}),this.on("click",function(e){e.stopPropagation()})),this.on(this.$searchField,"keyup input",this.onKeystroke),this.listen("showSearch",this.showSearchPanel)}),this.initializeSearchFieldAutocomplete=function(){this.on(this.$searchField,"showMenu.autocomplete",this.showSearchResults),this.after("hideSearchPanel",function(e){this.trigger(this.$searchField,"reset.autocomplete")}),Autocomplete.attachTo(this.$searchField,{menuListParentSelector:this.attr.searchResultsSelector,queryParamName:"q",$queryAjaxSettings:{type:"POST",url:"/book/auto_complete",data:{book_origin:"header_search"}}})},this.activate=function(){this.isActive||(this.isActive=!0,this.$searchForm.addClass(this.attr.searchFormActiveClass),this.setSearchFieldClearState(),this.trigger(document,"hideBrowserAddressBar"))},this.deactivate=function(){this.isActive&&(this.isActive=!1,this.$searchField.val(""),this.setSearchFieldClearState(),this.resetSearchResults(),this.$searchField.focus())},this.hideSearchPanel=function(){this.hideSearchResults(),this.$node.removeClass(this.attr.searchPanelShowClass),this.$searchButton.removeClass(this.attr.buttonSelectedClass),this.broadcast("hide")},this.hideSearchResults=function(){this.$searchResultsContainer.removeClass(this.attr.searchResultsShowClass)},this.isSearchPanelVisible=function(){return this.$node.hasClass(this.attr.searchPanelShowClass)},this.onKeystroke=function(e){this.setSearchFieldClearState()},this.setSearchFieldClearState=function(){""===this.$searchField.val()?this.$searchFieldClear.removeClass(this.attr.clearIconShowClass):this.$searchFieldClear.addClass(this.attr.clearIconShowClass)},this.resetSearchResults=function(){this.trigger(this.$searchField,"reset.autocomplete")},this.showSearchPanel=function(){this.$searchButton.addClass(this.attr.buttonSelectedClass),this.trigger(document,"hideBrowserAddressBar",!0),this.defer(function(){this.$node.addClass(this.attr.searchPanelShowClass),this.broadcast("show")})},this.showSearchResults=function(){this.isSearchPanelVisible()&&this.$searchResultsContainer.addClass(this.attr.searchResultsShowClass)},this.toggleSearchPanel=function(e,t){e&&e.preventDefault();var n="boolean"==typeof t?t:!this.isSearchPanelVisible();n?(this.showSearchPanel(),this.trigger(document,"requestHide.siteNavSecondary")):this.hideSearchPanel()}},MixinEventUtils),SortMenuButton=flight.component(function(){var e="sortMenuButton";this.defaultAttrs({activeClass:"selected",menuSelector:"#sortMenu",slideUpListItemAllowDefaultAction:!0,channel:e,componentName:e}),this.after("initialize",function(){this.on("click",function(e){this.$node.hasClass(this.attr.activeClass)?this.$node.removeClass(this.attr.activeClass):this.$node.addClass(this.attr.activeClass),this.toggleSlideUpMenuVisibility(e)})})},withSlideUpMenu),Spoilers=flight.component(function(){var e="spoilers";this.defaultAttrs({channel:e,componentName:e,showSpoilerSelector:".jsShowSpoiler",hideSpoilerSelector:".jsHideSpoiler",spoilerContainerSelector:".spoilerContainer"}),this.after("initialize",function(){this.on($gr.touch,{showSpoilerSelector:this.onShowSpoiler,hideSpoilerSelector:this.onHideSpoiler})}),this.onHideSpoiler=function(e){var t=$j(e.target);e.preventDefault(),t.parent().siblings(this.attr.showSpoilerSelector).show(),t.parent(this.attr.spoilerContainerSelector).hide()},this.onShowSpoiler=function(e){var t=$j(e.target);e.preventDefault(),t.siblings(this.attr.spoilerContainerSelector).show(),t.hide()}}),TabCluster=flight.component(function(){var e,t="tab-id",n="tabCluster";this.defaultAttrs({channel:n,componentName:n,sectionRoot:null,sectionSelector:".tabSection",tabSelector:".tab",hideSectionClass:"hide",tabSelectedClass:"selected",tabLinkAttrName:t,sectionLinkAttrName:t}),this.after("initialize",function(){e=$j(this.attr.sectionRoot),e.length<1||(this.attr.defaultTabSelected=$j(this.attr.defaultTabSelected).first(),this.attr.defaultTabSelected.length<1&&(this.attr.defaultTabSelected=this.select("tabSelector").filter("."+this.attr.tabSelectedClass).first()),this.on("click",{tabSelector:this.onTabSelect}),this.listen("requestReset",this.reset))}),this.isTabSelected=function(e){return e.hasClass(this.attr.tabSelectedClass)},this.reset=function(){var e=this.attr.defaultTabSelected,t=e.data(this.attr.tabLinkAttrName);this.switchTab(t),this.broadcast("reset")},this.switchTab=function(t){e.find(this.attr.sectionSelector).each($.proxy(function(e,n){var i=$(n);i.toggleClass(this.attr.hideSectionClass,i.data(this.attr.sectionLinkAttrName)!==t)},this)),this.select("tabSelector").each($.proxy(function(e,n){var i=$(n);i.toggleClass(this.attr.tabSelectedClass,i.data(this.attr.tabLinkAttrName)===t)},this)),this.broadcast("switch")},this.onTabSelect=function(e){e.preventDefault();var t=$j(e.target).closest(this.attr.tabSelector),n=t.data(this.attr.tabLinkAttrName);"string"!=typeof n||this.isTabSelected(t)||this.switchTab(n)}},MixinEventUtils);$gr.shared.toggleQaForm=flight.component(function(){this.defaultAttrs({answerFormSelector:".answerForm",answerActionSelector:".answerQuestionAction",unansweredQuestionSelector:".unansweredQuestion"}),this.after("initialize",function(){this.on("click",{answerActionSelector:this.uiShowForm})}),this.uiShowForm=function(e){var t=$j(e.target);e.preventDefault(),$j.ajax({url:t.data("get-form-url"),type:"get",data:{format:"json"},context:this,success:function(e){t.parents(this.attr.unansweredQuestionSelector).find(this.attr.answerFormSelector).html(e.content_html),$gr.communityQA.readerQAForm.attachTo(".js-readerQAForm"),$gr.shared.notification.attachTo(".js-notification"),$gr.communityQA.shareToggle.attachTo(".js-shareToggle")}})}},MixinEventUtils),$gr.shared.tooltip=flight.component(function(){this.defaultAttrs({tooltipCaretSelector:".tooltipCaret",tooltipSelector:".js-tooltip",defaultTooltipClass:"tooltipDefault",htmlRetrievedEvent:"tooltipHtmlRetrieved.dataTooltip"}),this.after("initialize",function(){this.tooltipHtml=null,this.$node.data("synchronous")?this.$node.hover($j.proxy(this.showTooltip,this),$j.proxy(this.hideTooltip,this)):this.listen(this.attr.htmlRetrievedEvent,this.attachTooltipHoverEvents)}),this.attachTooltipHoverEvents=function(e,t){var n=this.$node.data("resource-type")+"."+this.$node.data("resource-id");null===this.tooltipHtml&&"undefined"!=typeof t.tooltips[n]&&(this.$node.find("a, img").removeAttr("title"),this.$node.removeAttr("title"),this.tooltipHtml=t.tooltips[n],this.$node.hover($j.proxy(this.showTooltip,this),$j.proxy(this.hideTooltip,this)))},this.showTooltip=function(e){HoverIntent.onEnterIntent(this,function(){var e=this.select("tooltipSelector");e.length?e.show():this.constructTooltip()},this,750)},this.hideTooltip=function(e){HoverIntent.onLeaveIntent(this,function(){this.select("tooltipSelector").hide()})},this.constructTooltip=function(){this.$node.append(this.tooltipHtml);var e=10,t=this.select("tooltipSelector");if("bottom"===this.$node.data("placement")){t.find(this.attr.tooltipCaretSelector).addClass("tooltipCaret--top");var n=(this.$node.height()+e).toString();t.css("left","0px"),t.css("top",n+"px")}else if("bottom-left"===this.$node.data("placement")){t.find(this.attr.tooltipCaretSelector).addClass("tooltipCaret--top-right");var i=(this.$node.height()+e).toString(),o=(this.$node.width()-3*e).toString();t.css("right",o+"px"),t.css("top",i+"px")}else if("left"===this.$node.data("placement")){t.find(this.attr.tooltipCaretSelector).addClass("tooltipCaret--right");var r=(this.$node.width()+e).toString();t.css("right",r+"px"),t.css("top","0px")}else{t.find(this.attr.tooltipCaretSelector).addClass("tooltipCaret--left");var s=(this.$node.width()+e).toString();t.css("left",s+"px"),t.css("top","0px")}this.broadcast("tooltipHtmlConstructed")}},MixinEventUtils),$gr.shared.twitterCallbacks=flight.component(function(){var e="twitterCallbacksComponent";this.defaultAttrs({channel:e,componentName:e}),this.after("initialize",function(){twttr.ready(function(e){e.events.bind("tweet",t)})});var t=function(e){var t="twitter_update_pushed",n=$j("#tracker").data("track-tweet");"undefined"==typeof n&&(n=$j(e.target.parentElement).data("gr-tracker-id")),n&&"undefined"!=typeof n&&(t=[t,n]),$j.ajax({url:"/track/track",type:"GET",data:{tid:t}})}}),$gr.shared.twitterDialog=flight.component(function(){this.defaultAttrs({counterSelector:".characterCounter",textareaSelector:".characterCountArea",tweetViaGrSelector:".tweetViaGr",shareButtonSelector:".button",warningClass:"warning",keystrokeDebounceDuration:100,maxUrlLengthAfterShortening:23,tweetMaxLength:140}),this.after("initialize",function(){var e=this.select("textareaSelector");this.tweetUrlLength=e.data("append-url")?this.attr.maxUrlLengthAfterShortening:0,this.tweetViaLength="true"===this.select("tweetViaGrSelector").val()?" via @goodreads".length:0,this.on("keyup",flight.utils.debounce(this.uiUpdateCounter,this.attr.keystrokeDebounceDuration)),this.uiUpdateCounter()}),this.uiUpdateCounter=function(){var e=this.getNumCharsRemaining(),t=this.select("counterSelector");0>e?(t.addClass(this.attr.warningClass),this.uiEnableButton(!1)):(t.removeClass(this.attr.warningClass),this.uiEnableButton(!0)),0===this.select("textareaSelector").val().length&&this.uiEnableButton(!1),t.html(e+" characters left")},this.uiEnableButton=function(e){this.select("shareButtonSelector").prop("disabled",!e)},this.getNumCharsRemaining=function(){var e=this.select("textareaSelector").val(),t=e.replace(/[\s]?(https?:\/\/[^\s]+)/g,"").replace(" via @goodreads","").length;return this.attr.tweetMaxLength-t-this.tweetUrlLength-1-this.tweetViaLength}}),$gr.shared.updateFiltersForm=flight.component(function(){this.defaultAttrs({updateFiltersFormSelector:".js-updateFiltersForm",updateTypeFiltersSelector:".js-updateTypeFilters",updateItemSelector:"input[name=update_item]:checked",updateScopeSelector:"input[name=update_scope]:checked",authorBlogPostsSelector:"input[name=author_blog_posts][type=checkbox]",authorBlogPostsHiddenSelector:"input[name=author_blog_posts][type=hidden]",hpUpdateFilterSelector:"#hp_update_filter"}),this.after("initialize",function(){this.on("submit",this.handleSubmit)}),this.handleSubmit=function(e){this.setUpdateFilterType(),this.setAuthorBlogPostsFlag(),this.broadcast("dataFiltersUpdated"),this.broadcast("dataUpdatesLoading")},this.setUpdateFilterType=function(){var e=this.select("updateScopeSelector").val();e.blank()&&(e="friends");var t=this.select("updateItemSelector").val(),n=e;t.blank()||(n=n+"-"+t),this.select("hpUpdateFilterSelector").val(n)},this.setAuthorBlogPostsFlag=function(){this.select("authorBlogPostsSelector").prop("checked")?this.select("authorBlogPostsHiddenSelector").val("1"):this.select("authorBlogPostsHiddenSelector").val("0")}},MixinEventUtils,withFormSubmission),$gr.shared.videoInline=flight.component(function(){this.defaultAttrs({height:315,width:560}),this.after("initialize",function(){this.on(".js-videoInline > a","click",this.playVideo)}),this.playVideo=function(e){var t=this.$node.data(),n=t.height||this.attr.height,i=t.width||this.attr.width;if("youtube"==t.source){var o=$j("<iframe>");o.attr({width:i,height:n,src:"//www.youtube.com/embed/"+t.sourceId+"?autoplay=1",frameborder:0,allowfullscreen:""}),this.$node.html(o),$j.post("/videos/update_views/"+t.goodreadsId),t.userChallengeId&&$j.post("/user_challenges/watched_video",{id:t.userChallengeId}),e.preventDefault()}}});var ViewportOverlay=flight.component(function(){var e,t=$gr&&$gr.touch?$gr.touch:"click",n="viewportOverlay",i="overlayId",o="overlay-scroll-lock",r={};this.defaultAttrs({channel:n,componentName:n,showClass:"show",disableDirectHide:!1}),this.after("initialize",function(){e||(e=$j("<div/>").addClass(n)),this.listen("show",this.onShow),this.listen("hide",this.onHide),this.listen("create",this.onCreate),this.listen("afterShow",function(e,t){this.toggleOverlayScrollSuppression(t.overlayId,!0)}),this.listen("beforeHide",function(e,t){this.toggleOverlayScrollSuppression(t.overlayId,!1)})}),this.hide=function(e){var t=this.getOverlayById(e);t&&(this.broadcast("beforeHide",{overlayId:e}),t.removeClass(this.attr.showClass),this.broadcast("afterHide",{overlayId:e}))},this.show=function(e){var t=this.getOverlayById(e);t&&(this.broadcast("beforeShow",{overlayId:e}),t.addClass(this.attr.showClass),this.broadcast("afterShow",{overlayId:e}))},this.onCreate=function(e,t){if(t&&t[i]){var n=t[i];n?this.getOverlayById(n)?this.broadcastError("overlay already exists for id: "+n):this.createOverlay(n,t.attr||null):this.broadcastError("could not create overlay, no id specified")}},this.onHide=function(e,t){t&&t[i]&&this.hide(t[i])},this.onShow=function(e,t){t&&t[i]&&this.show(t[i])},this.createOverlay=function(n,i){var s=i||{},a=e.clone();a.attr("id",n),"string"==typeof s.className&&a.addClass(s.className),s.disableDirectHide||a.on(t,$j.proxy(function(e){e.preventDefault(),this.hide()},this)),s.disableScrollLock||a.data(o,!0),a.appendTo(document.body),r[n]=a},this.getOverlayById=function(e){return r[e]||null},this.toggleOverlayScrollSuppression=function(e,t){var n=this.getOverlayById(e);n&&n.data(o)&&this.trigger(document,t?"enableScrollLock":"disableScrollLock")}},MixinEventUtils),ViewportServices=flight.component(function(){var e="viewportServices";this.defaultAttrs({channel:e}),this.after("initialize",function(){return Modernizr.touchevents?(this.initializeScrollLockMode(),void this.on("hideBrowserAddressBar",function(e,t){var n=t===!0;if(n&&/\bAndroid\s+2\.(2|3)/.test(navigator.userAgent))window.scrollTo(0,0);else{var i=n?0:window.scrollY;window.scrollTo(0,i+1),setTimeout(function(){window.scrollTo(0,i-1)},0)}})):this.teardown()}),/**
   *  Initialize "scroll lock mode" service.
   *  This mode, when enabled, temporarily prevents user scrolling within the
   *  browser viewport. This can be useful for overlays that cover a portion or
   *  all of the browser viewport, in which case viewport scrolling can be
   *  detrimental to the UX.
   *  Note: USE WITH EXTREME CAUTION!
   *  @method initializeScrollLockMode
   */
this.initializeScrollLockMode=function(){this.on(document,"enableScrollLock",this.onEnableScrollLock),this.on(document,"disableScrollLock",this.onDisableScrollLock)},this.onDisableScrollLock=function(){this.toggleScrollLockMode(!1)},this.onEnableScrollLock=function(e,t){this.toggleScrollLockMode(!0,t)},this.toggleScrollLockMode=function(e,t){var n,i={};"string"==typeof t?(t=t.toLowerCase(),"x"===t?i={drag_block_horizontal:!0}:"y"===t&&(i={drag_block_vertical:!0}),n=$j.noop):n=function(e){e.preventDefault()};var o=$j(document.body).hammer(i),r=this.getSafeEventName("touchmove");e===!0?o.on(r,n):o.off(r)}},MixinEventUtils),WantToReadButton=flight.component(function(){var e="wtrButton",t=/^\s*$/;this.defaultAttrs({buttonSelector:".jsWTR",buttonActiveSelector:".jsWTR.wtrSelected",buttonInactiveSelector:".jsWTR:not(.wtrSelected)",menuCatalystSelector:".areaSecondary",buttonLoadingClass:"wtrLoading",buttonSelectedClass:"wtrSelected",dataAttrParamShelf:"async-param-shelf",dataAttrUrlAdd:"async-url-add",dataAttrUrlDelete:"async-url-delete",dataAttrUrlMore:"url-more",dataAttrCurrentShelf:"current-shelf",dataAttrReftag:"ref",eventAttrAction:"actionType",eventAttrButtonId:"buttonId",eventAttrIsBookShelved:"isBookShelved",eventAttrShelfName:"shelfName",eventAttrSeeMoreUrl:"moreUrl",eventAttrReftag:"ref",channel:e,componentName:e}),this.after("initialize",function(){var e=[this.attr.buttonInactiveSelector+" "+this.attr.menuCatalystSelector,this.attr.buttonActiveSelector].join(",");this.$node.on("click",e,$j.proxy(function(e){var t=$j(e.target).closest(this.attr.buttonSelector);this.requestMenuShow(t)},this)),this.on(document,"listItemSelected.wtrButtonMenu",this.onMenuItemSelected),this.listen("saveRatingSuccess.ratingStars",this.onRateSuccess),
// dynamic! It's a Rails async form/link. We need to listen at the
this.$node.on("ajax:success",this.attr.buttonSelector,$j.proxy(function(e,t){this.onSaveSuccess(t)},this)),this.$node.on("ajax:error",this.attr.buttonSelector,$j.proxy(function(e,t){var n=$j(e.target).closest(this.attr.buttonSelector);this.toggleButtonLoadingState(n,!1),this.onSaveError(t)},this)),this.$node.on("ajax:beforeSend",this.attr.buttonSelector,$j.proxy(function(e){var t=$j(e.target).closest(this.attr.buttonSelector);this.trigger(document,"shelving.wtrButtonMenu",this.createEventPayload(t)),this.toggleButtonLoadingState(t,!0)},this))}),this.requestMenuShow=function(e){e.length&&this.trigger(document,"requestShow.wtrButtonMenu",this.createEventPayload(e))},this.toggleButtonLoadingState=function(e,t){e&&e.length&&e.toggleClass(this.attr.buttonLoadingClass,t)},this.addToShelf=function(e,n){if(e&&e.length){var i=e.data(this.attr.dataAttrUrlAdd);if(i&&!t.test(i)){this.trigger(document,"shelving.wtrButtonMenu",this.createEventPayload(e));var o={},r=e.data(this.attr.dataAttrParamShelf);o[r]=n[this.attr.eventAttrShelfName];var s={ref:n[this.attr.eventAttrReftag]};this.save(this.addUrlParams(i,o),e,s)}}},this.removeFromShelves=function(e,n){var i=e.data(this.attr.dataAttrUrlDelete);if(i&&!t.test(i)){var o=n[this.attr.eventAttrReftag],r={ref:o.replace(/_wtres/,"_wtruns")};this.save(i,e,r)}},this.save=function(e,n,i){e&&!t.test(e)&&(this.toggleButtonLoadingState(n,!0),$j.ajax({url:e,type:"post",dataType:"json",context:this,timeout:15e3,success:this.onSaveSuccess,error:this.onSaveError,data:i,complete:function(){this.toggleButtonLoadingState(n,!1)}}))},this.onMenuItemSelected=function(e,t){var n=this.attr.eventAttrButtonId;if($j.isPlainObject(t)&&t[n]){var i=$j("#"+t[n]);if(i.length){var o=t[this.attr.eventAttrAction];switch(o){case"add":this.addToShelf(i,t);break;case"delete":this.removeFromShelves(i,t);break;default:this.broadcastError("unknown action '"+o+"'")}}}},this.onSaveError=function(e){this.defer(function(){this.authRedirect(e,$j.proxy(function(){var t="Unknown XHR failure when trying to save book to shelf.";e.status&&(t+=" , status code "+e.status),this.broadcastError(t)},this))},500)},this.onRateSuccess=function(e,t){this.updateWtrButtonUI(t)},this.updateWtrButtonUI=function(e){var t=$j(e.html);"true"==$j("#reg_path").val()&&t.find(".areaSecondary").hide();var n=this.getButtonId(t),i=$j("#"+n);t.length&&i.length&&i.replaceWith(t)},this.onSaveSuccess=function(e){var n=!1;if($j.isPlainObject(e))if(e.ok&&"string"==typeof e.html&&!t.test(e.html))this.updateWtrButtonUI(e);else{n=!0;var i=e.error||"unknown error when attempting to save";this.broadcastError(i)}else this.broadcastError("malformed JSON response when trying to save book to shelf");n&&$j("#flashMessages").trigger("addFlashMessage",["Your change has not been saved. Please refresh the page any try again.","error"])},this.addUrlParams=function(e,n){if(!e||t.test(e))this.broadcastError("baseUrl is null or empty",!0);else if($j.isPlainObject(n)){var i=$j.param(n);if(!t.test(i)){var o=e.indexOf("?")<0?"?":"&";return e+o+i}}else this.broadcastError("paramPairs is not an object",!0)},this.createEventPayload=function(e){if(e.length){var t={};return t[this.attr.eventAttrButtonId]=this.getButtonId(e),t[this.attr.eventAttrSeeMoreUrl]=e.data(this.attr.dataAttrUrlMore),t[this.attr.eventAttrIsBookShelved]=e.hasClass(this.attr.buttonSelectedClass),t[this.attr.eventAttrShelfName]=e.data(this.attr.dataAttrCurrentShelf),t[this.attr.eventAttrReftag]=e.data(this.attr.dataAttrReftag),t}},this.getButtonId=function(e){return e&&e.length?e.first().attr("id"):void 0}},MixinEventUtils,MixinAuthRedirect),WantToReadButtonMenu=flight.component(function(){var e="wtrButtonMenu",t=/^\s*$/;this.defaultAttrs({menuSelector:"#wtrButtonMenu",moreSelector:".more",showDeleteOptionClass:"showDeleteOption",dataAttrActionType:"action",dataAttrShelfName:"shelf",dataAttrReftag:"ref",dataAttrDeleteAction:"delete",channel:e,componentName:e}),this.after("initialize",function(){this.listen("requestShow",this.onRequestMenuShow),this.onSlideUpEvent("afterHide",this.onHideMenu),this.onSlideUpEvent("listItemSelected",this.onMenuItemSelected),this.on("click",{moreSelector:function(e){e.preventDefault();var t=$j(e.target).attr("href");this.hideSlideUpMenu(),this.defer(function(){location.href=t})}})}),this.onHideMenu=function(e){this.manageShelfVisualSelection(),this.updateMoreLink()},this.onMenuItemSelected=function(e,t){var n=$j(t).first();n.length&&n.data(this.attr.dataAttrActionType)&&(n.data(this.attr.dataAttrActionType)===this.attr.dataAttrDeleteAction?this.onDeleteRequest(n):this.broadcastSelection(n)),this.hideSlideUpMenu()},this.broadcastSelection=function(e){this.broadcast("listItemSelected",{buttonId:this.getButtonId(),actionType:e.data(this.attr.dataAttrActionType),shelfName:e.data(this.attr.dataAttrShelfName),ref:e.data(this.attr.dataAttrReftag)})},this.onDeleteRequest=function(e){this.trigger(document,"requestShow.mobileConfirmationMenu"),this.on(document,"listItemSelected.mobileConfirmationMenu",$j.proxy(function(t,n){if($j.isPlainObject(n)){switch(n.action){case this.attr.dataAttrDeleteAction:this.broadcastSelection(e);break;default:this.onRequestMenuShow({},this.getShowMenuData())}this.off(document,"listItemSelected.mobileConfirmationMenu")}},this))},this.onRequestMenuShow=function(e,n){var i;$j.isPlainObject(n)&&n.buttonId?i=n.buttonId:"string"==typeof n&&(i=n),i&&!t.test(i)?(this.setShowMenuData(n),this.manageShelfVisualSelection(n.shelfName),this.updateMoreLink(n.moreUrl),$j(this.attr.menuSelector).toggleClass(this.attr.showDeleteOptionClass,n.isBookShelved),this.updateReftags(n.ref),this.showSlideUpMenu()):this.broadcastError("cannot show, no button id specified")},this.getShowMenuData=function(){return this.showMenuData||{}},this.setShowMenuData=function(e){this.showMenuData=e||{}},this.clearButtonId=function(){this.setButtonId(null)},this.getButtonId=function(){return this.getShowMenuData().buttonId},this.manageShelfVisualSelection=function(e){var t=this.getListItems();if(t&&t.length){var n='[data-shelf="'+e+'"]';t.each($j.proxy(function(e,t){var i=$j(t);i.toggleClass(this.attr.slideUpItemSelectedClass,i.is(n))},this))}},this.setButtonId=function(e){this.getShowMenuData().buttonId=e},this.updateMoreLink=function(e){var n="#";("string"!=typeof e||t.test(e))&&(e=n),this.select("moreSelector").attr("href",e).css("visibility",e===n?"":"visible")},this.updateReftags=function(e){this.getListItems().each(function(t,n){var i=$j(n);i.attr("data-ref",e+"_wtres")})}},MixinEventUtils,withSlideUpMenu);